# Методология исследований в проекте Quanto

## Преамбула

### 1. Цель исследований

Основная цель проекта **Quanto** — создание универсальной платформы для алготрейдинга, прогнозирования цен и количественного анализа финансовых рынков. Проект охватывает широкий спектр задач: от анализа технических индикаторов до машинного обучения и разработки торговых стратегий.

### 2. Пример исследования: Анализ индикатора MACD

Данный документ описывает методологию на примере исследования индикатора MACD. Цель этого конкретного исследования — провести глубокий количественный анализ индикатора MACD и его взаимосвязи с движением цены для выявления статистически значимых закономерностей ("альфы" или ее компонентов).

### 3. Задачи анализа (на примере MACD)

- **Сегментация:** Разбить историю ценового движения на "зоны" на основе знака MACD.
- **Извлечение признаков:** Для каждой зоны рассчитать исчерпывающий набор метрик, описывающих как сам индикатор, так и поведение цены внутри зоны.
- **Статистический анализ:** Изучить распределения полученных признаков, выявить аномалии и статистически значимые различия (например, между бычьими и медвежьими зонами).
- **Проверка гипотез:** Сформулировать и проверить торговые гипотезы, связывающие характеристики зон с последующим поведением цены.
- **Оценка робастности:** Проверить найденные закономерности на устойчивость к изменению параметров и на данных, не участвовавших в обучении.

### 4. Скоуп и ограничения (на примере MACD)

Данное исследование сфокусировано **исключительно на индикаторе MACD** как пример методологии. Мы сознательно не используем другие индикаторы (например, RSI, Bollinger Bands) или внешние данные (например, объемы торгов, новостной фон).

**Подход:** "Изолированный анализ". Цель — максимально глубоко понять, какую информацию можно извлечь из одного только MACD. Этот этап является примером методологии для серии исследований. В дальнейшем, после аналогичного анализа других факторов, будет проводиться их комбинированный анализ для построения комплексных торговых стратегий.

### 5. Универсальность подхода

Представленная методология может быть применена к любому техническому индикатору или комбинации индикаторов. Проект **Quanto** предоставляет универсальную инфраструктуру для проведения подобных исследований на различных финансовых инструментах.

---

## Предварительная подготовка

## Нормализация признаков.

**Проблема:** Амплитуда `MACD` или движение цены в пунктах сильно зависят от волатильности и текущей цены инструмента. Зона с размахом в 100 пунктов во время боковика — это много, а во время тренда — мало.
Решение: Нормализуйте признаки с помощью `ATR` (Average True Range). Например, вместо `max_price - entry_price` используйте `(max_price - entry_price) / ATR_at_entry`. Так вы будете сравнивать все зоны в "одинаковых единицах" волатильности. Это сделает модель более робастной.

## Дополнительные признаки
## 1. Определение "зон"

**Зона** — непрерывный отрезок времени, где:

- MACD > 0 (бычья зона)
- MACD < 0 (медвежья зона)

**Границы зоны:**
- **Начало:** пересечение нуля снизу вверх (для бычьей) или сверху вниз (для медвежьей)
- **Конец:** обратное пересечение

### 2.1 Обработка пограничных случаев
- **Минимальная длительность:** Зоны короче 2 баров считаются шумом и исключаются из анализа
- **MACD=0:** Трактуется как продолжение текущей зоны (не инициирует новую зону)
- **Гэпы:** При расчете ATR использовать истинный диапазон (True Range) для корректной нормализации

---

## 2. Новые признаки

Для каждой зоны считаем:

- **Длительность** (в барах или времени)
- **Амплитуда:**
    - Максимальное/минимальное значение MACD в зоне
    - Средний наклон гистограммы
- **Сопровождающее движение цены:**
    - Общий возврат (например, `close[end] / close[start] - 1`)
    - Посчитать разницу цен между началом и концом зоны — важно, но важнее знать, какое максимальное (минимальное для продаж) значение цены принимали в зоне. И еще более важно знать, какие были ходы вверх от впадин (вниз от пиков для зоны продаж) внутри зоны

**Уточнённые метрики для зон:**

- Для бычьей зоны (MACD > 0):
    - `max_price` — максимальная цена в зоне (пик)
    - `drawdown_from_peak` — просадка от пика до конца зоны (`close[end] / max_price - 1`)
    - `intra_zone_rally` — максимальный ход вверх от локального минимума внутри зоны (например, самый сильный отскок)
- Для медвежьей зоны (MACD < 0):
    - `min_price` — минимальная цена в зоне (дно)
    - `rally_from_trough` — отскок от дна до конца зоны (`close[end] / min_price - 1`)
    - `intra_zone_drop` — максимальный ход вниз от локального максимума внутри зоны
    - Максимальная просадка (drawdown)

**Зачем это нужно?**
- Если в бычьей зоне цена сильно откатывает от пика перед пересечением MACD вниз — это может сигнализировать о слабости тренда
- Если внутри зоны были резкие отскоки/падения — это помогает оценить волатильность и силу движения

### Расширенные метрики (анализ внутренней структуры цены)

Эти метрики позволяют глубже понять *характер* движения цены внутри зоны, а не только ее крайние точки.

**1. Метрики диапазона (Range Metrics):**

- **Для бычьей зоны:**
    - `min_price_in_zone` — минимальная цена, достигнутая внутри зоны.
    - `full_amplitude_abs` — полный размах цены в зоне (`max_price - min_price_in_zone`).
    - `full_amplitude_pct` — полный размах в процентах (`(max_price / min_price_in_zone) - 1`).
- **Для медвежьей зоны:**
    - `max_price_in_zone` — максимальная цена, достигнутая внутри зоны.
    - `full_amplitude_abs` — (`max_price_in_zone - min_price`).
    - `full_amplitude_pct` — (`(min_price / max_price_in_zone) - 1`).

**2. Анализ свингов (Swing Analysis):**

Используя алгоритм для поиска локальных экстремумов (например, ZigZag), можно разбить движение цены внутри зоны на последовательность свингов (импульсов и коррекций).

- **Что извлекаем:**
    - `num_swings` — количество свингов (импульс+коррекция). Помогает отличить плавный тренд от "рваного".
    - `avg_rally_pct` / `avg_drop_pct` — средний размер импульсов / коррекций в процентах.
    - `max_rally_pct` / `max_drop_pct` — максимальный импульс / коррекция.
    - `rally_to_drop_ratio` — отношение средней амплитуды импульса к средней амплитуде коррекции. Высокое значение (>2-3) говорит о сильном тренде.

**3. Метрики времени и скорости (Timing & Velocity Metrics):**

- `time_to_peak_ratio` — отношение времени от начала зоны до ценового пика ко всей длине зоны. Значение `0.2` означает, что пик был достигнут в первые 20% времени.
- `peak_macd_time_ratio` — то же самое, но для пика значения линии MACD или гистограммы.

**4. Метрики согласованности (Congruence Metrics):**

- `price_hist_corr` — корреляция Пирсона между ценой (`close`) и гистограммой MACD внутри зоны. Высокая положительная корреляция (>0.7) — признак здорового тренда. Низкая или отрицательная — признак скрытой дивергенции.

**Важное замечание по нормализации:**

Все метрики, связанные с амплитудой цены или значениями MACD (`full_amplitude_abs`, `avg_rally_pct` и т.д.), должны быть нормализованы для сопоставимости.
- **Способ 1 (процентный):** Рассчитывать как процент от цены входа в зону.
- **Способ 2 (волатильность):** Делить абсолютное значение на `ATR` на момент начала зоны. Этот способ часто предпочтительнее, так как учитывает рыночную волатильность.

### 3.4 Метрики дивергенций
- **Тип дивергенции:** 
  - Регулярная (цена обновляет экстремум, MACD - нет)
  - Скрытая (MACD обновляет экстремум, цена - нет)
- **Сила дивергенции:** 
  `|price_slope - macd_slope| * duration`

### 3.5 Метрики объема
- `volume_change_entry` - % изменение объема при входе в зону относительно среднего объема
- `volume_zone_ratio` - отношение среднего объема в зоне к объему в предыдущих N периодах
- `volume_macd_corr` - корреляция между объемом и изменением гистограммы MACD

---

# Анализ распределения длин зон MACD (концептуальный план)

## 1. Анализ распределений

### a) Описательная статистика

- Средняя/медианная длительность зон
- Разница между бычьими и медвежьими зонами
    - Зачем и как выявлять эту разницу?
    - Что сравниваем:
        - Среднюю/медианную длину зон
        - Амплитуду MACD (насколько сильным было движение)
        - Возврат цены (насколько цена выросла/упала за зону)

**Зачем это нужно?**
- Если бычьи зоны статистически длиннее медвежьих — это может указывать на асимметрию рынка (например, "бычьи тренды длятся дольше")
- Если в медвежьих зонах большая волатильность — это может влиять на риск-менеджмент

**Как использовать?**
- Настраивать разные параметры для лонгов и шортов (например, тейк-профит или стоп-лосс)

### b) Визуализация

- Гистограммы длин зон (отдельно для >0 и <0)
- QQ-plot для проверки на нормальность

### c) Тесты на стационарность

- Тест Дики-Фуллера (ADF): есть ли зависимость длин от времени?
    - непонятно что здесь ищем / в чем смысл?
    - **c.1) Тест Дики-Фуллера (ADF)**
    **Смысл:** Мы хотим понять, можно ли доверять средним значениям, посчитанным за всю историю. Тест на стационарность проверяет, не "сломался" ли рынок со временем.

    Пример: Допустим, мы посчитали, что средняя длина бычьей зоны за последние 10 лет — 15 дней. Мы хотим использовать это для тейк-профита. Но что, если за последние 2 года из-за роста HFT-торговли и общей волатильности рынок изменился, и теперь средняя длина зоны — всего 5 дней? Наша "историческая" средняя в 15 дней стала бесполезной и опасной.
    Тест ADF как раз и помогает это выяснить. Если он говорит, что ряд длин "нестационарный", это значит, что его среднее значение "плавает" во времени, и использовать общую среднюю нельзя.
        - Что проверяем: Меняется ли средняя длина зон со временем (например, из-за смены рыночного режима)
        - Пример: Если раньше зоны длились в среднем 5 дней, а теперь 3 — это может значить, что рынок стал более волатильным
        - Как использовать? Адаптировать стратегию: например, уменьшать таймфрейм для входов
    - **c.2) Если зоны становятся короче/длиннее**
        - Практическое применение:
            - Если зоны укоротились → рынок в боковике → переключиться на стратегию внутри дня
            - Если зоны удлинились → сильный тренд → держать позиции дольше
            - Если зоны становятся короче/длиннее — это важно для стратегии
            - непонятно в целом — что это и как использовать

---

## 2. Проверка гипотез

- **Гипотеза 1:** "Длинные зоны (>N бар) чаще заканчиваются разворотом"
    - Метод: разбить зоны на квартили по длине → сравнить средний возврат после окончания
    - что за вопрос? ведь любые зоны всегда заканчиваются разворотом
    - Уточнение:
        - Не просто "разворот" (пересечение нуля), а сильное движение в обратную сторону
        - Например: после окончания бычьей зоны цена падает на X% в течение M дней
    - Как считать:
        - Разделить зоны на короткие/длинные (по медиане)
        - Проверить: какая группа чаще даёт откат >2% после окончания
    Сама по себе формулировка тривиальна. Важно именно уточнение: речь идет не о смене знака индикатора, а о сильном ценовом движении после этого. Гипотеза становится такой: "После аномально длинных зон следует более сильное и продолжительное движение цены в обратную сторону". И это уже очень нетривиально и полезно для торговли.

- **Гипотеза 2:** "Зоны с крутым наклоном гистограммы короче"
    - Метод: корреляция (наклон vs длительность)
        - Берем максимальный наклон гистограммы в зоне (не средний!)
        - Например: если гистограмма росла со скоростью >0.5 в день → зона, скорее всего, короткая
    - Как использовать?
        - Если гистограмма резко растёт → готовиться к скорому развороту

- **Гипотеза 3:** "После аномально длинных зон следует более сильное движение цены в обратном направлении".
    - **Уточнение:** "Разворот" здесь — это не просто пересечение нуля индикатором (это происходит всегда), а значимое ценовое движение. Например: после окончания длинной бычьей зоны цена падает на X% в течение M баров.
    - **Метод:**
        - Разделить зоны на "нормальные" и "длинные" (например, по 80-му перцентилю длины).
        - Сравнить средний/медианный возврат цены за N баров *после* окончания зоны для обеих групп.

- **Гипотеза 4:** "Зоны с высокой корреляцией цены и гистограммы MACD имеют меньшую просадку"
    - **Метод:** Разделить зоны по уровню `price_hist_corr` (>0.7 vs <0.3) и сравнить средний `drawdown_from_peak`
    - **Практическое применение:** Использовать как фильтр качества сигнала

- **Гипотеза 5:** "Зоны, начинающиеся у уровней поддержки/сопротивления, имеют иную длительность"
    - **Метод:** Определить уровни (например, через Pivot Points) и сравнить длительность зон, начинающихся вблизи уровней

### 5.5 Анализ событий
- **Метод:** 
  - Пометить зоны, содержащие макро-события (FOMC, NFP) 
  - Сравнить метрики зон с событиями и без
- **Гипотеза:** 
  "Зоны с макро-событиями имеют повышенную волатильность и сокращенную длительность"

---

## 3. Моделирование зависимостей

- **Регрессия:**
    - `length ~ amplitude + volatility + prior_zone_length`

- **Цепь Маркова:**
    - Вероятность перехода:
        - Из "короткой бычьей" → в "длинную медвежью"
        - что за вопрос:? ведь всегда перейдем из короткой в длинную.
        Верное замечание, которое возникает из-за неполного определения "состояний". Идея в том, чтобы классифицировать зоны по нескольким параметрам (например, длина + тип) и смотреть на переходы между этими классами.

    Состояния: Не "короткая" -> "длинная", а, например:
    Короткая бычья зона  
    Длинная бычья зона  
    Короткая медвежья зона  
    Длинная медвежья зона  
    Вопрос: Какова вероятность, что после "Длинной бычьей зоны" наступит "Короткая медвежья", а не "Длинная медвежья"? Это помогает понять "ритм" рынка. Например, если после долгого тренда обычно наступает лишь короткая коррекция, это можно использовать для входа в позицию по основному тренду.  
    - Уточнение модели:
        - Состояния: короткая/длинная бычья/медвежья зона
        - Переходы:
            - Вероятность, что после короткой бычьей → будет длинная медвежья
            - Вероятность, что зоны чередуются (бычья → медвежья → бычья)
    - Зачем это нужно?
        - Предсказывать тип следующей зоны → например:
            - Если была длинная бычья зона → с вероятностью 70% следующая — короткая медвежья

**Как использовать?**
- Добавлять фильтр в стратегию:
    - Если высокая вероятность длинной медвежьей зоны → не открывать лонги

---

## 3.5 Анализ последовательностей и форм зон (Паттерн-анализ)

Этот раздел развивает идею анализа от отдельных зон к их последовательностям и внутренним формам, что позволяет выявлять более сложные рыночные паттерны.

### а) Классификация формы зоны (Zone Shape Classification)

- **Идея:** "Бугры" гистограммы MACD имеют разную форму, которая может нести информацию о характере рыночного движения.
- **Метод:**
    1.  **Инжиниринг признаков формы:** Для гистограммы каждой зоны рассчитать метрики, описывающие ее форму:
        - `skewness` (асимметрия): смещен ли пик к началу/концу зоны.
        - `kurtosis` (эксцесс): "острота" или "плоскость" пика.
        - `num_internal_peaks`: количество локальных экстремумов внутри зоны (помогает отличить гладкий бугор от "двойной вершины").
        - `smoothness`: гладкость кривой (например, std от `histogram.diff()`).
    2.  **Кластеризация:** Применить алгоритм кластеризации (например, K-Means) к этим признакам, чтобы сгруппировать все зоны в несколько (3-5) архетипов формы (например, "Резкий импульс", "Плавный тренд", "Затухающая волна").

### б) Анализ последовательностей зон (Zone Sequence Analysis)

- **Идея:** Характер текущей зоны может зависеть от характеристик предыдущих зон. Определенные последовательности зон могут формировать устойчивые паттерны.
- **Метод 1: N-gram анализ:**
    - После кластеризации присвоить каждой зоне метку ее типа (например, `Smooth_Bull`, `Spiky_Bear`).
    - Анализировать частоту встречаемости последовательностей (биграмм, триграмм). Например, "Какова вероятность, что после `Smooth_Bull` последует `Spiky_Bear`?".
- **Метод 2: Lookback-признаки:**
    - Для каждой зоны `N` создать признаки, описывающие зону `N-1` (`prev_zone_duration`, `prev_zone_shape_type` и т.д.).
    - Использовать эти признаки в регрессионных или классификационных моделях для предсказания характеристик текущей зоны.
- **Проверка гипотез:**
    - **Гипотеза (из примера):** "Последовательность из 2+ зон типа 'Плавный тренд' с низкой амплитудой соответствует боковому движению цены (флэту)".
    - **Проверка:** Идентифицировать такие последовательности и измерить волатильность цены (или `ADX`) в этих периодах. Сравнить со средним значением по всей выборке.

---

## 4. Связь с будущей динамикой

- Что происходит после окончания зоны?
    - Например: "Если зона >0 длилась 10+ дней, то после пересечения нуля вниз цена падает в 60% случаев"

---

## 5. Интеграция в стратегию

- **Фильтр для входа:**
    - "Входить в лонг только если предыдущая медвежья зона была короче 5 дней"
- **Тейк-профит:**
    - "Если длительность текущей зоны >90% перцентиля — закрывать позицию"

---

## 8. Валидация и повышение робастности

Любые найденные закономерности необходимо проверить на прочность, чтобы убедиться, что они не являются случайной находкой на исторических данных (переобучение).

### a) Out-of-Sample / Walk-Forward валидация

- **Проблема:** Правила, идеально работающие на всей истории, могут провалиться в будущем.
- **Решение:**
    - **Out-of-Sample:** Разделить данные на обучающий (in-sample, например, 70% данных) и тестовый (out-of-sample, 30% данных) наборы. Все гипотезы и правила разрабатываются на обучающем наборе, а затем их прибыльность проверяется на тестовом, "невиданном" наборе.
    - **Walk-Forward:** Более сложный метод, имитирующий реальную торговлю. Модель обучается на периоде [1..N], торгует на [N+1], затем переобучается на [1..N+1] и торгует на [N+2], и так далее.

### b) Анализ чувствительности к параметрам

- **Проблема:** Выводы могут быть верны только для стандартных параметров MACD (12, 26, 9).
- **Решение:** Повторить ключевые части анализа (например, распределение длин) для других наборов параметров (например, более быстрых `5, 20, 5` и более медленных `25, 50, 10`). Если выводы (например, "бычьи зоны длиннее медвежьих") сохраняются, они более робастны.

### c) Учёт глобального рыночного режима

- **Проблема:** Характеристики зон MACD могут кардинально отличаться в глобальном бычьем и медвежьем тренде.
- **Решение:** Добавить фильтр по глобальному тренду (например, цена выше/ниже своей 200-дневной скользящей средней). Проводить анализ раздельно для каждого режима.
- **Пример гипотезы:** "В глобальном бычьем тренде (цена > SMA200) бычьи зоны MACD в среднем в 2 раза длиннее медвежьих, а в глобальном медвежьем тренде это соотношение выравнивается".

### d) Бенчмаркинг
- **Наивная стратегия:** 
  Сравнение с базовой стратегией "Long при MACD>0, Short при MACD<0"
- **Тест случайного блуждания:** 
  Проверка статистической значимости против синтетических данных
- **Кросс-активность:** 
  Тестирование на 3+ классах активов (индексы, товары, валюты)


## Пример вывода (без кода)

- **Распределение длин:**
    - Бычьи зоны: в среднем 7 дней (медиана 5)
    - Медвежьи: в среднем 5 дней (медиана 4)
- **Аномалии:**
    - Зоны длиннее 15 дней встречаются редко (1%), но после них сильный откат
- **Наклон гистограммы:**
    - Если гистограмма растёт быстрее +2 std — зона обычно короче
- **Торговое правило:**
    - После зоны >10 дней ставить тейк-профит на 2×ATR

---

## Поэтапный план разработки (Двухтрековая архитектура)

Данный план реализуется в двух параллельных треках:

### Архитектура проекта:

1. **Скриптовый трек** (`nb/macd_analysis_functions.py`)
   - Подкапотная логика и функции
   - Модульная архитектура
   - Переиспользуемые компоненты

2. **Исследовательский трек** (`nb/macd_analysis.ipynb`)
   - Поэтапный ход исследования
   - Визуализация и графики
   - Интерпретация результатов
   - Итеративная разработка

### Итеративная методология:

Каждый этап проходит через цикл:
1. **Разработка** - создание/доработка функций
2. **Интеграция** - внедрение в ноутбук
3. **Верификация** - проверка и уточнения
4. **Переход** к следующему этапу

---

**Этап 1: Инициализация и загрузка данных**

**Скриптовый трек:**
1. Импорт библиотек: `pandas`, `numpy`, `matplotlib`, `seaborn`, `pandas_ta`, `statsmodels`.
2. Функция загрузки данных с проверкой структуры
3. Предварительная обработка: проверка на пропуски, коррекция часовых поясов

**Исследовательский трек:**
1. Создание ноутбука с описанием исследования
2. Ячейка загрузки и проверки данных
3. Визуализация структуры данных
4. Описание выбранного инструмента и периода

---

**Этап 2: Расчет индикаторов и определение зон**

**Скриптовый трек:**
1. Функция расчета MACD (линия, гистограмма, сигнал) и ATR
2. Функция определения границ зон:
   - Создание колонки `position` (`1` для MACD > 0, `-1` для MACD < 0)
   - Определение точек смены знака
   - Создание списка зон с метаданными
3. Обработка пограничных случаев (минимальная длительность)

**Исследовательский трек:**
1. Визуализация MACD и выделенных зон
2. Анализ распределения зон по типам
3. Статистика по длительности зон
4. Интерпретация результатов

---

**Этап 3: Инжиниринг признаков (Feature Engineering)**

**Скриптовый трек:**
1. Функция расчета базовых метрик (длительность, пики MACD)
2. Функция расчета метрик движения цены (`drawdown_from_peak` и т.д.)
3. Функция расчета расширенных метрик:
   - Диапазон и свинги (на основе `scipy.signal.find_peaks`)
   - Метрики времени и скорости
   - Метрики согласованности
4. Функция расчета метрик дивергенций и объема
5. Нормализация с помощью ATR
6. Кэширование промежуточных результатов

**Исследовательский трек:**
1. Анализ распределения признаков
2. Визуализация корреляций между признаками
3. Выявление аномалий и выбросов
4. Интерпретация значимых признаков

---

**Этап 4: Описательный анализ и визуализация**

**Скриптовый трек:**
1. Функция анализа распределения зон
2. Функция расчета описательных статистик
3. Функция тестирования на стационарность (ADF)

**Исследовательский трек:**
1. Гистограммы длин зон (отдельно для бычьих и медвежьих)
2. Box-plot'ы для сравнения распределений
3. QQ-plot'ы для проверки на нормальность
4. Визуализация результатов теста на стационарность
5. Интерпретация статистических различий

---

**Этап 5: Проверка гипотез**

**Скриптовый трек:**
1. Функция проверки гипотезы 1 (длина зоны и разворот):
   - Расчет будущего возврата цены
   - Группировка по перцентилям длины
   - Статистические тесты
2. Функция проверки гипотезы 2 (наклон гистограммы и длина)
3. Функция проверки гипотезы 3 (корреляция и просадка)
4. Функция проверки гипотез 4-5 (уровни и события)
5. Интеграция календаря макро-событий

**Исследовательский трек:**
1. Визуализация результатов гипотез
2. Интерпретация статистической значимости
3. Практические выводы для торговли
4. Анализ исключений и аномалий

---

**Этап 6: Моделирование**

**Скриптовый трек:**
1. Функция построения OLS-регрессии для предсказания длины зоны
2. Функция анализа цепей Маркова:
   - Категоризация зон
   - Построение матрицы переходов
3. Функция кластеризации форм зон

**Исследовательский трек:**
1. Визуализация матрицы переходов (heatmap)
2. Анализ кластеров форм зон
3. Интерпретация паттернов и последовательностей
4. Практические выводы

---

**Этап 6.5: Расширенный анализ паттернов**

**Скриптовый трек:**
1. Функция детальной классификации форм (`skew`, `kurtosis`)
2. Функция N-gram анализа последовательностей
3. Функция анализа рыночных режимов (ADX)

**Исследовательский трек:**
1. Визуализация форм зон
2. Анализ частых последовательностей
3. Связь с рыночными режимами
4. Проверка гипотезы о флэте

---

**Этап 7: Валидация**

**Скриптовый трек:**
1. Функция Out-of-Sample валидации
2. Функция Walk-Forward валидации
3. Функция анализа чувствительности к параметрам
4. Функция бенчмаркинга
5. Функция теста Монте-Карло
6. Функция кросс-активности тестирования

**Исследовательский трек:**
1. Визуализация результатов валидации
2. Сравнение с бенчмарками
3. Анализ робастности результатов
4. Интерпретация ограничений

---

**Этап 8: Интеграция в стратегию**

**Скриптовый трек:**
1. Функции торговых правил
2. Функции фильтров входа
3. Функции настройки тейк-профита
4. Функция бэктестинга

**Исследовательский трек:**
1. Бэктестинг стратегий
2. Анализ результатов торговли
3. Сравнение с наивными стратегиями
4. Финальные выводы и рекомендации

---

### Критерии готовности к переходу между этапами:

- **Скриптовый трек:** Все функции реализованы и протестированы
- **Исследовательский трек:** Визуализация и интерпретация завершены
- **Верификация:** Результаты проверены и одобрены
- **Документация:** Код прокомментирован, результаты задокументированы
