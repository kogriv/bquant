# –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –ø–æ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—é BQuant

> üí° **–î–ª—è –∫–æ–≥–æ —ç—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç?**
>
> –ò—Å—á–µ—Ä–ø—ã–≤–∞—é—â–µ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ä–∞–±–æ—Ç–µ —Å –∫—ç—à–µ–º: –≥–¥–µ —Ö—Ä–∞–Ω–∏—Ç—Å—è, –∫–∞–∫ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å, –∫–æ–≥–¥–∞ –æ—á–∏—â–∞—Ç—å –∏ –∫–∞–∫ –æ—Ç–ª–∞–∂–∏–≤–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—ã.

## 1. –û–±–∑–æ—Ä –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è

BQuant –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **–¥–≤—É—Ö—É—Ä–æ–≤–Ω–µ–≤—É—é** —Å–∏—Å—Ç–µ–º—É –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è:

| –£—Ä–æ–≤–µ–Ω—å | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ | –†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ |
| :--- | :--- | :--- |
| **Memory** | –ë—ã—Å—Ç—Ä—ã–π –¥–æ—Å—Ç—É–ø, LRU-—ç–≤–∏–∫—Ü–∏—è –ø—Ä–∏ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–∏ | RAM –ø—Ä–æ—Ü–µ—Å—Å–∞ |
| **Disk** | –î–æ–ª–≥–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –º–µ–∂–¥—É –∑–∞–ø—É—Å–∫–∞–º–∏ | `~/.cache/bquant/` |

–ú–µ–Ω–µ–¥–∂–µ—Ä –∫—ç—à–∞ (`CacheManager`) –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç –æ–±–∞ —É—Ä–æ–≤–Ω—è: –ø—Ä–∏ `get()` —Å–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –ø–∞–º—è—Ç—å, –ø—Ä–∏ –ø—Ä–æ–º–∞—Ö–µ ‚Äî –¥–∏—Å–∫. –ü—Ä–∏ –∑–∞–ø–∏—Å–∏ –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –∏ –≤ –ø–∞–º—è—Ç—å, –∏ –Ω–∞ –¥–∏—Å–∫ (–µ—Å–ª–∏ –≤–∫–ª—é—á—ë–Ω –¥–∏—Å–∫–æ–≤—ã–π –∫—ç—à).

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

- **`bquant.core.cache`** ‚Äî –æ–±—â–∏–π –º–µ–Ω–µ–¥–∂–µ—Ä (`CacheManager`), `MemoryCache`, `DiskCache`, `get_cache_manager()`, `clear_cache()`, `cache_stats()`.
- **`bquant.analysis.zones.cache.ZoneAnalysisCache`** ‚Äî —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –æ–±—ë—Ä—Ç–∫–∞ –¥–ª—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∞–Ω–∞–ª–∏–∑–∞ –∑–æ–Ω (–≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ, —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–ª—é—á–µ–π).

## 2. –ì–¥–µ —Ö—Ä–∞–Ω–∏—Ç—Å—è –∫—ç—à

### –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

```
~/.cache/bquant/
```

–§–∞–π–ª—ã zone analysis: `zone_analysis_<hash>.pkl` (pickle).

### –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é

```python
from bquant.core.config import CACHE_CONFIG, get_cache_config

# –¢–µ–∫—É—â–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
config = get_cache_config()
# {'enable_memory_cache': True, 'enable_disk_cache': True, 'memory_size': 100, ...}
```

–ü–∞—Ä–∞–º–µ—Ç—Ä `cache_dir` –≤ `CACHE_CONFIG` (`bquant.core.config`) –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `None` ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `Path.home() / ".cache" / "bquant"`.

## 3. –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ Zone Analysis

### –í–∫–ª—é—á–µ–Ω–∏–µ –∏ –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ

–ö—ç—à **–≤–∫–ª—é—á—ë–Ω –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é**. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ fluent API:

```python
from bquant.analysis.zones import analyze_zones

# –° –∫—ç—à–µ–º (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
result = analyze_zones(df).detect_zones(...).build()

# –û—Ç–∫–ª—é—á–∏—Ç—å –∫—ç—à (–¥–ª—è —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–æ–≤, –æ—Ç–ª–∞–¥–∫–∏)
result = analyze_zones(df).with_cache(enable=False).detect_zones(...).build()

# –ö—ç—à —Å TTL 2 —á–∞—Å–∞
result = analyze_zones(df).with_cache(ttl=7200).detect_zones(...).build()
```

### –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–ª—é—á–∞ –∫—ç—à–∞

–ö–ª—é—á –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –æ–¥–Ω–æ–∑–Ω–∞—á–Ω–æ –∏ –≤–∫–ª—é—á–∞–µ—Ç:

1. **CACHE_VERSION** (—Å–µ–π—á–∞—Å 2) ‚Äî –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ö–µ–º—ã —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞.
2. **–•–µ—à –¥–∞–Ω–Ω—ã—Ö** ‚Äî OHLCV-–∫–æ–ª–æ–Ω–∫–∏ (`open`, `high`, `low`, `close`).
3. **–ü–æ–¥–ø–∏—Å—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏** ‚Äî –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä, –¥–µ—Ç–µ–∫—Ü–∏—è, `swing_scope`, –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è, —Ä–µ–≥—Ä–µ—Å—Å–∏—è, –≤–∞–ª–∏–¥–∞—Ü–∏—è.
4. **–ü–æ–¥–ø–∏—Å—å —Å–≤–∏–Ω–≥–æ–≤** ‚Äî –ø—Ä–µ—Å–µ—Ç, —Å—Ç—Ä–∞—Ç–µ–≥–∏—è, –∞–≤—Ç–æ-–ø–æ—Ä–æ–≥–∏ –∏ —Ç.–ø.

–ü—Ä–∏ –ª—é–±–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–∏ (–ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞, `swing_scope`, –ø—Ä–µ—Å–µ—Ç, —Å—Ç—Ä–∞—Ç–µ–≥–∏—è) –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è **–¥—Ä—É–≥–æ–π –∫–ª—é—á**. –°—Ç–∞—Ä—ã–µ –∑–∞–ø–∏—Å–∏ —Å –¥—Ä—É–≥–∏–º–∏ –∫–ª—é—á–∞–º–∏ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è ‚Äî –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Ä—É—á–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –Ω–µ –Ω—É–∂–Ω–∞.

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ –≤–µ—Ä—Å–∏–∏

–ü—Ä–∏ —á—Ç–µ–Ω–∏–∏ –∏–∑ –∫—ç—à–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è `cache_version` –≤ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö:

- –ï—Å–ª–∏ `cached_version < CACHE_VERSION` ‚Üí –∑–∞–ø–∏—Å—å –ø–æ–º–µ—á–∞–µ—Ç—Å—è –∫–∞–∫ —É—Å—Ç–∞—Ä–µ–≤—à–∞—è, —É–¥–∞–ª—è–µ—Ç—Å—è, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è `None` (–ø–µ—Ä–µ—Å—á—ë—Ç).
- –í –ª–æ–≥ –ø–∏—à–µ—Ç—Å—è: `"Cache invalidated due to schema upgrade (v1 ‚Üí v2). Recalculating..."`.

–†—É—á–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ **–Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞** ‚Äî —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ –∑–∞–ø–∏—Å–∏ –∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

## 4. –ö–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –æ—á–∏—â–∞—Ç—å –∫—ç—à

| –°–∏—Ç—É–∞—Ü–∏—è | –î–µ–π—Å—Ç–≤–∏–µ |
| :--- | :--- |
| –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –ø–∞–π–ø–ª–∞–π–Ω–∞ (–∏–Ω–¥–∏–∫–∞—Ç–æ—Ä, —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏, –ø—Ä–µ—Å–µ—Ç, scope) | **–ù–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è** ‚Äî –Ω–æ–≤—ã–π –∫–ª—é—á, –Ω–æ–≤—ã–µ –∑–∞–ø–∏—Å–∏ |
| –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ BQuant —Å –∏–∑–º–µ–Ω–µ–Ω–∏–µ–º —Å—Ö–µ–º—ã —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ | **–ù–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è** ‚Äî –∞–≤—Ço-–∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ –≤–µ—Ä—Å–∏–∏ |
| –ü–æ–¥–æ–∑—Ä–µ–Ω–∏–µ –Ω–∞ –±–∏—Ç—ã–µ/—É—Å—Ç–∞—Ä–µ–≤—à–∏–µ —Ñ–∞–π–ª—ã | –û—á–∏—Å—Ç–∏—Ç—å –≤—Ä—É—á–Ω—É—é |
| –û—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ –º–µ—Å—Ç–∞ –Ω–∞ –¥–∏—Å–∫–µ | –û—á–∏—Å—Ç–∏—Ç—å –≤—Ä—É—á–Ω—É—é |
| –û—Ç–ª–∞–¥–∫–∞ (–∏—Å–∫–ª—é—á–∏—Ç—å –≤–ª–∏—è–Ω–∏–µ –∫—ç—à–∞) | –û—Ç–∫–ª—é—á–∏—Ç—å –∫—ç—à `.with_cache(enable=False)` –∏–ª–∏ –æ—á–∏—Å—Ç–∏—Ç—å |

## 5. –ö–∞–∫ –æ—á–∏—â–∞—Ç—å –∫—ç—à

### –ü—Ä–æ–≥—Ä–∞–º–º–Ω–æ (–≤ –∫–æ–¥–µ)

```python
# –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ –∫—ç—à–∞ (–ø–∞–º—è—Ç—å + –¥–∏—Å–∫)
from bquant.core.cache import clear_cache
clear_cache()

# –ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è —Ç–æ–ª—å–∫–æ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –¥–∞—Ç–∞—Å–µ—Ç–∞ (—Ç—Ä–µ–±—É–µ—Ç –¥–æ—Å—Ç—É–ø –∫ pipeline)
from bquant.analysis.zones import analyze_zones
# ... –ø–æ—Å—Ç—Ä–æ–∏—Ç—å pipeline —Å enable_cache=True ...
# pipeline.invalidate_cache(df)  # —Ç—Ä–µ–±—É–µ—Ç —ç–∫–∑–µ–º–ø–ª—è—Ä ZoneAnalysisPipeline
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** `invalidate_cache(df)` ‚Äî –º–µ—Ç–æ–¥ `ZoneAnalysisPipeline`, –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ `build()` —á–µ—Ä–µ–∑ –≤–æ–∑–≤—Ä–∞—â—ë–Ω–Ω—ã–π pipeline. –ß–µ—Ä–µ–∑ fluent API –Ω–∞–ø—Ä—è–º—É—é –≤—ã–∑—ã–≤–∞—Ç—å –Ω–µ–ª—å–∑—è; –¥–ª—è –ø–æ–ª–Ω–æ–π –æ—á–∏—Å—Ç–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `clear_cache()`.

### –í—Ä—É—á–Ω—É—é (–≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ)

```bash
# –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ —Ñ–∞–π–ª—ã –∫—ç—à–∞ zone analysis
rm -rf ~/.cache/bquant/zone_analysis_*.pkl

# –û—á–∏—Å—Ç–∏—Ç—å –≤–µ—Å—å –∫—ç—à BQuant
rm -rf ~/.cache/bquant/*.pkl

# –£–¥–∞–ª–∏—Ç—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –∫—ç—à–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é
rm -rf ~/.cache/bquant
```

## 6. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫—ç—à–∞

### –ì–ª–æ–±–∞–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (`bquant.core.config`)

```python
CACHE_CONFIG = {
    'enable_memory_cache': True,
    'enable_disk_cache': True,
    'memory_size': 100,        # –º–∞–∫—Å. –∑–∞–ø–∏—Å–µ–π –≤ –ø–∞–º—è—Ç–∏ (LRU)
    'default_ttl': 3600,       # –≤—Ä–µ–º—è –∂–∏–∑–Ω–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (—Å–µ–∫—É–Ω–¥—ã)
    'cache_dir': None,         # None = ~/.cache/bquant
    'auto_cleanup': True,
    'cleanup_interval': 300,
}
```

–ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ç—Ä–µ–±—É–µ—Ç –ø—Ä–∞–≤–∫–∏ `bquant/core/config.py` –∏–ª–∏ –ø–æ–¥–º–µ–Ω—ã –¥–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –º–µ–Ω–µ–¥–∂–µ—Ä–∞.

### Per-pipeline –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

```python
result = (
    analyze_zones(df)
    .with_cache(enable=True, ttl=7200)  # 2 —á–∞—Å–∞
    .detect_zones(...)
    .build()
)
```

## 7. –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

```python
from bquant.core.cache import cache_stats, get_cache_manager

# –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
stats = cache_stats()
# {'memory': {'entries': 5, 'hits': 120, 'misses': 10, 'hit_rate': 92.3, ...},
#  'disk': {'entries': 5, 'cache_dir': '/home/user/.cache/bquant'}}

# –û—á–∏—Å—Ç–∫–∞ –∏—Å—Ç–µ–∫—à–∏—Ö –∑–∞–ø–∏—Å–µ–π
manager = get_cache_manager()
cleaned = manager.cleanup()
# {'memory_cleaned': 2, 'disk_cleaned': 1}
```

## 8. –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ Zone Analysis Cache

### –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –∫–ª—é—á–∞

- `version` ‚Äî CACHE_VERSION.
- `data` ‚Äî —Ö–µ—à OHLCV.
- `config` ‚Äî —Ö–µ—à `ZoneAnalysisConfig` (indicator, zone_detection, clustering, regression, validation, **swing_scope**).
- `swing` ‚Äî —Ö–µ—à –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Å–≤–∏–Ω–≥–æ–≤ (preset, —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏, –∞–≤—Ç–æ-–ø–æ—Ä–æ–≥–∏).

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

- **–ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è –∏ A/B-—Ç–µ—Å—Ç—ã:** `.with_cache(enable=False)` ‚Äî —á—Ç–æ–±—ã –Ω–µ —Å–º–µ—à–∏–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞–∑–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤.
- **–ü—Ä–æ–¥–∞–∫—à–µ–Ω –∏ –æ—Ç—á—ë—Ç—ã:** –æ—Å—Ç–∞–≤–∏—Ç—å –∫—ç—à –≤–∫–ª—é—á—ë–Ω–Ω—ã–º, –∑–∞–¥–∞—Ç—å `ttl` –ø–æ–¥ —á–∞—Å—Ç–æ—Ç—É –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö.
- **Lambda –∏ callable –≤ –ø—Ä–∞–≤–∏–ª–∞—Ö –¥–µ—Ç–µ–∫—Ü–∏–∏:** –∫—ç—à –º–æ–∂–µ—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞—Ç—å (callable –Ω–µ —Å–µ—Ä–∏–∞–ª–∏–∑—É–µ—Ç—Å—è –≤ –∫–ª—é—á) ‚Äî –≤ —Ç–∞–∫–∏—Ö —Å–ª—É—á–∞—è—Ö –æ—Ç–∫–ª—é—á–∞—Ç—å –∫—ç—à.

## 9. –°–≤—è–∑–∞–Ω–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã

- [Zone Analysis Guide](zone_analysis.md) ‚Äî —Ä–∞–∑–¥–µ–ª ¬´–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å¬ª
- [Best Practices](best_practices.md) ‚Äî —Ö—Ä–∞–Ω–µ–Ω–∏–µ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤ –∏ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
- [–ú–∏–≥—Ä–∞—Ü–∏—è global swings](../migration/global_swings_migration.md) ‚Äî –®–∞–≥ 3: –æ—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞ –ø—Ä–∏ –º–∏–≥—Ä–∞—Ü–∏–∏
- [API: bquant.core.config](../api/core/config.md) ‚Äî `get_cache_config()`, `CACHE_CONFIG`
