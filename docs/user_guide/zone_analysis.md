# ĞŸĞ¾Ğ»Ğ½Ñ‹Ğ¹ Ğ¿Ğ°Ğ¹Ğ¿Ğ»Ğ°Ğ¹Ğ½ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ° Ğ·Ğ¾Ğ½ BQuant

> ğŸ’¡ **Ğ˜Ñ‰ĞµÑ‚Ğµ ĞºĞ¾Ğ½Ñ†ĞµĞ¿Ñ‚ÑƒĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ¾Ğ±Ğ·Ğ¾Ñ€?**
>
> Ğ­Ñ‚Ğ¾Ñ‚ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚ â€” Ğ¾Ñ‡ĞµĞ½ÑŒ Ğ´ĞµÑ‚Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ, Ğ½Ğ¸Ğ·ĞºĞ¾ÑƒÑ€Ğ¾Ğ²Ğ½ĞµĞ²Ğ¾Ğµ Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ³Ğ¾ ÑˆĞ°Ğ³Ğ° Ğ¿Ğ°Ğ¹Ğ¿Ğ»Ğ°Ğ¹Ğ½Ğ°. Ğ”Ğ»Ñ Ğ±Ğ¾Ğ»ĞµĞµ Ğ²Ñ‹ÑĞ¾ĞºĞ¾ÑƒÑ€Ğ¾Ğ²Ğ½ĞµĞ²Ğ¾Ğ³Ğ¾ Ğ¸ ĞºĞ¾Ğ½Ñ†ĞµĞ¿Ñ‚ÑƒĞ°Ğ»ÑŒĞ½Ğ¾Ğ³Ğ¾ Ğ¿Ğ¾Ğ½Ğ¸Ğ¼Ğ°Ğ½Ğ¸Ñ Ğ»Ğ¾Ğ³Ğ¸ĞºĞ¸ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹, Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´ÑƒĞµĞ¼ ÑĞ½Ğ°Ñ‡Ğ°Ğ»Ğ° Ğ¿Ñ€Ğ¾Ñ‡Ğ¸Ñ‚Ğ°Ñ‚ÑŒ **[Ğ“Ğ»ÑƒĞ±Ğ¾ĞºĞ¾Ğµ Ğ¿Ğ¾Ğ³Ñ€ÑƒĞ¶ĞµĞ½Ğ¸Ğµ: ĞŸĞ°Ğ¹Ğ¿Ğ»Ğ°Ğ¹Ğ½ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ‚Ğ¾Ñ€Ğ° Ğ·Ğ¾Ğ½](../developer_guide/zone_analyzer_deep_dive.md)**.

Ğ­Ñ‚Ğ¾ Ñ€ÑƒĞºĞ¾Ğ²Ğ¾Ğ´ÑÑ‚Ğ²Ğ¾ Ğ¾Ğ¿Ğ¸ÑÑ‹Ğ²Ğ°ĞµÑ‚ Ğ¿Ğ¾Ğ»Ğ½Ñ‹Ğ¹ Ğ¿Ğ°Ğ¹Ğ¿Ğ»Ğ°Ğ¹Ğ½ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ° Ğ·Ğ¾Ğ½ Ğ² BQuant - Ğ¾Ñ‚ Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ° Ğ´Ğ¾ ĞºĞ¾Ğ½Ñ†Ğ°. Ğ’Ñ‹ ÑƒĞ·Ğ½Ğ°ĞµÑ‚Ğµ ĞºĞ°Ğº Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚ ĞºĞ°Ğ¶Ğ´Ñ‹Ğ¹ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹ Ğ¸ ĞºĞ°Ğº Ğ¾Ğ½Ğ¸ Ğ²Ğ·Ğ°Ğ¸Ğ¼Ğ¾Ğ´ĞµĞ¹ÑÑ‚Ğ²ÑƒÑÑ‚ Ğ¼ĞµĞ¶Ğ´Ñƒ ÑĞ¾Ğ±Ğ¾Ğ¹.

## ğŸ“š Ğ¡Ğ²ÑĞ·Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¼Ğ°Ñ‚ĞµÑ€Ğ¸Ğ°Ğ»Ñ‹

- [Best Practices Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ° Ğ·Ğ¾Ğ½](best_practices.md) â€” Ğ¿Ñ€Ğ°ĞºÑ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ğ¸ Ğ¿Ğ¾ Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ñ Ğ°Ñ€Ñ‚ĞµÑ„Ğ°ĞºÑ‚Ğ¾Ğ² Ğ¸ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒĞ½Ğ¾Ğ¼Ñƒ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ.
- [ĞœĞ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ñ Ğ½Ğ° Universal Zone Analysis v2](../migration/MIGRATION_v2.md) â€” Ğ¿ĞµÑ€ĞµÑ…Ğ¾Ğ´ ÑĞ¾ ÑÑ‚Ğ°Ñ€Ğ¾Ğ³Ğ¾ `MACDZoneAnalyzer` Ğ½Ğ° Ğ½Ğ¾Ğ²Ñ‹Ğ¹ Ğ¿Ğ°Ğ¹Ğ¿Ğ»Ğ°Ğ¹Ğ½.

## ğŸ“Š ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° (Ğ²Ñ‹ÑĞ¾ĞºĞ¾ÑƒÑ€Ğ¾Ğ²Ğ½ĞµĞ²Ğ°Ñ)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    FLUENT API (analyze_zones)                   â”‚
â”‚                     ZoneAnalysisBuilder                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  ZoneAnalysisPipeline                           â”‚
â”‚  (ĞšĞ¾Ğ¾Ñ€Ğ´Ğ¸Ğ½Ğ°Ñ‚Ğ¾Ñ€ + ĞšÑÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ)                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                          â”‚
         â–¼                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ IndicatorFactoryâ”‚      â”‚  ZoneDetectionStrategy       â”‚
â”‚  (Ğ Ğ°ÑÑ‡ĞµÑ‚        â”‚      â”‚  (Ğ”ĞµÑ‚ĞµĞºÑ†Ğ¸Ñ Ğ·Ğ¾Ğ½)              â”‚
â”‚   Ğ¸Ğ½Ğ´Ğ¸ĞºĞ°Ñ‚Ğ¾Ñ€Ğ°)   â”‚      â”‚  - ZeroCrossingDetection     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚  - ThresholdDetection        â”‚
         â”‚               â”‚  - LineCrossingDetection     â”‚
         â”‚               â”‚  - PreloadedZonesDetection   â”‚
         â”‚               â”‚  - CombinedRulesDetection    â”‚
         â”‚               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                         â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
         List[ZoneInfo] (Ğ¾Ğ±Ğ½Ğ°Ñ€ÑƒĞ¶ĞµĞ½Ğ½Ñ‹Ğµ Ğ·Ğ¾Ğ½Ñ‹)
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              UniversalZoneAnalyzer                              â”‚
â”‚  (Ğ£Ğ½Ğ¸Ğ²ĞµÑ€ÑĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ¾Ñ€ĞºĞµÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ°)                            â”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚       â”‚          â”‚            â”‚            â”‚
    â–¼       â–¼          â–¼            â–¼            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Featuresâ”‚ â”‚Statâ”‚ â”‚Hypoth. â”‚ â”‚Sequence  â”‚ â”‚Regressionâ”‚
â”‚Extract â”‚ â”‚    â”‚ â”‚Tests   â”‚ â”‚Analysis  â”‚ â”‚(optional)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚       â”‚          â”‚            â”‚            â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
             ZoneAnalysisResult
```

## Global vs Per-Zone Swing Calculation

**ĞŸĞ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ** Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ Ñ€ĞµĞ¶Ğ¸Ğ¼ `global`: Ğ¿Ğ¸Ğ²Ğ¾Ñ‚Ñ‹ ÑĞ²Ğ¸Ğ½Ğ³Ğ¾Ğ² Ğ²Ñ‹Ñ‡Ğ¸ÑĞ»ÑÑÑ‚ÑÑ Ğ¾Ğ´Ğ¸Ğ½ Ñ€Ğ°Ğ· Ğ½Ğ° Ğ¿Ğ¾Ğ»Ğ½Ğ¾Ğ¼ Ğ´Ğ°Ñ‚Ğ°ÑĞµÑ‚Ğµ Ğ¸ Ğ½Ğ°Ñ€ĞµĞ·Ğ°ÑÑ‚ÑÑ Ğ¿Ğ¾Ğ´ ĞºĞ°Ğ¶Ğ´ÑƒÑ Ğ·Ğ¾Ğ½Ñƒ Ñ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸ĞµĞ¼ ÑĞ¾ÑĞµĞ´Ğ½Ğ¸Ñ… Ñ‚Ğ¾Ñ‡ĞµĞº. Ğ­Ñ‚Ğ¾ Ğ¾ÑĞ¾Ğ±ĞµĞ½Ğ½Ğ¾ Ğ¿Ğ¾Ğ»ĞµĞ·Ğ½Ğ¾ Ğ´Ğ»Ñ ÑˆĞ¸Ñ€Ğ¾ĞºĞ¸Ñ… Ñ‚Ñ€ĞµĞ½Ğ´Ğ¾Ğ², ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğµ Ğ¿ĞµÑ€ĞµÑĞµĞºĞ°ÑÑ‚ Ğ³Ñ€Ğ°Ğ½Ğ¸Ñ†Ñ‹ Ğ·Ğ¾Ğ½. Ğ”Ğ»Ñ Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‚Ğ° Ğº Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ğ¾Ğ¼Ñƒ Ñ€Ğ°ÑÑ‡Ñ‘Ñ‚Ñƒ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹Ñ‚Ğµ `.with_swing_scope('per_zone')`.

| ĞšÑ€Ğ¸Ñ‚ĞµÑ€Ğ¸Ğ¹ | `global` (Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ) | `per_zone` |
| --- | --- | --- |
| ĞšĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚ Ñ€Ğ°ÑÑ‡Ñ‘Ñ‚Ğ° | Ğ¡Ğ²Ğ¸Ğ½Ğ³Ğ¸ ÑÑ‡Ğ¸Ñ‚Ğ°ÑÑ‚ÑÑ Ğ½Ğ° Ğ²ÑÑ‘Ğ¼ DataFrame Ğ¸ ÑˆĞ°Ñ€ÑÑ‚ÑÑ Ğ¼ĞµĞ¶Ğ´Ñƒ Ğ·Ğ¾Ğ½Ğ°Ğ¼Ğ¸ | ĞšĞ°Ğ¶Ğ´Ñ‹Ğ¹ ÑĞ²Ğ¸Ğ½Ğ³ ÑÑ‡Ğ¸Ñ‚Ğ°ĞµÑ‚ÑÑ Ğ½Ğ° Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ğ¾Ğ¼ ÑÑ€ĞµĞ·Ğµ `zone.data` |
| ĞŸĞ¾Ğ»Ğ½Ğ¾Ñ‚Ğ° Ğ¼ĞµÑ‚Ñ€Ğ¸Ğº | Ğ—Ğ°Ñ…Ğ²Ğ°Ñ‚Ñ‹Ğ²Ğ°ÑÑ‚ÑÑ ÑĞ¾ÑĞµĞ´Ğ½Ğ¸Ğµ Ğ¿Ğ¸Ğ²Ğ¾Ñ‚Ñ‹, coverage 70â€“90% | Ğ§Ğ°ÑÑ‚Ğ¾ Ñ‚ĞµÑ€ÑÑÑ‚ÑÑ Ğ¿Ğ¸Ğ²Ğ¾Ñ‚Ñ‹ Ğ½Ğ° Ğ³Ñ€Ğ°Ğ½Ğ¸Ñ†Ğ°Ñ…, coverage 18â€“62% |
| ĞŸÑ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ | Ğ•Ğ´Ğ¸Ğ½Ğ¾Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğ¹ Ñ€Ğ°ÑÑ‡Ñ‘Ñ‚ + Ğ´ĞµÑˆÑ‘Ğ²Ğ°Ñ Ğ½Ğ°Ñ€ĞµĞ·ĞºĞ° Ğ¿Ğ¾ Ğ·Ğ¾Ğ½Ğ°Ğ¼ | Ğ‘Ñ‹ÑÑ‚Ñ€ĞµĞµ Ğ½Ğ° ĞºĞ¾Ñ€Ğ¾Ñ‚ĞºĞ¸Ñ… ÑĞµÑ€Ğ¸ÑÑ…, Ğ±ĞµĞ· Ğ¿Ğ¾Ğ´Ğ³Ğ¾Ñ‚Ğ¾Ğ²ĞºĞ¸ ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚Ğ° |
| Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´ÑƒĞµĞ¼Ñ‹Ğµ ÑÑ†ĞµĞ½Ğ°Ñ€Ğ¸Ğ¸ | Production-Ğ°Ğ½Ğ°Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ°, Ğ¾Ñ‚Ñ‡Ñ‘Ñ‚Ñ‹, Ğ¸ÑÑĞ»ĞµĞ´Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒÑĞºĞ¸Ğµ Ğ½Ğ¾ÑƒÑ‚Ğ±ÑƒĞºĞ¸ | Ğ‘Ñ‹ÑÑ‚Ñ€Ñ‹Ğµ Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ğµ ÑĞºÑĞ¿ĞµÑ€Ğ¸Ğ¼ĞµĞ½Ñ‚Ñ‹, Ğ¾Ñ‚Ğ»Ğ°Ğ´ĞºĞ° Ğ½ĞµĞ±Ğ¾Ğ»ÑŒÑˆĞ¸Ñ… Ğ¾ĞºĞ¾Ğ½ |

### Ğ‘Ñ‹ÑÑ‚Ñ€Ñ‹Ğ¹ ÑÑ‚Ğ°Ñ€Ñ‚

```python
from bquant.analysis.zones import analyze_zones

result = (
    analyze_zones(price_df)
    .with_indicator('custom', 'macd', fast_period=12, slow_period=26, signal_period=9)
    .detect_zones('zero_crossing', indicator_col='macd_hist')
    .with_strategies(swing='zigzag')
    .with_swing_preset('narrow_zone')
    .with_swing_scope('global')  # Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ, Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ¾Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒ
    .analyze()
    .build()
)

for zone in result.zones:
    swings = zone.get_zone_swings()  # Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ SwingPoint, Ğ²ĞºĞ»ÑÑ‡Ğ°Ñ ÑĞ¾ÑĞµĞ´Ğ½Ğ¸Ğµ Ğ¿Ğ¸Ğ²Ğ¾Ñ‚Ñ‹
    swing_mode = zone.features.get('metadata', {}).get('swing_calculation_mode')
    print(zone.zone_id, swing_mode, len(swings))
```

**ĞĞ° Ñ‡Ñ‚Ğ¾ Ğ¾Ğ±Ñ€Ğ°Ñ‚Ğ¸Ñ‚ÑŒ Ğ²Ğ½Ğ¸Ğ¼Ğ°Ğ½Ğ¸Ğµ:**

- Ğ¡Ñ‚Ñ€Ğ°Ñ‚ĞµĞ³Ğ¸Ñ ÑĞ²Ğ¸Ğ½Ğ³Ğ¾Ğ² Ğ·Ğ°Ğ´Ğ°Ñ‘Ñ‚ÑÑ Ñ‡ĞµÑ€ĞµĞ· `with_strategies(swing='...')`, Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹ â€” Ñ‡ĞµÑ€ĞµĞ· `with_swing_preset('narrow_zone')` Ğ¸Ğ»Ğ¸ `'wide_zone'`. Ğ¡Ğ¼. [Ğ“Ğ»ÑƒĞ±Ğ¾ĞºĞ¾Ğµ Ğ¿Ğ¾Ğ³Ñ€ÑƒĞ¶ĞµĞ½Ğ¸Ğµ](../developer_guide/zone_analyzer_deep_dive.md) Ğ¸ [ĞšĞµĞ¹Ñ Ğ¿Ğ¾ ÑĞ¾ÑÑ‚Ğ¾ÑÑ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸ MACD-Ğ·Ğ¾Ğ½](../analytics/zones/macd_zone_consistency_case_study.md).
- Ğ ĞµĞ¶Ğ¸Ğ¼ Ñ€Ğ°ÑÑ‡Ñ‘Ñ‚Ğ° ÑĞ¾Ñ…Ñ€Ğ°Ğ½ÑĞµÑ‚ÑÑ Ğ² `zone.features['metadata']['swing_calculation_mode']` (`'global'` Ğ¸Ğ»Ğ¸ `'per_zone'`). Ğ£ `ZoneInfo` Ğ½ĞµÑ‚ Ğ°Ñ‚Ñ€Ğ¸Ğ±ÑƒÑ‚Ğ° `metadata` â€” Ğ¾Ğ½ Ğ²Ğ½ÑƒÑ‚Ñ€Ğ¸ `features`.
- ĞœĞµÑ‚Ğ¾Ğ´ `get_zone_swings()` Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ²Ñ‹Ğ´Ğ°Ñ‘Ñ‚ Ğ°ĞºÑ‚ÑƒĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ ÑĞ¿Ğ¸ÑĞ¾Ğº Ğ¿Ğ¸Ğ²Ğ¾Ñ‚Ğ¾Ğ² Ğ²Ğ½Ğµ Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸ Ğ¾Ñ‚ Ñ€ĞµĞ¶Ğ¸Ğ¼Ğ°.
- Ğ’ Ñ€ĞµĞ¶Ğ¸Ğ¼Ğµ `global` Ğ°Ğ»Ğ³Ğ¾Ñ€Ğ¸Ñ‚Ğ¼ ÑĞ¾Ğ·Ğ´Ğ°Ñ‘Ñ‚ Ğ¾Ğ´Ğ¸Ğ½ `SwingContext` Ğ¸ ÑˆĞ°Ñ€Ğ¸Ñ‚ ĞµĞ³Ğ¾ Ğ¼ĞµĞ¶Ğ´Ñƒ Ğ·Ğ¾Ğ½Ğ°Ğ¼Ğ¸ â€” ÑĞºĞ¾Ğ½Ğ¾Ğ¼Ğ¸Ñ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸ Ğ¿Ñ€Ğ¸ Ğ±Ğ¾Ğ»ÑŒÑˆĞ¾Ğ¼ ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğµ Ğ·Ğ¾Ğ½.

### ĞŸĞµÑ€ĞµĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ Ğ¼ĞµĞ¶Ğ´Ñƒ Ñ€ĞµĞ¶Ğ¸Ğ¼Ğ°Ğ¼Ğ¸ Ğ² Ğ¾Ğ´Ğ½Ğ¾Ğ¹ ÑĞµÑÑĞ¸Ğ¸

```python
per_zone_result = (
    analyze_zones(price_df)
    .with_indicator('custom', 'macd', fast_period=12, slow_period=26, signal_period=9)
    .detect_zones('zero_crossing', indicator_col='macd_hist')
    .with_strategies(swing='find_peaks')
    .with_swing_preset('narrow_zone')
    .with_swing_scope('per_zone')
    .build()
)

global_result = (
    analyze_zones(price_df)
    .with_indicator('custom', 'macd', fast_period=12, slow_period=26, signal_period=9)
    .detect_zones('zero_crossing', indicator_col='macd_hist')
    .with_strategies(swing='find_peaks')
    .with_swing_preset('narrow_zone')
    .with_swing_scope('global')
    .build()
)

comparison = [
    (
        zone.zone_id,
        len(zone.get_zone_swings()),
        len(global_result.zones[idx].get_zone_swings())
    )
    for idx, zone in enumerate(per_zone_result.zones)
]

print('zone_id | per_zone | global')
for zone_id, local_count, global_count in comparison:
    print(f"{zone_id:>7} | {local_count:>7} | {global_count:>6}")
```

Ğ’Ñ‚Ğ¾Ñ€Ğ¾Ğ¹ Ğ·Ğ°Ğ¿ÑƒÑĞº Ğ¿ĞµÑ€ĞµĞ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ Ğ¿Ğ¾Ğ´Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ğ»ĞµĞ½Ğ½Ñ‹Ğ¹ `SwingContext`, Ğ¿Ğ¾ÑÑ‚Ğ¾Ğ¼Ñƒ Ñ€Ğ°Ğ·Ğ½Ğ¸Ñ†Ğ° Ğ²Ğ¾ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸ Ğ¼Ğ¸Ğ½Ğ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ğ°. Ğ¢Ğ°ĞºĞ¾Ğ¹ Ğ¿Ñ€Ğ¸Ñ‘Ğ¼ ÑƒĞ´Ğ¾Ğ±Ğ½Ğ¾ Ğ¿Ñ€Ğ¸Ğ¼ĞµĞ½ÑÑ‚ÑŒ Ğ²
research-Ğ½Ğ¾ÑƒÑ‚Ğ±ÑƒĞºĞ°Ñ… Ğ´Ğ»Ñ Ğ²Ğ¸Ğ·ÑƒĞ°Ğ»ÑŒĞ½Ğ¾Ğ³Ğ¾ ÑÑ€Ğ°Ğ²Ğ½ĞµĞ½Ğ¸Ñ Ñ€ĞµĞ¶Ğ¸Ğ¼Ğ¾Ğ².

### ĞœĞ¸Ğ½Ğ¸-Ğ²Ğ¸Ğ·ÑƒĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ğ¾Ğ²

```python
import matplotlib.pyplot as plt

zone = global_result.zones[0]
swings = zone.get_zone_swings()

plt.plot(price_df['close'], label='Close price')
# SwingPoint: timestamp, price, swing_type ('peak'/'trough')
plt.scatter([p.timestamp for p in swings], [p.price for p in swings],
            c=['red' if p.swing_type == 'peak' else 'green' for p in swings],
            label='Global swings')
plt.axvspan(zone.start_time, zone.end_time, alpha=0.2, color='steelblue', label='Zone window')
plt.legend()
plt.title('Ğ¡Ñ€Ğ°Ğ²Ğ½ĞµĞ½Ğ¸Ğµ Ğ·Ğ¾Ğ½Ñ‹ Ñ Ğ³Ğ»Ğ¾Ğ±Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¼Ğ¸ ÑĞ²Ğ¸Ğ½Ğ³Ğ°Ğ¼Ğ¸')
plt.show()
```

Ğ”Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ° Ğ½Ğ°Ğ³Ğ»ÑĞ´Ğ½Ğ¾ Ğ´ĞµĞ¼Ğ¾Ğ½ÑÑ‚Ñ€Ğ¸Ñ€ÑƒĞµÑ‚, Ñ‡Ñ‚Ğ¾ ÑĞ²Ğ¸Ğ½Ğ³Ğ¸ Ğ²ĞºĞ»ÑÑ‡Ğ°ÑÑ‚ Ñ‚Ğ¾Ñ‡ĞºĞ¸, Ğ²Ñ‹Ñ…Ğ¾Ğ´ÑÑ‰Ğ¸Ğµ Ğ·Ğ° Ğ³Ñ€Ğ°Ğ½Ğ¸Ñ†Ñ‹ Ğ·Ğ¾Ğ½Ñ‹, Ñ‡Ñ‚Ğ¾ Ğ¾Ğ±ĞµÑĞ¿ĞµÑ‡Ğ¸Ğ²Ğ°ĞµÑ‚ ĞºĞ¾Ñ€Ñ€ĞµĞºÑ‚Ğ½ÑƒÑ Ğ°Ğ¼Ğ¿Ğ»Ğ¸Ñ‚ÑƒĞ´Ñƒ Ğ¸
Ğ´Ğ»Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ Ğ´Ğ²Ğ¸Ğ¶ĞµĞ½Ğ¸Ñ Ğ²Ğ½ÑƒÑ‚Ñ€Ğ¸ Ğ¾ĞºĞ½Ğ° Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ°.

## ğŸ”„ Ğ”ĞµÑ‚Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑ (Ğ¿Ğ¾ÑˆĞ°Ğ³Ğ¾Ğ²Ğ¾)

### Ğ­Ñ‚Ğ°Ğ¿ 1: ĞŸĞ¾Ğ´Ğ³Ğ¾Ñ‚Ğ¾Ğ²ĞºĞ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…

```python
# ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ·Ğ°Ğ¿ÑƒÑĞºĞ°ĞµÑ‚:
result = (
    analyze_zones(df)
    .with_indicator('custom', 'macd', fast_period=12, slow_period=26, signal_period=9)
    .detect_zones('zero_crossing', indicator_col='macd_hist')
    .analyze(clustering=True, n_clusters=3)
    .build()
)
```

**Ğ§Ñ‚Ğ¾ Ğ¿Ñ€Ğ¾Ğ¸ÑÑ…Ğ¾Ğ´Ğ¸Ñ‚:**

```
1. analyze_zones(df) ÑĞ¾Ğ·Ğ´Ğ°ĞµÑ‚ ZoneAnalysisBuilder
2. .with_indicator() â†’ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ÑĞµÑ‚ IndicatorConfig
3. .detect_zones() â†’ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ÑĞµÑ‚ ZoneDetectionConfig
4. .analyze() â†’ Ğ½Ğ°ÑÑ‚Ñ€Ğ°Ğ¸Ğ²Ğ°ĞµÑ‚ Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ°
5. .build() â†’ Ğ·Ğ°Ğ¿ÑƒÑĞºĞ°ĞµÑ‚ pipeline!
```

### Ğ­Ñ‚Ğ°Ğ¿ 2: Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ğµ pipeline

```python
# ZoneAnalysisBuilder.build() ÑĞ¾Ğ·Ğ´Ğ°ĞµÑ‚:
pipeline = ZoneAnalysisPipeline(config, enable_cache=True)
result = pipeline.run(df)
```

**pipeline.run() Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ÑĞµÑ‚:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. ĞŸĞ ĞĞ’Ğ•Ğ ĞšĞ ĞšĞ­Ğ¨Ğ                                         â”‚
â”‚    â”œâ”€ Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ ĞºĞ»ÑÑ‡Ğ° (hash Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… + ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ)      â”‚
â”‚    â”œâ”€ ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° cache_manager.get(key)                   â”‚
â”‚    â””â”€ Ğ•ÑĞ»Ğ¸ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½ â†’ Ğ²ĞµÑ€Ğ½ÑƒÑ‚ÑŒ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚ (Ğ‘Ğ«Ğ¡Ğ¢Ğ Ğ!)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼ (cache miss)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. ĞŸĞĞ”Ğ“ĞĞ¢ĞĞ’ĞšĞ Ğ”ĞĞĞĞ«Ğ¥ (ĞµÑĞ»Ğ¸ Ğ½ÑƒĞ¶ĞµĞ½ Ğ¸Ğ½Ğ´Ğ¸ĞºĞ°Ñ‚Ğ¾Ñ€)             â”‚
â”‚    â”œâ”€ IndicatorFactory.create(source, name, **params)   â”‚
â”‚    â”œâ”€ indicator.calculate(df)                           â”‚
â”‚    â”œâ”€ ĞĞ±ÑŠĞµĞ´Ğ¸Ğ½ĞµĞ½Ğ¸Ğµ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ğ° Ñ Ğ¸ÑÑ…Ğ¾Ğ´Ğ½Ñ‹Ğ¼ df              â”‚
â”‚    â””â”€ df_prepared (Ñ Ğ¸Ğ½Ğ´Ğ¸ĞºĞ°Ñ‚Ğ¾Ñ€Ğ¾Ğ¼)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. Ğ”Ğ•Ğ¢Ğ•ĞšĞ¦Ğ˜Ğ¯ Ğ—ĞĞ                                          â”‚
â”‚    â”œâ”€ ZoneDetectionRegistry.get(strategy_name)          â”‚
â”‚    â”œâ”€ detector.detect_zones(df_prepared, config)        â”‚
â”‚    â””â”€ List[ZoneInfo] Ñ Ğ·Ğ°Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ½Ñ‹Ğ¼ indicator_context    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. ĞĞĞĞ›Ğ˜Ğ— Ğ—ĞĞ                                            â”‚
â”‚    â”œâ”€ UniversalZoneAnalyzer.analyze_zones(zones, df)    â”‚
â”‚    â””â”€ ZoneAnalysisResult                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. Ğ¡ĞĞ¥Ğ ĞĞĞ•ĞĞ˜Ğ• Ğ’ ĞšĞ­Ğ¨                                      â”‚
â”‚    â””â”€ cache_manager.put(key, result, ttl=3600)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Ğ­Ñ‚Ğ°Ğ¿ 3: Ğ”ĞµÑ‚ĞµĞºÑ†Ğ¸Ñ Ğ·Ğ¾Ğ½ (Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€ ZeroCrossingDetection)

```python
class ZeroCrossingDetection:
    def detect_zones(self, data, config):
        # 1. Ğ’Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ
        config.validate(required_rules=['indicator_col'])
        indicator_col = config.rules['indicator_col']

        # 2. Ğ˜Ğ·Ğ²Ğ»ĞµÑ‡ĞµĞ½Ğ¸Ğµ Ğ¸Ğ½Ğ´Ğ¸ĞºĞ°Ñ‚Ğ¾Ñ€Ğ°
        indicator_values = data[indicator_col].values

        # 3. ĞĞ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ ÑĞ³Ğ»Ğ°Ğ¶Ğ¸Ğ²Ğ°Ğ½Ğ¸Ğµ
        if smooth_window:
            indicator_values = smooth(indicator_values)

        # 4. ĞŸĞ¾Ğ¸ÑĞº Ğ¿ĞµÑ€ĞµÑĞµÑ‡ĞµĞ½Ğ¸Ğ¹ Ğ½ÑƒĞ»Ñ
        signs = np.sign(indicator_values)
        sign_changes = np.where(np.diff(signs) != 0)[0] + 1

        # 5. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ·Ğ¾Ğ½
        zones = []
        for i in range(len(boundaries) - 1):
            start_idx = boundaries[i]
            end_idx = boundaries[i + 1] - 1

            # Ğ¤Ğ¸Ğ»ÑŒÑ‚Ñ€ Ğ¿Ğ¾ min_duration
            if duration < config.min_duration:
                continue

            # ĞĞ¿Ñ€ĞµĞ´ĞµĞ»ĞµĞ½Ğ¸Ğµ Ñ‚Ğ¸Ğ¿Ğ° Ğ·Ğ¾Ğ½Ñ‹
            zone_type = 'bull' if mean_value > 0 else 'bear'

            # Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ ZoneInfo Ñ indicator_context
            zone = ZoneInfo(
                zone_id=len(zones),
                type=zone_type,
                start_idx=start_idx,
                end_idx=end_idx,
                start_time=data.index[start_idx],
                end_time=data.index[end_idx],
                duration=duration,
                data=data.iloc[start_idx:end_idx + 1],
                indicator_context={
                    'detection_strategy': 'zero_crossing',
                    'detection_indicator': indicator_col,
                    'signal_line': None,
                    'detection_rules': config.rules
                }
            )
            zones.append(zone)

        return zones
```

### Ğ­Ñ‚Ğ°Ğ¿ 4: ĞĞ½Ğ°Ğ»Ğ¸Ğ· Ğ·Ğ¾Ğ½ (UniversalZoneAnalyzer)

```python
class UniversalZoneAnalyzer:
    def analyze_zones(self, zones, data, perform_clustering, n_clusters, ...):
        # 1. Ğ˜Ğ·Ğ²Ğ»ĞµÑ‡ĞµĞ½Ğ¸Ğµ Ğ¿Ñ€Ğ¸Ğ·Ğ½Ğ°ĞºĞ¾Ğ² Ğ¸Ğ· ĞºĞ°Ğ¶Ğ´Ğ¾Ğ¹ Ğ·Ğ¾Ğ½Ñ‹
        zones_features = self.features.extract_all_zones_features(zones)

        # Ğ—Ğ°Ğ¿Ğ¸ÑĞ°Ñ‚ÑŒ Ğ¿Ñ€Ğ¸Ğ·Ğ½Ğ°ĞºĞ¸ Ğ¾Ğ±Ñ€Ğ°Ñ‚Ğ½Ğ¾ Ğ² ZoneInfo
        for zone, features in zip(zones, zones_features):
            zone.features = features.to_dict()

        # 2. Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·
        statistics = self.features.analyze_zones_distribution(zones_features)

        # 3. Ğ¢ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ³Ğ¸Ğ¿Ğ¾Ñ‚ĞµĞ·
        hypothesis_tests = self.hypotheses.run_all_tests(zones_features)

        # 4. ĞĞ½Ğ°Ğ»Ğ¸Ğ· Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ĞµĞ¹ (ĞµÑĞ»Ğ¸ >= 3 Ğ·Ğ¾Ğ½Ñ‹)
        sequence_analysis = None
        if len(zones) >= 3:
            sequence_analysis = self.sequences.analyze_zone_transitions(zones_features)

        # 5. ĞšĞ»Ğ°ÑÑ‚ĞµÑ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ (Ğ¾Ğ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾)
        clustering = None
        if perform_clustering and len(zones) >= n_clusters:
            clustering = self.sequences.cluster_zones(zones_features, n_clusters)

        # 6. Ğ ĞµĞ³Ñ€ĞµÑÑĞ¸Ñ (Ğ¾Ğ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾, ĞµÑĞ»Ğ¸ >= 10 Ğ·Ğ¾Ğ½)
        regression_results = None
        if run_regression and len(zones) > 10:
            regression_results = self.regression.predict_zone_duration(...)

        # 7. Ğ’Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ (Ğ¾Ğ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾, ĞµÑĞ»Ğ¸ >= 20 Ğ·Ğ¾Ğ½)
        validation_results = None
        if run_validation and len(zones) > 20:
            validation_results = self.validation.validate(...)

        # Ğ¡Ğ±Ğ¾Ñ€ĞºĞ° Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ğ°
        return ZoneAnalysisResult(
            zones=zones,
            statistics=statistics,
            hypothesis_tests=hypothesis_tests,
            sequence_analysis=sequence_analysis,
            clustering=clustering,
            regression_results=regression_results,
            validation_results=validation_results,
            data=data,
            metadata={...}
        )
```

## ğŸ§© ĞšĞ»ÑÑ‡ĞµĞ²Ñ‹Ğµ Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…

### ZoneInfo (Ğ¾Ğ´Ğ½Ğ° Ğ·Ğ¾Ğ½Ğ°)

```python
@dataclass
class ZoneInfo:
    zone_id: int                    # Ğ£Ğ½Ğ¸ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ ID
    type: str                       # 'bull', 'bear', 'overbought', 'oversold'
    start_idx: int                  # ĞĞ°Ñ‡Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ¸Ğ½Ğ´ĞµĞºÑ (iloc)
    end_idx: int                    # ĞšĞ¾Ğ½ĞµÑ‡Ğ½Ñ‹Ğ¹ Ğ¸Ğ½Ğ´ĞµĞºÑ (iloc)
    start_time: datetime            # Ğ’Ñ€ĞµĞ¼Ñ Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ°
    end_time: datetime              # Ğ’Ñ€ĞµĞ¼Ñ Ğ¾ĞºĞ¾Ğ½Ñ‡Ğ°Ğ½Ğ¸Ñ
    duration: int                   # Ğ”Ğ»Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ Ğ² Ğ±Ğ°Ñ€Ğ°Ñ…
    data: pd.DataFrame              # Ğ”Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ·Ğ¾Ğ½Ñ‹ (OHLCV + Ğ¸Ğ½Ğ´Ğ¸ĞºĞ°Ñ‚Ğ¾Ñ€Ñ‹)
    features: Dict[str, Any]        # ĞŸÑ€Ğ¸Ğ·Ğ½Ğ°ĞºĞ¸ (Ğ·Ğ°Ğ¿Ğ¾Ğ»Ğ½ÑĞµÑ‚ÑÑ Ğ¿Ğ¾ÑĞ»Ğµ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ°)
    indicator_context: Dict[str, Any]  # v2.1: ĞšĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚ Ğ´ĞµÑ‚ĞµĞºÑ†Ğ¸Ğ¸
    swing_context: Optional[SwingContext]  # ĞŸÑ€Ğ¸ Ğ³Ğ»Ğ¾Ğ±Ğ°Ğ»ÑŒĞ½Ğ¾Ğ¼ Ñ€ĞµĞ¶Ğ¸Ğ¼Ğµ (Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ)

    # indicator_context ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ñ‚:
    # {'detection_strategy': 'zero_crossing', 'detection_indicator': 'macd_hist', ...}

    def get_zone_swings(self) -> List[SwingPoint]:  # Ğ¡Ğ²Ğ¸Ğ½Ğ³Ğ¸ Ğ·Ğ¾Ğ½Ñ‹ (Ğ¸Ğ· swing_context)
```

**Ğ’Ğ°Ğ¶Ğ½Ğ¾:** Ñƒ `ZoneInfo` Ğ½ĞµÑ‚ Ğ°Ñ‚Ñ€Ğ¸Ğ±ÑƒÑ‚Ğ° `metadata`. ĞœĞµÑ‚Ğ°Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ (Ğ² Ñ‚.Ñ‡. `swing_calculation_mode`, `swing_metrics`) Ğ»ĞµĞ¶Ğ°Ñ‚ Ğ² `zone.features['metadata']`.

### ZoneAnalysisResult (Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ°)

```python
@dataclass
class ZoneAnalysisResult:
    zones: List[ZoneInfo]              # Ğ’ÑĞµ Ğ¾Ğ±Ğ½Ğ°Ñ€ÑƒĞ¶ĞµĞ½Ğ½Ñ‹Ğµ Ğ·Ğ¾Ğ½Ñ‹
    statistics: Dict[str, Any]         # Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ¸ (ÑÑ€ĞµĞ´Ğ½ĞµĞµ, Ğ¼ĞµĞ´Ğ¸Ğ°Ğ½Ğ°, std)
    hypothesis_tests: Dict[str, Any]   # Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ñ… Ñ‚ĞµÑÑ‚Ğ¾Ğ²
    clustering: Optional[Dict]         # Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹ ĞºĞ»Ğ°ÑÑ‚ĞµÑ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸
    sequence_analysis: Optional[Dict]  # ĞĞ½Ğ°Ğ»Ğ¸Ğ· Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ĞµĞ¹
    regression_results: Optional[Dict] # Ğ ĞµĞ³Ñ€ĞµÑÑĞ¸Ğ¾Ğ½Ğ½Ñ‹Ğ¹ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·
    validation_results: Optional[Dict] # Ğ’Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ
    data: Optional[pd.DataFrame]       # Ğ˜ÑÑ…Ğ¾Ğ´Ğ½Ñ‹Ğ¹ DataFrame
    metadata: Dict[str, Any]           # ĞœĞµÑ‚Ğ°Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ

    # ĞœĞµÑ‚Ğ¾Ğ´Ñ‹:
    def save(filepath, format='pickle')   # Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ğ°
    def visualize(mode='overview')        # Ğ’Ğ¸Ğ·ÑƒĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ

# load â€” Ğ¼ĞµÑ‚Ğ¾Ğ´ ĞºĞ»Ğ°ÑÑĞ°:
loaded = ZoneAnalysisResult.load('results/zones.pkl', format='pickle')
```

## ğŸ¯ Ğ¡Ñ‚Ñ€Ğ°Ñ‚ĞµĞ³Ğ¸Ğ¸ Ğ´ĞµÑ‚ĞµĞºÑ†Ğ¸Ğ¸ Ğ·Ğ¾Ğ½

### 1. ZeroCrossingDetection (Ğ¿ĞµÑ€ĞµÑĞµÑ‡ĞµĞ½Ğ¸Ğµ Ğ½ÑƒĞ»Ñ)

**ĞŸÑ€Ğ¸Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğµ:** MACD, AO, CCI, Ğ»ÑĞ±Ğ¾Ğ¹ Ğ¾ÑÑ†Ğ¸Ğ»Ğ»ÑÑ‚Ğ¾Ñ€ Ñ Ğ½ÑƒĞ»ĞµĞ²Ğ¾Ğ¹ Ğ»Ğ¸Ğ½Ğ¸ĞµĞ¹

```python
config = ZoneDetectionConfig(
    min_duration=2,
    zone_types=['bull', 'bear'],
    rules={'indicator_col': 'macd_hist'},  # custom MACD ÑĞ¾Ğ·Ğ´Ğ°Ñ‘Ñ‚ ĞºĞ¾Ğ»Ğ¾Ğ½ĞºÑƒ macd_hist
    strategy_name='zero_crossing'
)
```

**ĞĞ»Ğ³Ğ¾Ñ€Ğ¸Ñ‚Ğ¼:**
- Ğ˜Ğ½Ğ´Ğ¸ĞºĞ°Ñ‚Ğ¾Ñ€ > 0 â†’ 'bull' Ğ·Ğ¾Ğ½Ğ°
- Ğ˜Ğ½Ğ´Ğ¸ĞºĞ°Ñ‚Ğ¾Ñ€ < 0 â†’ 'bear' Ğ·Ğ¾Ğ½Ğ°
- ĞŸĞµÑ€ĞµÑĞµÑ‡ĞµĞ½Ğ¸Ğµ Ğ½ÑƒĞ»Ñ = Ğ³Ñ€Ğ°Ğ½Ğ¸Ñ†Ğ° Ğ·Ğ¾Ğ½Ñ‹

### 2. ThresholdDetection (Ğ¿Ğ¾Ñ€Ğ¾Ğ³Ğ¾Ğ²Ñ‹Ğµ Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ñ)

**ĞŸÑ€Ğ¸Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğµ:** RSI, Stochastic, Williams %R

```python
config = ZoneDetectionConfig(
    min_duration=3,
    zone_types=['overbought', 'oversold'],
    rules={
        'indicator_col': 'rsi',
        'upper_threshold': 70,
        'lower_threshold': 30
    },
    strategy_name='threshold'
)
```

**ĞĞ»Ğ³Ğ¾Ñ€Ğ¸Ñ‚Ğ¼:**
- Ğ˜Ğ½Ğ´Ğ¸ĞºĞ°Ñ‚Ğ¾Ñ€ > upper_threshold â†’ 'overbought'
- Ğ˜Ğ½Ğ´Ğ¸ĞºĞ°Ñ‚Ğ¾Ñ€ < lower_threshold â†’ 'oversold'
- ĞœĞµĞ¶Ğ´Ñƒ Ğ¿Ğ¾Ñ€Ğ¾Ğ³Ğ°Ğ¼Ğ¸ â†’ Ğ½ĞµÑ‚ Ğ·Ğ¾Ğ½Ñ‹

### 3. LineCrossingDetection (Ğ¿ĞµÑ€ĞµÑĞµÑ‡ĞµĞ½Ğ¸Ğµ Ğ»Ğ¸Ğ½Ğ¸Ğ¹)

**ĞŸÑ€Ğ¸Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğµ:** MA crossover, MACD line/signal, Stochastic %K/%D

```python
config = ZoneDetectionConfig(
    min_duration=2,
    zone_types=['bull', 'bear'],
    rules={
        'line1_col': 'sma_fast',
        'line2_col': 'sma_slow'
    },
    strategy_name='line_crossing'
)
```

**ĞĞ»Ğ³Ğ¾Ñ€Ğ¸Ñ‚Ğ¼:**
- line1 > line2 â†’ 'bull' Ğ·Ğ¾Ğ½Ğ°
- line1 < line2 â†’ 'bear' Ğ·Ğ¾Ğ½Ğ°
- ĞŸĞµÑ€ĞµÑĞµÑ‡ĞµĞ½Ğ¸Ğµ = Ğ³Ñ€Ğ°Ğ½Ğ¸Ñ†Ğ° Ğ·Ğ¾Ğ½Ñ‹

### 4. PreloadedZonesDetection (Ğ²Ğ½ĞµÑˆĞ½Ğ¸Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ)

**ĞŸÑ€Ğ¸Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğµ:** Ğ—Ğ¾Ğ½Ñ‹ Ğ¸Ğ· CSV, Excel, database, Ğ´Ñ€ÑƒĞ³Ğ¾Ğ¹ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹

```python
config = ZoneDetectionConfig(
    rules={'zones_data': 'zones.csv'},
    strategy_name='preloaded'
)
```

### 5. CombinedRulesDetection (ĞºĞ¾Ğ¼Ğ±Ğ¸Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»Ğ°)

**ĞŸÑ€Ğ¸Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğµ:** Ğ¡Ğ»Ğ¾Ğ¶Ğ½Ğ°Ñ Ğ»Ğ¾Ğ³Ğ¸ĞºĞ° Ñ Ğ½ĞµÑĞºĞ¾Ğ»ÑŒĞºĞ¸Ğ¼Ğ¸ ÑƒÑĞ»Ğ¾Ğ²Ğ¸ÑĞ¼Ğ¸

```python
config = ZoneDetectionConfig(
    rules={
        'conditions': [
            {'type': 'lambda', 'func': lambda row: row['rsi'] > 70},
            {'type': 'threshold', 'col': 'volume', 'threshold': 1000000}
        ]
    },
    strategy_name='combined'
)
```

## ğŸ”¬ Ğ˜Ğ·Ğ²Ğ»ĞµÑ‡ĞµĞ½Ğ¸Ğµ Ğ¿Ñ€Ğ¸Ğ·Ğ½Ğ°ĞºĞ¾Ğ²

**ZoneFeaturesAnalyzer** Ğ·Ğ°Ğ¿Ğ¾Ğ»Ğ½ÑĞµÑ‚ `zone.features`. Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° â€” ÑĞ¼ĞµÑÑŒ Ğ¿Ğ¾Ğ»ĞµĞ¹ Ğ²ĞµÑ€Ñ…Ğ½ĞµĞ³Ğ¾ ÑƒÑ€Ğ¾Ğ²Ğ½Ñ Ğ¸ Ğ²Ğ»Ğ¾Ğ¶ĞµĞ½Ğ½Ğ¾Ğ³Ğ¾ `metadata`:

```python
zone.features = {
    # Ğ’ĞµÑ€Ñ…Ğ½Ğ¸Ğ¹ ÑƒÑ€Ğ¾Ğ²ĞµĞ½ÑŒ (ZoneFeatures)
    'zone_id': 'bull_0',
    'zone_type': 'bull',
    'duration': 15,
    'start_price': 2050.0,
    'end_price': 2062.3,
    'price_return': 0.006,
    'hist_amplitude': 0.012,
    'num_peaks': 3,
    'num_troughs': 2,
    'peak_time_ratio': 0.73,
    'drawdown_from_peak': -0.002,
    # ...

    # Ğ’Ğ»Ğ¾Ğ¶ĞµĞ½Ğ½Ñ‹Ğµ Ğ¼ĞµÑ‚Ñ€Ğ¸ĞºĞ¸ (Ğ¿Ğ¾ ÑÑ‚Ñ€Ğ°Ñ‚ĞµĞ³Ğ¸ÑĞ¼)
    'metadata': {
        'swing_calculation_mode': 'global',  # Ğ¸Ğ»Ğ¸ 'per_zone'
        'swing_metrics': {
            'rally_count': 4,
            'drop_count': 3,
            'avg_rally_pct': 0.5,
            'avg_drop_pct': -0.3,
            'num_swings': 7,
            'rally_to_drop_ratio': 1.2,
        },
        'shape_metrics': {'hist_skewness': -0.5, 'hist_kurtosis': 2.3, ...},
        'divergence_metrics': {'divergence_type': 'none', 'divergence_count': 0, ...},
        'volatility_metrics': {...},
        'volume_metrics': {'volume_indicator_corr': 0.65, ...},
    }
}
```

ĞŸÑ€Ğ¸Ğ¼ĞµÑ€ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ° Ğº Ğ¼ĞµÑ‚Ñ€Ğ¸ĞºĞ°Ğ¼ ÑĞ²Ğ¸Ğ½Ğ³Ğ¾Ğ² (Ğ´Ğ»Ñ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ° ÑĞ¾ÑÑ‚Ğ¾ÑÑ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸):

```python
swing_metrics = zone.features.get('metadata', {}).get('swing_metrics', {})
rally_count = swing_metrics.get('rally_count')
avg_rally_pct = swing_metrics.get('avg_rally_pct')
```

## ğŸ“ˆ ĞŸÑ€Ğ¸Ğ¼ĞµÑ€Ñ‹ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ

### ĞœĞ¸Ğ½Ğ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€ (MACD)

```python
from bquant.analysis.zones import analyze_zones
from bquant.data.samples import get_sample_data

df = get_sample_data('mt_xauusd_m15')

result = (
    analyze_zones(df)
    .with_indicator('custom', 'macd', fast_period=12, slow_period=26, signal_period=9)
    .detect_zones('zero_crossing', indicator_col='macd_hist')
    .build()
)

print(f"ĞĞ°Ğ¹Ğ´ĞµĞ½Ğ¾ Ğ·Ğ¾Ğ½: {len(result.zones)}")
```

### ĞŸĞ¾Ğ»Ğ½Ñ‹Ğ¹ Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€ (Ñ ĞºĞ°ÑÑ‚Ğ¾Ğ¼Ğ¸Ğ·Ğ°Ñ†Ğ¸ĞµĞ¹)

```python
result = (
    analyze_zones(df)
    .with_indicator('custom', 'macd', fast_period=12, slow_period=26, signal_period=9)
    .detect_zones('zero_crossing', indicator_col='macd_hist', min_duration=5)
    .with_strategies(
        swing='zigzag',
        shape='statistical',
        divergence='classic',
        volume='standard'
    )
    .with_swing_preset('narrow_zone')
    .with_swing_scope('global')
    .analyze(clustering=True, n_clusters=3, regression=True)
    .with_cache(enable=True, ttl=7200)
    .build()
)

# Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚ Ñ Ğ¿Ğ¾Ğ»Ğ½Ñ‹Ğ¼ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ¾Ğ¼
print(f"Ğ—Ğ¾Ğ½: {len(result.zones)}")
print(f"ĞšĞ»Ğ°ÑÑ‚ĞµÑ€Ñ‹: {result.clustering}")
print(f"Ğ“Ğ¸Ğ¿Ğ¾Ñ‚ĞµĞ·Ñ‹: {result.hypothesis_tests.results if hasattr(result.hypothesis_tests, 'results') else result.hypothesis_tests}")

# Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ
result.save('results/macd_zones.pkl')

# Ğ’Ğ¸Ğ·ÑƒĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ
fig = result.visualize('overview', title='Price + Zones')
fig.show()

# Ğ”ĞµÑ‚Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ñ€Ğ°Ğ·Ğ±Ğ¾Ñ€ Ğ¾Ğ´Ğ½Ğ¾Ğ¹ Ğ·Ğ¾Ğ½Ñ‹ (ÑĞ¼. Ñ€Ğ°Ğ·Ğ´ĞµĞ» Â«Ğ’Ğ¸Ğ·ÑƒĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸ÑÂ» Ğ½Ğ¸Ğ¶Ğµ)
detail = result.visualize(
    'detail',
    zone_id=result.zones[0].zone_id,
    context_bars=30,
)
detail.show()

# Ğ¡Ñ€Ğ°Ğ²Ğ½ĞµĞ½Ğ¸Ğµ Ğ½ĞµÑĞºĞ¾Ğ»ÑŒĞºĞ¸Ñ… Ğ·Ğ¾Ğ½ Ñ Ğ²Ñ‹Ğ±Ğ¾Ñ€Ğ¾Ğ¼ backend Ğ²Ğ¸Ğ·ÑƒĞ°Ğ»Ğ¸Ğ·Ğ°Ñ‚Ğ¾Ñ€Ğ°
comparison = result.visualize(
    'comparison',
    backend='matplotlib',
    max_zones=4,
)
comparison.show()

# Ğ‘Ñ‹ÑÑ‚Ñ€Ñ‹Ğ¹ Ğ¾Ğ±Ğ·Ğ¾Ñ€ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ¸ Ğ·Ğ¾Ğ½
stats = result.visualize('statistics', title='Zone Statistics Summary')
stats.show()

> âš ï¸ Ğ’Ğ¸Ğ·ÑƒĞ°Ğ»Ğ¸Ğ·Ğ°Ñ‚Ğ¾Ñ€ Ñ‚Ñ€ĞµĞ±ÑƒĞµÑ‚ Ğ¸ÑÑ…Ğ¾Ğ´Ğ½Ñ‹Ğ¹ ``DataFrame`` Ğ¸ ÑĞ¿Ğ¸ÑĞ¾Ğº Ğ·Ğ¾Ğ½. Ğ•ÑĞ»Ğ¸
> Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚ Ğ±Ñ‹Ğ» ÑĞ¾Ñ…Ñ€Ğ°Ğ½Ñ‘Ğ½ Ğ±ĞµĞ· ``data`` Ğ¸Ğ»Ğ¸ Ğ²Ñ‹ Ğ¾Ñ‡Ğ¸ÑÑ‚Ğ¸Ğ»Ğ¸ ``result.zones``,
> Ğ¼ĞµÑ‚Ğ¾Ğ´ Ğ²Ñ‹Ğ´Ğ°ÑÑ‚ Ğ¿Ğ¾Ğ½ÑÑ‚Ğ½ÑƒÑ Ğ¾ÑˆĞ¸Ğ±ĞºÑƒ Ñ Ğ¿Ğ¾Ğ´ÑĞºĞ°Ğ·ĞºĞ¾Ğ¹.
```

### ĞœĞ¾Ğ´ÑƒĞ»ÑŒĞ½Ğ¾Ğµ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ (Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ´ĞµÑ‚ĞµĞºÑ†Ğ¸Ñ)

```python
from bquant.analysis.zones.detection import ZoneDetectionRegistry, ZoneDetectionConfig

detector = ZoneDetectionRegistry.get('zero_crossing')
config = ZoneDetectionConfig(
    min_duration=2,
    rules={'indicator_col': 'macd_hist'}
)

zones = detector.detect_zones(df, config)
# zones = List[ZoneInfo] Ğ±ĞµĞ· Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ°
```

## ğŸ¨ Ğ£Ğ½Ğ¸ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ¾ÑĞ¾Ğ±ĞµĞ½Ğ½Ğ¾ÑÑ‚Ğ¸ v2.1

### indicator_context - Ğ¡Ğ°Ğ¼Ğ¾Ğ¾Ğ¿Ğ¸ÑÑ‹Ğ²Ğ°ÑÑ‰Ğ¸ĞµÑÑ Ğ·Ğ¾Ğ½Ñ‹

ĞšĞ°Ğ¶Ğ´Ğ°Ñ Ğ·Ğ¾Ğ½Ğ° "Ğ·Ğ½Ğ°ĞµÑ‚" ĞºĞ°Ğº Ğ¾Ğ½Ğ° Ğ±Ñ‹Ğ»Ğ° Ğ¾Ğ±Ğ½Ğ°Ñ€ÑƒĞ¶ĞµĞ½Ğ°:

```python
zone = result.zones[0]
ctx = zone.indicator_context

print(f"Ğ˜Ğ½Ğ´Ğ¸ĞºĞ°Ñ‚Ğ¾Ñ€: {ctx['detection_indicator']}")  # 'macd_hist'
print(f"Ğ¡Ñ‚Ñ€Ğ°Ñ‚ĞµĞ³Ğ¸Ñ: {ctx['detection_strategy']}")   # 'zero_crossing'
print(f"Signal line: {ctx['signal_line']}")        # None Ğ¸Ğ»Ğ¸ ĞºĞ¾Ğ»Ğ¾Ğ½ĞºĞ°

# Ğ­Ñ‚Ğ¾ Ğ¿Ğ¾Ğ·Ğ²Ğ¾Ğ»ÑĞµÑ‚ analytical strategies Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°Ñ‚ÑŒ Ñ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ñ‹Ğ¼ Ğ¸Ğ½Ğ´Ğ¸ĞºĞ°Ñ‚Ğ¾Ñ€Ğ¾Ğ¼!
```

### Ğ£Ğ½Ğ¸Ğ²ĞµÑ€ÑĞ°Ğ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ - Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚ Ñ Ğ›Ğ®Ğ‘Ğ«Ğœ Ğ¸Ğ½Ğ´Ğ¸ĞºĞ°Ñ‚Ğ¾Ñ€Ğ¾Ğ¼

```python
# ĞšĞ°ÑÑ‚Ğ¾Ğ¼Ğ½Ñ‹Ğ¹ Ğ¸Ğ½Ğ´Ğ¸ĞºĞ°Ñ‚Ğ¾Ñ€ (Ğ»ÑĞ±Ğ°Ñ Ñ„Ğ¾Ñ€Ğ¼ÑƒĞ»Ğ°!)
df['MY_CUSTOM'] = (df['close'].diff(5) / df['close'].rolling(20).std())

result = (
    analyze_zones(df)
    .detect_zones('zero_crossing', indicator_col='MY_CUSTOM')
    .with_strategies(swing='zigzag')  # Ğ Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚ ÑÑ€Ğ°Ğ·Ñƒ!
    .build()
)
# Ğ‘Ğ•Ğ— Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¹ Ğ² ĞºĞ¾Ğ´Ğµ BQuant!
```

## ğŸ’¾ ĞšÑÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¸ Ğ¿ĞµÑ€ÑĞ¸ÑÑ‚ĞµĞ½Ñ‚Ğ½Ğ¾ÑÑ‚ÑŒ

ĞŸĞ¾Ğ´Ñ€Ğ¾Ğ±Ğ½Ğ¾Ğµ Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ: **[Ğ¡Ğ¿Ñ€Ğ°Ğ²Ğ¾Ñ‡Ğ½Ğ¸Ğº Ğ¿Ğ¾ ĞºÑÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ](caching.md)** â€” Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°, Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ°, Ğ¾Ñ‡Ğ¸ÑÑ‚ĞºĞ°.

```python
# ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¾Ğµ ĞºÑÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ (2-level: memory + disk)
result = (
    analyze_zones(df)
    .with_indicator('custom', 'macd')
    .detect_zones('zero_crossing', indicator_col='macd_hist')
    .with_cache(enable=True, ttl=3600)  # 1 Ñ‡Ğ°Ñ TTL
    .build()
)

# Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ Ğ² Ñ€Ğ°Ğ·Ğ½Ñ‹Ñ… Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ°Ñ…
result.save('results/zones.pkl', format='pickle')         # Ğ‘Ñ‹ÑÑ‚Ñ€Ğ¾, Ğ²ÑĞµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ
result.save('results/zones.json', format='json')          # Ğ§Ğ¸Ñ‚Ğ°ĞµĞ¼Ğ¾, Ğ±ĞµĞ· DataFrame
result.save('results/zones.parquet', format='parquet')    # ĞšĞ¾Ğ¼Ğ¿Ğ°ĞºÑ‚Ğ½Ğ¾, columnar

# Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ°
from bquant.analysis.zones.models import ZoneAnalysisResult
loaded = ZoneAnalysisResult.load('results/zones.pkl')
```

## ğŸš€ Ğ“Ğ»Ğ°Ğ²Ğ½Ñ‹Ğµ Ğ¿Ñ€ĞµĞ¸Ğ¼ÑƒÑ‰ĞµÑÑ‚Ğ²Ğ°

- âœ… **Ğ£Ğ½Ğ¸Ğ²ĞµÑ€ÑĞ°Ğ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ** - Ğ¾Ğ´Ğ¸Ğ½ API Ğ´Ğ»Ñ Ğ²ÑĞµÑ… Ğ¸Ğ½Ğ´Ğ¸ĞºĞ°Ñ‚Ğ¾Ñ€Ğ¾Ğ²
- âœ… **ĞœĞ¾Ğ´ÑƒĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ** - Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¾Ñ‚Ğ´ĞµĞ»ÑŒĞ½Ñ‹Ğµ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹
- âœ… **Ğ Ğ°ÑÑˆĞ¸Ñ€ÑĞµĞ¼Ğ¾ÑÑ‚ÑŒ** - Ğ»ĞµĞ³ĞºĞ¾ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ½Ğ¾Ğ²Ñ‹Ğµ ÑÑ‚Ñ€Ğ°Ñ‚ĞµĞ³Ğ¸Ğ¸
- âœ… **ĞŸÑ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ** - Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¾Ğµ ĞºÑÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ
- âœ… **Ğ£Ğ´Ğ¾Ğ±ÑÑ‚Ğ²Ğ¾** - fluent API + presets
- âœ… **Ğ¡Ğ°Ğ¼Ğ¾Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ** - indicator_context Ğ² ĞºĞ°Ğ¶Ğ´Ğ¾Ğ¹ Ğ·Ğ¾Ğ½Ğµ

## ğŸ“š Ğ”Ğ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğµ Ñ€ĞµÑÑƒÑ€ÑÑ‹

- [Ğ¡Ğ¿Ñ€Ğ°Ğ²Ğ¾Ñ‡Ğ½Ğ¸Ğº Ğ¿Ğ¾ ĞºÑÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ](caching.md) â€” Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ° Ñ ĞºÑÑˆĞµĞ¼ (zone analysis Ğ¸ Ğ¾Ğ±Ñ‰Ğ¸Ğ¹)
- [API Reference: zones module](../api/analysis/zones.md)
- [Ğ“Ğ»ÑƒĞ±Ğ¾ĞºĞ¾Ğµ Ğ¿Ğ¾Ğ³Ñ€ÑƒĞ¶ĞµĞ½Ğ¸Ğµ: ĞŸĞ°Ğ¹Ğ¿Ğ»Ğ°Ğ¹Ğ½ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ‚Ğ¾Ñ€Ğ° Ğ·Ğ¾Ğ½](../developer_guide/zone_analyzer_deep_dive.md) â€” Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ `with_swing_preset`, `with_strategies`, ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° `zone.features`
- [ĞšĞµĞ¹Ñ: Ğ¡Ğ¾ÑÑ‚Ğ¾ÑÑ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ Ğ±Ñ‹Ñ‡ÑŒĞ¸Ñ… Ğ·Ğ¾Ğ½ MACD](../analytics/zones/macd_zone_consistency_case_study.md) â€” ÑÑ€Ğ°Ğ²Ğ½ĞµĞ½Ğ¸Ğµ ÑÑ‚Ñ€Ğ°Ñ‚ĞµĞ³Ğ¸Ğ¹ ÑĞ²Ğ¸Ğ½Ğ³Ğ¾Ğ² (zigzag, find_peaks, pivot_points), Ñ€ĞµĞ¶Ğ¸Ğ¼Ñ‹ `per_zone`/`global`
- [Examples: 02a_universal_zones.py](../../examples/02a_universal_zones.py)
- [Developer Guide: Zone Detection Strategies](../developer_guide/zone_detection_strategies.md)
- [Core Concepts](core_concepts.md)
- [Quick Start](quick_start.md)
