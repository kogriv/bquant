# –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è–º —Å–≤–∏–Ω–≥–æ–≤ BQuant

–≠—Ç–æ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –æ–ø–∏—Å—ã–≤–∞–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ —Ä–∞—Å—á—ë—Ç–∞ —Å–≤–∏–Ω–≥–æ–≤ –≤ –ø–∞–π–ø–ª–∞–π–Ω–µ –∞–Ω–∞–ª–∏–∑–∞ –∑–æ–Ω. –í—ã —É–∑–Ω–∞–µ—Ç–µ, —á–µ–º –æ—Ç–ª–∏—á–∞—é—Ç—Å—è ZigZag, FindPeaks –∏ PivotPoints, –∫–∞–∫ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏ –≤ –∫–∞–∫–∏—Ö —Å—Ü–µ–Ω–∞—Ä–∏—è—Ö –∫–∞–∂–¥–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –¥–∞—ë—Ç –Ω–∞–∏–ª—É—á—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç.

## üß≠ –ö–∞–∫ –≤—ã–±—Ä–∞—Ç—å —Å—Ç—Ä–∞—Ç–µ–≥–∏—é

| –°—Ç—Ä–∞—Ç–µ–≥–∏—è | –ö–ª—é—á–µ–≤–∞—è –∏–¥–µ—è | –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å | –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã |
| --- | --- | --- | --- |
| `zigzag` | –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –¥–≤–∏–∂–µ–Ω–∏–π –ø–æ –ø—Ä–æ—Ü–µ–Ω—Ç–Ω–æ–º—É –ø–æ—Ä–æ–≥—É (swing threshold) | –ê–Ω–∞–ª–∏–∑ —Ç—Ä–µ–Ω–¥–æ–≤ —Å—Ä–µ–¥–Ω–µ–π –∏ –±–æ–ª—å—à–æ–π –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏, –≤–æ–ª–Ω–æ–≤—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã | `threshold`, `backstep`, `retrace` |
| `find_peaks` | –ü–æ–∏—Å–∫ –ª–æ–∫–∞–ª—å–Ω—ã—Ö —ç–∫—Å—Ç—Ä–µ–º—É–º–æ–≤ –ø–æ –ø—Ä–æ–º–∏–Ω–µ–Ω—Ü–∏–∏ / —à–∏—Ä–∏–Ω–µ | –í—ã—è–≤–ª–µ–Ω–∏–µ —Ä–µ–∑–∫–∏—Ö –∏–º–ø—É–ª—å—Å–æ–≤, –≤–æ–ª–∞—Ç–∏–ª—å–Ω—ã–µ –∞–∫—Ç–∏–≤—ã | `prominence`, `width`, `distance` |
| `pivot_points` | –ö–æ–º–±–∏–Ω–∞—Ü–∏—è —Å–≤–∏–Ω–≥–æ–≤ –ø–æ —Å–≤–µ—á–∞–º (high/low) | –ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑, —Ä—É—á–Ω–∞—è –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è —É—Ä–æ–≤–Ω–µ–π | `min_bars`, `max_bars`, `sensitivity` |

> üí° **–°–æ–≤–µ—Ç:** –ù–∞—á–Ω–∏—Ç–µ —Å ZigZag. –ì–ª–æ–±–∞–ª—å–Ω—ã–π —Ä–µ–∂–∏–º (`swing_scope='global'`) ‚Äî **–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é**. –î–ª—è –∞–¥–∞–ø—Ç–∏–≤–Ω–æ–≥–æ –ø–æ—Ä–æ–≥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `with_auto_swing_thresholds(True)`. –≠—Ç–æ –¥–∞—ë—Ç —Å—Ç–∞–±–∏–ª—å–Ω—É—é –±–∞–∑—É –¥–ª—è –æ—Ç—á—ë—Ç–æ–≤ –∏ –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –Ω–æ—É—Ç–±—É–∫–æ–≤.

## ‚öôÔ∏è –û–±—â–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

```python
from bquant.analysis.zones import analyze_zones

builder = (
    analyze_zones(price_df)
    .detect_zones('zero_crossing', indicator_col='macd_hist')
    .with_swing_scope('global')
)

result = (
    builder
    .with_swing_strategy('zigzag', threshold=0.025, backstep=3)
    .analyze()
    .build()
)
```

`with_swing_strategy()` –º–æ–∂–Ω–æ –≤—ã–∑—ã–≤–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑: –∫–∞–∂–¥–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –ø–æ–ª—É—á–∏—Ç —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π `SwingContext`, –Ω–æ –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä –æ–±—ä–µ–¥–∏–Ω–∏—Ç –º–µ—Ç—Ä–∏–∫–∏ –≤ `ZoneInfo.swing_metrics`.

## ZigZagSwingStrategy

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–ª—é—á–µ–≤—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

- `threshold` ‚Äî –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –ø—Ä–æ—Ü–µ–Ω—Ç–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –¥–ª—è —Ñ–∏–∫—Å–∞—Ü–∏–∏ —Å–≤–∏–Ω–≥–∞. –î–ª—è –¥–Ω–µ–≤–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥–∏–∞–ø–∞–∑–æ–Ω 1‚Äì3%, –¥–ª—è –º–∏–Ω—É—Ç–Ω—ã—Ö ‚Äî 0.3‚Äì1%.
- `backstep` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–∞—Ä–æ–≤, –≤ —Ç–µ—á–µ–Ω–∏–µ –∫–æ—Ç–æ—Ä—ã—Ö —Ç–æ—á–∫–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–µ—Ä–µ—Å–º–æ—Ç—Ä–µ–Ω–∞, –µ—Å–ª–∏ –ø–æ—è–≤–∏–ª—Å—è –±–æ–ª–µ–µ –≤—ã—Å–æ–∫–∏–π/–Ω–∏–∑–∫–∏–π —ç–∫—Å—Ç—Ä–µ–º—É–º.
- `retrace` ‚Äî –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç —á–∞—Å—Ç–∏—á–Ω–æ–≥–æ –æ—Ç–∫–∞—Ç–∞, –ø—Ä–∏ –∫–æ—Ç–æ—Ä–æ–º –Ω–æ–≤—ã–π —Å–≤–∏–Ω–≥ —Å—á–∏—Ç–∞–µ—Ç—Å—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω–Ω—ã–º.

```python
result = (
    builder
    .with_swing_strategy('zigzag', threshold=0.02, backstep=5, retrace=0.4)
    .analyze()
    .build()
)
```

### –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –ø–æ—Ä–æ–≥–∏

```python
result = (
    analyze_zones(price_df)
    .with_swing_scope('global')
    .with_swing_strategy('zigzag')
    .with_auto_swing_thresholds(True)  # —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç threshold –Ω–∞ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–æ–º –¥–∏–∞–ø–∞–∑–æ–Ω–µ
    .build()
)
```

- –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π —Ä–µ–∂–∏–º –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å —Ü–µ–Ω—ã –∏ –ø–æ–¥–±–∏—Ä–∞–µ—Ç `threshold` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ –Ω–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏, –ø–æ—ç—Ç–æ–º—É –ø—Ä–∏ —Å–º–µ–Ω–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ –∏–ª–∏ –∞–∫—Ç–∏–≤–∞ —Ä–∞—Å—á—ë—Ç –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∑–∞–Ω–æ–≤–æ.

## FindPeaksSwingStrategy

### –ö–æ–Ω—Ç—Ä–æ–ª—å –ø—Ä–æ–º–∏–Ω–µ–Ω—Ü–∏–∏ –∏ —à–∏—Ä–∏–Ω—ã

- `prominence` –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –º–∏–Ω–∏–º–∞–ª—å–Ω—É—é –≤—ã—Å–æ—Ç—É –ø–∏–∫–∞ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ —Å–æ—Å–µ–¥–µ–π.
- `width` (–∏–ª–∏ –ø–∞—Ä–∞ `width`, `rel_height`) –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç, –Ω–∞—Å–∫–æ–ª—å–∫–æ ¬´—à–∏—Ä–æ–∫–∏–º¬ª –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —ç–∫—Å—Ç—Ä–µ–º—É–º.
- `distance` –∑–∞–¥–∞—ë—Ç –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É –ø–∏–∫–∞–º–∏ (–≤ –±–∞—Ä–∞—Ö), –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞—è –ø–µ—Ä–µ–∏–∑–±—ã—Ç–æ–∫ —Å–≤–∏–Ω–≥–æ–≤.

```python
result = (
    builder
    .with_swing_strategy('find_peaks', prominence=1.8, width=4, distance=6)
    .analyze()
    .build()
)
```

### –ü–æ–¥—Å–∫–∞–∑–∫–∏

- –î–ª—è —à—É–º–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö —É–≤–µ–ª–∏—á—å—Ç–µ `prominence` –∏ `distance`.
- –°–æ–≤–º–µ—â–∞–π—Ç–µ —Å –≥–ª–æ–±–∞–ª—å–Ω—ã–º —Ä–µ–∂–∏–º–æ–º: —Å–æ—Å–µ–¥–Ω–∏–µ –ø–∏–≤–æ—Ç—ã –ø–æ–º–æ–≥–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ—Ü–µ–Ω–∏—Ç—å –∞–º–ø–ª–∏—Ç—É–¥—É.
- –•—Ä–∞–Ω–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –æ—Ç—á—ë—Ç–∞, —á—Ç–æ–±—ã –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã.

## PivotPointsSwingStrategy

### –ë–∞–∑–æ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

- `min_bars` ‚Äî –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ —Å–≤–∏–Ω–≥–∞ (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–∞—Ä–æ–≤ –º–µ–∂–¥—É high/low).
- `max_bars` ‚Äî –≤–µ—Ä—Ö–Ω–µ–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–ª—è –¥–æ–ª–≥–∏—Ö —Å–≤–∏–Ω–≥–æ–≤.
- `sensitivity` ‚Äî –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –º–µ–ª–∫–∏—Ö –∫–æ–ª–µ–±–∞–Ω–∏–π (0‚Äì1).

```python
result = (
    builder
    .with_swing_strategy('pivot_points', min_bars=3, max_bars=20, sensitivity=0.25)
    .analyze()
    .build()
)
```

### –†–∞–±–æ—Ç–∞ —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è–º–∏

```python
result = (
    analyze_zones(price_df)
    .with_swing_scope('global')
    .with_swing_strategy('zigzag', threshold=0.018)
    .with_swing_strategy('pivot_points', min_bars=4, sensitivity=0.2)
    .analyze()
    .build()
)

for zone in result.zones:
    zigzag_swings = zone.get_zone_swings(strategy='zigzag')
    pivot_swings = zone.get_zone_swings(strategy='pivot_points')
    print(zone.zone_id, len(zigzag_swings), len(pivot_swings))
```

–ï—Å–ª–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞, –º–µ—Ç–æ–¥ `get_zone_swings()` –≤—ã–±—Ä–æ—Å–∏—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏–µ —Å –ø–æ–¥—Å–∫–∞–∑–∫–æ–π –ø–æ –¥–æ—Å—Ç—É–ø–Ω—ã–º –∫–ª—é—á–∞–º. –≠—Ç–æ –ø–æ–º–æ–≥–∞–µ—Ç –æ–±–Ω–∞—Ä—É–∂–∏—Ç—å –æ–ø–µ—á–∞—Ç–∫—É –≤ –Ω–∞–∑–≤–∞–Ω–∏–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏.

## üìà –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

1. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `ZoneAnalysisResult.visualize(zone_id=...)` (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω –≤ –≤–∞—à–µ–π —Å–±–æ—Ä–∫–µ) –∏–ª–∏ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ –≥—Ä–∞—Ñ–∏–∫–∏ Matplotlib.
2. –°—Ä–∞–≤–Ω–∏–≤–∞–π—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–≤–∏–Ω–≥–æ–≤ –∏ –∞–º–ø–ª–∏—Ç—É–¥—ã –º–µ–∂–¥—É —Å—Ç—Ä–∞—Ç–µ–≥–∏—è–º–∏ –¥–ª—è –æ–¥–Ω–æ–π –∏ —Ç–æ–π –∂–µ –∑–æ–Ω—ã.
3. –§–∏–∫—Å–∏—Ä—É–π—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ changelog: –≥–ª–æ–±–∞–ª—å–Ω—ã–π —Ä–µ–∂–∏–º + –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏.

## üß™ –ö–æ–Ω—Ç—Ä–æ–ª—å –∫–∞—á–µ—Å—Ç–≤–∞

- –ó–∞–ø—É—Å–∫–∞–π—Ç–µ smoke-—Ç–µ—Å—Ç—ã –ø–∞–π–ø–ª–∞–π–Ω–∞ (`tests/integration/test_pipeline_global_swings.py`), –µ—Å–ª–∏ –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.
- –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ `ZoneInfo.metadata['swing_scope']` ‚Äî –æ–Ω –¥–æ–ª–∂–µ–Ω —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å —Ä–µ–∂–∏–º–æ–º, –∫–æ—Ç–æ—Ä—ã–π –≤—ã —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–ª–∏ –≤ builder.
- –î–ª—è –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –Ω–æ—É—Ç–±—É–∫–æ–≤ —Å–æ—Ö—Ä–∞–Ω—è–π—Ç–µ `SwingPoint`-–æ–±—ä–µ–∫—Ç—ã –≤ `DataFrame`, —á—Ç–æ–±—ã –ø–æ–≤—Ç–æ—Ä–Ω–æ —Å—Ç—Ä–æ–∏—Ç—å –≥—Ä–∞—Ñ–∏–∫–∏ –±–µ–∑ –ø–µ—Ä–µ—Å—á—ë—Ç–∞.

