# Аналитический отчёт по состоятельности бычьих зон MACD

Этот отчёт фиксирует результаты запуска `research/notebooks/05_case_study_zone_consistency.py` с параметром `--no-trap` и анализирует полученные метрики по шагам пайплайна.

## Шаг 1. Данные и гипотезы
- Исходный датасет: `tv_xauusd_1h`, 1000 баров за период 11.06.2025 20:00 (+07) — 12.08.2025 13:00 (+07).【85502d†L15-L24】
- Гипотеза H1: внутри бычьих зон MACD средние ап‑свинги превышают даун‑свинги; H0 утверждает отсутствие статистически значимой разницы.【85502d†L18-L24】

## Шаг 2. Исследовательский анализ зон (EDA)
- Детектор `zero_crossing` выявил 72 зоны (37 бычьих, 35 медвежьих).【85502d†L31-L36】
- Инвентаризация метрик подтвердила наличие полного набора swing-метрик в `metadata` зон.【6a58e1†L14-L23】
- При использовании пресета `narrow_zone` с `find_peaks` только 7 из 37 бычьих зон (19%) имели хотя бы один свинг; остальные 81% давали `num_swings = 0`, среднее число свингов — 0.22, в среднем 0.54 ап‑свинга и 0.35 даун‑свинга на зону.【6a58e1†L25-L35】【F:outputs/reports/macd_zone_consistency_results.json†L3-L16】

## Шаг 2. Основной эксперимент
Пайплайн повторно запускался с отключённым кэшем для двух конфигураций swing-параметров и трёх стратегий (`find_peaks`, `pivot_points`, `zigzag`).

### Конфигурация «Узкий пресет (фиксированные пороги)»
- `find_peaks`: 7/37 зон (18.9%) содержат свинги; собрано 7 пар «ап‑/даун‑свинг», этого недостаточно для теста Уилкоксона.【6a58e1†L43-L59】【F:outputs/reports/macd_zone_consistency_results.json†L18-L35】
- `pivot_points`: 3/37 зон (8.1%) со свингами; всего 3 пары, тест не выполнялся из-за малого объёма данных.【6a58e1†L60-L80】【F:outputs/reports/macd_zone_consistency_results.json†L36-L51】
- `zigzag`: 23/37 зон (62.2%) со свингами, 23 пары; тест Уилкоксона дал статистику 232.0 и p-value 0.0015, что подтверждает преимущество ап‑свингов на уровне значимости 0.05.【734648†L1-L33】【171dc9†L1-L20】【F:outputs/reports/macd_zone_consistency_results.json†L52-L67】

### Конфигурация «Узкий пресет + авто-пороги»
- `find_peaks`: при включённой авто-настройке порогов 0/37 зон содержат свинги, парные наблюдения отсутствуют.【734648†L34-L58】【F:outputs/reports/macd_zone_consistency_results.json†L68-L83】
- `pivot_points`: также 0/37 зон со свингами; тест невозможен.【734648†L59-L78】【F:outputs/reports/macd_zone_consistency_results.json†L84-L99】
- `zigzag`: сохраняет покрытие 23/37 зон (62.2%) и повторяет статистику 232.0 с p-value 0.0015.【734648†L79-L92】【171dc9†L21-L32】【F:outputs/reports/macd_zone_consistency_results.json†L100-L115】

## Шаг 3. Сводка и выводы
- Единственная комбинация, обеспечившая достаточное покрытие и статистически значимый результат, — стратегия `zigzag` с фиксированным пресетом `narrow_zone` (p-value 0.0015 < 0.05).【171dc9†L23-L44】【F:outputs/reports/macd_zone_consistency_results.json†L52-L67】
- Автоматическое масштабирование порогов обнуляет свинги для `find_peaks` и `pivot_points`, поэтому при текущих настройках их следует запускать только с фиксированными порогами или пересматривать параметры авто-тюнинга.【734648†L34-L78】【F:outputs/reports/macd_zone_consistency_results.json†L68-L99】
- Гипотеза H1 подтверждается для детектора `zigzag`: средние ап‑свинги внутри бычьих зон статистически превосходят даун‑свинги, что указывает на состоятельность MACD-булл-зон в исследуемом окне данных.【171dc9†L21-L44】

## Рекомендации
1. Использовать `with_swing_preset('narrow_zone')` и держать авто-пороги отключёнными для анализа MACD-булл-зон на подобных данных, если требуется покрытие ≥60% зон свингами.
2. Для `find_peaks` и `pivot_points` провести дополнительный подбор параметров авто-настройки, прежде чем включать `with_auto_swing_thresholds(True)` в исследовательских сценариях.
3. Контролировать покрытие свингами через экспортируемый JSON-отчёт `outputs/reports/macd_zone_consistency_results.json` при каждом обновлении пресетов или стратегий.
