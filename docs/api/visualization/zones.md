# Zone Visualization - –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∑–æ–Ω

## üìö –û–±–∑–æ—Ä

–ú–æ–¥—É–ª—å `bquant.visualization.zones` –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ —Ç–æ—Ä–≥–æ–≤—ã—Ö –∑–æ–Ω, –æ–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã—Ö —Å –ø–æ–º–æ—â—å—é [Universal Zone Analysis Pipeline](../analysis/zones.md). –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –¥–≤–∞ backend'–∞ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ ‚Äî **Plotly** (–∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π) –∏ **Matplotlib** (—Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π) ‚Äî —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º fallback –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫.

**–ö–ª—é—á–µ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
- üéØ **–î–≤–∞ –æ—Å–Ω–æ–≤–Ω—ã—Ö –ø–æ–¥—Ö–æ–¥–∞**: –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –≤—ã–∑–æ–≤ `result.visualize()` –∏ –ø—Ä—è–º–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–ª–∞—Å—Å–∞ `ZoneVisualizer`.
- üìä **4 —Ä–µ–∂–∏–º–∞ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏**: `overview`, `detail`, `comparison`, `statistics`.
- üïí **–ü—Ä–æ–¥–≤–∏–Ω—É—Ç–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Å—å—é –≤—Ä–µ–º–µ–Ω–∏**: –†–µ–∂–∏–º—ã `dense` (–±–µ–∑ —Ä–∞–∑—Ä—ã–≤–æ–≤) –∏ `timeseries` (—Ä–µ–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è).
- ‚öôÔ∏è **–ì–∏–±–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ, —è–≤–Ω–æ–µ —É–∫–∞–∑–∞–Ω–∏–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–∏–ø–æ–≤ –≥—Ä–∞—Ñ–∏–∫–æ–≤ (`line`/`bar`).
- üíæ **–£–¥–æ–±–Ω—ã–π —ç–∫—Å–ø–æ—Ä—Ç**: –í—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è `save_figure` —Å —É–º–Ω—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ PNG/HTML.
- üé® **–ü–æ–ª–Ω–∞—è –∫–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—è**: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º —Ç–∏–∫–æ–≤, –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º –≥—ç–ø–æ–≤ –∏ –ø–∞–Ω–µ–ª—è–º–∏.

---

## üöÄ –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Ä–∞–±–æ—á–∏–π –ø—Ä–æ—Ü–µ—Å—Å

–î–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ –∑–∞–¥–∞—á —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —Å–ª–µ–¥—É—é—â–∏–π –¥–≤—É—Ö—ç—Ç–∞–ø–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å:

1.  **–ê–Ω–∞–ª–∏–∑**: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ [Universal Zone Analysis Pipeline](../analysis/zones.md) –¥–ª—è –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è –∏ –∞–Ω–∞–ª–∏–∑–∞ –∑–æ–Ω.
    ```python
    from bquant.analysis.zones import analyze_zones
    from bquant.data.samples import get_sample_data

    # –ó–∞–ø—É—Å–∫–∞–µ–º –ø–∞–π–ø–ª–∞–π–Ω
    result = (
        analyze_zones(get_sample_data('tv_xauusd_1h'))
        .with_indicator('custom', 'macd')
        .detect_zones('zero_crossing', indicator_col='macd_hist')
        .analyze()
        .build()
    )
    ```

2.  **–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è**: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–µ—Ç–æ–¥ `result.visualize()` –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–æ–≤. –≠—Ç–æ —Å–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π –∏ –º–æ—â–Ω—ã–π —Å–ø–æ—Å–æ–±.
    ```python
    # –û–±—â–∏–π –æ–±–∑–æ—Ä –≤—Å–µ—Ö –∑–æ–Ω
    fig_overview = result.visualize('overview', title="MACD Zones Overview")

    # –î–µ—Ç–∞–ª—å–Ω—ã–π –æ–±–∑–æ—Ä –æ–¥–Ω–æ–π –∑–æ–Ω—ã
    fig_detail = result.visualize('detail', zone_id=3, context_bars=15)

    # –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∑–æ–Ω
    fig_comparison = result.visualize('comparison', max_zones=4)

    # –ü–æ–∫–∞–∑–∞—Ç—å –≥—Ä–∞—Ñ–∏–∫
    fig_overview.show()
    ```

---

## üéØ –í—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∏–∑ `ZoneAnalysisResult`

–ú–µ—Ç–æ–¥ `result.visualize(mode, **kwargs)` ‚Äî —ç—Ç–æ –æ—Å–Ω–æ–≤–Ω–æ–π –∏ –Ω–∞–∏–±–æ–ª–µ–µ —É–¥–æ–±–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏.

### –†–µ–∂–∏–º `overview`

–û–±—â–∏–π –æ–±–∑–æ—Ä –≤—Å–µ—Ö –∑–æ–Ω –Ω–∞ –≥—Ä–∞—Ñ–∏–∫–µ —Ü–µ–Ω—ã.

```python
fig = result.visualize(
    'overview',
    title="Zones Overview with Timeseries Axis",
    show_indicators=True,
    time_axis_mode='timeseries'  # –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å —É—á–µ—Ç–æ–º —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ (–≤–∫–ª—é—á–∞—è –≤—ã—Ö–æ–¥–Ω—ã–µ)
)
```

**–ö–ª—é—á–µ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã `overview`:**
- `show_indicators` (bool, default=`False`): –û—Ç–æ–±—Ä–∞–∑–∏—Ç—å –ø–∞–Ω–µ–ª—å —Å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞–º–∏.
- `indicator_chart_types` (dict, optional): –Ø–≤–Ω–æ –∑–∞–¥–∞—Ç—å —Ç–∏–ø –≥—Ä–∞—Ñ–∏–∫–∞ –¥–ª—è –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞. –ü—Ä–∏–º–µ—Ä: `{'macd_hist': 'bar'}`.
- `time_axis_mode` (str, default=`'dense'`): –†–µ–∂–∏–º –æ—Å–∏ –≤—Ä–µ–º–µ–Ω–∏.
  - `'dense'`: –£–±–∏—Ä–∞–µ—Ç —Ä–∞–∑—Ä—ã–≤—ã (–≤—ã—Ö–æ–¥–Ω—ã–µ), –æ—Ç–æ–±—Ä–∞–∂–∞—è —Ç–æ–ª—å–∫–æ —Ç–æ—Ä–≥–æ–≤—ã–µ –¥–Ω–∏. –ë—ã—Å—Ç—Ä–æ –∏ –∫–æ–º–ø–∞–∫—Ç–Ω–æ.
  - `'timeseries'`: –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤—Ä–µ–º–µ–Ω–Ω—É—é —à–∫–∞–ª—É, –ø–æ–∫–∞–∑—ã–≤–∞—è —Ä–∞–∑—Ä—ã–≤—ã. –ò–¥–µ–∞–ª—å–Ω–æ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –ø—Ä–æ–ø–æ—Ä—Ü–∏–π.
- `xaxis_num_ticks` (int, default=16): –ñ–µ–ª–∞–µ–º–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–µ—Ç–æ–∫ –Ω–∞ –æ—Å–∏ X (—Ç–æ–ª—å–∫–æ –¥–ª—è `dense` —Ä–µ–∂–∏–º–∞).
- `show_gap_lines` (bool, default=`False`): –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–µ –ª–∏–Ω–∏–∏ –≤ –º–µ—Å—Ç–∞—Ö –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ä–∞–∑—Ä—ã–≤–æ–≤.
- `date_range` (Tuple[datetime, datetime], optional): –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –¥–∏–∞–ø–∞–∑–æ–Ω—É –¥–∞—Ç. –°–º. [—Ä–∞–∑–¥–µ–ª –Ω–∏–∂–µ](#—Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è-–ø–æ-–¥–∏–∞–ø–∞–∑–æ–Ω—É-–¥–∞—Ç-date_range).
- `show_aggregate_metrics` (bool, default=`False`): –û—Ç–æ–±—Ä–∞–∑–∏—Ç—å –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –ø–æ –∑–æ–Ω–∞–º. –°–º. [—Ä–∞–∑–¥–µ–ª –Ω–∏–∂–µ](#–∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ-–º–µ—Ç—Ä–∏–∫–∏).
- `aggregate_metrics_mode` (str, default=`'compact'`): –†–µ–∂–∏–º –≤—ã–≤–æ–¥–∞ –º–µ—Ç—Ä–∏–∫ (`'compact'` –∏–ª–∏ `'full'`).
- `show_swings` (bool, default=`False`): –û—Ç–æ–±—Ä–∞–∑–∏—Ç—å swing-—Ç–æ—á–∫–∏ (peaks/troughs) –Ω–∞ –≥—Ä–∞—Ñ–∏–∫–µ.
- `swing_marker_size` (int, default=8): –†–∞–∑–º–µ—Ä –º–∞—Ä–∫–µ—Ä–æ–≤ –¥–ª—è swing-—Ç–æ—á–µ–∫.

#### –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –¥–∏–∞–ø–∞–∑–æ–Ω—É –¥–∞—Ç: `date_range`

–ü—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ `date_range` –≤–∏–∑—É–∞–ª–∏–∑–∞—Ç–æ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç –∫–∞–∫ –¥–∞–Ω–Ω—ã–µ, —Ç–∞–∫ –∏ –∑–æ–Ω—ã:

```python
import pandas as pd

# –°–æ–∑–¥–∞–µ–º –¥–∏–∞–ø–∞–∑–æ–Ω –¥–∞—Ç
start_date = pd.Timestamp('2025-06-25', tz='UTC')
end_date = pd.Timestamp('2025-07-03', tz='UTC')

# –í–∏–∑—É–∞–ª–∏–∑–∏—Ä—É–µ–º —Ç–æ–ª—å–∫–æ —ç—Ç–æ—Ç –ø–µ—Ä–∏–æ–¥
fig = result.visualize(
    'overview',
    date_range=(start_date, end_date),
    title=f"Zones from {start_date.date()} to {end_date.date()}",
    show_aggregate_metrics=True,  # –ú–µ—Ç—Ä–∏–∫–∏ –±—É–¥—É—Ç —Å—á–∏—Ç–∞—Ç—å—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è —ç—Ç–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞!
    show_swings=True
)
```

**‚ö†Ô∏è –í–∞–∂–Ω–æ**: –ê–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω—ã) —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è **—Ç–æ–ª—å–∫–æ –¥–ª—è –∑–æ–Ω –≤ –≤—ã–±—Ä–∞–Ω–Ω–æ–º –¥–∏–∞–ø–∞–∑–æ–Ω–µ**, –∞ –Ω–µ –ø–æ –≤—Å–µ–º—É –¥–∞—Ç–∞—Å–µ—Ç—É. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –∑–æ–Ω –≤ —Ä–∞–∑–Ω—ã–µ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–µ—Ä–∏–æ–¥—ã.

**–ü—Ä–∏–º–µ—Ä use case** - —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–æ–≤–µ–¥–µ–Ω–∏—è –∑–æ–Ω –ø–æ –º–µ—Å—è—Ü–∞–º:
```python
# –ò—é–Ω—å
fig_june = result.visualize('overview',
    date_range=(pd.Timestamp('2025-06-01'), pd.Timestamp('2025-06-30')),
    show_aggregate_metrics=True, aggregate_metrics_mode='full')

# –ò—é–ª—å
fig_july = result.visualize('overview',
    date_range=(pd.Timestamp('2025-07-01'), pd.Timestamp('2025-07-31')),
    show_aggregate_metrics=True, aggregate_metrics_mode='full')

# –ú–µ—Ç—Ä–∏–∫–∏ –±—É–¥—É—Ç —Ä–∞–∑–Ω—ã–µ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –º–µ—Å—è—Ü–∞!
```

#### –ê–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏

–ü–∞—Ä–∞–º–µ—Ç—Ä `show_aggregate_metrics` –¥–æ–±–∞–≤–ª—è–µ—Ç –Ω–∞ –≥—Ä–∞—Ñ–∏–∫ —Ç–µ–∫—Å—Ç–æ–≤—É—é –∞–Ω–Ω–æ—Ç–∞—Ü–∏—é —Å –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π –ø–æ bull/bear –∑–æ–Ω–∞–º:

```python
fig = result.visualize(
    'overview',
    show_aggregate_metrics=True,        # –í–∫–ª—é—á–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏
    aggregate_metrics_mode='compact',   # –†–µ–∂–∏–º: 'compact' (8 —Å—Ç—Ä–æ–∫) –∏–ª–∏ 'full' (~16 —Å—Ç—Ä–æ–∫)
)
```

**–†–µ–∂–∏–º—ã –≤—ã–≤–æ–¥–∞**:

- **`compact`** (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, 8 —Å—Ç—Ä–æ–∫):
  ```
  üìä Bull Zones: 37/37 with swings (100%)
    Avg Rally: +1.11% ¬± 0.70%
    Avg Drop: -1.00% ¬± 0.64%
    Rally/Drop Ratio: 1.11x
  ```

- **`full`** (~16 —Å—Ç—Ä–æ–∫, –≤–∫–ª—é—á–∞–µ—Ç –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏):
  ```
  üìä Bull Zones: 37/37 with swings (100%)
    Avg Rally: +1.11% ¬± 0.70% (3.5 ¬± 1.2 bars)
    Avg Drop: -1.00% ¬± 0.64% (2.1 ¬± 0.8 bars)
    Rally/Drop Ratio: 1.11x
    Avg Swing Duration: 2.8 ¬± 1.5 bars
  ```

**–ú–µ—Ç—Ä–∏–∫–∏ –≤–∫–ª—é—á–∞—é—Ç** (v1.0):
- –ü–æ–∫—Ä—ã—Ç–∏–µ –∑–æ–Ω —Å–≤–∏–Ω–≥–∞–º–∏ (% –∑–æ–Ω —Å –æ–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–º–∏ —Å–≤–∏–Ω–≥–∞–º–∏)
- –°—Ä–µ–¥–Ω—è—è –∞–º–ø–ª–∏—Ç—É–¥–∞ rally/drop (mean ¬± std)
- Ratio (—Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ rally –∫ drop)
- –°—Ä–µ–¥–Ω—è—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –¥–≤–∏–∂–µ–Ω–∏–π –≤ –±–∞—Ä–∞—Ö (—Ç–æ–ª—å–∫–æ –≤ `full` —Ä–µ–∂–∏–º–µ)

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ**: –¢–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è (v1.0) –∏—Å–ø–æ–ª—å–∑—É–µ—Ç MVP-–∞–≥—Ä–µ–≥–∞—Ü–∏—é —Å mean¬±std. –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è (v1.2) —Å median/IQR –∏ shape –º–µ—Ç—Ä–∏–∫–∞–º–∏ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∞. –°–º. [zomet_v1.2_advanced_aggregation.md](../../../devref/gaps/graph/zomet_v1.2_advanced_aggregation.md).

---

### –†–µ–∂–∏–º `detail`

–î–µ—Ç–∞–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä –æ–¥–Ω–æ–π –∑–æ–Ω—ã —Å –æ–∫—Ä—É–∂–∞—é—â–∏–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º.

```python
# –ù–∞–π—Ç–∏ –∑–æ–Ω—É –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
median_zone = min(result.zones, key=lambda z: abs(z.duration - 30))

fig = result.visualize(
    'detail',
    zone_id=median_zone.zone_id,
    context_bars=20,
    show_indicators=True,
    show_volume=True,
    time_axis_mode='dense',
    xaxis_num_ticks=20,
    title=f"Detail for Zone #{median_zone.zone_id}"
)
```

**–ö–ª—é—á–µ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã `detail`:**
- `zone_id` (int, **required**): ID –∑–æ–Ω—ã –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞.
- `context_bars` (int, default=20): –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–∞—Ä–æ–≤ –¥–æ –∏ –ø–æ—Å–ª–µ –∑–æ–Ω—ã –¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞.
- `show_indicators` (bool, default=`True`): –ü–æ–∫–∞–∑–∞—Ç—å –ø–∞–Ω–µ–ª—å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤.
- `show_volume` (bool, default=`True`): –ü–æ–∫–∞–∑–∞—Ç—å –ø–∞–Ω–µ–ª—å –æ–±—ä–µ–º–∞.
- `time_axis_mode` (str, default=`'dense'`): –†–µ–∂–∏–º –æ—Å–∏ –≤—Ä–µ–º–µ–Ω–∏ (`dense` –∏–ª–∏ `timeseries`).
- `xaxis_num_ticks` (int, default=16): –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–µ—Ç–æ–∫ –Ω–∞ –æ—Å–∏ X (–¥–ª—è `dense` —Ä–µ–∂–∏–º–∞).

---

### –†–µ–∂–∏–º `comparison`

–°—Ä–∞–≤–Ω–µ–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∑–æ–Ω, –∫–∞–∂–¥–∞—è –≤ —Å–≤–æ–µ–º "—Å–ª–æ—Ç–µ" –¥–ª—è —É–¥–æ–±–Ω–æ–≥–æ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è.

```python
fig = result.visualize(
    'comparison',
    max_zones=4,
    comparison_context=10, # –ú–µ–Ω—å—à–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
    show_indicators=True,
    time_axis_mode='dense',
    title="Comparison of 4 Zones"
)
```

**–ö–ª—é—á–µ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã `comparison`:**
- `max_zones` (int, default=5): –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–æ–Ω –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è.
- `date_range` (Tuple[datetime, datetime], optional): –î–∏–∞–ø–∞–∑–æ–Ω –¥–∞—Ç –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –∑–æ–Ω.
- `comparison_context` (int, default=30): –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–∞—Ä–æ–≤ –¥–æ –∏ –ø–æ—Å–ª–µ *–∫–∞–∂–¥–æ–π* –∑–æ–Ω—ã –≤ —Ä–µ–∂–∏–º–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è.
- `time_axis_mode` (str, default=`'dense'`): –†–µ–∂–∏–º –æ—Å–∏ –≤—Ä–µ–º–µ–Ω–∏.

---

### –†–µ–∂–∏–º `statistics`

–°—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ –≤—Å–µ—Ö –∑–æ–Ω (—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è, —Ç–∏–ø—ã –∏ —Ç.–¥.).

```python
fig = result.visualize('statistics', title='Zone Statistics')
```
**–í–Ω—É—Ç—Ä–∏ –≤—ã–∑—ã–≤–∞–µ—Ç:** `ZoneVisualizer.plot_zones_analysis()`

---

## üíæ –≠–∫—Å–ø–æ—Ä—Ç –≥—Ä–∞—Ñ–∏–∫–æ–≤: `save_figure`

–í–º–µ—Å—Ç–æ `fig.write_html()` –∏–ª–∏ `fig.write_image()`, —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é `save_figure` –∏–∑ `bquant.visualization.export`.

```python
from bquant.visualization.export import save_figure

# –°–æ–∑–¥–∞–µ–º –≥—Ä–∞—Ñ–∏–∫
fig = result.visualize('overview', time_axis_mode='timeseries')

# –ü—Ä–æ—Å—Ç–æ —Å–æ—Ö—Ä–∞–Ω—è–µ–º
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—Å—Ç –ø–∞–ø–∫—É –∏ –≤—ã–±–µ—Ä–µ—Ç —Ñ–æ—Ä–º–∞—Ç
saved_path = save_figure(fig, "01_overview_timeseries")
print(f"Chart saved to: {saved_path}")

# –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å –∫–∞—Å—Ç–æ–º–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
saved_path_png = save_figure(
    fig,
    "01_overview_custom",
    output_dir="C:/Users/Ivan/Documents/pro/bquant/output/my_charts",
    prefer='png',  # –ü—Ä–µ–¥–ø–æ—á–µ—Å—Ç—å PNG, –µ—Å–ª–∏ –≤–æ–∑–º–æ–∂–Ω–æ
    width=1600,
    height=900
)
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ `save_figure`:**
- **–£–º–Ω—ã–µ –ø—É—Ç–∏**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ `output/vis/<–∏–º—è_—Å–∫—Ä–∏–ø—Ç–∞>/<–∏–º—è_—Ñ–∞–π–ª–∞>`.
- **–ù–∞–¥–µ–∂–Ω—ã–π —ç–∫—Å–ø–æ—Ä—Ç**: –ü—ã—Ç–∞–µ—Ç—Å—è —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ `PNG` (–µ—Å–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω `kaleido`), –ø—Ä–∏ –æ—à–∏–±–∫–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –Ω–∞ `HTML`.
- **–ü—Ä–æ—Å—Ç–æ—Ç–∞**: –¢—Ä–µ–±—É–µ—Ç —Ç–æ–ª—å–∫–æ —Ñ–∏–≥—É—Ä—É –∏ –∏–º—è —Ñ–∞–π–ª–∞.

---

## üèóÔ∏è –ü—Ä—è–º–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `ZoneVisualizer`

–î–ª—è –ø–æ–ª–Ω–æ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª—è –Ω–∞–¥ –ø—Ä–æ—Ü–µ—Å—Å–æ–º –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–ª–∞—Å—Å `ZoneVisualizer` –Ω–∞–ø—Ä—è–º—É—é.

```python
from bquant.visualization import ZoneVisualizer

# 1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
visualizer = ZoneVisualizer(backend='plotly')

# 2. –í—ã–∑–æ–≤ –º–µ—Ç–æ–¥–æ–≤ —Å –ø–æ–ª–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
fig_detail = visualizer.plot_zone_detail(
    price_data=result.data,
    zone=median_zone,
    context_bars=15,
    show_indicators=True,
    indicator_chart_types={'macd_hist': 'bar'}, # –Ø–≤–Ω–æ –∑–∞–¥–∞–µ–º –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º—É
    time_axis_mode='dense',
    title="Detail from ZoneVisualizer"
)
fig_detail.show()
```

### –û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã `ZoneVisualizer`

- `plot_zones_on_price_chart()`: –û—Å–Ω–æ–≤–∞ –¥–ª—è —Ä–µ–∂–∏–º–∞ `overview`.
- `plot_zone_detail()`: –û—Å–Ω–æ–≤–∞ –¥–ª—è —Ä–µ–∂–∏–º–∞ `detail`.
- `plot_zones_comparison()`: –û—Å–Ω–æ–≤–∞ –¥–ª—è —Ä–µ–∂–∏–º–∞ `comparison`.

–í—Å–µ —ç—Ç–∏ –º–µ—Ç–æ–¥—ã –ø—Ä–∏–Ω–∏–º–∞—é—Ç —Ç–µ –∂–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã, —á—Ç–æ –∏ `result.visualize()`, –Ω–æ —Ç—Ä–µ–±—É—é—Ç —è–≤–Ω–æ–π –ø–µ—Ä–µ–¥–∞—á–∏ `price_data` –∏ –¥–∞–Ω–Ω—ã—Ö –æ –∑–æ–Ω–∞—Ö.

---

## üîß Convenience-—Ñ—É–Ω–∫—Ü–∏–∏

–î–ª—è –±—ã—Å—Ç—Ä—ã—Ö –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–π –±–µ–∑ —Å–æ–∑–¥–∞–Ω–∏—è `ZoneVisualizer` –∏–ª–∏ `ZoneAnalysisResult`.

```python
from bquant.visualization import plot_zone_detail, plot_zones_comparison

# –î–µ—Ç–∞–ª—å–Ω—ã–π –≥—Ä–∞—Ñ–∏–∫
fig_detail = plot_zone_detail(result.data, median_zone, context_bars=10)

# –ì—Ä–∞—Ñ–∏–∫ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
fig_cmp = plot_zones_comparison(result.data, result.zones[:3], max_zones=3)
```
–≠—Ç–∏ —Ñ—É–Ω–∫—Ü–∏–∏ —è–≤–ª—è—é—Ç—Å—è –æ–±–µ—Ä—Ç–∫–∞–º–∏ –Ω–∞–¥ –º–µ—Ç–æ–¥–∞–º–∏ `ZoneVisualizer`.

---

## üìñ –ü–æ–ª–Ω—ã–π –ø—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

–≠—Ç–æ—Ç –ø—Ä–∏–º–µ—Ä –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –∫ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏, –≤–∫–ª—é—á–∞—è –∞–Ω–∞–ª–∏–∑, —Å–æ–∑–¥–∞–Ω–∏–µ —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –≥—Ä–∞—Ñ–∏–∫–æ–≤ –∏ –∏—Ö —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ.

```python
from bquant.data.samples import get_sample_data
from bquant.analysis.zones import analyze_zones
from bquant.visualization.export import save_figure
from datetime import datetime

# 1. –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏ –∞–Ω–∞–ª–∏–∑
data = get_sample_data('tv_xauusd_1h')
result = (
    analyze_zones(data)
    .with_indicator('custom', 'macd', fast_period=12, slow_period=26, signal_period=9)
    .detect_zones('zero_crossing', indicator_col='macd_hist', min_duration=3)
    .analyze(clustering=True)
    .build()
)
print(f"–û–±–Ω–∞—Ä—É–∂–µ–Ω–æ {len(result.zones)} –∑–æ–Ω.")

# 2. –°–æ–∑–¥–∞–Ω–∏–µ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–∞ "overview" –≤ —Ä–µ–∂–∏–º–µ timeseries
print("–°–æ–∑–¥–∞–Ω–∏–µ overview-–≥—Ä–∞—Ñ–∏–∫–∞ –≤ —Ä–µ–∂–∏–º–µ timeseries...")
fig_overview = result.visualize(
    'overview',
    title="–û–±–∑–æ—Ä –∑–æ–Ω MACD (—Ä–µ–∂–∏–º Timeseries)",
    show_indicators=True,
    time_axis_mode='timeseries' # –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø—Ä–æ–ø–æ—Ä—Ü–∏–∏ –≤—Ä–µ–º–µ–Ω–∏
)
save_figure(fig_overview, "01_overview_timeseries_mode")

# 3. –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –æ–¥–Ω–æ–π –∑–æ–Ω—ã
# –ù–∞—Ö–æ–¥–∏–º –∑–æ–Ω—É —Å –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é, –±–ª–∏–∑–∫–æ–π –∫ –º–µ–¥–∏–∞–Ω–Ω–æ–π
median_duration = result.statistics['duration_distribution']['overall']['median']
median_zone = min(result.zones, key=lambda z: abs(z.features['duration'] - median_duration))

print(f"–°–æ–∑–¥–∞–Ω–∏–µ –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –≥—Ä–∞—Ñ–∏–∫–∞ –¥–ª—è –∑–æ–Ω—ã #{median_zone.zone_id}...")
fig_detail = result.visualize(
    'detail',
    zone_id=median_zone.zone_id,
    context_bars=25,
    show_indicators=True,
    indicator_chart_types={'macd_hist': 'bar'}, # –Ø–≤–Ω–æ–µ —É–∫–∞–∑–∞–Ω–∏–µ —Ç–∏–ø–∞ –≥—Ä–∞—Ñ–∏–∫–∞
    time_axis_mode='dense', # –ö–æ–º–ø–∞–∫—Ç–Ω—ã–π –≤–∏–¥
    xaxis_num_ticks=20,
    title=f"–î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –∑–æ–Ω—ã #{median_zone.zone_id}"
)
save_figure(fig_detail, f"02_detail_zone_{median_zone.zone_id}")

# 4. –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–µ—Ä–≤—ã—Ö 4 –∑–æ–Ω
print("–°–æ–∑–¥–∞–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–∞ –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è 4 –∑–æ–Ω...")
fig_comparison = result.visualize(
    'comparison',
    max_zones=4,
    comparison_context=5, # –ù–µ–±–æ–ª—å—à–æ–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
    show_indicators=True,
    title="–°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–µ—Ä–≤—ã—Ö 4 –∑–æ–Ω"
)
save_figure(fig_comparison, "03_comparison_4_zones")

print("–í—Å–µ –≥—Ä–∞—Ñ–∏–∫–∏ —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω—ã –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ –ø–∞–ø–∫—É 'output/vis/'.")
```

---

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ä–∞–∑–¥–µ–ª—ã

- **[Zone Analysis](../analysis/zones.md)**: –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ `ZoneAnalysisResult`.
- **[research/notebooks/04_zones_sample.py](../../../research/notebooks/04_zones_sample.py)**: –ê–∫—Ç—É–∞–ª—å–Ω—ã–π —Å–∫—Ä–∏–ø—Ç —Å –ø–æ–ª–Ω—ã–º –ø–æ–∫—Ä—ã—Ç–∏–µ–º –≤—Å–µ—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤.

---

## üìù Changelog

- **v1.0** (2025-11-11):
  - ‚ú® **–ê–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏**: –ù–æ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã `show_aggregate_metrics` –∏ `aggregate_metrics_mode` –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ –∑–æ–Ω–∞–º.
  - ‚ú® **–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Å–≤–∏–Ω–≥–æ–≤**: –ü–∞—Ä–∞–º–µ—Ç—Ä `show_swings` –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è swing-—Ç–æ—á–µ–∫ (peaks/troughs) –Ω–∞ –≥—Ä–∞—Ñ–∏–∫–µ.
  - ‚ú® **–ú–µ—Ç—Ä–∏–∫–∏ –∑–æ–Ω –≤ detail —Ä–µ–∂–∏–º–µ**: –ü–∞—Ä–∞–º–µ—Ç—Ä—ã `show_zone_metrics` –∏ `show_zone_stats` –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞.
  - üêõ **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –∞–≥—Ä–µ–≥–∞—Ü–∏—è**: –¢–µ–ø–µ—Ä—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –Ω–µ—Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–≤–∏–Ω–≥–∏ –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∫–ª—é—á–∏ (`avg_rally_pct`).
  - üìö **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: –î–æ–±–∞–≤–ª–µ–Ω—ã —Ä–∞–∑–¥–µ–ª—ã –ø–æ –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –º–µ—Ç—Ä–∏–∫–∞–º –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ `date_range`.

- **v0.0.1** (2025-11-05):
  - ‚ú® **–î–æ–±–∞–≤–ª–µ–Ω `time_axis_mode`**: –ü–∞—Ä–∞–º–µ—Ç—Ä –¥–ª—è –≤—ã–±–æ—Ä–∞ –º–µ–∂–¥—É `dense` –∏ `timeseries` —Ä–µ–∂–∏–º–∞–º–∏ –æ—Å–∏ –≤—Ä–µ–º–µ–Ω–∏.
  - ‚ú® **–î–æ–±–∞–≤–ª–µ–Ω `xaxis_num_ticks`**: –ü–∞—Ä–∞–º–µ—Ç—Ä –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –º–µ—Ç–æ–∫ –Ω–∞ –æ—Å–∏ X –≤ `dense` —Ä–µ–∂–∏–º–µ.
  - ‚ú® **–î–æ–±–∞–≤–ª–µ–Ω `indicator_chart_types`**: –ü–æ–∑–≤–æ–ª—è–µ—Ç —è–≤–Ω–æ –∑–∞–¥–∞–≤–∞—Ç—å —Ç–∏–ø –≥—Ä–∞—Ñ–∏–∫–∞ –¥–ª—è –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤ (`bar`/`line`).
  - ‚ú® **–î–æ–±–∞–≤–ª–µ–Ω `comparison_context`**: –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –¥–ª—è —Ä–µ–∂–∏–º–∞ `comparison`.
  - üìö **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: –ü–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∞–Ω–∞ –¥–ª—è –æ—Ç—Ä–∞–∂–µ–Ω–∏—è –Ω–æ–≤—ã—Ö –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π –∏ –ª—É—á—à–∏—Ö –ø—Ä–∞–∫—Ç–∏–∫.

- **v0.0.0** (2025-10-28):
  - üéâ **–ù–∞—á–∞–ª—å–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è**: –î–æ–±–∞–≤–ª–µ–Ω—ã `plot_zone_detail()`, `plot_zones_comparison()`.
  - üéâ **–í—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è**: `ZoneAnalysisResult.visualize()`.
  - üéâ **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ Backends**: Plotly –∏ Matplotlib.

