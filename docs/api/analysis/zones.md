# bquant.analysis.zones ‚Äî –ê–Ω–∞–ª–∏–∑ –∑–æ–Ω

> **–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**
> 
> –ê–Ω–∞–ª–∏–∑ –∑–æ–Ω —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç —Å **–õ–Æ–ë–´–ú –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–º** –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π –∫–æ–¥–∞!
> 
> **–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã:**
> - –õ–Æ–ë–û–ô –æ—Å—Ü–∏–ª–ª—è—Ç–æ—Ä: MACD, RSI, AO, CCI, Stochastic, Williams %R, MFI, CMF, ROC
> - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –∏–∑ pandas_ta (158 –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤)
> - –í–∞—à–∏ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ä–∞—Å—á–µ—Ç—ã
> 
> **–ö–ª—é—á–µ–≤–∞—è –∏–Ω–Ω–æ–≤–∞—Ü–∏—è:** `ZoneInfo.indicator_context` - –∑–æ–Ω—ã —Å–∞–º–∏ –æ–ø–∏—Å—ã–≤–∞—é—Ç —Å–≤–æ—é —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –¥–µ—Ç–µ–∫—Ü–∏–∏
> 
> **–î–æ–∫–∞–∑–∞–Ω–Ω–∞—è —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ—Å—Ç—å:**
> - ‚úÖ 115 —Ç–µ—Å—Ç–æ–≤ —Å 10+ —Ä–µ–∞–ª—å–Ω—ã–º–∏ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞–º–∏ (MACD, RSI, AO, CCI, Stochastic, Williams, MFI, CMF, ROC, custom)
> - ‚úÖ 100% –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤
> - ‚úÖ FICTIONAL_INDICATOR_99 —Ç–µ—Å—Ç - —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–º, –∫–æ—Ç–æ—Ä–æ–≥–æ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç!
> - ‚úÖ –ù–ï–¢ –∂–µ—Å—Ç–∫–æ –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∏–º–µ–Ω –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤
> 
> **–°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ API:**
> - [–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–µ –°—Ç—Ä–∞—Ç–µ–≥–∏–∏](strategies.md) - –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –¥–ª—è –õ–Æ–ë–û–ì–û –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞
> - [–†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –†–∞—Å—à–∏—Ä–µ–Ω–∏—é](../developer_guide/zone_detection_strategies.md) - —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Å—Ç—Ä–∞—Ç–µ–≥–∏–π

## –û–±–∑–æ—Ä

–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã —Ä–∞–±–æ—Ç—ã —Å —Ç–æ—Ä–≥–æ–≤—ã–º–∏ –∑–æ–Ω–∞–º–∏: –ø–æ–¥–¥–µ—Ä–∂–∫–∞/—Å–æ–ø—Ä–æ—Ç–∏–≤–ª–µ–Ω–∏–µ, –ø—Ä–∏–∑–Ω–∞–∫–∏ –∑–æ–Ω, –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏ –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è.

## –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (v2.1)

### –ö–ª—é—á–µ–≤–∞—è –ö–æ–Ω—Ü–µ–ø—Ü–∏—è: indicator_context

–ö–∞–∂–¥–∞—è –æ–±–Ω–∞—Ä—É–∂–µ–Ω–Ω–∞—è –∑–æ–Ω–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–ª–æ–≤–∞—Ä—å `indicator_context`, –∫–æ—Ç–æ—Ä—ã–π –æ–ø–∏—Å—ã–≤–∞–µ—Ç **–ö–ê–ö** –∑–æ–Ω–∞ –±—ã–ª–∞ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∞:

```python
from bquant.analysis.zones import analyze_zones

result = analyze_zones(df).detect_zones('zero_crossing', indicator_col='RSI_14').build()

# Access zone's detection context
zone = result.zones[0]
context = zone.indicator_context

print(context['detection_indicator'])  # ‚Üí 'RSI_14'
print(context['detection_strategy'])   # ‚Üí 'zero_crossing'
print(context['signal_line'])          # ‚Üí None (single-line indicator)
```

**–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –ø–æ–ª—è (–∑–∞–ø–æ–ª–Ω—è—é—Ç—Å—è —Å—Ç—Ä–∞—Ç–µ–≥–∏–µ–π –¥–µ—Ç–µ–∫—Ü–∏–∏):**
- `detection_indicator`: –ò–º—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Å—Ç–æ–ª–±—Ü–∞ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 'RSI_14', 'macd_hist')
- `detection_strategy`: –ò—Å–ø–æ–ª—å–∑—É–µ–º–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, 'zero_crossing', 'threshold', 'line_crossing')
- `signal_line`: –í—Ç–æ—Ä–∏—á–Ω—ã–π –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –¥–ª—è 2-–ª–∏–Ω–µ–π–Ω—ã—Ö —Å—Ç—Ä–∞—Ç–µ–≥–∏–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, 'STOCH_D')
- `detection_rules`: –ü–æ–ª–Ω—ã–π —Å–ª–æ–≤–∞—Ä—å –ø—Ä–∞–≤–∏–ª –¥–ª—è —Å–ø—Ä–∞–≤–∫–∏

**–£–¥–æ–±–Ω—ã–µ –º–µ—Ç–æ–¥—ã:**
```python
# Get primary indicator column
indicator = zone.get_primary_indicator_column()  # ‚Üí 'RSI_14'

# Get signal line (if exists)
signal = zone.get_signal_line_column()  # ‚Üí 'STOCH_D' or None
```

### –ü—Ä–∏–º–µ—Ä—ã —Å –†–∞–∑–Ω—ã–º–∏ –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞–º–∏

#### MACD (zero-crossing oscillator)
```python
result = (
    analyze_zones(df)
    .with_indicator('custom', 'macd', fast_period=12, slow_period=26, signal_period=9)
    .detect_zones('zero_crossing', indicator_col='macd_hist')
    .analyze()
    .build()
)

# Context: {'detection_indicator': 'macd_hist', 'detection_strategy': 'zero_crossing'}
```

#### RSI (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–æ—Ä–æ–≥–æ–≤)
```python
result = (
    analyze_zones(df)
    .with_indicator('pandas_ta', 'rsi', length=14)
    .detect_zones('threshold',
                 indicator_col='RSI_14',
                 upper_threshold=70,
                 lower_threshold=30)
    .analyze()
    .build()
)

# Context: {'detection_indicator': 'RSI_14', 'detection_strategy': 'threshold'}
```

#### Stochastic (–ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ 2 –ª–∏–Ω–∏–π)
```python
result = (
    analyze_zones(df)
    .with_indicator('pandas_ta', 'stoch', k=14, d=3)
    .detect_zones('line_crossing',
                 line1_col='STOCHk_14_3_3',
                 line2_col='STOCHd_14_3_3')
    .analyze()
    .build()
)

# Context: {'detection_indicator': 'STOCHk_14_3_3', 'signal_line': 'STOCHd_14_3_3'}
```

#### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä (–¥–æ–∫–∞–∑—ã–≤–∞–µ—Ç —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ—Å—Ç—å!)
```python
# Create your own indicator
df['MY_CUSTOM_OSC'] = df['close'].diff(5) / df['close'].rolling(20).std()

result = (
    analyze_zones(df)
    .detect_zones('zero_crossing', indicator_col='MY_CUSTOM_OSC')
    .analyze()
    .build()
)

# ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç —Å—Ä–∞–∑—É - –ù–ï–¢ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –≤ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö –∫–æ–¥–∞!
# Context: {'detection_indicator': 'MY_CUSTOM_OSC', 'detection_strategy': 'zero_crossing'}
```

#### FICTIONAL_INDICATOR_99 (—Ñ–∏–Ω–∞–ª—å–Ω–æ–µ –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–æ)

```python
import numpy as np
from bquant.analysis.zones import analyze_zones
from bquant.data.samples import get_sample_data

df = get_sample_data('tv_xauusd_1h').copy()

# –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä, –∫–æ—Ç–æ—Ä–æ–≥–æ –ù–ï —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ –∫–æ–¥–æ–≤–æ–π –±–∞–∑–µ ‚Äî —Å–æ–∑–¥–∞—ë–º —Å–∏–Ω—É—Å–æ–∏–¥—É
df['FICTIONAL_INDICATOR_99'] = np.sin(np.linspace(0, 6 * np.pi, len(df))) * 5

result = (
    analyze_zones(df)
    .detect_zones('zero_crossing', indicator_col='FICTIONAL_INDICATOR_99')
    .analyze()
    .build()
)

first_zone = result.zones[0]
print(len(result.zones))  # ‚Üí 4 –∑–æ–Ω—ã
print(first_zone.indicator_context['detection_indicator'])  # ‚Üí 'FICTIONAL_INDICATOR_99'
```

> ‚úÖ **–ï—Å–ª–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–º, –∫–æ—Ç–æ—Ä–æ–≥–æ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –±—ã–ª–æ –≤ –∫–æ–¥–µ,** —Ç–æ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞.



### –ß—Ç–æ –ù–æ–≤–æ–≥–æ –≤ v2.1

**–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –ê–Ω–∞–ª–∏–∑ –ó–æ–Ω:**
- ‚ú® **5 –°—Ç—Ä–∞—Ç–µ–≥–∏–π –î–µ—Ç–µ–∫—Ü–∏–∏** - zero_crossing, threshold, line_crossing, preloaded, combined
- ‚ú® **–†–∞–±–æ—Ç–∞–µ—Ç —Å –õ–Æ–ë–´–ú –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–º** - MACD, RSI, Stochastic, AO, CCI, custom, etc.
- ‚ú® **indicator_context** - –∑–æ–Ω—ã —Å–∞–º–∏ –æ–ø–∏—Å—ã–≤–∞—é—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–µ—Ç–µ–∫—Ü–∏–∏
- ‚ú® **Pipeline API** - fluent builder —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
- ‚ú® **–î–æ–∫–∞–∑–∞–Ω–Ω–∞—è —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ—Å—Ç—å** - FICTIONAL_INDICATOR_99 —Ç–µ—Å—Ç –ø—Ä–æ—Ö–æ–¥–∏—Ç

**–ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ –°—Ç—Ä–∞—Ç–µ–≥–∏–∏ (67 –º–µ—Ç—Ä–∏–∫ –≤—Å–µ–≥–æ):**
- ‚ú® **–ü–∞—Ç—Ç–µ—Ä–Ω –°—Ç—Ä–∞—Ç–µ–≥–∏—è** –¥–ª—è —Ä–∞—Å—à–∏—Ä—è–µ–º—ã—Ö –º–µ—Ç—Ä–∏–∫ (8 —Å—Ç—Ä–∞—Ç–µ–≥–∏–π)
- ‚ú® **Swing –∞–Ω–∞–ª–∏–∑:** 23 –º–µ—Ç—Ä–∏–∫–∏ —á–µ—Ä–µ–∑ 3 —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ (ZigZag, FindPeaks, PivotPoints)
- ‚ú® **Shape –∞–Ω–∞–ª–∏–∑:** 3 –º–µ—Ç—Ä–∏–∫–∏ —á–µ—Ä–µ–∑ StatisticalShapeStrategy (—É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π - –ª—é–±–æ–π –æ—Å—Ü–∏–ª–ª—è—Ç–æ—Ä)
- ‚ú® **–î–µ—Ç–µ–∫—Ü–∏—è –¥–∏–≤–µ—Ä–≥–µ–Ω—Ü–∏–∏:** 4 –º–µ—Ç—Ä–∏–∫–∏ —á–µ—Ä–µ–∑ ClassicDivergenceStrategy (—É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π)
- ‚ú® **–û—Ü–µ–Ω–∫–∞ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏:** 10 –º–µ—Ç—Ä–∏–∫ —á–µ—Ä–µ–∑ CombinedVolatilityStrategy
- ‚ú® **Volume –∞–Ω–∞–ª–∏–∑:** 4 –º–µ—Ç—Ä–∏–∫–∏ —á–µ—Ä–µ–∑ StandardVolumeStrategy (—É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è –∫–æ—Ä—Ä–µ–ª—è—Ü–∏—è)
- ‚ú® **–í—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏:** 2 –º–µ—Ç—Ä–∏–∫–∏ (peak_time_ratio, trough_time_ratio)

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:**
- **–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:** –°–º. –≤—ã—à–µ (üü¢ v2.1 - —Å—Ç–∞–±–∏–ª—å–Ω–æ)
- **–ü–∞—Ç—Ç–µ—Ä–Ω –°—Ç—Ä–∞—Ç–µ–≥–∏—è:** –°–º. [strategies.md](strategies.md) (üü¢ —Å—Ç–∞–±–∏–ª—å–Ω—ã–π API)
- **–†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –†–∞—Å—à–∏—Ä–µ–Ω–∏—é:** –°–º. [developer guide](../developer_guide/zone_detection_strategies.md) (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏)

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏—Ö –°—Ç—Ä–∞—Ç–µ–≥–∏–π (v2.1)

üéØ **–ù–û–í–´–ô API:** –ù–∞—Å—Ç—Ä–æ–π–∫–∞ swing, shape, divergence, volatility –∏ volume —Å—Ç—Ä–∞—Ç–µ–≥–∏–π —Å –ø–æ–º–æ—â—å—é `.with_strategies()`

**–ü—Ä–æ—Å—Ç–æ–π swing –∞–Ω–∞–ª–∏–∑:**
```python
from bquant.analysis.zones import analyze_zones

result = (
    analyze_zones(df)
    .detect_zones('zero_crossing', indicator_col='macd_hist')
    .with_strategies(swing='find_peaks')  # ‚úÖ NEW!
    .analyze(clustering=True)
    .build()
)

# Access swing metrics
zone = result.zones[0]
print(f"Peaks: {zone.features['num_peaks']}")
print(f"Troughs: {zone.features['num_troughs']}")
print(f"Drawdown: {zone.features['drawdown_from_peak']}")
```

**–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏:**
```python
result = (
    analyze_zones(df)
    .detect_zones('zero_crossing', indicator_col='macd_hist')
    .with_strategies(
        swing='find_peaks',       # Swing detection
        shape='statistical',      # Shape analysis
        divergence='classic',     # Divergence detection
        volume='standard'         # Volume analysis
    )
    .analyze(clustering=True)
    .build()
)

# All features available in zone.features
zone = result.zones[0]
print(f"Swing: {zone.features.get('num_peaks', 0)} peaks")
print(f"Shape: {zone.features.get('skewness', 0)} skewness")
print(f"Divergence: {zone.features.get('has_classic_divergence', False)}")
print(f"Volume: {zone.features.get('volume_indicator_corr', 0)} correlation")
```

**–î–æ—Å—Ç—É–ø–Ω—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏:**
- **swing:** `'find_peaks'`, `'zigzag'`, `'pivot_points'`, –∏–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π —ç–∫–∑–µ–º–ø–ª—è—Ä
- **shape:** `'statistical'` –∏–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π —ç–∫–∑–µ–º–ø–ª—è—Ä (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 'statistical')
- **divergence:** `'classic'` –∏–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π —ç–∫–∑–µ–º–ø–ª—è—Ä
- **volatility:** –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π —ç–∫–∑–µ–º–ø–ª—è—Ä (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: CombinedVolatilityStrategy)
- **volume:** `'standard'` –∏–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π —ç–∫–∑–µ–º–ø–ª—è—Ä

**–†–∞–±–æ—Ç–∞–µ—Ç —Å –õ–Æ–ë–´–ú –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–º:**
```python
# RSI with swing analysis
result = (
    analyze_zones(df)
    .with_indicator('pandas_ta', 'rsi', period=14)
    .detect_zones('threshold', 
                 indicator_col='RSI_14',
                 upper_threshold=70, 
                 lower_threshold=30)
    .with_strategies(swing='pivot_points')  # ‚úÖ Works!
    .build()
)

# Custom indicator with multiple strategies
df['MY_OSC'] = df['close'].diff(5) / df['close'].rolling(20).std()

result = (
    analyze_zones(df)
    .detect_zones('zero_crossing', indicator_col='MY_OSC')
    .with_strategies(
        swing='find_peaks',
        shape='statistical'
    )
    .build()
)
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏—è:**
- –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ—Å—Ç—É–ø–Ω—ã –≤ `zone.features` (–Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è —Ä—É—á–Ω–æ–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ)
- –í—Å–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: None = –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å)
- –û–±—Ä–∞—Ç–Ω–æ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –∫–æ–¥–æ–º

## Universal Pipeline API (v2.1)

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

#### `analyze_zones(df) -> ZoneAnalysisBuilder`
–¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –¥–ª—è Universal Pipeline. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç fluent builder –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–Ω–∞–ª–∏–∑–∞.

#### `ZoneAnalysisBuilder`
Fluent interface –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–Ω–∞–ª–∏–∑–∞:
- `.with_indicator(source, name, **params)` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞
- `.detect_zones(strategy, **params)` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–µ—Ç–µ–∫—Ü–∏–∏ –∑–æ–Ω
- `.with_strategies(**strategies)` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Å—Ç—Ä–∞—Ç–µ–≥–∏–π
- `.analyze(**options)` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–Ω–∞–ª–∏–∑–∞
- `.with_cache(enable=True, ttl=3600)` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
- `.build()` - –∑–∞–ø—É—Å–∫ –∞–Ω–∞–ª–∏–∑–∞

#### `ZoneAnalysisResult`
–†–µ–∑—É–ª—å—Ç–∞—Ç –∞–Ω–∞–ª–∏–∑–∞ —Å –ø–æ–ª–Ω—ã–º –Ω–∞–±–æ—Ä–æ–º –¥–∞–Ω–Ω—ã—Ö:
- `zones: List[ZoneInfo]` - –Ω–∞–π–¥–µ–Ω–Ω—ã–µ –∑–æ–Ω—ã
- `statistics: Dict` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∞–Ω–∞–ª–∏–∑–∞
- `hypothesis_tests: Optional[HypothesisTestSuite]` - —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ —Ç–µ—Å—Ç—ã
- `clustering: Optional[Dict]` - —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏
- `sequence_analysis: Optional[Dict]` - –∞–Ω–∞–ª–∏–∑ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–µ–π
- **`visualize(mode, **kwargs)`** - –≤—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∑–æ–Ω

üìä **[–ü–æ–¥—Ä–æ–±–Ω–µ–µ –æ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ ‚Üí](../visualization/zones.md)** - —Ä–µ–∂–∏–º—ã overview/detail/comparison/statistics, backend Plotly/Matplotlib

#### `ZoneInfo`
–ú–æ–¥–µ–ª—å –∑–æ–Ω—ã —Å –ø–æ–ª–Ω—ã–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º:
- `zone_id: int` - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä
- `type: str` - —Ç–∏–ø –∑–æ–Ω—ã ('bull'/'bear')
- `start_time: Timestamp` - –≤—Ä–µ–º—è –Ω–∞—á–∞–ª–∞
- `end_time: Timestamp` - –≤—Ä–µ–º—è –æ–∫–æ–Ω—á–∞–Ω–∏—è
- `features: Optional[Dict]` - –∏–∑–≤–ª–µ—á–µ–Ω–Ω—ã–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏
- `indicator_context: Dict` - –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞

### Legacy API (Deprecated)

‚ö†Ô∏è **DEPRECATED:** –°–ª–µ–¥—É—é—â–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —É—Å—Ç–∞—Ä–µ–ª–∏ –≤ v2.1:

- `Zone` class ‚Üí `ZoneInfo` dataclass
- `find_support_resistance()` ‚Üí Universal detection strategies
- `ZoneAnalyzer` ‚Üí `UniversalZoneAnalyzer` —á–µ—Ä–µ–∑ pipeline
- `extract_zone_features()` ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –≤ pipeline

**–†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –ú–∏–≥—Ä–∞—Ü–∏–∏:**
```python
# –°—Ç–∞—Ä—ã–π —Å–ø–æ—Å–æ–± (Deprecated)
from bquant.analysis.zones import find_support_resistance, extract_zone_features
zones = find_support_resistance(data, window=20, min_touches=2)
features = extract_zone_features(zone_info)

# –ù–æ–≤—ã–π —Å–ø–æ—Å–æ–± (Universal Pipeline)
from bquant.analysis.zones import analyze_zones
result = (
    analyze_zones(data)
    .detect_zones('threshold', indicator_col='rsi', upper_threshold=70)
    .analyze(clustering=True)
    .build()
)
zones = result.zones
features = zones[0].features  # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–∑–≤–ª–µ—á–µ–Ω—ã
```

## –ü—Ä–∏–º–µ—Ä—ã

### –ü—Ä–∏–º–µ—Ä—ã Universal Pipeline

#### MACD Analysis
```python
from bquant.analysis.zones import analyze_zones
from bquant.data.samples import get_sample_data

data = get_sample_data('tv_xauusd_1h')

result = (
    analyze_zones(data)
    .with_indicator('custom', 'macd', fast_period=12, slow_period=26, signal_period=9)
    .detect_zones('zero_crossing', indicator_col='macd_hist')
    .with_strategies(swing='find_peaks', divergence='classic')
    .analyze(clustering=True, n_clusters=3)
    .build()
)

print(f"–ù–∞–π–¥–µ–Ω–æ –∑–æ–Ω: {len(result.zones)}")
for zone in result.zones[:3]:
    if zone.features:
        print(f"–ó–æ–Ω–∞ {zone.zone_id}: {zone.type}")
```

#### RSI Analysis
```python
result = (
    analyze_zones(data)
    .with_indicator('pandas_ta', 'rsi', length=14)
    .detect_zones('threshold', indicator_col='rsi', 
                  upper_threshold=70, lower_threshold=30)
    .with_strategies(swing='pivot_points', volatility='combined')
    .analyze(clustering=True)
    .build()
)
```

#### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä
```python
# –°–æ–∑–¥–∞–µ–º —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä
data['MY_OSC'] = data['close'].diff(5) / data['close'].rolling(20).std()

result = (
    analyze_zones(data)
    .detect_zones('zero_crossing', indicator_col='MY_OSC')
    .with_strategies(swing='find_peaks', shape='statistical')
    .analyze(clustering=True)
    .build()
)
```

### Legacy –ü—Ä–∏–º–µ—Ä—ã (Deprecated)

‚ö†Ô∏è **DEPRECATED:** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Universal Pipeline –≤–º–µ—Å—Ç–æ —ç—Ç–∏—Ö –ø—Ä–∏–º–µ—Ä–æ–≤:

```python
# –°—Ç–∞—Ä—ã–π —Å–ø–æ—Å–æ–± (Deprecated)
import pandas as pd

from bquant.analysis.zones import find_support_resistance

data = pd.DataFrame(
    {
        "open": [100, 101, 102, 103, 102, 101, 100, 99, 100, 101, 102, 101],
        "high": [101, 102, 103, 104, 103, 102, 101, 100, 101, 102, 103, 102],
        "low": [99, 100, 101, 102, 101, 100, 99, 98, 99, 100, 101, 100],
        "close": [100, 101, 102, 102, 101, 100, 100, 99, 100, 101, 102, 101],
        "volume": [1000, 1100, 1080, 1150, 1120, 1090, 1110, 1130, 1140, 1125, 1115, 1105],
    },
    index=pd.date_range("2024-01-01", periods=12, freq="H"),
)

zones = find_support_resistance(data, window=3, min_touches=1)

if zones:
    legacy_zone = zones[0]
    duration_hours = legacy_zone.duration.total_seconds() / 3600
    print(
        f"{legacy_zone.zone_type} zone from {legacy_zone.start_time:%Y-%m-%d %H:%M} "
        f"to {legacy_zone.end_time:%Y-%m-%d %H:%M} ({duration_hours:.0f} hours)"
    )
else:
    print("No support/resistance zones detected with the legacy API.")

# ZoneFeaturesAnalyzer –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–∞–∫ –∏ —Ä–∞–Ω—å—à–µ, –ø–µ—Ä–µ–¥–∞–≤–∞—è —Å–ª–æ–≤–∞—Ä—å –∑–æ–Ω—ã.
# –ü—Ä–∏–º–µ—Ä:
# zfa = ZoneFeaturesAnalyzer()
# features = zfa.extract_zone_features({
#     "zone_id": legacy_zone.zone_id,
#     "type": legacy_zone.zone_type,
#     "data": data.loc[legacy_zone.start_time : legacy_zone.end_time],
#     "indicator_context": {"detection_strategy": "legacy_support_resistance"},
# })
```

## –°–º. —Ç–∞–∫–∂–µ

- **[Universal Pipeline](pipeline.md)** - –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Universal Pipeline v2.1
- **[Zone Detection Strategies](strategies.md)** - –î–µ—Ç–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ 5 —Å—Ç—Ä–∞—Ç–µ–≥–∏–π –¥–µ—Ç–µ–∫—Ü–∏–∏
- **[Statistical Analysis](statistical.md)** - –¢–µ—Å—Ç—ã –≥–∏–ø–æ—Ç–µ–∑ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑
- **[Examples](../../examples/README.md)** - –ì–æ—Ç–æ–≤—ã–µ –ø—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- **[Migration Guide](../../examples/README.md)** - –ü–µ—Ä–µ—Ö–æ–¥ —Å legacy API
