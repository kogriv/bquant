# Tutorial: MACD zones (–ü—Ä–∏–º–µ—Ä 1) ‚Äî –±–∞–∑–æ–≤—ã–π pipeline –∏ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è

## üéØ –¶–µ–ª–∏
- –ü–æ–≤—Ç–æ—Ä–∏—Ç—å –±–∞–∑–æ–≤—ã–π –∫–æ–Ω–≤–µ–π–µ—Ä –∏–∑ [–ü—Ä–∏–º–µ—Ä–∞ 1: MACD Analysis](../api/analysis/pipeline.md#–ø—Ä–∏–º–µ—Ä-1-macd-analysis)
- –ü–æ–ª—É—á–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç `ZoneAnalysisResult` —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
- –ü–æ—Å—Ç—Ä–æ–∏—Ç—å –æ–±–∑–æ—Ä–Ω—É—é –∏ –¥–µ—Ç–∞–ª—å–Ω—É—é –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—é —á–µ—Ä–µ–∑ `ZoneVisualizer`

## üîß –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
- –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π `bquant`
- –ë–∏–±–ª–∏–æ—Ç–µ–∫–∏ –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ (`plotly` —Å—Ç–∞–≤–∏—Ç—Å—è –∫–∞–∫ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å)
- –ü–æ–Ω–∏–º–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã OHLCV-–¥–∞–Ω–Ω—ã—Ö

## üì• –î–∞–Ω–Ω—ã–µ
–ò—Å–ø–æ–ª—å–∑—É–µ–º –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –¥–∞—Ç–∞—Å–µ—Ç `tv_xauusd_1h`, –æ–ø–∏—Å–∞–Ω–Ω—ã–π –≤ —Ä–∞–∑–¥–µ–ª–µ [BQuant Sample Data](../api/data/samples.md). –û–Ω —Å–æ–¥–µ—Ä–∂–∏—Ç 1000 —Å—Ç—Ä–æ–∫ —Å —á–∞—Å–æ–≤—ã–º–∏ –∫–æ—Ç–∏—Ä–æ–≤–∫–∞–º–∏ XAUUSD –∏ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ MACD.„ÄêF:docs/api/data/samples.md‚Ä†L1-L52„Äë

```python
from bquant.data.samples import get_sample_data

# –ó–∞–≥—Ä—É–∑–∏–º –¥–∞–Ω–Ω—ã–µ –∫–∞–∫ DataFrame
raw = get_sample_data('tv_xauusd_1h')
print(raw.head())
```

## üõ†Ô∏è –®–∞–≥ 1. –°–±–æ—Ä–∫–∞ –±–∞–∑–æ–≤–æ–≥–æ pipeline
–ò—Å–ø–æ–ª—å–∑—É–µ–º fluent builder `analyze_zones()` —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –∏–∑ –ü—Ä–∏–º–µ—Ä–∞ 1. –ì–ª–∞–≤–Ω–æ–µ ‚Äî –∑–∞–¥–∞—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ –∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –¥–µ—Ç–µ–∫—Ü–∏–∏.„ÄêF:docs/api/analysis/pipeline.md‚Ä†L218-L251„Äë

```python
from bquant.analysis.zones import analyze_zones

result = (
    analyze_zones(raw)
    .with_indicator('custom', 'macd', fast_period=12, slow_period=26, signal_period=9)
    .detect_zones('zero_crossing', indicator_col='macd_hist', min_duration=2)
    .analyze(clustering=True, n_clusters=3)
    .build()
)

print(f"–í—Å–µ–≥–æ –∑–æ–Ω: {len(result.zones)}")
print(f"–ü–µ—Ä–≤—ã–µ 3 —Ç–∏–ø–∞ –∑–æ–Ω: {[z.type for z in result.zones[:3]]}")
```

### –ß—Ç–æ –¥–µ–ª–∞–µ—Ç –∫–∞–∂–¥–∞—è —Å—Ç–∞–¥–∏—è
| –ú–µ—Ç–æ–¥ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|-------|-----------|
| `with_indicator` | —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç MACD –Ω–∞ –±–∞–∑–µ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ DataFrame |
| `detect_zones` | –ø—Ä–∏–º–µ–Ω—è–µ—Ç —Å—Ç—Ä–∞—Ç–µ–≥–∏—é `zero_crossing` –¥–ª—è MACD histogram |
| `analyze` | –≤–∫–ª—é—á–∞–µ—Ç –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—é (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é k=3) –∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ |
| `build` | –≤—ã–ø–æ–ª–Ω—è–µ—Ç pipeline –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `ZoneAnalysisResult` |

## üîé –®–∞–≥ 2. –†–∞–±–æ—Ç–∞ —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏
`ZoneAnalysisResult` —Å–æ–¥–µ—Ä–∂–∏—Ç –∑–æ–Ω—ã, –ø—Ä–∏–∑–Ω–∞–∫–∏ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É. –ß–µ—Ä–µ–∑ `indicator_context` –º–æ–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, –∫–∞–∫ –±—ã–ª–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –¥–µ—Ç–µ–∫—Ü–∏—è.

```python
first_zone = result.zones[0]
print(first_zone.indicator_context['detection_strategy'])  # 'zero_crossing'
print(result.statistics['avg_duration'])
```

## üìà –®–∞–≥ 3. –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∑–æ–Ω
–í –º–æ–¥–µ–ª–∏ `ZoneAnalysisResult` —É–∂–µ –≤—Å—Ç—Ä–æ–µ–Ω –¥–æ—Å—Ç—É–ø –∫ `ZoneVisualizer`. –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —Ä–µ–∂–∏–º—ã –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏.„ÄêF:bquant/analysis/zones/models.py‚Ä†L430-L478„Äë„ÄêF:docs/api/visualization/README.md‚Ä†L25-L86„Äë

```python
# 1. –û–±—â–∏–π –æ–±–∑–æ—Ä –∑–æ–Ω –Ω–∞ —Ü–µ–Ω–µ
overview_fig = result.visualize('overview', title='MACD Zones Overview')
overview_fig.show()

# 2. –î–µ—Ç–∞–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –∑–æ–Ω—ã
zone_fig = result.visualize('detail', zone_id=0, context_bars=20)
zone_fig.show()

# 3. –°—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–æ–µ —Ä–µ–∑—é–º–µ
stats_fig = result.visualize('statistics')
stats_fig.show()
```

> ‚ÑπÔ∏è `ZoneVisualizer` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Plotly backend –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —ç–∫—Å–ø–æ—Ä—Ç —á–µ—Ä–µ–∑ `write_html()` –∏–ª–∏ `write_image()`.

## ‚úÖ –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏
1. **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏** ‚Äî —É–≤–µ–ª–∏—á–∏–≤–∞–π—Ç–µ `min_duration`, –µ—Å–ª–∏ –ø–æ–ª—É—á–∞–µ—Ç–µ —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –∫–æ—Ä–æ—Ç–∫–∏—Ö –∑–æ–Ω.
2. **–ö–æ–Ω—Ç–µ–∫—Å—Ç –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞** ‚Äî —Å–æ—Ö—Ä–∞–Ω—è–π—Ç–µ `result.zones[i].indicator_context` –¥–ª—è —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤, –æ—Å–æ–±–µ–Ω–Ω–æ –ø—Ä–∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—Ö pipeline.
3. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ** ‚Äî –¥–ª—è –±–æ–ª—å—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö –≤–∫–ª—é—á–∞–π—Ç–µ `.with_cache(enable=True, ttl=3600)` –¥–æ `with_indicator`, —á—Ç–æ–±—ã –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –≤—ã–∑–æ–≤—ã –±—ã–ª–∏ –±—ã—Å—Ç—Ä–µ–µ.„ÄêF:docs/api/analysis/pipeline.md‚Ä†L268-L282„Äë
4. **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤** ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `result.save('macd_result.pkl')`, —á—Ç–æ–±—ã –ø–æ—Ç–æ–º —Å—Ç—Ä–æ–∏—Ç—å –≥—Ä–∞—Ñ–∏–∫–∏ –±–µ–∑ –ø–µ—Ä–µ—Å—á—ë—Ç–∞.

## üöÄ –ß—Ç–æ –¥–∞–ª—å—à–µ
- –î–æ–±–∞–≤—å—Ç–µ –¥—Ä—É–≥–∏–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –≤ pipeline –∏–ª–∏ –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –¥–µ—Ç–µ–∫—Ü–∏–∏ (—Å–º. Tutorial –ø–æ RSI).
- –ü–æ–¥–∫–ª—é—á–∏—Ç–µ swing/shape/divergence —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ —á–µ—Ä–µ–∑ `.with_strategies()`.
- –°—Ä–∞–≤–Ω–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å legacy-–ø–æ–¥—Ö–æ–¥–æ–º –∏–∑ `examples/02_macd_zone_analysis.py`.
