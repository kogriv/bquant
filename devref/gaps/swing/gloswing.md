# –ì–ª–æ–±–∞–ª—å–Ω—ã–π —Ä–∞—Å—á—ë—Ç —Å–≤–∏–Ω–≥–æ–≤ –∏ –ø–æ—Å–ª–µ–¥—É—é—â–µ–µ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —Å –∑–æ–Ω–∞–º–∏

## –ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

–°–µ–π—á–∞—Å –ø–∞–π–ø–ª–∞–π–Ω `ZoneAnalysisPipeline` —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç —Å–≤–∏–Ω–≥–æ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –æ—Ç–¥–µ–ª—å–Ω–æ –¥–ª—è –∫–∞–∂–¥–æ–π –∑–æ–Ω—ã, –ø–µ—Ä–µ–¥–∞–≤–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è–º (Find Peaks, Pivot Points, ZigZag) –ª–æ–∫–∞–ª—å–Ω—ã–µ —Ñ—Ä–µ–π–º—ã `zone.data`. –¢–∞–∫–æ–π –ø–æ–¥—Ö–æ–¥ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –∏—Å–∫–∞–∂–µ–Ω–∏—é –∞–Ω–∞–ª–∏–∑–∞: –µ—Å–ª–∏ –≥—Ä–∞–Ω–∏—Ü—ã –∑–æ–Ω—ã —Ä–∞–∑—Ä–µ–∑–∞—é—Ç –±–æ–ª–µ–µ –∫—Ä—É–ø–Ω—ã–π —Ç—Ä–µ–Ω–¥–æ–≤—ã–π —Ö–æ–¥, –ª–æ–∫–∞–ª—å–Ω—ã–µ –∞–ª–≥–æ—Ä–∏—Ç–º—ã –Ω–µ –≤–∏–¥—è—Ç —Å–≤–∏–Ω–≥–∏ —Ü–µ–ª–∏–∫–æ–º –∏ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç –Ω–µ–ø–æ–ª–Ω—ã–µ –ª–∏–±–æ –ø—É—Å—Ç—ã–µ –º–µ—Ç—Ä–∏–∫–∏. –í —Å—Ä–∞–≤–Ω–µ–Ω–∏–∏ —Å –≥–ª–æ–±–∞–ª—å–Ω—ã–º ZigZag, –ø–æ—Å—Ç—Ä–æ–µ–Ω–Ω—ã–º –Ω–∞ –≤—Å—ë–º —Ä—è–¥–µ –∫–æ—Ç–∏—Ä–æ–≤–æ–∫, —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ–ª—É—á–∞–µ—Ç—Å—è –±–µ–¥–Ω–µ–µ –∏ –º–µ–Ω–µ–µ –Ω–∞–¥—ë–∂–µ–Ω.

**–ü—Ä–∏–º–µ—Ä—ã –∏—Å–∫–∞–∂–µ–Ω–∏–π**:
1. **–ü–æ—Ç–µ—Ä—è –ø–∏–≤–æ—Ç–æ–≤ –Ω–∞ –≥—Ä–∞–Ω–∏—Ü–∞—Ö –∑–æ–Ω**: –°–≤–∏–Ω–≥-—Ç–æ—á–∫–∞ –ø–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º –∑–æ–Ω—ã –∏–ª–∏ –ø–æ—Å–ª–µ –µ—ë –æ–∫–æ–Ω—á–∞–Ω–∏—è –Ω–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è, —Ö–æ—Ç—è –æ–Ω–∞ –∫—Ä–∏—Ç–∏—á–Ω–∞ –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π –¥–∏–Ω–∞–º–∏–∫–∏.
2. **–õ–æ–∂–Ω—ã–µ —Å–≤–∏–Ω–≥–∏ –∏–∑-–∑–∞ –º–∞–ª–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞**: –ù–∞ —É–∑–∫–∏—Ö –∑–æ–Ω–∞—Ö (5-10 –±–∞—Ä–æ–≤) –∞–ª–≥–æ—Ä–∏—Ç–º—ã –¥–µ—Ç–µ–∫—Ç–∏—Ä—É—é—Ç —à—É–º –∫–∞–∫ –∑–Ω–∞—á–∏–º—ã–µ —Å–≤–∏–Ω–≥–∏.
3. **–ù–µ—Å–æ–ø–æ—Å—Ç–∞–≤–∏–º–æ—Å—Ç—å –º–µ—Ç—Ä–∏–∫ –º–µ–∂–¥—É –∑–æ–Ω–∞–º–∏**: –†–∞–∑–Ω—ã–µ –¥–ª–∏–Ω—ã –∑–æ–Ω ‚Üí —Ä–∞–∑–Ω—ã–µ –ø–æ—Ä–æ–≥–∏ –¥–µ—Ç–µ–∫—Ü–∏–∏ ‚Üí —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏ –Ω–µ—Å—Ä–∞–≤–Ω–∏–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã.

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π —Ä–∞–∑–±–æ—Ä —Ç–µ–∫—É—â–µ–≥–æ —Ä–µ—à–µ–Ω–∏—è

### 1. –ü–∞–π–ø–ª–∞–π–Ω –∞–Ω–∞–ª–∏–∑–∞ –∑–æ–Ω
```
ZoneAnalysisPipeline.build()
  ‚îú‚îÄ> _run_without_cache()
  ‚îÇ     ‚îú‚îÄ> prepare_dataframe()
  ‚îÇ     ‚îú‚îÄ> detect_zones()
  ‚îÇ     ‚îÇ      ‚îî‚îÄ> ZoneDetector.detect()  # –≤—ã–¥–µ–ª–µ–Ω–∏–µ –∑–æ–Ω –Ω–∞ –≤—Å—ë–º –¥–∏–∞–ø–∞–∑–æ–Ω–µ –¥–∞–Ω–Ω—ã—Ö
  ‚îÇ     ‚îî‚îÄ> UniversalZoneAnalyzer(...)
  ‚îÇ             ‚îî‚îÄ> ZoneFeaturesAnalyzer.extract_all_zones_features(zones)
  ‚îÇ                    ‚îî‚îÄ> swing_strategy.calculate(zone.data)
```
* –î–µ—Ç–µ–∫—Ç–æ—Ä –∑–æ–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –≥–ª–æ–±–∞–ª—å–Ω–æ–º DataFrame, –Ω–æ –Ω–∞ —ç—Ç–∞–ø–µ —É–ø–∞–∫–æ–≤–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∫–∞–∂–¥–∞—è –∑–æ–Ω–∞ –ø–æ–ª—É—á–∞–µ—Ç —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π —Å—Ä–µ–∑ `df.iloc[start_idx:end_idx+1]`, –∫–æ—Ç–æ—Ä—ã–π —Å–∫–ª–∞–¥—ã–≤–∞–µ—Ç—Å—è –≤ `ZoneInfo.data`.
* `UniversalZoneAnalyzer`/`ZoneFeaturesAnalyzer` –≤–∏–¥—è—Ç —Ç–æ–ª—å–∫–æ –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∑–æ–Ω—ã, –ø–æ—Ç–æ–º—É —á—Ç–æ `zone.data` –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é –≤ —Å–≤–∏–Ω–≥–æ–≤—É—é —Å—Ç—Ä–∞—Ç–µ–≥–∏—é.

### 2. –°—Ç—Ä–∞—Ç–µ–≥–∏–∏ —Å–≤–∏–Ω–≥–æ–≤
```python
class ZigZagSwingStrategy:
    def calculate(self, zone_data: pd.DataFrame) -> SwingMetrics:
        pivot_series = ta.zigzag(..., zone_data)
        pivots = _collect_pivots(pivot_series)
        return _calculate_swing_metrics(pivots)
```
* –°—Ç—Ä–∞—Ç–µ–≥–∏—è –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–∞: –æ–Ω–∞ —Å—Ç—Ä–æ–∏—Ç –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä, –∏–∑–≤–ª–µ–∫–∞–µ—Ç –ø–∏–≤–æ—Ç—ã –∏ –∞–≥—Ä–µ–≥–∏—Ä—É–µ—Ç –º–µ—Ç—Ä–∏–∫–∏, –Ω–µ –∑–Ω–∞—è –æ –≥–ª–æ–±–∞–ª—å–Ω–æ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ.
* –ê–Ω–∞–ª–æ–≥–∏—á–Ω—ã–π –ø–∞—Ç—Ç–µ—Ä–Ω –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è –≤ `FindPeaksSwingStrategy` –∏ `PivotPointsSwingStrategy`.

### 3. –ü–æ–±–æ—á–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã
* –ó–æ–Ω—ã, –Ω–∞—á–∏–Ω–∞—é—â–∏–µ—Å—è/–∑–∞–∫–∞–Ω—á–∏–≤–∞—é—â–∏–µ—Å—è –≤–Ω—É—Ç—Ä–∏ –±–æ–ª—å—à–æ–≥–æ –¥–≤–∏–∂–µ–Ω–∏—è, —Ç–µ—Ä—è—é—Ç –≤–Ω–µ—à–Ω–∏–µ –ø–∏–≤–æ—Ç—ã –∏ —á–∞—Å—Ç–æ –¥–∞—é—Ç `num_swings = 0`.
* –û—Ç—á—ë—Ç—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, `research/notebooks/05_case_study_zone_consistency.py`) –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç —Å–∏–ª—å–Ω—ã–π —Ä–∞–∑–±—Ä–æ—Å –≤ –ø–æ–∫—Ä—ã—Ç–∏–∏ —Å–≤–∏–Ω–≥–∞–º–∏:
  - `find_peaks`: 7/37 –∑–æ–Ω (18.9%) –∏–º–µ—é—Ç —Å–≤–∏–Ω–≥–∏
  - `pivot_points`: 3/37 –∑–æ–Ω (8.1%)
  - `zigzag`: 23/37 –∑–æ–Ω (62.2%)
* –ü–æ—Ä–æ–≥ ¬´auto¬ª (`with_auto_swing_thresholds(True)`) –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ–º —Å—Ä–µ–∑–µ, –∏–∑-–∑–∞ —á–µ–≥–æ –∏—Ç–æ–≥ –µ—â—ë –±–æ–ª—å—à–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —à–∏—Ä–∏–Ω—ã –∑–æ–Ω—ã.

## –ü—Ä–µ–¥–ª–∞–≥–∞–µ–º–æ–µ —Ä–µ—à–µ–Ω–∏–µ: –≥–ª–æ–±–∞–ª—å–Ω—ã–π —Ä–∞—Å—á—ë—Ç –∏ –Ω–∞—Ä–µ–∑–∫–∞ –Ω–∞ –∑–æ–Ω—ã

### –û–±—â–∞—è –∏–¥–µ—è
* –û–¥–∏–Ω —Ä–∞–∑ –ø–æ—Å—á–∏—Ç–∞—Ç—å —Å–≤–∏–Ω–≥–æ–≤—ã–µ –ø–∏–≤–æ—Ç—ã –Ω–∞ –≥–ª–æ–±–∞–ª—å–Ω–æ–º DataFrame, –∑–∞—Ç–µ–º –¥–ª—è –∫–∞–∂–¥–æ–π –∑–æ–Ω—ã –∏–∑–≤–ª–µ–∫–∞—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ —Ç–æ—á–∫–∏ –∏ –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞—Ç—å –º–µ—Ç—Ä–∏–∫–∏.
* –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –æ–ø—Ü–∏—é —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–≤–µ–¥–µ–Ω–∏—è (¬´per_zone¬ª), –¥–æ–±–∞–≤–∏–≤ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏.

---

## 1. –ù–æ–≤—ã–µ –º–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö

### 1.1. `SwingPoint` ‚Äî —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ç–æ—á–∫–∞ —Å–≤–∏–Ω–≥–∞

```python
from dataclasses import dataclass
from typing import Optional, Dict, Any
from datetime import datetime

@dataclass
class SwingPoint:
    """
    –¢–æ—á–∫–∞ —Å–≤–∏–Ω–≥–∞ –Ω–∞ –≥–ª–æ–±–∞–ª—å–Ω–æ–º —É—Ä–æ–≤–Ω–µ.

    Attributes:
        point_id: –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Ç–æ—á–∫–∏ –≤ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
        timestamp: –í—Ä–µ–º–µ–Ω–Ω–∞—è –º–µ—Ç–∫–∞ (–∑–Ω–∞—á–µ–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–∞ DataFrame)
        index: –ü–æ–∑–∏—Ü–∏—è –≤ –ø–æ–ª–Ω–æ–º –¥–∞—Ç–∞—Å–µ—Ç–µ (integer location)
        price: –¶–µ–Ω–∞ –≤ —Ç–æ—á–∫–µ —Å–≤–∏–Ω–≥–∞
        swing_type: –¢–∏–ø —Å–≤–∏–Ω–≥–∞ ('peak' | 'trough')
        amplitude_to_next: –ü—Ä–æ—Ü–µ–Ω—Ç–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –¥–æ —Å–ª–µ–¥—É—é—â–µ–π —Ç–æ—á–∫–∏ —Å–≤–∏–Ω–≥–∞
        duration_to_next: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–∞—Ä–æ–≤ –¥–æ —Å–ª–µ–¥—É—é—â–µ–π —Ç–æ—á–∫–∏ —Å–≤–∏–Ω–≥–∞
        strategy_name: –ò–º—è —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏, –∫–æ—Ç–æ—Ä–∞—è –¥–µ—Ç–µ–∫—Ç–∏—Ä–æ–≤–∞–ª–∞ —Å–≤–∏–Ω–≥
        strategy_params: –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –¥–ª—è —Ç—Ä–∞—Å—Å–∏—Ä—É–µ–º–æ—Å—Ç–∏

    Advantages:
        - –ë–æ–≥–∞—Ç–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞
        - –•—Ä–∞–Ω–∏—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ ‚Üí –ø–æ–ª–Ω–∞—è —Ç—Ä–∞—Å—Å–∏—Ä—É–µ–º–æ—Å—Ç—å
        - –ú–æ–∂–Ω–æ –≤–∏–∑—É–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –∑–æ–Ω
        - –†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å —á–µ—Ä–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è
    """
    point_id: int
    timestamp: datetime
    index: int  # Position in full dataset
    price: float
    swing_type: str  # 'peak' | 'trough'
    amplitude_to_next: Optional[float] = None  # % change to next swing
    duration_to_next: Optional[int] = None     # bars to next swing

    # –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∞–ª–≥–æ—Ä–∏—Ç–º–∞
    strategy_name: str = ''
    strategy_params: Dict[str, Any] = None

    def __post_init__(self):
        if self.strategy_params is None:
            self.strategy_params = {}
```

### 1.2. `SwingContext` ‚Äî –≥–ª–æ–±–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç —Å–≤–∏–Ω–≥–æ–≤

```python
import numpy as np
from bisect import bisect_left, bisect_right

@dataclass
class SwingContext:
    """
    –ì–ª–æ–±–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç —Å–≤–∏–Ω–≥–æ–≤ –¥–ª—è –≤—Å–µ–≥–æ –¥–∞—Ç–∞—Å–µ—Ç–∞.

    Attributes:
        swing_points: –°–ø–∏—Å–æ–∫ SwingPoint –æ–±—ä–µ–∫—Ç–æ–≤ –≤ —Ö—Ä–æ–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–º –ø–æ—Ä—è–¥–∫–µ
        indices: –û—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –º–∞—Å—Å–∏–≤ –∏–Ω–¥–µ–∫—Å–æ–≤ –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –Ω–∞—Ä–µ–∑–∫–∏ (bisect)
        full_data_length: –î–ª–∏–Ω–∞ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –¥–∞—Ç–∞—Å–µ—Ç–∞
        strategy_name: –ò–º—è —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ —Ä–∞—Å—á—ë—Ç–∞
        strategy_params: –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏

    Key Method:
        slice(start_idx, end_idx) ‚Äî –Ω–∞—Ä–µ–∑–∫–∞ —Å –∑–∞—Ö–≤–∞—Ç–æ–º —Å–æ—Å–µ–¥–Ω–∏—Ö –ø–∏–≤–æ—Ç–æ–≤
    """
    swing_points: List[SwingPoint]
    indices: np.ndarray  # Sorted indices for bisect performance
    full_data_length: int
    strategy_name: str
    strategy_params: Dict[str, Any]

    def slice(self, start_idx: int, end_idx: int) -> List[SwingPoint]:
        """
        –ù–∞—Ä–µ–∑–∫–∞ –ø–∏–≤–æ—Ç–æ–≤ —Å –∑–∞—Ö–≤–∞—Ç–æ–º —Å–æ—Å–µ–¥–Ω–∏—Ö —Ç–æ—á–µ–∫ –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∞–º–ø–ª–∏—Ç—É–¥.

        –ê–ª–≥–æ—Ä–∏—Ç–º:
        1. –ù–∞–π—Ç–∏ –ø–µ—Ä–≤—ã–π pivot >= start_idx
        2. –ù–∞–π—Ç–∏ –ø–µ—Ä–≤—ã–π pivot > end_idx
        3. –ó–∞—Ö–≤–∞—Ç–∏—Ç—å pivot —Å–ª–µ–≤–∞ (left-1) –∏ —Å–ø—Ä–∞–≤–∞ (right) –¥–ª—è –ø–æ–ª–Ω—ã—Ö —Å–≤–∏–Ω–≥–æ–≤

        Example:
            Global pivots: P0‚îÄ‚îÄ‚îÄ‚îÄP1‚îÄ‚îÄ‚îÄ‚îÄP2‚îÄ‚îÄ‚îÄ‚îÄP3‚îÄ‚îÄ‚îÄ‚îÄP4‚îÄ‚îÄ‚îÄ‚îÄP5
            Zone A:              |‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ|
                               start_idx  end_idx

            Without neighbors: [P2, P3]         ‚Üê –ü–æ—Ç–µ—Ä—è–ª–∏ P1‚ÜíP2 –∏ P3‚ÜíP4 —Å–≤–∏–Ω–≥–∏!
            With neighbors:    [P1, P2, P3, P4] ‚úÖ –ü–æ–ª–Ω—ã–µ —Å–≤–∏–Ω–≥–∏

        Args:
            start_idx: –ù–∞—á–∞–ª—å–Ω—ã–π –∏–Ω–¥–µ–∫—Å –∑–æ–Ω—ã (inclusive)
            end_idx: –ö–æ–Ω–µ—á–Ω—ã–π –∏–Ω–¥–µ–∫—Å –∑–æ–Ω—ã (inclusive)

        Returns:
            List[SwingPoint] —Å –∑–∞—Ö–≤–∞—Ç–æ–º —Å–æ—Å–µ–¥–Ω–∏—Ö —Ç–æ—á–µ–∫
        """
        if len(self.swing_points) == 0:
            return []

        # –ë–∏–Ω–∞—Ä–Ω—ã–π –ø–æ–∏—Å–∫ –≥—Ä–∞–Ω–∏—Ü
        left = bisect_left(self.indices, start_idx)
        right = bisect_right(self.indices, end_idx)

        # –ó–∞—Ö–≤–∞—Ç —Å–æ—Å–µ–¥–Ω–∏—Ö –ø–∏–≤–æ—Ç–æ–≤
        left_with_neighbor = max(0, left - 1)
        right_with_neighbor = min(len(self.swing_points), right + 1)

        return self.swing_points[left_with_neighbor:right_with_neighbor]

    def get_swings_for_zone(self, zone: 'ZoneInfo') -> List[SwingPoint]:
        """
        –£–¥–æ–±–Ω—ã–π –º–µ—Ç–æ–¥ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–≤–∏–Ω–≥–æ–≤ –∑–æ–Ω—ã.

        Args:
            zone: ZoneInfo –æ–±—ä–µ–∫—Ç —Å start_idx –∏ end_idx

        Returns:
            List[SwingPoint] –≤–Ω—É—Ç—Ä–∏ –∑–æ–Ω—ã (—Å —Å–æ—Å–µ–¥–Ω–∏–º–∏)
        """
        return self.slice(zone.start_idx, zone.end_idx)

    def to_dict(self) -> Dict[str, Any]:
        """–°–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è."""
        return {
            'swing_points': [
                {
                    'point_id': sp.point_id,
                    'timestamp': sp.timestamp.isoformat(),
                    'index': sp.index,
                    'price': sp.price,
                    'swing_type': sp.swing_type,
                    'amplitude_to_next': sp.amplitude_to_next,
                    'duration_to_next': sp.duration_to_next,
                    'strategy_name': sp.strategy_name,
                    'strategy_params': sp.strategy_params
                }
                for sp in self.swing_points
            ],
            'full_data_length': self.full_data_length,
            'strategy_name': self.strategy_name,
            'strategy_params': self.strategy_params
        }
```

### 1.3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ `ZoneInfo`

**‚ö†Ô∏è –í–ê–ñ–ù–û–ï –û–ì–†–ê–ù–ò–ß–ï–ù–ò–ï (Current Scope)**:

–í —ç—Ç–æ–π –≤–µ—Ä—Å–∏–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è **—Ç–æ–ª—å–∫–æ –û–î–ù–ê swing —Å—Ç—Ä–∞—Ç–µ–≥–∏—è** –∑–∞ —Ä–∞–∑.

- –ü–æ–ª–µ `swing_context` —Ö—Ä–∞–Ω–∏—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç **–û–î–ù–û–ô** —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
- `Pipeline.with_strategies(swing='zigzag')` –ø—Ä–∏–Ω–∏–º–∞–µ—Ç **—Å—Ç—Ä–æ–∫—É** (–Ω–µ —Å–ø–∏—Å–æ–∫)
- –ï—Å–ª–∏ –ø–µ—Ä–µ–¥–∞—Ç—å —Å–ø–∏—Å–æ–∫ `swing=['zigzag', 'find_peaks']` ‚Üí ValueError —Å –ø–æ–Ω—è—Ç–Ω—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ**: –≠—Ç–æ —É–ø—Ä–æ—â–∞–µ—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –∏ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å—Ñ–æ–∫—É—Å–∏—Ä–æ–≤–∞—Ç—å—Å—è –Ω–∞ —Ä–µ—à–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º—ã per_zone –≥—Ä–∞–Ω–∏—Ü –±–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Å—Ç—Ä–∞—Ç–µ–≥–∏–π.

**–î–ª—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Å—Ç—Ä–∞—Ç–µ–≥–∏–π**: –ó–∞–ø—É—Å–∫ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Å—Ç—Ä–∞—Ç–µ–≥–∏–π –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ (consensus analysis, strategy comparison) –æ–ø–∏—Å–∞–Ω –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –¥–æ–∫—É–º–µ–Ω—Ç–µ [multiswing.md](multiswing.md). –≠—Ç–∞ —Ñ–∏—á–∞ –±—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ **–ü–û–°–õ–ï** –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è global swing calculation –∫–∞–∫ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ.

---

```python
# –í bquant/analysis/zones/models.py

@dataclass
class ZoneInfo:
    """
    –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–æ–Ω–µ (—É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞).

    NEW FIELD:
        swing_context: Optional[SwingContext] - —Å—Å—ã–ª–∫–∞ –Ω–∞ –≥–ª–æ–±–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç —Å–≤–∏–Ω–≥–æ–≤
                                                  (–û–î–ù–û–ô —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏)
    """
    zone_id: int
    type: str
    start_idx: int
    end_idx: int
    start_time: datetime
    end_time: datetime
    duration: int
    data: pd.DataFrame
    features: Optional[Dict[str, Any]] = None
    indicator_context: Optional[Dict[str, Any]] = None
    swing_context: Optional[SwingContext] = None  # –ù–û–í–û–ï –ü–û–õ–ï

    def get_zone_swings(self) -> List[SwingPoint]:
        """
        –ü–æ–ª—É—á–∏—Ç—å —Å–≤–∏–Ω–≥–∏ –≤–Ω—É—Ç—Ä–∏ –∑–æ–Ω—ã –∏–∑ –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞.

        –£–¥–æ–±–Ω—ã–π API –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ —Å–≤–∏–Ω–≥–∞–º –±–µ–∑ –ø—Ä—è–º–æ–π —Ä–∞–±–æ—Ç—ã —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º.

        Returns:
            List[SwingPoint] –≤–Ω—É—Ç—Ä–∏ –∑–æ–Ω—ã (–ø—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫ –µ—Å–ª–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç)

        Example:
            for zone in result.zones:
                swings = zone.get_zone_swings()
                print(f"Zone {zone.zone_id}: {len(swings)} swings")
        """
        if self.swing_context is None:
            return []
        return self.swing_context.get_swings_for_zone(self)

    def to_analyzer_format(self) -> Dict[str, Any]:
        """
        –§–æ—Ä–º–∞—Ç –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –≤ –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä—ã.

        UPDATED: –î–æ–±–∞–≤–ª–µ–Ω swing_context –≤ –≤—ã—Ö–æ–¥–Ω–æ–π —Å–ª–æ–≤–∞—Ä—å
        """
        return {
            'zone_id': self.zone_id,
            'type': self.type,
            'start_idx': self.start_idx,
            'end_idx': self.end_idx,
            'start_time': self.start_time,
            'end_time': self.end_time,
            'duration': self.duration,
            'data': self.data,
            'indicator_context': self.indicator_context,
            'swing_context': self.swing_context,  # –ù–û–í–û–ï: –ø–µ—Ä–µ–¥–∞—ë–º –∫–æ–Ω—Ç–µ–∫—Å—Ç
            **(self.features or {})
        }
```

---

## 2. –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

### 2.1. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ `swing_scope` –≤ `ZoneAnalysisConfig`

```python
# –í bquant/analysis/zones/pipeline.py

from typing import Literal

@dataclass
class ZoneAnalysisConfig:
    """
    –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∞–Ω–∞–ª–∏–∑–∞ –∑–æ–Ω.

    NEW FIELD:
        swing_scope: –†–µ–∂–∏–º —Ä–∞—Å—á—ë—Ç–∞ —Å–≤–∏–Ω–≥–æ–≤
            - "per_zone" (default): –ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ä–∞—Å—á—ë—Ç –¥–ª—è –∫–∞–∂–¥–æ–π –∑–æ–Ω—ã (legacy)
            - "global": –ì–ª–æ–±–∞–ª—å–Ω—ã–π —Ä–∞—Å—á—ë—Ç –Ω–∞ –≤—Å—ë–º –¥–∞—Ç–∞—Å–µ—Ç–µ —Å –ø–æ—Å–ª–µ–¥—É—é—â–µ–π –Ω–∞—Ä–µ–∑–∫–æ–π
    """
    # ... existing fields ...

    swing_scope: Literal["per_zone", "global"] = "per_zone"

    def to_cache_key(self) -> str:
        """
        –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–∞ –∫—ç—à–∞.

        UPDATED: –í–∫–ª—é—á–∞–µ—Ç swing_scope –¥–ª—è —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è —Ä–µ–∂–∏–º–æ–≤ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
        """
        # ... existing cache key generation ...
        key_parts.append(f"swing_scope={self.swing_scope}")
        # ...
```

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ**:
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ—Ä–∏–∞–ª–∏–∑—É–µ—Ç—Å—è –≤–º–µ—Å—Ç–µ —Å –∫–æ–Ω—Ñ–∏–≥–æ–º
- ‚úÖ –£—á–∞—Å—Ç–≤—É–µ—Ç –≤ –∫—ç—à-–∫–ª—é—á–∞—Ö ‚Üí —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞–∑–Ω—ã—Ö —Ä–µ–∂–∏–º–æ–≤ –Ω–µ —Å–º–µ—à–∏–≤–∞—é—Ç—Å—è
- ‚úÖ –Ø–≤–Ω–∞—è —á–∞—Å—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏, –¥–æ—Å—Ç—É–ø–Ω–∞—è –¥–ª—è –∏–Ω—Å–ø–µ–∫—Ü–∏–∏

---

## 3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ API —Å—Ç—Ä–∞—Ç–µ–≥–∏–π —Å–≤–∏–Ω–≥–æ–≤

### 3.1. –ù–æ–≤—ã–π –ø—Ä–æ—Ç–æ–∫–æ–ª `SwingCalculationStrategy`

```python
# –í bquant/analysis/zones/strategies/base.py

from typing import Protocol, runtime_checkable

@runtime_checkable
class SwingCalculationStrategy(Protocol):
    """
    –ü—Ä–æ—Ç–æ–∫–æ–ª –¥–ª—è —Å—Ç—Ä–∞—Ç–µ–≥–∏–π —Ä–∞—Å—á—ë—Ç–∞ —Å–≤–∏–Ω–≥–æ–≤.

    –°—Ç—Ä–∞—Ç–µ–≥–∏—è –¥–æ–ª–∂–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –¥–≤–∞ —Ä–µ–∂–∏–º–∞:
    1. –ì–ª–æ–±–∞–ª—å–Ω—ã–π —Ä–∞—Å—á—ë—Ç: calculate_global() ‚Üí SwingContext
    2. –ê–≥—Ä–µ–≥–∞—Ü–∏—è –¥–ª—è –∑–æ–Ω—ã: aggregate_for_zone() ‚Üí SwingMetrics
    3. Legacy —Ä–∞—Å—á—ë—Ç: calculate() ‚Üí SwingMetrics (–¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏)
    """

    def calculate_global(self, full_data: pd.DataFrame) -> SwingContext:
        """
        –†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Å–≤–∏–Ω–≥–∏ –Ω–∞ –í–°–Å–ú –¥–∞—Ç–∞—Å–µ—Ç–µ.

        PRIORITY METHOD: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —Ä–µ–∂–∏–º–µ swing_scope="global"

        Args:
            full_data: –ü–æ–ª–Ω—ã–π DataFrame —Å OHLCV + –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞–º–∏

        Returns:
            SwingContext —Å –≥–ª–æ–±–∞–ª—å–Ω—ã–º–∏ SwingPoint –æ–±—ä–µ–∫—Ç–∞–º–∏

        Raises:
            ValueError: –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è —Ä–∞—Å—á—ë—Ç–∞
            RuntimeError: –ü—Ä–∏ –æ—à–∏–±–∫–∞—Ö –∞–ª–≥–æ—Ä–∏—Ç–º–∞

        Example:
            strategy = ZigZagSwingStrategy(legs=10, deviation=0.05)
            context = strategy.calculate_global(full_data)
            print(f"Detected {len(context.swing_points)} global swing points")
        """
        ...

    def aggregate_for_zone(self, zone: ZoneInfo, context: SwingContext) -> SwingMetrics:
        """
        –ê–≥—Ä–µ–≥–∏—Ä–æ–≤–∞—Ç—å –≥–ª–æ–±–∞–ª—å–Ω—ã–µ —Å–≤–∏–Ω–≥–∏ –≤ –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –∑–æ–Ω—ã.

        PRIORITY METHOD: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —Ä–µ–∂–∏–º–µ swing_scope="global"

        Process:
        1. –ò–∑–≤–ª–µ—á—å —Å–≤–∏–Ω–≥–∏ –≤–Ω—É—Ç—Ä–∏ –∑–æ–Ω—ã —á–µ—Ä–µ–∑ context.get_swings_for_zone(zone)
        2. –†–∞–∑–¥–µ–ª–∏—Ç—å –Ω–∞ rallies (–≤–æ—Å—Ö–æ–¥—è—â–∏–µ) –∏ drops (–Ω–∏—Å—Ö–æ–¥—è—â–∏–µ)
        3. –ê–≥—Ä–µ–≥–∏—Ä–æ–≤–∞—Ç—å –≤ SwingMetrics

        Args:
            zone: –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–æ–Ω–µ
            context: –ì–ª–æ–±–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç —Å–≤–∏–Ω–≥–æ–≤

        Returns:
            SwingMetrics —Å –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –º–µ—Ç—Ä–∏–∫–∞–º–∏

        Example:
            zone_swings = context.get_swings_for_zone(zone)
            metrics = strategy.aggregate_for_zone(zone, context)
        """
        ...

    def calculate(self, zone_data: pd.DataFrame) -> SwingMetrics:
        """
        Legacy: —Ä–∞—Å—á—ë—Ç –¥–ª—è –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –∑–æ–Ω—ã.

        DEPRECATED (–Ω–æ —Å–æ—Ö—Ä–∞–Ω—ë–Ω –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏)

        –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —Ä–µ–∂–∏–º–µ swing_scope="per_zone" –∏–ª–∏ –∫–∞–∫ fallback
        –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ —Ä–∞—Å—á—ë—Ç–∞.

        Args:
            zone_data: DataFrame —Ç–æ–ª—å–∫–æ –¥–ª—è —ç—Ç–æ–π –∑–æ–Ω—ã

        Returns:
            SwingMetrics —Å –ª–æ–∫–∞–ª—å–Ω–æ —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–Ω—ã–º–∏ –º–µ—Ç—Ä–∏–∫–∞–º–∏
        """
        ...

    def config_hash(self) -> Dict[str, Any]:
        """
        –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –¥–ª—è –∫—ç—à-–∫–ª—é—á–µ–π.

        Returns:
            Dict —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
        """
        ...
```

### 3.2. –ü—Ä–∏–º–µ—Ä —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–ª—è `ZigZagSwingStrategy`

```python
# –í bquant/analysis/zones/strategies/swing/zigzag.py

@StrategyRegistry.register_swing_strategy('zigzag')
@dataclass
class ZigZagSwingStrategy:
    """
    Swing detection using pandas-ta ZigZag algorithm.

    UPDATED: –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞ —Ä–∞—Å—á—ë—Ç–∞
    """
    legs: int = 10
    deviation: float = 0.05  # 5% minimum movement

    def calculate_global(self, full_data: pd.DataFrame) -> SwingContext:
        """
        –†–∞—Å—Å—á–∏—Ç–∞—Ç—å ZigZag –Ω–∞ –≤—Å—ë–º –¥–∞—Ç–∞—Å–µ—Ç–µ.

        Algorithm:
        1. –ü—Ä–∏–º–µ–Ω–∏—Ç—å pandas-ta ZigZag –∫ –ø–æ–ª–Ω—ã–º –¥–∞–Ω–Ω—ã–º
        2. –ò–∑–≤–ª–µ—á—å –≤—Å–µ —Ç–æ—á–∫–∏ –ø–∏–≤–æ—Ç–æ–≤
        3. –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ç–∏–ø—ã (peak/trough) –ø–æ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—é –∏–∑–º–µ–Ω–µ–Ω–∏—è
        4. –†–∞—Å—Å—á–∏—Ç–∞—Ç—å –∞–º–ø–ª–∏—Ç—É–¥—ã –∏ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –º–µ–∂–¥—É —Å–æ—Å–µ–¥–Ω–∏–º–∏ —Ç–æ—á–∫–∞–º–∏
        5. –£–ø–∞–∫–æ–≤–∞—Ç—å –≤ SwingContext
        """
        from .....indicators import LibraryManager
        from .....core.logging_config import get_logger

        logger = get_logger(__name__)

        # Validate input
        if len(full_data) < self.legs * 2:
            raise ValueError(
                f"Insufficient data for ZigZag: {len(full_data)} bars < {self.legs * 2}"
            )

        # 1. Calculate ZigZag indicator
        zigzag = LibraryManager.create_indicator(
            'pandas_ta',
            'zigzag',
            legs=self.legs,
            deviation=self.deviation
        )
        result = zigzag.calculate(full_data)

        # 2. Extract swing values
        if result.data.shape[1] < 2:
            logger.warning("ZigZag returned insufficient columns, no swings detected")
            return SwingContext(
                swing_points=[],
                indices=np.array([]),
                full_data_length=len(full_data),
                strategy_name='zigzag',
                strategy_params={'legs': self.legs, 'deviation': self.deviation}
            )

        swing_values = result.data.iloc[:, 1]  # Column with prices
        swing_points_series = swing_values.dropna()

        if len(swing_points_series) < 2:
            logger.warning(f"ZigZag detected only {len(swing_points_series)} points")
            return SwingContext(
                swing_points=[],
                indices=np.array([]),
                full_data_length=len(full_data),
                strategy_name='zigzag',
                strategy_params={'legs': self.legs, 'deviation': self.deviation}
            )

        # 3. Convert to SwingPoint objects
        swing_points = []
        indices = []

        for i, (timestamp, price) in enumerate(swing_points_series.items()):
            position = full_data.index.get_loc(timestamp)

            # Determine swing_type by price change direction
            if i > 0:
                prev_price = swing_points_series.iloc[i-1]
                swing_type = 'peak' if price > prev_price else 'trough'
            else:
                # First point: determine by next point
                if i < len(swing_points_series) - 1:
                    next_price = swing_points_series.iloc[i+1]
                    swing_type = 'trough' if next_price > price else 'peak'
                else:
                    swing_type = 'trough'  # Single point default

            # Calculate amplitude and duration to next point
            amplitude_to_next = None
            duration_to_next = None
            if i < len(swing_points_series) - 1:
                next_timestamp = swing_points_series.index[i + 1]
                next_price = swing_points_series.iloc[i + 1]
                next_position = full_data.index.get_loc(next_timestamp)

                amplitude_to_next = (next_price / price - 1) * 100
                duration_to_next = next_position - position

            swing_point = SwingPoint(
                point_id=i,
                timestamp=timestamp,
                index=position,
                price=float(price),
                swing_type=swing_type,
                amplitude_to_next=amplitude_to_next,
                duration_to_next=duration_to_next,
                strategy_name='zigzag',
                strategy_params={'legs': self.legs, 'deviation': self.deviation}
            )

            swing_points.append(swing_point)
            indices.append(position)

        logger.info(f"ZigZag global: detected {len(swing_points)} swing points")

        return SwingContext(
            swing_points=swing_points,
            indices=np.array(indices),
            full_data_length=len(full_data),
            strategy_name='zigzag',
            strategy_params={'legs': self.legs, 'deviation': self.deviation}
        )

    def aggregate_for_zone(self, zone: ZoneInfo, context: SwingContext) -> SwingMetrics:
        """
        –ê–≥—Ä–µ–≥–∏—Ä–æ–≤–∞—Ç—å –≥–ª–æ–±–∞–ª—å–Ω—ã–µ —Å–≤–∏–Ω–≥–∏ –¥–ª—è –∑–æ–Ω—ã.

        Process:
        1. –ü–æ–ª—É—á–∏—Ç—å —Å–≤–∏–Ω–≥–∏ –≤–Ω—É—Ç—Ä–∏ –∑–æ–Ω—ã (—Å —Å–æ—Å–µ–¥–Ω–∏–º–∏ —á–µ—Ä–µ–∑ slice)
        2. –†–∞–∑–¥–µ–ª–∏—Ç—å –Ω–∞ rallies –∏ drops
        3. –ê–≥—Ä–µ–≥–∏—Ä–æ–≤–∞—Ç—å –º–µ—Ç—Ä–∏–∫–∏
        """
        from .....core.logging_config import get_logger
        logger = get_logger(__name__)

        # 1. Get swings for zone (with neighbors)
        zone_swings = context.get_swings_for_zone(zone)

        if len(zone_swings) < 2:
            logger.debug(
                f"Zone {zone.zone_id}: insufficient swings ({len(zone_swings)} points)"
            )
            return self._empty_metrics()

        # 2. Separate into rallies and drops
        rallies = []
        drops = []

        for i in range(len(zone_swings) - 1):
            curr = zone_swings[i]
            next_swing = zone_swings[i + 1]

            price_change_pct = (next_swing.price / curr.price - 1) * 100
            duration_bars = next_swing.index - curr.index

            if price_change_pct > 0:
                # Rally (up movement)
                rallies.append({
                    'amplitude_pct': price_change_pct,
                    'duration_bars': duration_bars,
                    'speed_pct_per_bar': price_change_pct / duration_bars if duration_bars > 0 else 0
                })
            else:
                # Drop (down movement)
                drops.append({
                    'amplitude_pct': abs(price_change_pct),
                    'duration_bars': duration_bars,
                    'speed_pct_per_bar': abs(price_change_pct) / duration_bars if duration_bars > 0 else 0
                })

        # 3. Aggregate metrics (reuse existing logic)
        return self._aggregate_metrics(rallies, drops)

    def _aggregate_metrics(self, rallies: List[Dict], drops: List[Dict]) -> SwingMetrics:
        """
        –ê–≥—Ä–µ–≥–∏—Ä–æ–≤–∞—Ç—å rallies –∏ drops –≤ SwingMetrics.

        EXTRACTED: –û–±—â–∞—è –ª–æ–≥–∏–∫–∞ –¥–ª—è calculate() –∏ aggregate_for_zone()
        """
        rally_count = len(rallies)
        drop_count = len(drops)

        # Amplitude metrics
        if rally_count > 0:
            rally_amps = [r['amplitude_pct'] for r in rallies]
            avg_rally_pct = np.mean(rally_amps)
            max_rally_pct = np.max(rally_amps)
            min_rally_pct = np.min(rally_amps)
            rally_amplitude_std = np.std(rally_amps)
            rally_amplitude_median = np.median(rally_amps)
        else:
            avg_rally_pct = max_rally_pct = min_rally_pct = 0.0
            rally_amplitude_std = rally_amplitude_median = 0.0

        if drop_count > 0:
            drop_amps = [d['amplitude_pct'] for d in drops]
            avg_drop_pct = np.mean(drop_amps)
            max_drop_pct = np.max(drop_amps)
            min_drop_pct = np.min(drop_amps)
            drop_amplitude_std = np.std(drop_amps)
            drop_amplitude_median = np.median(drop_amps)
        else:
            avg_drop_pct = max_drop_pct = min_drop_pct = 0.0
            drop_amplitude_std = drop_amplitude_median = 0.0

        # Duration metrics
        if rally_count > 0:
            rally_durs = [r['duration_bars'] for r in rallies]
            avg_rally_duration_bars = float(np.mean(rally_durs))
            max_rally_duration_bars = int(np.max(rally_durs))
        else:
            avg_rally_duration_bars = 0.0
            max_rally_duration_bars = 0

        if drop_count > 0:
            drop_durs = [d['duration_bars'] for d in drops]
            avg_drop_duration_bars = float(np.mean(drop_durs))
            max_drop_duration_bars = int(np.max(drop_durs))
        else:
            avg_drop_duration_bars = 0.0
            max_drop_duration_bars = 0

        # Speed metrics
        if rally_count > 0:
            rally_speeds = [r['speed_pct_per_bar'] for r in rallies]
            avg_rally_speed_pct_per_bar = np.mean(rally_speeds)
            max_rally_speed_pct_per_bar = np.max(rally_speeds)
        else:
            avg_rally_speed_pct_per_bar = max_rally_speed_pct_per_bar = 0.0

        if drop_count > 0:
            drop_speeds = [d['speed_pct_per_bar'] for d in drops]
            avg_drop_speed_pct_per_bar = np.mean(drop_speeds)
            max_drop_speed_pct_per_bar = np.max(drop_speeds)
        else:
            avg_drop_speed_pct_per_bar = max_drop_speed_pct_per_bar = 0.0

        # Ratio and symmetry
        rally_to_drop_ratio = avg_rally_pct / avg_drop_pct if avg_drop_pct > 0 else 0.0
        duration_symmetry = (avg_rally_duration_bars / avg_drop_duration_bars
                           if avg_drop_duration_bars > 0 else 0.0)

        num_swings = min(rally_count, drop_count)

        metrics = SwingMetrics(
            num_swings=num_swings,
            avg_rally_pct=avg_rally_pct,
            avg_drop_pct=avg_drop_pct,
            max_rally_pct=max_rally_pct,
            max_drop_pct=max_drop_pct,
            rally_to_drop_ratio=rally_to_drop_ratio,
            rally_count=rally_count,
            drop_count=drop_count,
            min_rally_pct=min_rally_pct,
            min_drop_pct=min_drop_pct,
            rally_amplitude_std=rally_amplitude_std,
            drop_amplitude_std=drop_amplitude_std,
            rally_amplitude_median=rally_amplitude_median,
            drop_amplitude_median=drop_amplitude_median,
            avg_rally_duration_bars=avg_rally_duration_bars,
            avg_drop_duration_bars=avg_drop_duration_bars,
            max_rally_duration_bars=max_rally_duration_bars,
            max_drop_duration_bars=max_drop_duration_bars,
            avg_rally_speed_pct_per_bar=avg_rally_speed_pct_per_bar,
            avg_drop_speed_pct_per_bar=avg_drop_speed_pct_per_bar,
            max_rally_speed_pct_per_bar=max_rally_speed_pct_per_bar,
            max_drop_speed_pct_per_bar=max_drop_speed_pct_per_bar,
            duration_symmetry=duration_symmetry,
            strategy_name='zigzag',
            strategy_params={'legs': self.legs, 'deviation': self.deviation}
        )

        metrics.validate()
        return metrics

    def calculate(self, zone_data: pd.DataFrame) -> SwingMetrics:
        """
        Legacy per-zone calculation (DEPRECATED, –Ω–æ –æ—Å—Ç–∞–≤–ª–µ–Ω –¥–ª—è BC).

        –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ fallback –ø—Ä–∏ swing_scope="per_zone"
        """
        # Existing implementation –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
        # ... (current code from zigzag.py)
```

---

## 4. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ `ZoneAnalysisPipeline`

### 4.1. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ —Ä–∞—Å—á—ë—Ç–∞ —Å–≤–∏–Ω–≥–æ–≤

```python
# –í bquant/analysis/zones/pipeline.py

class ZoneAnalysisPipeline:
    """
    –ü–∞–π–ø–ª–∞–π–Ω –∞–Ω–∞–ª–∏–∑–∞ –∑–æ–Ω.

    UPDATED: –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ —Ä–∞—Å—á—ë—Ç–∞ —Å–≤–∏–Ω–≥–æ–≤
    """

    def _run_without_cache(self) -> ZoneAnalysisResult:
        """
        –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∞–Ω–∞–ª–∏–∑–∞ –±–µ–∑ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è.

        UPDATED: –î–æ–±–∞–≤–ª–µ–Ω —ç—Ç–∞–ø –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ —Ä–∞—Å—á—ë—Ç–∞ —Å–≤–∏–Ω–≥–æ–≤

        Workflow:
        1. prepare_dataframe() ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤
        2. [NEW] _calculate_global_swings() ‚Äî –≥–ª–æ–±–∞–ª—å–Ω—ã–π —Ä–∞—Å—á—ë—Ç (–µ—Å–ª–∏ swing_scope="global")
        3. detect_zones() ‚Äî –¥–µ—Ç–µ–∫—Ü–∏—è –∑–æ–Ω
        4. [NEW] _inject_swing_context() ‚Äî –∏–Ω–∂–µ–∫—Ü–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –≤ –∑–æ–Ω—ã
        5. _analyze_zones_internal() ‚Äî –∞–Ω–∞–ª–∏–∑ –∑–æ–Ω
        """
        # 1. Prepare data
        df_prepared = self._prepare_dataframe()

        # 2. –ù–û–í–û–ï: Calculate global swings (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–æ)
        global_swing_context = None
        if self._config.swing_scope == "global" and self._swing_strategy is not None:
            try:
                global_swing_context = self._calculate_global_swings(df_prepared)
            except Exception as e:
                self.logger.warning(
                    f"Global swing calculation failed, falling back to per_zone mode: {e}"
                )
                # Fallback: –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –±–µ–∑ –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞

        # 3. Detect zones
        zones = self._detect_zones_internal(df_prepared)

        # 4. –ù–û–í–û–ï: Inject swing_context into zones
        if global_swing_context is not None:
            self._inject_swing_context(zones, global_swing_context)

        # 5. Analyze zones
        result = self._analyze_zones_internal(zones, df_prepared)

        return result

    def _calculate_global_swings(self, data: pd.DataFrame) -> SwingContext:
        """
        –†–∞—Å—Å—á–∏—Ç–∞—Ç—å –≥–ª–æ–±–∞–ª—å–Ω—ã–µ —Å–≤–∏–Ω–≥–∏ –¥–ª—è –≤—Å–µ–≥–æ –¥–∞—Ç–∞—Å–µ—Ç–∞.

        NEW METHOD

        Args:
            data: –ü–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω—ã–π DataFrame —Å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞–º–∏

        Returns:
            SwingContext —Å –≥–ª–æ–±–∞–ª—å–Ω—ã–º–∏ —Å–≤–∏–Ω–≥–∞–º–∏

        Raises:
            ValueError: –ï—Å–ª–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≥–ª–æ–±–∞–ª—å–Ω—ã–π —Ä–∞—Å—á—ë—Ç
            RuntimeError: –ü—Ä–∏ –æ—à–∏–±–∫–∞—Ö –∞–ª–≥–æ—Ä–∏—Ç–º–∞
        """
        self.logger.info(
            f"Calculating global swings with strategy: {self._swing_strategy.__class__.__name__}"
        )

        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞
        if not hasattr(self._swing_strategy, 'calculate_global'):
            raise ValueError(
                f"Strategy {self._swing_strategy.__class__.__name__} "
                f"does not support global swing calculation"
            )

        # –í—ã–∑–æ–≤ –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ —Ä–∞—Å—á—ë—Ç–∞
        swing_context = self._swing_strategy.calculate_global(data)

        self.logger.info(
            f"Global swings calculated: {len(swing_context.swing_points)} swing points detected"
        )

        return swing_context

    def _inject_swing_context(
        self,
        zones: List[ZoneInfo],
        swing_context: SwingContext
    ) -> None:
        """
        –ò–Ω–∂–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –≥–ª–æ–±–∞–ª—å–Ω—ã–π SwingContext –≤ –∫–∞–∂–¥—É—é –∑–æ–Ω—É.

        NEW METHOD

        Args:
            zones: –°–ø–∏—Å–æ–∫ –¥–µ—Ç–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∑–æ–Ω
            swing_context: –ì–ª–æ–±–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç —Å–≤–∏–Ω–≥–æ–≤

        Side Effects:
            –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç zones in-place, —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—è zone.swing_context
        """
        for zone in zones:
            zone.swing_context = swing_context

        self.logger.debug(
            f"Injected swing_context into {len(zones)} zones"
        )
```

### 4.2. Builder API

```python
# –í bquant/analysis/zones/pipeline.py

class ZoneAnalysisBuilder:
    """
    Fluent API –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–Ω–∞–ª–∏–∑–∞ –∑–æ–Ω.

    UPDATED: –î–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ with_swing_scope()
    """

    def with_swing_scope(self, scope: Literal["per_zone", "global"]) -> 'ZoneAnalysisBuilder':
        """
        –í—ã–±–æ—Ä —Ä–µ–∂–∏–º–∞ —Ä–∞—Å—á—ë—Ç–∞ —Å–≤–∏–Ω–≥–æ–≤.

        NEW METHOD

        Args:
            scope: –†–µ–∂–∏–º —Ä–∞—Å—á—ë—Ç–∞
                - "per_zone": –ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ä–∞—Å—á—ë—Ç –¥–ª—è –∫–∞–∂–¥–æ–π –∑–æ–Ω—ã (legacy, default)
                - "global": –ì–ª–æ–±–∞–ª—å–Ω—ã–π —Ä–∞—Å—á—ë—Ç –Ω–∞ –≤—Å—ë–º –¥–∞—Ç–∞—Å–µ—Ç–µ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

        Returns:
            Self –¥–ª—è fluent API

        Raises:
            ValueError: –ï—Å–ª–∏ –ø–µ—Ä–µ–¥–∞–Ω –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π scope

        Example:
            # –ì–ª–æ–±–∞–ª—å–Ω—ã–π —Ä–µ–∂–∏–º (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞)
            result = (
                analyze_zones(data)
                .with_indicator('custom', 'macd', fast_period=12, slow_period=26, signal_period=9)
                .detect_zones('zero_crossing', indicator_col='macd_hist')
                .with_strategies(swing='zigzag')
                .with_swing_scope('global')  # ‚Üê –ì–ª–æ–±–∞–ª—å–Ω—ã–π —Ä–∞—Å—á—ë—Ç
                .analyze()
                .build()
            )

            # Legacy —Ä–µ–∂–∏–º (–¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏)
            result = (
                analyze_zones(data)
                ...
                .with_swing_scope('per_zone')  # ‚Üê –ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ä–∞—Å—á—ë—Ç
                .build()
            )
        """
        if scope not in ['per_zone', 'global']:
            raise ValueError(
                f"Invalid swing_scope: {scope}. "
                f"Must be 'per_zone' or 'global'"
            )

        self.pipeline._config.swing_scope = scope

        self.logger.info(f"Swing calculation mode set to: {scope}")

        return self
```

---

## 5. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ `ZoneFeaturesAnalyzer`

```python
# –í bquant/analysis/zones/zone_features.py

class ZoneFeaturesAnalyzer:
    """
    –ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫ —Ç–æ—Ä–≥–æ–≤—ã—Ö –∑–æ–Ω.

    UPDATED: –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ —Ä–∞—Å—á—ë—Ç–∞ —Å–≤–∏–Ω–≥–æ–≤
    """

    def extract_zone_features(self, zone_info: Dict[str, Any]) -> ZoneFeatures:
        """
        –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ –∏–∑ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∑–æ–Ω–µ.

        UPDATED: –î–æ–±–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –≤—ã–±–æ—Ä–∞ —Ä–µ–∂–∏–º–∞ —Ä–∞—Å—á—ë—Ç–∞ —Å–≤–∏–Ω–≥–æ–≤
        """
        # ... existing code ...

        # Calculate swing metrics using strategy
        if self.swing_strategy is not None:
            try:
                swing_context = zone_info.get('swing_context')

                if swing_context is not None:
                    # –ì–õ–û–ë–ê–õ–¨–ù–´–ô –†–ï–ñ–ò–ú
                    # –°–æ–∑–¥–∞—ë–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π ZoneInfo –¥–ª—è aggregate_for_zone
                    temp_zone = ZoneInfo(
                        zone_id=zone_info['zone_id'],
                        type=zone_info['type'],
                        start_idx=zone_info['start_idx'],
                        end_idx=zone_info['end_idx'],
                        start_time=zone_info['start_time'],
                        end_time=zone_info['end_time'],
                        duration=zone_info['duration'],
                        data=data,
                        swing_context=swing_context
                    )

                    swing_metrics = self.swing_strategy.aggregate_for_zone(
                        temp_zone,
                        swing_context
                    )

                    metadata['swing_calculation_mode'] = 'global'

                    self.logger.debug(
                        f"Swing metrics aggregated from global context: "
                        f"{swing_metrics.rally_count} rallies, {swing_metrics.drop_count} drops, "
                        f"ratio={swing_metrics.rally_to_drop_ratio:.2f}"
                    )

                else:
                    # PER-ZONE –†–ï–ñ–ò–ú (legacy –∏–ª–∏ fallback)
                    swing_metrics = self.swing_strategy.calculate(data)

                    metadata['swing_calculation_mode'] = 'per_zone'

                    self.logger.debug(
                        f"Swing metrics calculated in per_zone mode: "
                        f"{swing_metrics.rally_count} rallies, {swing_metrics.drop_count} drops"
                    )

                metadata['swing_metrics'] = swing_metrics.to_dict()

            except Exception as e:
                self.logger.warning(f"Failed to calculate swing metrics: {e}")
                metadata['swing_metrics'] = None

        # ... rest of existing code ...
```

---

## 6. –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –ø–æ—Ä–æ–≥–∏ –≤ –≥–ª–æ–±–∞–ª—å–Ω–æ–º —Ä–µ–∂–∏–º–µ

```python
# –í bquant/analysis/zones/strategies/swing/thresholds.py

class _AdaptiveSwingStrategy:
    """
    Wrapper –¥–ª—è –∞–¥–∞–ø—Ç–∏–≤–Ω—ã—Ö –ø–æ—Ä–æ–≥–æ–≤ —Å–≤–∏–Ω–≥–æ–≤.

    UPDATED: –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞
    """

    def __init__(self, base_strategy, adaptive_params: Dict[str, Any]):
        self.base_strategy = base_strategy
        self.adaptive_params = adaptive_params
        self._global_threshold_cache = None  # –ö—ç—à –¥–ª—è –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞

    def calculate_global(self, full_data: pd.DataFrame) -> SwingContext:
        """
        –ì–ª–æ–±–∞–ª—å–Ω—ã–π —Ä–∞—Å—á—ë—Ç —Å –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–º–∏ –ø–æ—Ä–æ–≥–∞–º–∏.

        NEW METHOD

        –í–ê–ñ–ù–û: –ü–æ—Ä–æ–≥–∏ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –û–î–ò–ù –†–ê–ó –Ω–∞ –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
        –∏ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –∫–æ –≤—Å–µ–º –∑–æ–Ω–∞–º.
        """
        # 1. Calculate adaptive thresholds on FULL data
        thresholds = self._calculate_adaptive_thresholds(full_data)
        self._global_threshold_cache = thresholds

        # 2. Apply thresholds to base strategy
        self._apply_thresholds_to_strategy(self.base_strategy, thresholds)

        # 3. Delegate to base strategy
        return self.base_strategy.calculate_global(full_data)

    def aggregate_for_zone(self, zone: ZoneInfo, context: SwingContext) -> SwingMetrics:
        """
        –ê–≥—Ä–µ–≥–∞—Ü–∏—è —Å –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö –ø–æ—Ä–æ–≥–æ–≤.

        NEW METHOD

        –ü–æ—Ä–æ–≥–∏ –ù–ï –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –¥–ª—è –∫–∞–∂–¥–æ–π –∑–æ–Ω—ã ‚Äî –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≥–ª–æ–±–∞–ª—å–Ω—ã–µ!
        """
        # –ò—Å–ø–æ–ª—å–∑—É–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–æ—Ä–æ–≥–∏ (—É–∂–µ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã –≤ calculate_global)
        return self.base_strategy.aggregate_for_zone(zone, context)
```

---

## 7. –°—Ö–µ–º–∞ –æ–±–Ω–æ–≤–ª—ë–Ω–Ω–æ–≥–æ –≤–æ—Ä–∫—Ñ–ª–æ—É

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ               ZoneAnalysisPipeline._run_without_cache              ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ 1. prepare_dataframe()                                            ‚îÇ
‚îÇ    ‚îî‚îÄ> df_prepared (with indicators)                              ‚îÇ
‚îÇ                                                                    ‚îÇ
‚îÇ 2. if config.swing_scope == "global":                             ‚îÇ
‚îÇ    ‚îî‚îÄ> _calculate_global_swings(df_prepared)                      ‚îÇ
‚îÇ        ‚îî‚îÄ> swing_strategy.calculate_global(df_prepared)           ‚îÇ
‚îÇ            ‚îî‚îÄ> SwingContext(swing_points=[...], indices=[...])    ‚îÇ
‚îÇ                                                                    ‚îÇ
‚îÇ 3. _detect_zones_internal(df_prepared)                            ‚îÇ
‚îÇ    ‚îî‚îÄ> zones: List[ZoneInfo]                                      ‚îÇ
‚îÇ                                                                    ‚îÇ
‚îÇ 4. if global_swing_context:                                       ‚îÇ
‚îÇ    ‚îî‚îÄ> _inject_swing_context(zones, global_swing_context)         ‚îÇ
‚îÇ        ‚îî‚îÄ> for zone in zones: zone.swing_context = context        ‚îÇ
‚îÇ                                                                    ‚îÇ
‚îÇ 5. _analyze_zones_internal(zones, df_prepared)                    ‚îÇ
‚îÇ    ‚îî‚îÄ> UniversalZoneAnalyzer.analyze_zones(zones, df)             ‚îÇ
‚îÇ        ‚îî‚îÄ> ZoneFeaturesAnalyzer.extract_all_zones_features(zones) ‚îÇ
‚îÇ            ‚îî‚îÄ> for zone in zones:                                 ‚îÇ
‚îÇ                if zone.swing_context:                             ‚îÇ
‚îÇ                    swing_strategy.aggregate_for_zone(zone, ctx)   ‚îÇ
‚îÇ                    ‚îî‚îÄ> zone_swings = ctx.slice(zone.range)        ‚îÇ
‚îÇ                        ‚îî‚îÄ> SwingMetrics                            ‚îÇ
‚îÇ                else:                                               ‚îÇ
‚îÇ                    swing_strategy.calculate(zone.data)            ‚îÇ
‚îÇ                    ‚îî‚îÄ> SwingMetrics (legacy)                       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## 8. –ú–∏–≥—Ä–∞—Ü–∏–æ–Ω–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è

### –§–∞–∑–∞ 1: –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö (Week 1)
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: –í–´–°–û–ö–ò–ô**

**üìñ –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ pre-reading**:
- **–†–∞–∑–¥–µ–ª 1** - "–ù–æ–≤—ã–µ –º–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö" (—Å—Ç—Ä–æ–∫–∏ 55-266) - –ø–æ–ª–Ω–∞—è —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è SwingPoint, SwingContext, –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è ZoneInfo
- **–†–∞–∑–¥–µ–ª 10, –†–∏—Å–∫ 2** - "–ü–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏" (—Å—Ç—Ä–æ–∫–∏ 1649-1752) - –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ –¥–∏–∑–∞–π–Ω –º–æ–¥–µ–ª–µ–π –¥–ª—è –±–æ–ª—å—à–∏—Ö –¥–∞—Ç–∞—Å–µ—Ç–æ–≤
- **–†–∞–∑–¥–µ–ª 2** - "–†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏" (—Å—Ç—Ä–æ–∫–∏ 268-306) - —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ ZoneAnalysisConfig

---

**–ó–∞–¥–∞—á–∏**:

1.1. ‚úÖ **–°–æ–∑–¥–∞—Ç—å `SwingPoint` dataclass** (`bquant/analysis/zones/models.py`)

     **–°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è**: –°–º. —Ä–∞–∑–¥–µ–ª 1.1 (—Å—Ç—Ä–æ–∫–∏ 55-101) - –ø–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –∏–∑ 9 –ø–æ–ª–µ–π

     **Checklist**:
     - [ ] –í—Å–µ 9 –ø–æ–ª–µ–π —Å–æ–≥–ª–∞—Å–Ω–æ —Ç–∞–±–ª–∏—Ü–µ –≤ Attributes (—Ä–∞–∑–¥–µ–ª 1.1, —Å—Ç—Ä–æ–∫–∏ 70-78)
     - [ ] `__post_init__` –≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–ª—è strategy_params (—Å—Ç—Ä–æ–∫–∏ 98-100)
     - [ ] Type hints: `point_id: int`, `timestamp: datetime`, `swing_type: str`, etc.
     - [ ] Docstring —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏ (Google Style Guide)

     **–ü—Ä–æ–≤–µ—Ä–∫–∞**: –ö–æ–¥ –¥–æ–ª–∂–µ–Ω —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å –ø—Ä–∏–º–µ—Ä–æ–º –∏–∑ —Ä–∞–∑–¥–µ–ª–∞ 1.1 (—Å—Ç—Ä–æ–∫–∏ 64-101)

1.2. ‚úÖ **–°–æ–∑–¥–∞—Ç—å `SwingContext` dataclass** (`bquant/analysis/zones/models.py`)

     **–°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è**: –°–º. —Ä–∞–∑–¥–µ–ª 1.2 (—Å—Ç—Ä–æ–∫–∏ 103-200) - –ø–æ–ª–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å –º–µ—Ç–æ–¥–∞–º–∏

     **Checklist**:
     - [ ] 5 –ø–æ–ª–µ–π: swing_points, indices, full_data_length, strategy_name, strategy_params (—Å—Ç—Ä–æ–∫–∏ 124-128)
     - [ ] –ú–µ—Ç–æ–¥ `slice()` —Å bisect –∞–ª–≥–æ—Ä–∏—Ç–º–æ–º (—Å—Ç—Ä–æ–∫–∏ 130-165) - **–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û**
     - [ ] –ú–µ—Ç–æ–¥ `get_swings_for_zone()` (—Å—Ç—Ä–æ–∫–∏ 167-177)
     - [ ] –ú–µ—Ç–æ–¥ `to_dict()` –¥–ª—è —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏ (—Å—Ç—Ä–æ–∫–∏ 179-199)
     - [ ] indices –∫–∞–∫ `np.ndarray` –¥–ª—è O(log N) –ø–æ–∏—Å–∫–∞

     **–ê–ª–≥–æ—Ä–∏—Ç–º slice()**:
     - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `bisect_left`/`bisect_right` –¥–ª—è –≥—Ä–∞–Ω–∏—Ü (—Å—Ç—Ä–æ–∫–∏ 158-159)
     - –ó–∞—Ö–≤–∞—Ç–∏—Ç—å —Å–æ—Å–µ–¥–Ω–∏–µ –ø–∏–≤–æ—Ç—ã: `left-1` –∏ `right+1` (—Å—Ç—Ä–æ–∫–∏ 162-163)
     - –°–º. –≤–∏–∑—É–∞–ª—å–Ω—ã–π –ø—Ä–∏–º–µ—Ä –≤ —Å—Ç—Ä–æ–∫–∞—Ö 140-145

     **Memory constraint**: –û—Ü–µ–Ω–∫–∞ ~264 bytes/point (—Ä–∞–∑–¥–µ–ª 10, —Å—Ç—Ä–æ–∫–∏ 1652-1669)

1.3. ‚úÖ **–û–±–Ω–æ–≤–∏—Ç—å `ZoneInfo`** (`bquant/analysis/zones/models.py`)

     **–°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è**: –°–º. —Ä–∞–∑–¥–µ–ª 1.3 (—Å—Ç—Ä–æ–∫–∏ 202-264)

     **Checklist**:
     - [ ] –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ `swing_context: Optional[SwingContext] = None` (—Å—Ç—Ä–æ–∫–∞ 225)
     - [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –º–µ—Ç–æ–¥ `get_zone_swings()` (—Å—Ç—Ä–æ–∫–∏ 227-243)
     - [ ] –û–±–Ω–æ–≤–∏—Ç—å `to_analyzer_format()` - –≤–∫–ª—é—á–∏—Ç—å swing_context (—Å—Ç—Ä–æ–∫–∏ 245-263)
     - [ ] Docstrings —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è (—Å—Ç—Ä–æ–∫–∏ 228-239)

1.4. ‚úÖ **–î–æ–±–∞–≤–∏—Ç—å `swing_scope` –≤ `ZoneAnalysisConfig`** (`bquant/analysis/zones/pipeline.py`)

     **–°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è**: –°–º. —Ä–∞–∑–¥–µ–ª 2.1 (—Å—Ç—Ä–æ–∫–∏ 268-300)

     **Checklist**:
     - [ ] –ü–æ–ª–µ `swing_scope: Literal["per_zone", "global"] = "per_zone"` (—Å—Ç—Ä–æ–∫–∞ 289)
     - [ ] –û–±–Ω–æ–≤–∏—Ç—å `to_cache_key()` - –≤–∫–ª—é—á–∏—Ç—å swing_scope (—Å—Ç—Ä–æ–∫–∞ 298)
     - [ ] Default = "per_zone" –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
     - [ ] Docstring –æ–±—ä—è—Å–Ω—è–µ—Ç –æ–±–∞ —Ä–µ–∂–∏–º–∞ (—Å—Ç—Ä–æ–∫–∏ 278-286)

1.5. ‚úÖ **–û–±–Ω–æ–≤–∏—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –≤–µ—Ä—Å–∏–µ–π** (`bquant/analysis/zones/cache.py`)

     **–°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è**: –°–º. —Ä–∞–∑–¥–µ–ª 9.4 (—Å—Ç—Ä–æ–∫–∏ 2090-2209) - –º–∏–≥—Ä–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∫—ç—à–µ–π

     **Checklist** (–¥–≤—É—Å—Ç–æ—Ä–æ–Ω–Ω—è—è —Å—Ö–µ–º–∞ WRITE + READ):
     - [ ] –î–æ–±–∞–≤–∏—Ç—å –∫–æ–Ω—Å—Ç–∞–Ω—Ç—É `CACHE_VERSION = 2` –≤ ZoneAnalysisCache
     - [ ] –û–±–Ω–æ–≤–∏—Ç—å `_generate_cache_key()` - –≤–∫–ª—é—á–∏—Ç—å `f"version={self.CACHE_VERSION}"` –≤ key_parts
     - [ ] **WRITE PATH**: –û–±–Ω–æ–≤–∏—Ç—å `save()` - –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å `'cache_version': self.CACHE_VERSION` –≤ payload
     - [ ] **READ PATH**: –û–±–Ω–æ–≤–∏—Ç—å `load()` - –ø—Ä–æ–≤–µ—Ä—è—Ç—å `cached_version = cached_data.get('cache_version', 1)`
     - [ ] –î–æ–±–∞–≤–∏—Ç—å –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—é: `if cached_version < self.CACHE_VERSION: return None`
     - [ ] –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å INFO –ø—Ä–∏ –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∫—ç—à–∞, DEBUG –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏

---

**‚úÖ Post-completion checklist**:

**Immediate (–ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–µ–π—á–∞—Å)**:
- [ ] –í—Å–µ –º–æ–¥–µ–ª–∏ –∏–∑ —Ä–∞–∑–¥–µ–ª–∞ 1 —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã (SwingPoint, SwingContext, ZoneInfo updates)
- [ ] –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–æ (CACHE_VERSION = 2, –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è —Å—Ç–∞—Ä—ã—Ö –∫—ç—à–µ–π)
- [ ] API —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏ –∏–∑ —Ä–∞–∑–¥–µ–ª–∞ 1 (–≤—Ä—É—á–Ω—É—é —Å—Ä–∞–≤–Ω–∏—Ç—å —Å–∏–≥–Ω–∞—Ç—É—Ä—ã –º–µ—Ç–æ–¥–æ–≤)
- [ ] **–¢–ï–°–¢**: –ó–∞–ø—É—Å—Ç–∏—Ç—å `mypy bquant/analysis/zones/models.py` - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å type hints
- [ ] **–¢–ï–°–¢**: –°–æ–∑–¥–∞—Ç—å smoke test –Ω–∞ —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—é - –≤—ã–∑–≤–∞—Ç—å `SwingContext.to_dict()`, –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ Dict —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ –ø–æ–ª—è
- [ ] **–¢–ï–°–¢**: –°–æ–∑–¥–∞—Ç—å smoke test –Ω–∞ memory - —Å–æ–∑–¥–∞—Ç—å SwingContext —Å 1000 SwingPoint, –∏–∑–º–µ—Ä–∏—Ç—å —á–µ—Ä–µ–∑ `sys.getsizeof()`, –ø—Ä–æ–≤–µ—Ä–∏—Ç—å ~264 KB ¬±50%
- [ ] **–¢–ï–°–¢**: –°–æ–∑–¥–∞—Ç—å smoke test –Ω–∞ cache invalidation - —Å–æ–∑–¥–∞—Ç—å fake –∫—ç—à —Å version=1, –ø–æ–ø—ã—Ç–∞—Ç—å—Å—è –∑–∞–≥—Ä—É–∑–∏—Ç—å, –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –≤–µ—Ä–Ω—É–ª—Å—è None
- [ ] Docstrings —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç Google Style Guide (–ø—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Ä—É—á–Ω—É—é –∏–ª–∏ —á–µ—Ä–µ–∑ linter)

**Future compatibility (‚è≥ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –§–∞–∑–µ 5)**:
- [ ] ‚è≥ –ö–æ–¥ –≥–æ—Ç–æ–≤ –∫ edge case —Ç–µ—Å—Ç–∞–º: `SwingContext.slice()` –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≥—Ä–∞–Ω–∏—Ü—ã –º–∞—Å—Å–∏–≤–∞ (–≤–∫–ª—é—á–∞–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ `max(0, left-1)` –∏ `min(len, right+1)`)
- [ ] ‚è≥ –ö–æ–¥ –≥–æ—Ç–æ–≤ –∫ integration —Ç–µ—Å—Ç–∞–º: `ZoneInfo.get_zone_swings()` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫ –µ—Å–ª–∏ `swing_context is None`
- [ ] ‚è≥ –ö–æ–¥ –≥–æ—Ç–æ–≤ –∫ cache migration —Ç–µ—Å—Ç–∞–º: —Å—Ç–∞—Ä—ã–µ –∫—ç—à–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–Ω–≤–∞–ª–∏–¥–∏—Ä—É—é—Ç—Å—è –ø—Ä–∏ CACHE_VERSION —É–≤–µ–ª–∏—á–µ–Ω–∏–∏

### –§–∞–∑–∞ 2: –ü—Ä–æ—Ç–æ–∫–æ–ª –∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ —Å–≤–∏–Ω–≥–æ–≤ (Week 2)
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: –í–´–°–û–ö–ò–ô**

**üìñ –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ pre-reading**:
- **–†–∞–∑–¥–µ–ª 3** - "–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ API —Å—Ç—Ä–∞—Ç–µ–≥–∏–π —Å–≤–∏–Ω–≥–æ–≤" (—Å—Ç—Ä–æ–∫–∏ 308-689) - –ø–æ–ª–Ω–∞—è —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ –∏ –ø—Ä–∏–º–µ—Ä—ã —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
- **–†–∞–∑–¥–µ–ª 6** - "–ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –ø–æ—Ä–æ–≥–∏ –≤ –≥–ª–æ–±–∞–ª—å–Ω–æ–º —Ä–µ–∂–∏–º–µ" (—Å—Ç—Ä–æ–∫–∏ 946-992) - –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –∞–¥–∞–ø—Ç–∏–≤–Ω—ã—Ö —Å—Ç—Ä–∞—Ç–µ–≥–∏–π
- **–†–∞–∑–¥–µ–ª 10, –†–∏—Å–∫ 4** - "–†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å —Å—Ç—Ä–∞—Ç–µ–≥–∏–π" (—Å—Ç—Ä–æ–∫–∞ 1765-1770) - —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –ø—Ä–æ—Ç–æ–∫–æ–ª—É

---

**–ó–∞–¥–∞—á–∏**:

2.1. ‚úÖ **–û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ—Ç–æ–∫–æ–ª `SwingCalculationStrategy`** (`bquant/analysis/zones/strategies/base.py`)

     **–°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è**: –°–º. —Ä–∞–∑–¥–µ–ª 3.1 (—Å—Ç—Ä–æ–∫–∏ 310-401) - Protocol —Å 3 –º–µ—Ç–æ–¥–∞–º–∏

     **Checklist**:
     - [ ] `@runtime_checkable` decorator –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤ runtime
     - [ ] –ú–µ—Ç–æ–¥ `calculate_global(full_data) -> SwingContext` (—Å—Ç—Ä–æ–∫–∏ 329-350)
     - [ ] –ú–µ—Ç–æ–¥ `aggregate_for_zone(zone, context) -> SwingMetrics` (—Å—Ç—Ä–æ–∫–∏ 352-374)
     - [ ] –ú–µ—Ç–æ–¥ `calculate(zone_data) -> SwingMetrics` –ø–æ–º–µ—á–µ–Ω –∫–∞–∫ DEPRECATED (—Å—Ç—Ä–æ–∫–∏ 376-391)
     - [ ] –ú–µ—Ç–æ–¥ `config_hash() -> Dict[str, Any]` (—Å—Ç—Ä–æ–∫–∏ 393-400)
     - [ ] –ü–æ–ª–Ω—ã–µ docstrings –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –º–µ—Ç–æ–¥–∞

     **–í–ê–ñ–ù–û**: –ú–µ—Ç–æ–¥—ã calculate_global() –∏ aggregate_for_zone() - PRIORITY, calculate() - —Ç–æ–ª—å–∫–æ BC

2.2. ‚úÖ **–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `calculate_global()` –¥–ª—è `ZigZagSwingStrategy`** (`strategies/swing/zigzag.py`)

     **–°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è**: –°–º. —Ä–∞–∑–¥–µ–ª 3.2 (—Å—Ç—Ä–æ–∫–∏ 419-527) - –ø–æ–ª–Ω—ã–π –ø—Ä–∏–º–µ—Ä —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

     **Checklist**:
     - [ ] –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (—Å—Ç—Ä–æ–∫–∏ 436-439)
     - [ ] –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ pandas-ta ZigZag (—Å—Ç—Ä–æ–∫–∏ 442-448)
     - [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ edge cases (–Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∫–æ–ª–æ–Ω–æ–∫, –º–∞–ª–æ —Ç–æ—á–µ–∫) (—Å—Ç—Ä–æ–∫–∏ 450-472)
     - [ ] –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –≤ SwingPoint –æ–±—ä–µ–∫—Ç—ã (—Å—Ç—Ä–æ–∫–∏ 474-517)
     - [ ] –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ swing_type (peak/trough) –ø–æ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—é (—Å—Ç—Ä–æ–∫–∏ 482-491)
     - [ ] –†–∞—Å—á—ë—Ç amplitude_to_next –∏ duration_to_next (—Å—Ç—Ä–æ–∫–∏ 493-502)
     - [ ] –í–æ–∑–≤—Ä–∞—Ç SwingContext —Å –ø–æ–ª–Ω—ã–º–∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏ (—Å—Ç—Ä–æ–∫–∏ 521-527)

     **–ê–ª–≥–æ—Ä–∏—Ç–º**:
     1. –ò–∑–≤–ª–µ—á—å swing_values –∏–∑ ZigZag result (—Å—Ç—Ä–æ–∫–∞ 461)
     2. –ò—Ç–µ—Ä–∞—Ü–∏—è –ø–æ swing_points_series (—Å—Ç—Ä–æ–∫–∞ 478)
     3. –ü–æ–ª—É—á–∏—Ç—å position —á–µ—Ä–µ–∑ `full_data.index.get_loc()` (—Å—Ç—Ä–æ–∫–∞ 479)
     4. –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å swing_type –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å prev/next (—Å—Ç—Ä–æ–∫–∏ 482-491)

2.3. ‚úÖ **–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `aggregate_for_zone()` –¥–ª—è `ZigZagSwingStrategy`** (`strategies/swing/zigzag.py`)

     **–°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è**: –°–º. —Ä–∞–∑–¥–µ–ª 3.2 (—Å—Ç—Ä–æ–∫–∏ 529-577) - –∞–≥—Ä–µ–≥–∞—Ü–∏—è –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö —Å–≤–∏–Ω–≥–æ–≤

     **Checklist**:
     - [ ] –ü–æ–ª—É—á–µ–Ω–∏–µ zone_swings —á–µ—Ä–µ–∑ `context.get_swings_for_zone(zone)` (—Å—Ç—Ä–æ–∫–∞ 542)
     - [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Å–≤–∏–Ω–≥–æ–≤ (—Å—Ç—Ä–æ–∫–∏ 544-548)
     - [ ] –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ rallies –∏ drops –ø–æ price_change_pct (—Å—Ç—Ä–æ–∫–∏ 550-574)
     - [ ] –í—ã–∑–æ–≤ `_aggregate_metrics()` –¥–ª—è —Ñ–∏–Ω–∞–ª—å–Ω–æ–π –∞–≥—Ä–µ–≥–∞—Ü–∏–∏ (—Å—Ç—Ä–æ–∫–∞ 577)

2.4. ‚úÖ **–ò–∑–≤–ª–µ—á—å `_aggregate_metrics()` –∫–∞–∫ –æ–±—â–∏–π –º–µ—Ç–æ–¥** (`strategies/swing/zigzag.py`)

     **–°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è**: –°–º. —Ä–∞–∑–¥–µ–ª 3.2 (—Å—Ç—Ä–æ–∫–∏ 579-679) - –æ–±—â–∞—è –ª–æ–≥–∏–∫–∞ –∞–≥—Ä–µ–≥–∞—Ü–∏–∏

     **Checklist**:
     - [ ] –ü—Ä–∏–Ω–∏–º–∞–µ—Ç `rallies: List[Dict]` –∏ `drops: List[Dict]`
     - [ ] –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –í–°–ï 23 –ø–æ–ª—è SwingMetrics (—Å—Ç—Ä–æ–∫–∏ 588-676)
     - [ ] –í—ã–∑—ã–≤–∞–µ—Ç `metrics.validate()` –ø–µ—Ä–µ–¥ –≤–æ–∑–≤—Ä–∞—Ç–æ–º (—Å—Ç—Ä–æ–∫–∞ 678)
     - [ ] –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∏ –≤ calculate() (legacy), –∏ –≤ aggregate_for_zone()

     **–í–ê–ñ–ù–û**: –≠—Ç–æ—Ç –º–µ—Ç–æ–¥ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–æ–≤—Ç–æ—Ä–Ω–æ - –Ω–µ –¥—É–±–ª–∏—Ä–æ–≤–∞—Ç—å –ª–æ–≥–∏–∫—É!

2.5. ‚úÖ **–û–±–Ω–æ–≤–∏—Ç—å `FindPeaksSwingStrategy`** (`strategies/swing/find_peaks.py`)

     **–°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è**: –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ ZigZagSwingStrategy (—Ä–∞–∑–¥–µ–ª 3.2)

     **Checklist**:
     - [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `calculate_global()` —Å scipy.signal.find_peaks –Ω–∞ –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
     - [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `aggregate_for_zone()` –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ ZigZag
     - [ ] –ò–∑–≤–ª–µ—á—å `_aggregate_metrics()` –∏–∑ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ calculate()
     - [ ] –°–æ—Ö—Ä–∞–Ω–∏—Ç—å legacy –º–µ—Ç–æ–¥ calculate() –¥–ª—è BC

2.6. ‚úÖ **–û–±–Ω–æ–≤–∏—Ç—å `PivotPointsSwingStrategy`** (`strategies/swing/pivot_points.py`)

     **–°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è**: –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ ZigZagSwingStrategy

     **Checklist**:
     - [ ] calculate_global(), aggregate_for_zone(), _aggregate_metrics()
     - [ ] –¢–µ –∂–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã, —á—Ç–æ –∏ –¥–ª—è ZigZag/FindPeaks

2.7. ‚úÖ **–û–±–Ω–æ–≤–∏—Ç—å `_AdaptiveSwingStrategy`** (`strategies/swing/thresholds.py`)

     **–°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è**: –°–º. —Ä–∞–∑–¥–µ–ª 6 (—Å—Ç—Ä–æ–∫–∏ 946-992) - wrapper –¥–ª—è –∞–¥–∞–ø—Ç–∏–≤–Ω—ã—Ö –ø–æ—Ä–æ–≥–æ–≤

     **Checklist**:
     - [ ] –î–æ–±–∞–≤–∏—Ç—å `_global_threshold_cache` –ø–æ–ª–µ (—Å—Ç—Ä–æ–∫–∞ 961)
     - [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `calculate_global()` - –ø–æ—Ä–æ–≥–∏ ONE TIME –Ω–∞ –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (—Å—Ç—Ä–æ–∫–∏ 963-980)
     - [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `aggregate_for_zone()` - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–æ—Ä–æ–≥–∏ (—Å—Ç—Ä–æ–∫–∏ 982-991)

     **–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û**: –ü–æ—Ä–æ–≥–∏ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –û–î–ò–ù –†–ê–ó –Ω–∞ –ø–æ–ª–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö, –ù–ï –¥–ª—è –∫–∞–∂–¥–æ–π –∑–æ–Ω—ã!

---

**‚úÖ Post-completion checklist**:

**Immediate (–ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–µ–π—á–∞—Å)**:
- [ ] –ü—Ä–æ—Ç–æ–∫–æ–ª SwingCalculationStrategy –æ–±–Ω–æ–≤–ª—ë–Ω –≤ base.py (3 –º–µ—Ç–æ–¥–∞: calculate_global, aggregate_for_zone, calculate)
- [ ] –í—Å–µ 3 —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ (ZigZag, FindPeaks, PivotPoints) —Ä–µ–∞–ª–∏–∑—É—é—Ç –Ω–æ–≤—ã–µ –º–µ—Ç–æ–¥—ã
- [ ] `_aggregate_metrics()` –∏–∑–≤–ª–µ—á—ë–Ω –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω—ã–π –º–µ—Ç–æ–¥ (–±–µ–∑ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–¥–∞)
- [ ] –ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è –æ–±—ë—Ä—Ç–∫–∞ `_AdaptiveSwingStrategy` –∏–º–µ–µ—Ç –ø–æ–ª–µ `_global_threshold_cache`
- [ ] **–¢–ï–°–¢**: –ó–∞–ø—É—Å—Ç–∏—Ç—å `mypy` –Ω–∞ strategies/ - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å type hints –∏ Protocol compliance
- [ ] **–¢–ï–°–¢**: –°–æ–∑–¥–∞—Ç—å smoke test –¥–ª—è ZigZag - –≤—ã–∑–≤–∞—Ç—å `calculate_global(sample_data)`, –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –≤–µ—Ä–Ω—É–ª—Å—è SwingContext —Å swing_points
- [ ] **–¢–ï–°–¢**: –°–æ–∑–¥–∞—Ç—å smoke test –¥–ª—è –∞–≥—Ä–µ–≥–∞—Ü–∏–∏ - –≤—ã–∑–≤–∞—Ç—å `aggregate_for_zone(zone, context)`, –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –≤–µ—Ä–Ω—É–ª—Å—è SwingMetrics
- [ ] Docstrings –æ–±–Ω–æ–≤–ª–µ–Ω—ã (Google Style) - –≤—Å–µ –Ω–æ–≤—ã–µ –º–µ—Ç–æ–¥—ã –∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã

**Future compatibility (‚è≥ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –§–∞–∑–µ 5)**:
- [ ] ‚è≥ –ö–æ–¥ –≥–æ—Ç–æ–≤ –∫ unit —Ç–µ—Å—Ç–∞–º –∏–∑ –§–∞–∑—ã 5: `calculate_global()` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—É—Å—Ç–æ–π SwingContext –µ—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö < legs*2 (–Ω–µ –ø–∞–¥–∞–µ—Ç —Å –∏—Å–∫–ª—é—á–µ–Ω–∏–µ–º)
- [ ] ‚è≥ –ö–æ–¥ –≥–æ—Ç–æ–≤ –∫ unit —Ç–µ—Å—Ç–∞–º –∏–∑ –§–∞–∑—ã 5: `aggregate_for_zone()` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç empty metrics –µ—Å–ª–∏ zone_swings < 2
- [ ] ‚è≥ –ö–æ–¥ –≥–æ—Ç–æ–≤ –∫ BC —Ç–µ—Å—Ç–∞–º: Legacy –º–µ—Ç–æ–¥ `calculate()` —Å–æ—Ö—Ä–∞–Ω—ë–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ —Ä–∞–Ω—å—à–µ (–º–æ–∂–Ω–æ –≤—ã–∑–≤–∞—Ç—å –Ω–∞ zone.data)
- [ ] ‚è≥ –ö–æ–¥ –≥–æ—Ç–æ–≤ –∫ adaptive threshold —Ç–µ—Å—Ç–∞–º: –ü–æ—Ä–æ–≥–∏ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è ONE TIME –≤ `calculate_global()` –∏ –∫—ç—à–∏—Ä—É—é—Ç—Å—è –≤ `_global_threshold_cache`

### –§–∞–∑–∞ 3: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Pipeline (Week 3)
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: –°–†–ï–î–ù–ò–ô**

**üìñ –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ pre-reading**:
- **–†–∞–∑–¥–µ–ª 4** - "–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ ZoneAnalysisPipeline" (—Å—Ç—Ä–æ–∫–∏ 691-867) - –ø–æ–ª–Ω–∞—è —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ Pipeline
- **–†–∞–∑–¥–µ–ª 7** - "–°—Ö–µ–º–∞ –æ–±–Ω–æ–≤–ª—ë–Ω–Ω–æ–≥–æ –≤–æ—Ä–∫—Ñ–ª–æ—É" (—Å—Ç—Ä–æ–∫–∏ 996-1028) - –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ workflow
- **–†–∞–∑–¥–µ–ª 9.3** - "Graceful Degradation" (—Å—Ç—Ä–æ–∫–∏ 1623-1636) - –ª–æ–≥–∏–∫–∞ fallback –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö

---

**–ó–∞–¥–∞—á–∏**:

3.1. ‚úÖ **–î–æ–±–∞–≤–∏—Ç—å `_calculate_global_swings()` –≤ `ZoneAnalysisPipeline`** (`bquant/analysis/zones/pipeline.py`)

     **–°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è**: –°–º. —Ä–∞–∑–¥–µ–ª 4.1 (—Å—Ç—Ä–æ–∫–∏ 746-780) - –Ω–æ–≤—ã–π –º–µ—Ç–æ–¥ —Ä–∞—Å—á—ë—Ç–∞

     **Checklist**:
     - [ ] –°–∏–≥–Ω–∞—Ç—É—Ä–∞: `_calculate_global_swings(data: pd.DataFrame) -> SwingContext`
     - [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞ (—Å—Ç—Ä–æ–∫–∏ 767-771)
     - [ ] –í—ã–∑–æ–≤ `self._swing_strategy.calculate_global(data)` (—Å—Ç—Ä–æ–∫–∞ 774)
     - [ ] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã—Ö —Å–≤–∏–Ω–≥–æ–≤ (—Å—Ç—Ä–æ–∫–∏ 776-778)
     - [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π (ValueError, RuntimeError)

     **–í–∞–∂–Ω—ã–µ –¥–µ—Ç–∞–ª–∏**:
     - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `hasattr(self._swing_strategy, 'calculate_global')` –ø–µ—Ä–µ–¥ –≤—ã–∑–æ–≤–æ–º
     - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ INFO —É—Ä–æ–≤–Ω–µ: "Calculating global swings with strategy..."

3.2. ‚úÖ **–î–æ–±–∞–≤–∏—Ç—å `_inject_swing_context()` –≤ `ZoneAnalysisPipeline`**

     **–°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è**: –°–º. —Ä–∞–∑–¥–µ–ª 4.1 (—Å—Ç—Ä–æ–∫–∏ 782-804) - –∏–Ω–∂–µ–∫—Ü–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –≤ –∑–æ–Ω—ã

     **Checklist**:
     - [ ] –°–∏–≥–Ω–∞—Ç—É—Ä–∞: `_inject_swing_context(zones: List[ZoneInfo], swing_context: SwingContext) -> None`
     - [ ] –ò—Ç–µ—Ä–∞—Ü–∏—è –ø–æ –∑–æ–Ω–∞–º: `for zone in zones: zone.swing_context = swing_context` (—Å—Ç—Ä–æ–∫–∏ 799-800)
     - [ ] Side effect: –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è in-place (—Å—Ç—Ä–æ–∫–∞ 797)
     - [ ] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ DEBUG —É—Ä–æ–≤–Ω–µ (—Å—Ç—Ä–æ–∫–∏ 802-804)

3.3. ‚úÖ **–û–±–Ω–æ–≤–∏—Ç—å `_run_without_cache()` —Å –Ω–æ–≤—ã–º –≤–æ—Ä–∫—Ñ–ª–æ—É**

     **–°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è**: –°–º. —Ä–∞–∑–¥–µ–ª 4.1 (—Å—Ç—Ä–æ–∫–∏ 707-744) + –¥–∏–∞–≥—Ä–∞–º–º–∞ —Ä–∞–∑–¥–µ–ª 7 (—Å—Ç—Ä–æ–∫–∏ 999-1028)

     **Checklist**:
     - [ ] –®–∞–≥ 1: prepare_dataframe() - –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π (—Å—Ç—Ä–æ–∫–∞ 721)
     - [ ] –®–∞–≥ 2: –í—ã–∑–æ–≤ _calculate_global_swings() –µ—Å–ª–∏ swing_scope=="global" (—Å—Ç—Ä–æ–∫–∏ 724-732)
     - [ ] –®–∞–≥ 2a: try-except —Å fallback –Ω–∞ per_zone (—Å—Ç—Ä–æ–∫–∏ 726-732)
     - [ ] –®–∞–≥ 3: detect_zones() - –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π (—Å—Ç—Ä–æ–∫–∞ 735)
     - [ ] –®–∞–≥ 4: _inject_swing_context() –µ—Å–ª–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç —Å—É—â–µ—Å—Ç–≤—É–µ—Ç (—Å—Ç—Ä–æ–∫–∏ 738-739)
     - [ ] –®–∞–≥ 5: analyze_zones() - –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π (—Å—Ç—Ä–æ–∫–∞ 742)

     **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π –±–ª–æ–∫ fallback** (—Å—Ç—Ä–æ–∫–∏ 726-732):
     ```python
     try:
         global_swing_context = self._calculate_global_swings(df_prepared)
     except Exception as e:
         self.logger.warning(
             f"Global swing calculation failed, falling back to per_zone mode: {e}"
         )
         # Fallback: –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –±–µ–∑ –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
     ```

3.4. ‚úÖ **–î–æ–±–∞–≤–∏—Ç—å `with_swing_scope()` –≤ `ZoneAnalysisBuilder`**

     **–°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è**: –°–º. —Ä–∞–∑–¥–µ–ª 4.2 (—Å—Ç—Ä–æ–∫–∏ 806-867) - Builder API –º–µ—Ç–æ–¥

     **Checklist**:
     - [ ] –°–∏–≥–Ω–∞—Ç—É—Ä–∞: `with_swing_scope(scope: Literal["per_zone", "global"]) -> 'ZoneAnalysisBuilder'`
     - [ ] –í–∞–ª–∏–¥–∞—Ü–∏—è scope: raise ValueError –µ—Å–ª–∏ –Ω–µ 'per_zone' –∏–ª–∏ 'global' (—Å—Ç—Ä–æ–∫–∏ 856-860)
     - [ ] –£—Å—Ç–∞–Ω–æ–≤–∫–∞: `self.pipeline._config.swing_scope = scope` (—Å—Ç—Ä–æ–∫–∞ 862)
     - [ ] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ: `self.logger.info(f"Swing calculation mode set to: {scope}")` (—Å—Ç—Ä–æ–∫–∞ 864)
     - [ ] –í–æ–∑–≤—Ä–∞—Ç self –¥–ª—è fluent API (—Å—Ç—Ä–æ–∫–∞ 866)
     - [ ] –ü–æ–ª–Ω—ã–π docstring —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏ (—Å—Ç—Ä–æ–∫–∏ 820-854)

     **–ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è**: –°–º. —Å—Ç—Ä–æ–∫–∏ 837-854 –≤ docstring

3.5. ‚úÖ **–û–±–Ω–æ–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Ä–µ–∂–∏–º–∞**

     **Checklist**:
     - [ ] INFO: "Calculating global swings with strategy: ..." (—Å—Ç—Ä–æ–∫–∞ 763)
     - [ ] INFO: "Global swings calculated: N swing points detected" (—Å—Ç—Ä–æ–∫–∞ 776)
     - [ ] WARNING: "Global swing calculation failed, falling back..." (—Å—Ç—Ä–æ–∫–∞ 729)
     - [ ] INFO: "Swing calculation mode set to: global/per_zone" (—Å—Ç—Ä–æ–∫–∞ 864)
     - [ ] DEBUG: "Injected swing_context into N zones" (—Å—Ç—Ä–æ–∫–∞ 802)

---

**‚úÖ Post-completion checklist**:

**Immediate (–ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–µ–π—á–∞—Å)**:
- [ ] –ú–µ—Ç–æ–¥—ã `_calculate_global_swings()` –∏ `_inject_swing_context()` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –≤ ZoneAnalysisPipeline
- [ ] Workflow `_run_without_cache()` –æ–±–Ω–æ–≤–ª—ë–Ω: prepare ‚Üí calculate_global (if global) ‚Üí detect ‚Üí inject ‚Üí analyze
- [ ] Builder API –º–µ—Ç–æ–¥ `with_swing_scope()` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –∏ –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç scope ('per_zone' | 'global')
- [ ] **–¢–ï–°–¢**: –°–æ–∑–¥–∞—Ç—å smoke test –Ω–∞ fallback - –ø–µ—Ä–µ–¥–∞—Ç—å –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ WARNING –∑–∞–ª–æ–≥–∏—Ä–æ–≤–∞–Ω –∏ execution –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è
- [ ] **–¢–ï–°–¢**: –°–æ–∑–¥–∞—Ç—å smoke test –Ω–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ - –≤—ã–∑–≤–∞—Ç—å —Å swing_scope='global', –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ INFO "Calculating global swings..."
- [ ] **–¢–ï–°–¢**: –°–æ–∑–¥–∞—Ç—å smoke test –Ω–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ä–µ–∂–∏–º–æ–≤ - –∑–∞–ø—É—Å—Ç–∏—Ç—å —Å 'per_zone', –∑–∞—Ç–µ–º —Å 'global', —É–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ—Ç–ª–∏—á–∞—é—Ç—Å—è

**Future compatibility (‚è≥ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –§–∞–∑–µ 5)**:
- [ ] ‚è≥ –ö–æ–¥ –≥–æ—Ç–æ–≤ –∫ integration —Ç–µ—Å—Ç–∞–º –∏–∑ –§–∞–∑—ã 5: try-except –±–ª–æ–∫ –≤ _run_without_cache() –ª–æ–≤–∏—Ç –≤—Å–µ Exception –∏ –¥–µ–ª–∞–µ—Ç fallback –Ω–∞ per_zone
- [ ] ‚è≥ –ö–æ–¥ –≥–æ—Ç–æ–≤ –∫ integration —Ç–µ—Å—Ç–∞–º –∏–∑ –§–∞–∑—ã 5: `_inject_swing_context()` –ø—Ä–∏—Å–≤–∞–∏–≤–∞–µ—Ç –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ –æ–±—ä–µ–∫—Ç SwingContext –≤—Å–µ–º –∑–æ–Ω–∞–º (–ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ `zone_a.swing_context is zone_b.swing_context`)
- [ ] ‚è≥ –ö–æ–¥ –≥–æ—Ç–æ–≤ –∫ cache collision —Ç–µ—Å—Ç–∞–º: `swing_scope` –≤–∫–ª—é—á—ë–Ω –≤ cache key generation (—Ä–∞–∑–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –¥–ª—è per_zone vs global)

### –§–∞–∑–∞ 4: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ ZoneFeaturesAnalyzer (Week 3)
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: –°–†–ï–î–ù–ò–ô**

**üìñ –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ pre-reading**:
- **–†–∞–∑–¥–µ–ª 5** - "–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ ZoneFeaturesAnalyzer" (—Å—Ç—Ä–æ–∫–∏ 869-942) - –ª–æ–≥–∏–∫–∞ –≤—ã–±–æ—Ä–∞ —Ä–µ–∂–∏–º–∞ –≤ extract_zone_features()
- **–†–∞–∑–¥–µ–ª 1.3** - "–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ ZoneInfo" (—Å—Ç—Ä–æ–∫–∏ 202-264) - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ ZoneInfo.swing_context

---

**–ó–∞–¥–∞—á–∏**:

4.1. ‚úÖ **–û–±–Ω–æ–≤–∏—Ç—å `extract_zone_features()` —Å –ª–æ–≥–∏–∫–æ–π –≤—ã–±–æ—Ä–∞ —Ä–µ–∂–∏–º–∞** (`bquant/analysis/zones/zone_features.py`)

     **–°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è**: –°–º. —Ä–∞–∑–¥–µ–ª 5 (—Å—Ç—Ä–æ–∫–∏ 872-942) - –ø–æ–ª–Ω–∞—è –ª–æ–≥–∏–∫–∞ –≤–µ—Ç–≤–ª–µ–Ω–∏—è

     **Checklist**:
     - [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è swing_context –≤ zone_info (—Å—Ç—Ä–æ–∫–∞ 894)
     - [ ] –í–ï–¢–ö–ê GLOBAL: –°–æ–∑–¥–∞–Ω–∏–µ temp_zone —Å swing_context (—Å—Ç—Ä–æ–∫–∏ 896-909)
     - [ ] –í–ï–¢–ö–ê GLOBAL: –í—ã–∑–æ–≤ `strategy.aggregate_for_zone(temp_zone, context)` (—Å—Ç—Ä–æ–∫–∏ 911-914)
     - [ ] –í–ï–¢–ö–ê GLOBAL: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ metadata['swing_calculation_mode'] = 'global' (—Å—Ç—Ä–æ–∫–∞ 916)
     - [ ] –í–ï–¢–ö–ê PER_ZONE: –í—ã–∑–æ–≤ `strategy.calculate(data)` (—Å—Ç—Ä–æ–∫–∞ 926)
     - [ ] –í–ï–¢–ö–ê PER_ZONE: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ metadata['swing_calculation_mode'] = 'per_zone' (—Å—Ç—Ä–æ–∫–∞ 928)
     - [ ] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ–±–µ–∏—Ö –≤–µ—Ç–æ–∫ (—Å—Ç—Ä–æ–∫–∏ 918-933)
     - [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π (—Å—Ç—Ä–æ–∫–∏ 937-939)

     **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π –±–ª–æ–∫** (—Å—Ç—Ä–æ–∫–∏ 894-934):
     ```python
     swing_context = zone_info.get('swing_context')

     if swing_context is not None:
         # –ì–õ–û–ë–ê–õ–¨–ù–´–ô –†–ï–ñ–ò–ú
         temp_zone = ZoneInfo(...)
         swing_metrics = self.swing_strategy.aggregate_for_zone(temp_zone, swing_context)
         metadata['swing_calculation_mode'] = 'global'
     else:
         # PER-ZONE –†–ï–ñ–ò–ú (legacy –∏–ª–∏ fallback)
         swing_metrics = self.swing_strategy.calculate(data)
         metadata['swing_calculation_mode'] = 'per_zone'
     ```

4.2. ‚úÖ **–î–æ–±–∞–≤–∏—Ç—å –º–∞—Ä–∫–µ—Ä `swing_calculation_mode` –≤ metadata**

     **Checklist**:
     - [ ] –ü–æ–ª–µ 'swing_calculation_mode' –≤ metadata dict
     - [ ] –ó–Ω–∞—á–µ–Ω–∏–µ 'global' –¥–ª—è –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞ (—Å—Ç—Ä–æ–∫–∞ 916)
     - [ ] –ó–Ω–∞—á–µ–Ω–∏–µ 'per_zone' –¥–ª—è legacy —Ä–µ–∂–∏–º–∞ (—Å—Ç—Ä–æ–∫–∞ 928)
     - [ ] –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ integration —Ç–µ—Å—Ç–∞—Ö –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–µ–∂–∏–º–∞

4.3. ‚úÖ **–û–±–Ω–æ–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**

     **Checklist**:
     - [ ] DEBUG —É—Ä–æ–≤–µ–Ω—å –¥–ª—è global mode: "Swing metrics aggregated from global context: N rallies, M drops, ratio=X" (—Å—Ç—Ä–æ–∫–∏ 918-922)
     - [ ] DEBUG —É—Ä–æ–≤–µ–Ω—å –¥–ª—è per_zone mode: "Swing metrics calculated in per_zone mode: N rallies, M drops" (—Å—Ç—Ä–æ–∫–∏ 930-933)
     - [ ] WARNING –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö: "Failed to calculate swing metrics: {e}" (—Å—Ç—Ä–æ–∫–∞ 938)

---

**‚úÖ Post-completion checklist**:

**Immediate (–ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–µ–π—á–∞—Å)**:
- [ ] –ú–µ—Ç–æ–¥ `extract_zone_features()` –∏–º–µ–µ—Ç if-else –≤–µ—Ç–≤–ª–µ–Ω–∏–µ: `if swing_context is not None: ... else: ...`
- [ ] –í–ï–¢–ö–ê GLOBAL: —Å–æ–∑–¥–∞—ë—Ç—Å—è temp_zone –∏ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `strategy.aggregate_for_zone(temp_zone, swing_context)`
- [ ] –í–ï–¢–ö–ê PER_ZONE: –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `strategy.calculate(data)`
- [ ] –ü–æ–ª–µ `metadata['swing_calculation_mode']` —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –≤ 'global' –∏–ª–∏ 'per_zone'
- [ ] **–¢–ï–°–¢**: –°–æ–∑–¥–∞—Ç—å smoke test –Ω–∞ global —Ä–µ–∂–∏–º - —Å–æ–∑–¥–∞—Ç—å zone_info —Å swing_context, –≤—ã–∑–≤–∞—Ç—å extract_zone_features(), –ø—Ä–æ–≤–µ—Ä–∏—Ç—å metadata['swing_calculation_mode'] == 'global'
- [ ] **–¢–ï–°–¢**: –°–æ–∑–¥–∞—Ç—å smoke test –Ω–∞ per_zone —Ä–µ–∂–∏–º - —Å–æ–∑–¥–∞—Ç—å zone_info –ë–ï–ó swing_context, –ø—Ä–æ–≤–µ—Ä–∏—Ç—å metadata['swing_calculation_mode'] == 'per_zone'
- [ ] **–¢–ï–°–¢**: –°–æ–∑–¥–∞—Ç—å smoke test –Ω–∞ exception handling - –ø–µ—Ä–µ–¥–∞—Ç—å –±–∏—Ç—É—é —Å—Ç—Ä–∞—Ç–µ–≥–∏—é, –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ WARNING –∑–∞–ª–æ–≥–∏—Ä–æ–≤–∞–Ω –∏ metadata['swing_metrics'] == None

**Future compatibility (‚è≥ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –§–∞–∑–µ 5)**:
- [ ] ‚è≥ –ö–æ–¥ –≥–æ—Ç–æ–≤ –∫ integration —Ç–µ—Å—Ç–∞–º –∏–∑ –§–∞–∑—ã 5: try-except –±–ª–æ–∫ –æ–±–æ—Ä–∞—á–∏–≤–∞–µ—Ç –≤—Å—é swing calculation –ª–æ–≥–∏–∫—É (–Ω–µ –ø–∞–¥–∞–µ—Ç –Ω–∞ –æ—à–∏–±–∫–∞—Ö —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏)
- [ ] ‚è≥ –ö–æ–¥ –≥–æ—Ç–æ–≤ –∫ integration —Ç–µ—Å—Ç–∞–º –∏–∑ –§–∞–∑—ã 5: temp_zone —Å–æ–∑–¥–∞—ë—Ç—Å—è —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ (start_idx, end_idx, swing_context –∏–∑ zone_info)

### –§–∞–∑–∞ 5: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô

**üìñ –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ pre-reading**:
- **–†–∞–∑–¥–µ–ª 10** - "–†–∏—Å–∫–∏ –∏ –º–µ—Ä—ã" - –≤—Å–µ edge cases –∏ —Ä–∏—Å–∫–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- **–†–∞–∑–¥–µ–ª 1.2** - "SwingContext.slice()" - –∞–ª–≥–æ—Ä–∏—Ç–º –Ω–∞—Ä–µ–∑–∫–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≥—Ä–∞–Ω–∏—Ü
- **–†–∞–∑–¥–µ–ª 9** - "–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å, –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ fallback" - —Å—Ü–µ–Ω–∞—Ä–∏–∏ –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤
- **–†–∞–∑–¥–µ–ª 14** - "–ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏" - KPI –¥–ª—è –∏–∑–º–µ—Ä–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

---

**–í–ê–ñ–ù–û**: –§–∞–∑–∞ 5 —Ä–∞–∑–¥–µ–ª–µ–Ω–∞ –Ω–∞ **MVP (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã)** –∏ **Comprehensive (–∂–µ–ª–∞—Ç–µ–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã)**.

MVP —Ç–µ—Å—Ç—ã **–±–ª–æ–∫–∏—Ä—É—é—Ç —Ä–µ–ª–∏–∑**, Comprehensive —Ç–µ—Å—Ç—ã **–ø–æ–≤—ã—à–∞—é—Ç confidence** –Ω–æ –º–æ–≥—É—Ç –±—ã—Ç—å —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –ø–æ—Å–ª–µ —Ä–µ–ª–∏–∑–∞.

---

### –§–∞–∑–∞ 5.1: MVP Testing (Week 4, Days 1-2) - –ë–õ–û–ö–ò–†–£–ï–¢ –†–ï–õ–ò–ó

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô**

**5.1.1. Unit-—Ç–µ—Å—Ç—ã (–º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –Ω–∞–±–æ—Ä)**:
```python
# tests/unit/test_swing_global_calculation.py
def test_zigzag_global_vs_isolated():
    """–°—Ä–∞–≤–Ω–µ–Ω–∏–µ –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ –∏ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ä–µ–∂–∏–º–æ–≤ ZigZag."""
    # –°–æ–∑–¥–∞—Ç—å –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π —Ä—è–¥ —Å —è–≤–Ω—ã–º–∏ —Å–≤–∏–Ω–≥–∞–º–∏
    # –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –≥–ª–æ–±–∞–ª—å–Ω—ã–π —Ä–µ–∂–∏–º –Ω–∞—Ö–æ–¥–∏—Ç –±–æ–ª—å—à–µ —Å–≤–∏–Ω–≥–æ–≤

def test_swing_context_slice_with_neighbors():
    """–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –∑–∞—Ö–≤–∞—Ç–∞ —Å–æ—Å–µ–¥–Ω–∏—Ö –ø–∏–≤–æ—Ç–æ–≤."""
    # –°–æ–∑–¥–∞—Ç—å SwingContext —Å 5 —Ç–æ—á–∫–∞–º–∏
    # Slice [2:3] –¥–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å [1, 2, 3, 4] (—Å —Å–æ—Å–µ–¥–Ω–∏–º–∏)

def test_adaptive_thresholds_global_mode():
    """–ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –ø–æ—Ä–æ–≥–∏ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –≥–ª–æ–±–∞–ª—å–Ω–æ."""
    # –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –ø–æ—Ä–æ–≥ —Ä–∞—Å—Å—á–∏—Ç–∞–Ω –Ω–∞ –ø–æ–ª–Ω–æ–º –¥–∞—Ç–∞—Å–µ—Ç–µ
```

**Edge Case —Ç–µ—Å—Ç—ã (–ù–û–í–û–ï - –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û)**:
```python
# tests/unit/test_swing_edge_cases.py

def test_single_bar_zone():
    """
    –ó–æ–Ω–∞ –∏–∑ –æ–¥–Ω–æ–≥–æ –±–∞—Ä–∞ (start_idx == end_idx).

    Expected behavior:
        - slice() –¥–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å —Å–æ—Å–µ–¥–Ω–∏–µ –ø–∏–≤–æ—Ç—ã (–µ—Å–ª–∏ –µ—Å—Ç—å)
        - aggregate_for_zone() –¥–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å empty metrics (0 swings)
        - –ù–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å IndexError –∏–ª–∏ –¥—Ä—É–≥–∏—Ö –∏—Å–∫–ª—é—á–µ–Ω–∏–π
    """
    # –°–æ–∑–¥–∞—Ç—å –¥–∞—Ç–∞—Å–µ—Ç —Å 100 –±–∞—Ä–∞–º–∏
    # –°–æ–∑–¥–∞—Ç—å SwingContext —Å –ø–∏–≤–æ—Ç–∞–º–∏ –Ω–∞ –∏–Ω–¥–µ–∫—Å–∞—Ö [10, 30, 50, 70, 90]
    # –°–æ–∑–¥–∞—Ç—å –∑–æ–Ω—É [50:50] (–æ–¥–∏–Ω –±–∞—Ä)
    zone = ZoneInfo(zone_id=0, start_idx=50, end_idx=50, ...)

    # –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å [30, 50, 70] (—Å–æ—Å–µ–¥–Ω–∏–µ –ø–∏–≤–æ—Ç—ã)
    swings = context.get_swings_for_zone(zone)
    assert len(swings) == 3
    assert swings[0].index == 30  # left neighbor
    assert swings[1].index == 50  # zone pivot
    assert swings[2].index == 70  # right neighbor

    # –ú–µ—Ç—Ä–∏–∫–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø—É—Å—Ç—ã–º–∏ (–Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö —Å–≤–∏–Ω–≥–æ–≤)
    metrics = strategy.aggregate_for_zone(zone, context)
    assert metrics.num_swings == 0
    assert metrics.rally_count == 0
    assert metrics.drop_count == 0

def test_zone_without_internal_swings():
    """
    –ó–æ–Ω–∞ –±–µ–∑ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –ø–∏–≤–æ—Ç–æ–≤ (–≤—Å–µ –ø–∏–≤–æ—Ç—ã –≤–Ω–µ –∑–æ–Ω—ã).

    Expected behavior:
        - slice() –≤–µ—Ä–Ω—ë—Ç —Ç–æ–ª—å–∫–æ —Å–æ—Å–µ–¥–Ω–∏–µ –ø–∏–≤–æ—Ç—ã (2 —Ç–æ—á–∫–∏)
        - aggregate_for_zone() –≤–µ—Ä–Ω—ë—Ç metrics —Å 1 —Å–≤–∏–Ω–≥–æ–º (–¥–≤–∏–∂–µ–Ω–∏–µ –º–µ–∂–¥—É —Å–æ—Å–µ–¥–Ω–∏–º–∏)
    """
    # –ü–∏–≤–æ—Ç—ã: [10, 50, 90]
    # –ó–æ–Ω–∞: [20:40] (–º–µ–∂–¥—É –ø–∏–≤–æ—Ç–∞–º–∏ 10 –∏ 50)
    zone = ZoneInfo(zone_id=0, start_idx=20, end_idx=40, ...)

    swings = context.get_swings_for_zone(zone)
    assert len(swings) == 2  # [pivot@10, pivot@50]

    metrics = strategy.aggregate_for_zone(zone, context)
    # –û–¥–∏–Ω —Å–≤–∏–Ω–≥ –º–µ–∂–¥—É –¥–≤—É–º—è —Å–æ—Å–µ–¥–Ω–∏–º–∏ –ø–∏–≤–æ—Ç–∞–º–∏
    assert metrics.num_swings == 1 or (metrics.rally_count == 1 or metrics.drop_count == 1)

def test_zone_at_dataset_boundaries():
    """
    –ó–æ–Ω–∞ –Ω–∞ —Å–∞–º–æ–º –Ω–∞—á–∞–ª–µ –∏–ª–∏ –∫–æ–Ω—Ü–µ –¥–∞—Ç–∞—Å–µ—Ç–∞.

    Expected behavior:
        - –ó–æ–Ω–∞ –≤ –Ω–∞—á–∞–ª–µ: –∑–∞—Ö–≤–∞—Ç —Ç–æ–ª—å–∫–æ –ø—Ä–∞–≤–æ–≥–æ —Å–æ—Å–µ–¥–Ω–µ–≥–æ –ø–∏–≤–æ—Ç–∞
        - –ó–æ–Ω–∞ –≤ –∫–æ–Ω—Ü–µ: –∑–∞—Ö–≤–∞—Ç —Ç–æ–ª—å–∫–æ –ª–µ–≤–æ–≥–æ —Å–æ—Å–µ–¥–Ω–µ–≥–æ –ø–∏–≤–æ—Ç–∞
        - –ù–µ—Ç IndexError –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ –∑–∞ –≥—Ä–∞–Ω–∏—Ü—ã
    """
    # –î–∞—Ç–∞—Å–µ—Ç: 100 –±–∞—Ä–æ–≤ [0:99]
    # –ü–∏–≤–æ—Ç—ã: [5, 30, 50, 70, 95]

    # –ó–æ–Ω–∞ –≤ –Ω–∞—á–∞–ª–µ [0:10]
    zone_start = ZoneInfo(zone_id=0, start_idx=0, end_idx=10, ...)
    swings_start = context.get_swings_for_zone(zone_start)
    # –î–æ–ª–∂–Ω–æ –±—ã—Ç—å [pivot@5, pivot@30] (–Ω–µ—Ç –ª–µ–≤–æ–≥–æ —Å–æ—Å–µ–¥–∞)
    assert swings_start[0].index >= 0  # –ù–µ –≤—ã—Ö–æ–¥–∏—Ç –∑–∞ –≥—Ä–∞–Ω–∏—Ü—ã

    # –ó–æ–Ω–∞ –≤ –∫–æ–Ω—Ü–µ [90:99]
    zone_end = ZoneInfo(zone_id=1, start_idx=90, end_idx=99, ...)
    swings_end = context.get_swings_for_zone(zone_end)
    # –î–æ–ª–∂–Ω–æ –±—ã—Ç—å [pivot@70, pivot@95] (–Ω–µ—Ç –ø—Ä–∞–≤–æ–≥–æ —Å–æ—Å–µ–¥–∞)
    assert swings_end[-1].index <= 99  # –ù–µ –≤—ã—Ö–æ–¥–∏—Ç –∑–∞ –≥—Ä–∞–Ω–∏—Ü—ã

def test_overlapping_zones():
    """
    –ü–µ—Ä–µ–∫—Ä—ã–≤–∞—é—â–∏–µ—Å—è –∑–æ–Ω—ã (–µ—Å–ª–∏ –¥–µ—Ç–µ–∫—Ç–æ—Ä —Å–æ–∑–¥–∞—ë—Ç —Ç–∞–∫–∏–µ).

    Expected behavior:
        - –ö–∞–∂–¥–∞—è –∑–æ–Ω–∞ –ø–æ–ª—É—á–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ —Å–≤–∏–Ω–≥–∏
        - SwingContext –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å–æ–≤–º–µ—Å—Ç–Ω–æ (–Ω–µ –¥—É–±–ª–∏—Ä—É–µ—Ç—Å—è)
        - –ú–µ—Ç—Ä–∏–∫–∏ –º–æ–≥—É—Ç –æ—Ç–ª–∏—á–∞—Ç—å—Å—è –∏–∑-–∑–∞ —Ä–∞–∑–Ω—ã—Ö –≥—Ä–∞–Ω–∏—Ü
    """
    # –ü–∏–≤–æ—Ç—ã: [10, 30, 50, 70, 90]
    # –ó–æ–Ω–∞ A: [20:60]  ‚Üí swings [10, 30, 50, 70]
    # –ó–æ–Ω–∞ B: [40:80]  ‚Üí swings [30, 50, 70, 90]

    zone_a = ZoneInfo(zone_id=0, start_idx=20, end_idx=60, ...)
    zone_b = ZoneInfo(zone_id=1, start_idx=40, end_idx=80, ...)

    swings_a = context.get_swings_for_zone(zone_a)
    swings_b = context.get_swings_for_zone(zone_b)

    # –†–∞–∑–Ω—ã–µ –≥—Ä–∞–Ω–∏—Ü—ã ‚Üí —Ä–∞–∑–Ω—ã–µ —Å–≤–∏–Ω–≥–∏
    assert swings_a != swings_b

    # –ù–æ –æ–±–∞ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –æ–¥–∏–Ω SwingContext (–ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ id)
    assert zone_a.swing_context is zone_b.swing_context

def test_zone_with_all_peaks_or_all_troughs():
    """
    –ó–æ–Ω–∞, —Å–æ–¥–µ—Ä–∂–∞—â–∞—è —Ç–æ–ª—å–∫–æ peaks –∏–ª–∏ —Ç–æ–ª—å–∫–æ troughs.

    Expected behavior:
        - –ú–µ—Ç—Ä–∏–∫–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç –∞—Å–∏–º–º–µ—Ç—Ä–∏—é
        - rally_count –∏–ª–∏ drop_count –º–æ–∂–µ—Ç –±—ã—Ç—å 0
        - –ù–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å division by zero –≤ –º–µ—Ç—Ä–∏–∫–∞—Ö
    """
    # –°–æ–∑–¥–∞—Ç—å –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π —Å–ª—É—á–∞–π:
    # –ü–∏–≤–æ—Ç—ã: peak@10, peak@30, trough@50, peak@70
    # –ó–æ–Ω–∞: [5:40] ‚Üí —Å–æ–¥–µ—Ä–∂–∏—Ç [peak@10, peak@30]

    zone = ZoneInfo(zone_id=0, start_idx=5, end_idx=40, ...)
    metrics = strategy.aggregate_for_zone(zone, context)

    # –¢–æ–ª—å–∫–æ drops (–º–µ–∂–¥—É –¥–≤—É–º—è peaks)
    # rally_count –º–æ–∂–µ—Ç –±—ã—Ç—å 0
    assert metrics.drop_count >= 0
    assert metrics.rally_count >= 0

    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ division by zero
    if metrics.avg_drop_pct == 0:
        assert metrics.rally_to_drop_ratio == 0.0  # –ù–µ NaN –∏–ª–∏ Inf

def test_zone_exactly_matching_swing_boundaries():
    """
    –ó–æ–Ω–∞, –≥—Ä–∞–Ω–∏—Ü—ã –∫–æ—Ç–æ—Ä–æ–π —Ç–æ—á–Ω–æ —Å–æ–≤–ø–∞–¥–∞—é—Ç —Å –ø–∏–≤–æ—Ç–∞–º–∏.

    Expected behavior:
        - –ì—Ä–∞–Ω–∏—á–Ω—ã–µ –ø–∏–≤–æ—Ç—ã –≤–∫–ª—é—á–µ–Ω—ã –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç
        - –°–æ—Å–µ–¥–Ω–∏–µ –ø–∏–≤–æ—Ç—ã —Ç–∞–∫–∂–µ –∑–∞—Ö–≤–∞—á–µ–Ω—ã
    """
    # –ü–∏–≤–æ—Ç—ã: [10, 30, 50, 70, 90]
    # –ó–æ–Ω–∞: [30:70] (–≥—Ä–∞–Ω–∏—Ü—ã —Ç–æ—á–Ω–æ –Ω–∞ –ø–∏–≤–æ—Ç–∞—Ö)

    zone = ZoneInfo(zone_id=0, start_idx=30, end_idx=70, ...)
    swings = context.get_swings_for_zone(zone)

    # –î–æ–ª–∂–Ω–æ –±—ã—Ç—å [10, 30, 50, 70, 90] (–≤–∫–ª—é—á–∞—è —Å–æ—Å–µ–¥–Ω–∏–µ)
    assert 30 in [s.index for s in swings]  # –ì—Ä–∞–Ω–∏—Ü–∞ –≤–∫–ª—é—á–µ–Ω–∞
    assert 70 in [s.index for s in swings]  # –ì—Ä–∞–Ω–∏—Ü–∞ –≤–∫–ª—é—á–µ–Ω–∞
    assert 10 in [s.index for s in swings]  # –õ–µ–≤—ã–π —Å–æ—Å–µ–¥
    assert 90 in [s.index for s in swings]  # –ü—Ä–∞–≤—ã–π —Å–æ—Å–µ–¥

def test_empty_swing_context():
    """
    SwingContext –±–µ–∑ –ø–∏–≤–æ—Ç–æ–≤ (–∞–ª–≥–æ—Ä–∏—Ç–º –Ω–µ –Ω–∞—à—ë–ª —Å–≤–∏–Ω–≥–æ–≤).

    Expected behavior:
        - get_swings_for_zone() –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç []
        - aggregate_for_zone() –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç empty metrics
        - –ù–µ—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏–π
    """
    empty_context = SwingContext(
        swing_points=[],
        indices=np.array([]),
        full_data_length=100,
        strategy_name='zigzag',
        strategy_params={}
    )

    zone = ZoneInfo(zone_id=0, start_idx=20, end_idx=40, ...)
    zone.swing_context = empty_context

    swings = zone.get_zone_swings()
    assert swings == []

    metrics = strategy.aggregate_for_zone(zone, empty_context)
    assert metrics.num_swings == 0
```

**–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã**:
```python
# tests/integration/test_pipeline_global_swings.py
def test_pipeline_global_swing_scope():
    """–ü–æ–ª–Ω—ã–π –ø–∞–π–ø–ª–∞–π–Ω —Å global swing_scope."""
    result = (
        analyze_zones(sample_data)
        .with_indicator('custom', 'macd', ...)
        .detect_zones('zero_crossing', indicator_col='macd_hist')
        .with_strategies(swing='zigzag')
        .with_swing_scope('global')
        .analyze()
        .build()
    )

    # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –≤—Å–µ –∑–æ–Ω—ã –∏–º–µ—é—Ç swing_context
    assert all(zone.swing_context is not None for zone in result.zones)

    # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –º–µ—Ç—Ä–∏–∫–∏ –ø–æ–º–µ—á–µ–Ω—ã –∫–∞–∫ 'global'
    for zone in result.zones:
        if zone.features and 'metadata' in zone.features:
            assert zone.features['metadata'].get('swing_calculation_mode') == 'global'

def test_fallback_to_per_zone():
    """Fallback –Ω–∞ per_zone –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ —Ä–∞—Å—á—ë—Ç–∞."""
    # –°–æ–∑–¥–∞—Ç—å –¥–∞–Ω–Ω—ã–µ, –Ω–∞ –∫–æ—Ç–æ—Ä—ã—Ö global —Ä–∞—Å—á—ë—Ç —É–ø–∞–¥—ë—Ç
    # –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –ø–∞–π–ø–ª–∞–π–Ω –Ω–µ –ø–∞–¥–∞–µ—Ç –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç per_zone
```

**5.4. –°—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã**:
```python
# research/notebooks/test_global_swing_coverage.py
def compare_swing_coverage():
    """
    –°—Ä–∞–≤–Ω–∏—Ç—å –ø–æ–∫—Ä—ã—Ç–∏–µ –∑–æ–Ω —Å–≤–∏–Ω–≥–∞–º–∏ –≤ –¥–≤—É—Ö —Ä–µ–∂–∏–º–∞—Ö.

    Expected:
        Global mode: 70-90% –∑–æ–Ω –∏–º–µ—é—Ç —Å–≤–∏–Ω–≥–∏
        Per-zone mode: 20-60% –∑–æ–Ω –∏–º–µ—é—Ç —Å–≤–∏–Ω–≥–∏

    –û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ: –°–º. —Ä–∞–∑–¥–µ–ª 12 "–†–µ–∑—é–º–µ" - –æ–∂–∏–¥–∞–µ–º—ã–π —ç—Ñ—Ñ–µ–∫—Ç –Ω–∞ 05_case_study
    """
    # –ó–∞–ø—É—Å—Ç–∏—Ç—å 05_case_study —Å –æ–±–æ–∏–º–∏ —Ä–µ–∂–∏–º–∞–º–∏
    # –°—Ä–∞–≤–Ω–∏—Ç—å pct_with_swings
```

---

### –§–∞–∑–∞ 5.2: Comprehensive Testing (Post-MVP, optional) - –ù–ï –ë–õ–û–ö–ò–†–£–ï–¢ –†–ï–õ–ò–ó

**–í–ê–ñ–ù–û**: –≠—Ç–∏ —Ç–µ—Å—Ç—ã **–ø–æ–≤—ã—à–∞—é—Ç confidence** –∏ –∫–∞—á–µ—Å—Ç–≤–æ –ø—Ä–æ–¥—É–∫—Ç–∞, –Ω–æ **–ù–ï –±–ª–æ–∫–∏—Ä—É—é—Ç —Ä–µ–ª–∏–∑**. –ú–æ–≥—É—Ç –±—ã—Ç—å —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –ø–æ—Å–ª–µ –≤—ã–∫–∞—Ç–∫–∏ MVP.

**5.2.1. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ Edge Case —Ç–µ—Å—Ç—ã**:

**test_overlapping_zones()** - –ü–µ—Ä–µ–∫—Ä—ã–≤–∞—é—â–∏–µ—Å—è –∑–æ–Ω—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç –æ–¥–∏–Ω SwingContext
```python
def test_overlapping_zones():
    """
    –¶–µ–ª—å: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –ø–µ—Ä–µ–∫—Ä—ã–≤–∞—é—â–∏–µ—Å—è –∑–æ–Ω—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç –æ–¥–∏–Ω SwingContext

    Given: –î–≤–µ –∑–æ–Ω—ã [20:60] –∏ [40:80]
    When: calculate_global() –≤—ã–∑–≤–∞–Ω –æ–¥–∏–Ω —Ä–∞–∑
    Then: zone1.swing_context is zone2.swing_context (–æ–¥–∏–Ω –æ–±—ä–µ–∫—Ç)
    """
    global_context = strategy.calculate_global(data)
    zone1_swings = global_context.slice(20, 60)
    zone2_swings = global_context.slice(40, 80)
    # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –æ–±—â–∞—è —á–∞—Å—Ç—å [40:60] –∏–¥–µ–Ω—Ç–∏—á–Ω–∞
    assert zone1_swings[-n:] == zone2_swings[:n]
```

**test_zone_with_all_peaks_or_all_troughs()** - –ò–∑–±–µ–∂–∞—Ç—å division by zero
```python
def test_zone_with_all_peaks_or_all_troughs():
    """
    –¶–µ–ª—å: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞—Å—á—ë—Ç –º–µ—Ç—Ä–∏–∫ –¥–ª—è –∑–æ–Ω—ã —Å —Ç–æ–ª—å–∫–æ –ø–∏–∫–∞–º–∏ (–∏–ª–∏ —Ç–æ–ª—å–∫–æ –≤–ø–∞–¥–∏–Ω–∞–º–∏)

    Given: –ó–æ–Ω–∞ [30:50] —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–æ–ª—å–∫–æ peaks [32, 38, 45]
    When: aggregate_for_zone() —Ä–∞—Å—á–∏—Ç—ã–≤–∞–µ—Ç –º–µ—Ç—Ä–∏–∫–∏
    Then: SwingMetrics.avg_amplitude –º–æ–∂–µ—Ç –±—ã—Ç—å NaN –∏–ª–∏ 0 (–Ω–æ –Ω–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ)
    """
    # –°–æ–∑–¥–∞—Ç—å SwingContext —Å —Ç–æ–ª—å–∫–æ peaks
    peaks_only = [SwingPoint(32, 100.5, 'peak'), SwingPoint(38, 101.0, 'peak')]
    context = SwingContext(swing_points=peaks_only, indices=[32, 38])

    metrics = context.aggregate_for_zone(30, 50)
    assert metrics.num_swings == 0  # –ù–µ—Ç –ø–æ–ª–Ω—ã—Ö swings (–Ω—É–∂–Ω—ã peaks + troughs)
    assert not math.isnan(metrics.num_swings)  # –î–æ–ª–∂–Ω–æ –±—ã—Ç—å —á–∏—Å–ª–æ, –Ω–µ NaN
```

**test_zone_exactly_matching_swing_boundaries()** - –ì—Ä–∞–Ω–∏—Ü–∞ —Ç–æ—á–Ω–æ –Ω–∞ –ø–∏–≤–æ—Ç–µ
```python
def test_zone_exactly_matching_swing_boundaries():
    """
    –¶–µ–ª—å: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–∫–ª—é—á–µ–Ω–∏–µ —Å–æ—Å–µ–¥–Ω–∏—Ö –ø–∏–≤–æ—Ç–æ–≤ –ø—Ä–∏ —Ç–æ—á–Ω–æ–º —Å–æ–≤–ø–∞–¥–µ–Ω–∏–∏ –≥—Ä–∞–Ω–∏—Ü

    Given: –ü–∏–≤–æ—Ç—ã [10, 30, 50, 70, 90]
          –ó–æ–Ω–∞ [30:70] (—Ç–æ—á–Ω–æ –Ω–∞ –ø–∏–≤–æ—Ç–∞—Ö)
    When: slice(30, 70)
    Then: –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç [10, 30, 50, 70, 90] (–≤–∫–ª—é—á–∞—è —Å–æ—Å–µ–¥–Ω–∏–µ)
    """
    context = SwingContext(
        swing_points=[SwingPoint(i, 100.0, 'peak') for i in [10, 30, 50, 70, 90]],
        indices=[10, 30, 50, 70, 90]
    )
    result = context.slice(30, 70)
    assert [sp.index for sp in result] == [10, 30, 50, 70, 90]
```

**test_empty_swing_context()** - SwingContext —Å –ø—É—Å—Ç—ã–º —Å–ø–∏—Å–∫–æ–º
```python
def test_empty_swing_context():
    """
    –¶–µ–ª—å: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –ø—É—Å—Ç–æ–≥–æ SwingContext

    Given: SwingContext(swing_points=[], indices=[])
    When: slice(20, 40) –∏–ª–∏ aggregate_for_zone(20, 40)
    Then: –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—É—Å—Ç–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç (–Ω–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ)
    """
    empty_context = SwingContext(swing_points=[], indices=[])
    result = empty_context.slice(20, 40)
    assert result == []

    metrics = empty_context.aggregate_for_zone(20, 40)
    assert metrics.num_swings == 0
    assert metrics.avg_amplitude == 0.0
```

**5.2.2. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ Performance —Ç–µ—Å—Ç—ã**:

**test_memory_consumption_estimate()** - –û—Ü–µ–Ω–∫–∞ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è –ø–∞–º—è—Ç–∏
```python
def test_memory_consumption_estimate():
    """
    –¶–µ–ª—å: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏ –±–ª–∏–∑–∫–æ –∫ –æ—Ü–µ–Ω–∫–µ (264 bytes/point)

    When: –°–æ–∑–¥–∞—Ç—å 1000 SwingPoint –æ–±—ä–µ–∫—Ç–æ–≤
    Then: sys.getsizeof(SwingContext) ‚âà 264KB ¬± 50% tolerance
    """
    swing_points = [
        SwingPoint(i, 100.0 + i * 0.1, 'peak' if i % 2 == 0 else 'trough')
        for i in range(1000)
    ]
    context = SwingContext(swing_points=swing_points, indices=list(range(1000)))

    actual_bytes = sys.getsizeof(context)
    expected_bytes = 264 * 1000  # 264 bytes per point
    tolerance = 0.5  # 50% tolerance

    assert actual_bytes < expected_bytes * (1 + tolerance)
    assert actual_bytes > expected_bytes * (1 - tolerance)
```

**benchmark_global_vs_perzone()** - –°—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω—ã–π benchmark –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
```python
def benchmark_global_vs_perzone():
    """
    –¶–µ–ª—å: –ò–∑–º–µ—Ä–∏—Ç—å —Ä–∞–∑–Ω–∏—Ü—É –≤–æ –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ä–∞–∑–º–µ—Ä–æ–≤ –¥–∞—Ç–∞—Å–µ—Ç–∞

    –î–∞—Ç–∞—Å–µ—Ç—ã: 10k, 50k, 100k bars
    –†–µ–∂–∏–º—ã: global vs per_zone
    –ö—Ä–∏—Ç–µ—Ä–∏–π: global ‚â§ 1.5√ó –≤—Ä–µ–º—è per_zone
    """
    for dataset_size in [10_000, 50_000, 100_000]:
        data = generate_synthetic_data(dataset_size)
        zones = detect_zones(data)

        # Benchmark global mode
        start = time.perf_counter()
        global_context = strategy.calculate_global(data)
        for zone in zones:
            zone_swings = global_context.slice(zone.start_idx, zone.end_idx)
        global_time = time.perf_counter() - start

        # Benchmark per_zone mode
        start = time.perf_counter()
        for zone in zones:
            zone_data = data.iloc[zone.start_idx:zone.end_idx+1]
            zone_context = strategy.calculate(zone_data)
        perzone_time = time.perf_counter() - start

        ratio = global_time / perzone_time
        print(f"{dataset_size} bars: global {global_time:.3f}s, per_zone {perzone_time:.3f}s, ratio {ratio:.2f}√ó")
        assert ratio <= 1.5, f"Global mode too slow: {ratio:.2f}√ó per_zone"
```

**5.2.3. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π Comparative —Ç–µ—Å—Ç**:

**compare_swing_coverage()** - –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–æ–∫—Ä—ã—Ç–∏—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º —Å—Ü–µ–Ω–∞—Ä–∏–∏ (—É–∂–µ –æ–ø–∏—Å–∞–Ω –≤—ã—à–µ, —Å—Ç—Ä–æ–∫–∏ 1670-1685)

---

**‚úÖ Post-completion checklist –§–∞–∑—ã 5**:

### üö® –§–ê–ó–ê 5.1: MVP TESTING (–ë–õ–û–ö–ò–†–£–ï–¢ –†–ï–õ–ò–ó)

**A. MVP Unit-—Ç–µ—Å—Ç—ã** (tests/unit/test_swing_global_calculation.py):
- [ ] **–¢–ï–°–¢ –°–û–ó–î–ê–ù**: test_zigzag_global_vs_isolated() - –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, global –Ω–∞—Ö–æ–¥–∏—Ç –±–æ–ª—å—à–µ —Å–≤–∏–Ω–≥–æ–≤
- [ ] **–¢–ï–°–¢ –°–û–ó–î–ê–ù**: test_swing_context_slice_with_neighbors() - SwingContext.slice() –≤–∫–ª—é—á–∞–µ—Ç —Å–æ—Å–µ–¥–Ω–∏–µ —Ç–æ—á–∫–∏
- [ ] **–¢–ï–°–¢ –°–û–ó–î–ê–ù**: test_adaptive_thresholds_global_mode() - –∞–¥–∞–ø—Ç–∏–≤–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è, _global_threshold_cache –∑–∞–ø–æ–ª–Ω–µ–Ω

**B. MVP Edge Case —Ç–µ—Å—Ç—ã** (tests/unit/test_swing_edge_cases.py) - –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û:
- [ ] **–¢–ï–°–¢ –°–û–ó–î–ê–ù**: test_single_bar_zone() - –∑–æ–Ω–∞ [50:50], –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–æ—Å–µ–¥–Ω–∏–µ –ø–∏–≤–æ—Ç—ã, metrics.num_swings == 0
- [ ] **–¢–ï–°–¢ –°–û–ó–î–ê–ù**: test_zone_at_dataset_boundaries() - –∑–æ–Ω—ã [0:10] –∏ [90:99], –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ IndexError

**C. MVP Integration —Ç–µ—Å—Ç—ã** (tests/integration/test_pipeline_global_swings.py):
- [ ] **–¢–ï–°–¢ –°–û–ó–î–ê–ù**: test_pipeline_global_swing_scope() - –ø–æ–ª–Ω—ã–π pipeline —Å .with_swing_scope('global'), –≤—Å–µ –∑–æ–Ω—ã –∏–º–µ—é—Ç swing_context
- [ ] **–¢–ï–°–¢ –°–û–ó–î–ê–ù**: test_fallback_to_per_zone() - –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, WARNING –≤ –ª–æ–≥–∞—Ö, –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞ MVP (–ë–õ–û–ö–ò–†–£–ï–¢ –†–ï–õ–ò–ó)**:
- [ ] ‚úÖ **–í—Å–µ 3 unit-—Ç–µ—Å—Ç–∞ –ø—Ä–æ—Ö–æ–¥—è—Ç**
- [ ] ‚úÖ **–û–±–∞ edge case —Ç–µ—Å—Ç–∞ –ø—Ä–æ—Ö–æ–¥—è—Ç** (–ë–ï–ó IndexError)
- [ ] ‚úÖ **–û–±–∞ integration —Ç–µ—Å—Ç–∞ –ø—Ä–æ—Ö–æ–¥—è—Ç** (pipeline —Ä–∞–±–æ—Ç–∞–µ—Ç + fallback —Ä–∞–±–æ—Ç–∞–µ—Ç)

**‚ùå –ï—Å–ª–∏ —Ö–æ—Ç—å –æ–¥–∏–Ω MVP —Ç–µ—Å—Ç –ù–ï –ø—Ä–æ—Ö–æ–¥–∏—Ç ‚Üí –†–ï–õ–ò–ó –ë–õ–û–ö–ò–†–û–í–ê–ù**

---

### ‚≠ê –§–ê–ó–ê 5.2: COMPREHENSIVE TESTING (–ù–ï –ë–õ–û–ö–ò–†–£–ï–¢ –†–ï–õ–ò–ó)

**D. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ Edge Case —Ç–µ—Å—Ç—ã** (tests/unit/test_swing_edge_cases.py):
- [ ] **–¢–ï–°–¢ –°–û–ó–î–ê–ù**: test_zone_without_internal_swings() - –∑–æ–Ω–∞ [20:40] –º–µ–∂–¥—É –ø–∏–≤–æ—Ç–∞–º–∏ [10, 50], 2 —Ç–æ—á–∫–∏ –∏ 1 —Å–≤–∏–Ω–≥
- [ ] **–¢–ï–°–¢ –°–û–ó–î–ê–ù**: test_overlapping_zones() - –∑–æ–Ω—ã [20:60] –∏ [40:80], swing_context –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π –æ–±—ä–µ–∫—Ç
- [ ] **–¢–ï–°–¢ –°–û–ó–î–ê–ù**: test_zone_with_all_peaks_or_all_troughs() - —Ç–æ–ª—å–∫–æ peaks –≤ –∑–æ–Ω–µ, –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ division by zero
- [ ] **–¢–ï–°–¢ –°–û–ó–î–ê–ù**: test_zone_exactly_matching_swing_boundaries() - –≥—Ä–∞–Ω–∏—Ü—ã [30:70] —Ç–æ—á–Ω–æ –Ω–∞ –ø–∏–≤–æ—Ç–∞—Ö, –≤–∫–ª—é—á–µ–Ω–∏–µ —Å–æ—Å–µ–¥–Ω–∏—Ö
- [ ] **–¢–ï–°–¢ –°–û–ó–î–ê–ù**: test_empty_swing_context() - SwingContext —Å –ø—É—Å—Ç—ã–º —Å–ø–∏—Å–∫–æ–º, empty metrics

**E. –°—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã** (research/notebooks/test_global_swing_coverage.py):
- [ ] **–¢–ï–°–¢ –°–û–ó–î–ê–ù**: compare_swing_coverage() - –∑–∞–ø—É—Å—Ç–∏—Ç—å 05_case_study –≤ –æ–±–æ–∏—Ö —Ä–µ–∂–∏–º–∞—Ö, —Å—Ä–∞–≤–Ω–∏—Ç—å pct_with_swings

**F. Performance –∏ Memory —Ç–µ—Å—Ç—ã** (tests/performance/):
- [ ] **–¢–ï–°–¢ –°–û–ó–î–ê–ù**: test_memory_consumption_estimate() - —Å–æ–∑–¥–∞—Ç—å 1000 SwingPoint, –∏–∑–º–µ—Ä–∏—Ç—å —á–µ—Ä–µ–∑ sys.getsizeof(), –ø—Ä–æ–≤–µ—Ä–∏—Ç—å ~264 bytes/point ¬±50%
- [ ] **BENCHMARK –°–û–ó–î–ê–ù**: benchmark_global_vs_perzone() - –¥–∞—Ç–∞—Å–µ—Ç—ã 10k, 50k, 100k –±–∞—Ä–æ–≤, –∏–∑–º–µ—Ä–∏—Ç—å –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞ Comprehensive (–ü–û–í–´–®–ê–ï–¢ CONFIDENCE, –Ω–æ –ù–ï –±–ª–æ–∫–∏—Ä—É–µ—Ç —Ä–µ–ª–∏–∑)**:
- [ ] ‚≠ê –í—Å–µ 5 –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö edge case —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ—Ö–æ–¥—è—Ç
- [ ] ‚≠ê –°—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Ç–µ—Å—Ç –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —É–ª—É—á—à–µ–Ω–∏–µ: global mode 70-90% coverage vs per_zone 20-60%
- [ ] ‚≠ê Memory test: —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ < 400 bytes/point (264 bytes + 50% tolerance)
- [ ] ‚≠ê Benchmark: global mode –ù–ï –º–µ–¥–ª–µ–Ω–Ω–µ–µ —á–µ–º 1.5√ó per_zone

**‚úÖ –ï—Å–ª–∏ Comprehensive —Ç–µ—Å—Ç—ã –ù–ï –ø—Ä–æ—Ö–æ–¥—è—Ç ‚Üí –º–æ–∂–Ω–æ –≤—ã–ø—É—Å—Ç–∏—Ç—å —Ä–µ–ª–∏–∑ —Å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ–º (warning), –∏—Å–ø—Ä–∞–≤–∏—Ç—å –≤ —Å–ª–µ–¥—É—é—â–µ–π –≤–µ—Ä—Å–∏–∏**

**Future validation (–ø—Ä–æ–≤–µ—Ä–∫–∞ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —Ñ–∞–∑)**:
- [ ] üîÑ **–†–ï–¢–†–û–°–ü–ï–ö–¢–ò–í–ê –§–∞–∑—ã 1**: Smoke tests –∏–∑ –§–∞–∑—ã 1 —Ç–µ–ø–µ—Ä—å –ø–æ–∫—Ä—ã—Ç—ã —Ñ–æ—Ä–º–∞–ª—å–Ω—ã–º–∏ unit-—Ç–µ—Å—Ç–∞–º–∏
- [ ] üîÑ **–†–ï–¢–†–û–°–ü–ï–ö–¢–ò–í–ê –§–∞–∑—ã 2**: Smoke tests –∏–∑ –§–∞–∑—ã 2 —Ç–µ–ø–µ—Ä—å –ø–æ–∫—Ä—ã—Ç—ã —Ñ–æ—Ä–º–∞–ª—å–Ω—ã–º–∏ unit-—Ç–µ—Å—Ç–∞–º–∏
- [ ] üîÑ **–†–ï–¢–†–û–°–ü–ï–ö–¢–ò–í–ê –§–∞–∑—ã 3**: Smoke tests –∏–∑ –§–∞–∑—ã 3 —Ç–µ–ø–µ—Ä—å –ø–æ–∫—Ä—ã—Ç—ã integration-—Ç–µ—Å—Ç–∞–º–∏
- [ ] üîÑ **–†–ï–¢–†–û–°–ü–ï–ö–¢–ò–í–ê –§–∞–∑—ã 4**: Smoke tests –∏–∑ –§–∞–∑—ã 4 —Ç–µ–ø–µ—Ä—å –ø–æ–∫—Ä—ã—Ç—ã integration-—Ç–µ—Å—Ç–∞–º–∏

**–ï—Å–ª–∏ —Ö–æ—Ç—å –æ–¥–∏–Ω —Ç–µ—Å—Ç –ù–ï –ø—Ä–æ—Ö–æ–¥–∏—Ç**:
1. –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –≤ –∫–∞–∫–æ–π —Ñ–∞–∑–µ (1-4) –±—ã–ª –¥–æ–ø—É—â–µ–Ω –±–∞–≥
2. –í–µ—Ä–Ω—É—Ç—å—Å—è –≤ —Ç—É —Ñ–∞–∑—É –∏ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –∫–æ–¥
3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Ç–µ—Å—Ç—ã —Å–Ω–æ–≤–∞
4. –¢–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ –í–°–ï —Ç–µ—Å—Ç—ã –∑–µ–ª—ë–Ω—ã–µ ‚Üí –¥–≤–∏–≥–∞—Ç—å—Å—è –≤ –§–∞–∑—É 6

### –§–∞–∑–∞ 6.1: MVP Documentation (Week 4, Day 3) - –ë–õ–û–ö–ò–†–£–ï–¢ –†–ï–õ–ò–ó
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: –í–´–°–û–ö–ò–ô**

**–í–ê–ñ–ù–û**: –§–∞–∑–∞ 6 —Ä–∞–∑–¥–µ–ª–µ–Ω–∞ –Ω–∞ **MVP (–º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–ª—è —Ä–µ–ª–∏–∑–∞)** –∏ **Comprehensive (–ø–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è)**.

MVP –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è **–±–ª–æ–∫–∏—Ä—É–µ—Ç —Ä–µ–ª–∏–∑**, Comprehensive –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è **–∂–µ–ª–∞—Ç–µ–ª—å–Ω–∞** –Ω–æ –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–æ–∑–¥–∞–Ω–∞ –ø–æ—Å–ª–µ —Ä–µ–ª–∏–∑–∞.

**üìñ –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ pre-reading**:
- **–†–∞–∑–¥–µ–ª 11** - "–ò—Ç–æ–≥–æ–≤—ã–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞" - –∫–ª—é—á–µ–≤—ã–µ –≤—ã–≥–æ–¥—ã –¥–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- **–†–∞–∑–¥–µ–ª 4.2** - "Builder API" - –ø—Ä–∏–º–µ—Ä—ã –¥–ª—è migration guide
- **–†–∞–∑–¥–µ–ª 12** - "–†–µ–∑—é–º–µ" - –∫–ª—é—á–µ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è migration guide

---

**6.1.1. Docstrings –≤ –∫–æ–¥–µ** (–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û):

‚úÖ **–û–±–Ω–æ–≤–∏—Ç—å docstrings –≤–æ –≤—Å–µ—Ö –Ω–æ–≤—ã—Ö/–∏–∑–º–µ–Ω—ë–Ω–Ω—ã—Ö –∫–ª–∞—Å—Å–∞—Ö –∏ –º–µ—Ç–æ–¥–∞—Ö**:

```python
# bquant/analysis/zones/models.py
@dataclass
class SwingPoint:
    """–ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –æ–¥–Ω–æ–π swing —Ç–æ—á–∫–∏ (–ø–∏–∫ –∏–ª–∏ –≤–ø–∞–¥–∏–Ω–∞) –≤ —Ü–µ–Ω–æ–≤–æ–º —Ä—è–¥–µ.

    Attributes:
        index: –ü–æ–∑–∏—Ü–∏—è —Ç–æ—á–∫–∏ –≤ –∏—Å—Ö–æ–¥–Ω–æ–º –¥–∞—Ç–∞—Å–µ—Ç–µ (integer index)
        value: –¶–µ–Ω–∞ –≤ —ç—Ç–æ–π —Ç–æ—á–∫–µ (float)
        swing_type: –¢–∏–ø —Ç–æ—á–∫–∏ - 'peak' (–º–∞–∫—Å–∏–º—É–º) –∏–ª–∏ 'trough' (–º–∏–Ω–∏–º—É–º)

    Example:
        >>> sp = SwingPoint(index=42, value=1850.5, swing_type='peak')
        >>> sp.index
        42
    """
    index: int
    value: float
    swing_type: Literal['peak', 'trough']

@dataclass
class SwingContext:
    """–ì–ª–æ–±–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç swing —Ç–æ—á–µ–∫ –¥–ª—è –≤—Å–µ–≥–æ –¥–∞—Ç–∞—Å–µ—Ç–∞.

    –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è swing —Ç–æ—á–µ–∫
    –¥–ª—è –ª—é–±–æ–π –∑–æ–Ω—ã –±–µ–∑ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ —Ä–∞—Å—á—ë—Ç–∞.

    Attributes:
        swing_points: –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö swing —Ç–æ—á–µ–∫ –¥–ª—è –¥–∞—Ç–∞—Å–µ—Ç–∞
        indices: –û—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ –∏–Ω–¥–µ–∫—Å–æ–≤ swing_points –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞

    Methods:
        slice(start_idx, end_idx): –ò–∑–≤–ª–µ—á—å swing —Ç–æ—á–∫–∏ –¥–ª—è –∑–æ–Ω—ã [start_idx:end_idx]
        aggregate_for_zone(start_idx, end_idx): –†–∞—Å—Å—á–∏—Ç–∞—Ç—å SwingMetrics –¥–ª—è –∑–æ–Ω—ã

    Example:
        >>> context = SwingContext(
        ...     swing_points=[SwingPoint(10, 100.0, 'peak'), SwingPoint(30, 95.0, 'trough')],
        ...     indices=[10, 30]
        ... )
        >>> zone_swings = context.slice(5, 35)  # –í–∫–ª—é—á–∞–µ—Ç —Å–æ—Å–µ–¥–Ω–∏–µ —Ç–æ—á–∫–∏
        >>> len(zone_swings)
        2
    """
    swing_points: List[SwingPoint]
    indices: List[int]

    def slice(self, start_idx: int, end_idx: int) -> List[SwingPoint]:
        """–ò–∑–≤–ª–µ—á—å swing —Ç–æ—á–∫–∏ –¥–ª—è –∑–æ–Ω—ã —Å –≤–∫–ª—é—á–µ–Ω–∏–µ–º —Å–æ—Å–µ–¥–Ω–∏—Ö —Ç–æ—á–µ–∫.

        Args:
            start_idx: –ù–∞—á–∞–ª—å–Ω—ã–π –∏–Ω–¥–µ–∫—Å –∑–æ–Ω—ã (inclusive)
            end_idx: –ö–æ–Ω–µ—á–Ω—ã–π –∏–Ω–¥–µ–∫—Å –∑–æ–Ω—ã (inclusive)

        Returns:
            –°–ø–∏—Å–æ–∫ SwingPoint –≤–Ω—É—Ç—Ä–∏ –∑–æ–Ω—ã –ü–õ–Æ–° –æ–¥–∏–Ω —Å–æ—Å–µ–¥–Ω–∏–π —Å–ª–µ–≤–∞ –∏ —Å–ø—Ä–∞–≤–∞

        Example:
            >>> context.indices = [10, 30, 50, 70, 90]
            >>> result = context.slice(40, 60)  # –ó–æ–Ω–∞ [40:60]
            >>> [sp.index for sp in result]
            [30, 50, 70]  # –í–∫–ª—é—á–∞–µ—Ç —Å–æ—Å–µ–¥–Ω–∏–µ 30 –∏ 70
        """
        ...

@dataclass
class ZoneInfo:
    """–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ MACD –∑–æ–Ω–µ —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ –∞–Ω–∞–ª–∏–∑–∞.

    Attributes:
        swing_context: –ì–ª–æ–±–∞–ª—å–Ω—ã–π SwingContext (NEW in v0.X.Y)
            –ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ global —Ä–µ–∂–∏–º–µ, None –≤ per_zone —Ä–µ–∂–∏–º–µ

    Methods:
        get_zone_swings() -> List[SwingPoint]:
            –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Å–ø–æ—Å–æ–± –ø–æ–ª—É—á–µ–Ω–∏—è swing —Ç–æ—á–µ–∫ –¥–ª—è –∑–æ–Ω—ã.
            –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç swing_context.slice() –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω.
    """
    swing_context: Optional[SwingContext] = None

    def get_zone_swings(self) -> List[SwingPoint]:
        """–ü–æ–ª—É—á–∏—Ç—å swing —Ç–æ—á–∫–∏ –¥–ª—è —ç—Ç–æ–π –∑–æ–Ω—ã.

        Returns:
            –°–ø–∏—Å–æ–∫ SwingPoint –≤–Ω—É—Ç—Ä–∏ –∑–æ–Ω—ã (—Å —Å–æ—Å–µ–¥–Ω–∏–º–∏ —Ç–æ—á–∫–∞–º–∏)
            –ü—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫ –µ—Å–ª–∏ swing_context –Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω

        Example:
            >>> zone.swing_context = global_context
            >>> swings = zone.get_zone_swings()
            >>> len(swings)
            5  # –ó–∞–≤–∏—Å–∏—Ç –æ—Ç –∑–æ–Ω—ã –∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
        """
        ...
```

```python
# bquant/analysis/zones/pipeline.py
class ZoneAnalysisBuilder:
    """Builder –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ ZoneAnalysisPipeline.

    Methods:
        with_swing_scope(scope: Literal['per_zone', 'global']) -> Self:
            –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Ä–µ–∂–∏–º —Ä–∞—Å—á—ë—Ç–∞ swing —Ç–æ—á–µ–∫ (NEW in v0.X.Y)
    """

    def with_swing_scope(self, scope: Literal['per_zone', 'global']) -> 'ZoneAnalysisBuilder':
        """–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ä–µ–∂–∏–º —Ä–∞—Å—á—ë—Ç–∞ swing —Ç–æ—á–µ–∫.

        Args:
            scope: 'per_zone' (default) - —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—Ç—å –¥–ª—è –∫–∞–∂–¥–æ–π –∑–æ–Ω—ã –æ—Ç–¥–µ–ª—å–Ω–æ
                   'global' - —Ä–∞—Å—Å—á–∏—Ç–∞—Ç—å –æ–¥–∏–Ω —Ä–∞–∑ –¥–ª—è –≤—Å–µ–≥–æ –¥–∞—Ç–∞—Å–µ—Ç–∞

        Returns:
            Self –¥–ª—è method chaining

        Example:
            >>> result = (
            ...     analyze_zones(data)
            ...     .with_strategies(swing='zigzag')
            ...     .with_swing_scope('global')  # –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è 70-90% coverage
            ...     .build()
            ... )
        """
        ...

class ZoneAnalysisPipeline:
    """–ü–∞–π–ø–ª–∞–π–Ω –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ MACD –∑–æ–Ω."""

    def _calculate_global_swings(self, data: pd.DataFrame) -> SwingContext:
        """–†–∞—Å—Å—á–∏—Ç–∞—Ç—å swing —Ç–æ—á–∫–∏ –¥–ª—è –≤—Å–µ–≥–æ –¥–∞—Ç–∞—Å–µ—Ç–∞ –æ–¥–∏–Ω —Ä–∞–∑.

        –í—ã–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ global —Ä–µ–∂–∏–º–µ. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç strategy.calculate_global().

        Args:
            data: –ü–æ–ª–Ω—ã–π –¥–∞—Ç–∞—Å–µ—Ç —Å OHLCV –∫–æ–ª–æ–Ω–∫–∞–º–∏

        Returns:
            SwingContext —Å–æ –≤—Å–µ–º–∏ swing —Ç–æ—á–∫–∞–º–∏ –¥–ª—è –¥–∞—Ç–∞—Å–µ—Ç–∞

        Raises:
            ValueError: –ï—Å–ª–∏ swing_strategy –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞
        """
        ...
```

```python
# bquant/analysis/zones/strategies/base.py
class SwingCalculationStrategy(Protocol):
    """–ü—Ä–æ—Ç–æ–∫–æ–ª –¥–ª—è —Å—Ç—Ä–∞—Ç–µ–≥–∏–π —Ä–∞—Å—á—ë—Ç–∞ swing —Ç–æ—á–µ–∫.

    Methods:
        calculate(data): Legacy –º–µ—Ç–æ–¥ –¥–ª—è per_zone —Ä–µ–∂–∏–º–∞
        calculate_global(data): –ù–æ–≤—ã–π –º–µ—Ç–æ–¥ –¥–ª—è global —Ä–µ–∂–∏–º–∞ (v0.X.Y)
        aggregate_for_zone(context, start_idx, end_idx): –ê–≥—Ä–µ–≥–∞—Ü–∏—è –º–µ—Ç—Ä–∏–∫
    """

    def calculate_global(self, data: pd.DataFrame) -> SwingContext:
        """–†–∞—Å—Å—á–∏—Ç–∞—Ç—å swing —Ç–æ—á–∫–∏ –¥–ª—è –≤—Å–µ–≥–æ –¥–∞—Ç–∞—Å–µ—Ç–∞.

        Args:
            data: DataFrame —Å –∫–æ–ª–æ–Ω–∫–∞–º–∏ ['time', 'open', 'high', 'low', 'close']

        Returns:
            SwingContext —Å–æ –≤—Å–µ–º–∏ swing —Ç–æ—á–∫–∞–º–∏

        Example:
            >>> strategy = ZigZagSwingStrategy(threshold=0.02)
            >>> context = strategy.calculate_global(data)
            >>> len(context.swing_points)
            127  # –ó–∞–≤–∏—Å–∏—Ç –æ—Ç –¥–∞–Ω–Ω—ã—Ö –∏ threshold
        """
        ...
```

**6.1.2. CHANGELOG.md** (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û):

‚úÖ **`CHANGELOG.md`** (–û–ë–ù–û–í–ò–¢–¨)
```markdown
## [X.Y.Z] - YYYY-MM-DD

### Added
- Global swing calculation mode for zone analysis (`with_swing_scope('global')`)
- `SwingPoint` and `SwingContext` data models for efficient swing storage
- `ZoneInfo.swing_context` field for accessing global swing context
- `ZoneInfo.get_zone_swings()` helper method
- Cache versioning system (CACHE_VERSION = 2) for schema upgrades

### Changed
- `SwingCalculationStrategy` protocol extended with `calculate_global()` and `aggregate_for_zone()`
- Zone coverage with swing metrics improved: 70-90% (global mode) vs 18-62% (per_zone mode)

### Fixed
- Boundary artifacts in per_zone swing calculation causing low zone coverage
- Cache collisions between different strategy parameters

### Migration
See `docs/migration/global_swings_migration.md` for upgrade instructions.
```

**6.1.3. Short Migration Guide** (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û):

‚úÖ **`docs/migration/global_swings_migration.md`** (–°–û–ó–î–ê–¢–¨ –ù–û–í–´–ô) - –ö–†–ê–¢–ö–ê–Ø –í–ï–†–°–ò–Ø

```markdown
# Migration to Global Swing Calculation

## Why Migrate?

**Problem**: Per-zone swing calculation suffers from boundary artifacts, leading to low zone coverage:
- find_peaks: 18.9% zones have swing metrics
- pivot_points: 8.1% zones have swing metrics
- zigzag: 62.2% zones have swing metrics

**Solution**: Global mode calculates swings once for entire dataset, then slices for each zone:
- **70-90% zone coverage** (improvement: +20-50 percentage points)
- **Faster**: 1 calculation instead of N
- **Consistent**: No boundary artifacts

## Migration Steps

### Step 1: Update pipeline configuration

```python
# BEFORE (per_zone mode - implicit default)
result = (
    analyze_zones(data)
    .with_strategies(swing='zigzag')
    .build()
)

# AFTER (global mode - add one line)
result = (
    analyze_zones(data)
    .with_strategies(swing='zigzag')
    .with_swing_scope('global')  # ‚Üê ADD THIS
    .build()
)
```

### Step 2: Access swing points (if needed)

```python
# Recommended API
for zone in result.zones:
    swings = zone.get_zone_swings()  # Returns List[SwingPoint]
    print(f"Zone {zone.id}: {len(swings)} swing points")
```

### Step 3: Clear cache (one-time)

Old cached results are automatically invalidated. If you see "Cache invalidated due to schema upgrade" in logs - this is expected.

## Breaking Changes

**None** - per_zone mode remains the default. Global mode is opt-in via `with_swing_scope('global')`.

## Troubleshooting

**Q**: "I'm getting warnings about cache invalidation"
**A**: Normal - cache version changed from 1 to 2. Old caches are automatically invalidated.

**Q**: "Global mode is slower than per_zone"
**A**: Global mode is faster when you have many zones. For <10 zones, per_zone may be faster.

**Q**: "Some zones still have no swings"
**A**: Even in global mode, zones can have no internal swings (e.g., single-bar zones). This is expected.

## Performance

- **Recommended**: Datasets <1M bars
- **Benchmark**: Global mode ‚â§1.5√ó per_zone time for 100k bars, 100 zones
- **Memory**: ~264 bytes per swing point

## Next Steps

For detailed examples and API reference, see:
- User Guide: `docs/user_guide/zone_analysis.md` (Section "Global vs Per-Zone Swing Calculation")
- API Reference: `docs/api/analysis/zones/models.md` (SwingPoint, SwingContext)
```

---

### –§–∞–∑–∞ 6.2: Comprehensive Documentation (Post-MVP, optional) - –ù–ï –ë–õ–û–ö–ò–†–£–ï–¢ –†–ï–õ–ò–ó

**–í–ê–ñ–ù–û**: –≠—Ç–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è **–ø–æ–≤—ã—à–∞–µ—Ç usability** –∏ –ø–æ–º–æ–≥–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º, –Ω–æ **–ù–ï –±–ª–æ–∫–∏—Ä—É–µ—Ç —Ä–µ–ª–∏–∑**. –ú–æ–∂–µ—Ç –±—ã—Ç—å —Å–æ–∑–¥–∞–Ω–∞ –ø–æ—Å–ª–µ –≤—ã–∫–∞—Ç–∫–∏ MVP.

**6.2.1. User Guide - –û–±–Ω–æ–≤–ª–µ–Ω–∏—è**:

1. ‚úÖ **`docs/user_guide/zone_analysis.md`** (–û–ë–ù–û–í–ò–¢–¨)
   - –î–æ–±–∞–≤–∏—Ç—å —Ä–∞–∑–¥–µ–ª "Global vs Per-Zone Swing Calculation"
   - –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `.with_swing_scope('global')`
   - –°—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ —Ä–µ–∂–∏–º–æ–≤ (–ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ)
   - –ö–æ–¥ –ø—Ä–∏–º–µ—Ä—ã —Å –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–µ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

2. ‚úÖ **`docs/user_guide/swing_strategies.md`** (–°–û–ó–î–ê–¢–¨ –ù–û–í–´–ô)
   - –û–±–∑–æ—Ä –≤—Å–µ—Ö –¥–æ—Å—Ç—É–ø–Ω—ã—Ö swing —Å—Ç—Ä–∞—Ç–µ–≥–∏–π
   - –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–∞–∂–¥–æ–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ (ZigZag, FindPeaks, PivotPoints)
   - –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –≤—ã–±–æ—Ä—É —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤
   - –ü—Ä–∏–º–µ—Ä—ã –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–¥–∞–ø—Ç–∏–≤–Ω—ã—Ö –ø–æ—Ä–æ–≥–æ–≤

**6.2.2. API Reference - –û–±–Ω–æ–≤–ª–µ–Ω–∏—è**:

3. ‚úÖ **`docs/api/analysis/zones/models.md`** (–û–ë–ù–û–í–ò–¢–¨)
   - `SwingPoint` dataclass - –ø–æ–ª–Ω–∞—è —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ–ª–µ–π
   - `SwingContext` dataclass - –º–µ—Ç–æ–¥—ã –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
   - `ZoneInfo.swing_context` - –Ω–æ–≤–æ–µ –ø–æ–ª–µ
   - `ZoneInfo.get_zone_swings()` - API –º–µ—Ç–æ–¥

4. ‚úÖ **`docs/api/analysis/zones/pipeline.md`** (–û–ë–ù–û–í–ò–¢–¨)
   - `ZoneAnalysisPipeline._calculate_global_swings()` - –Ω–æ–≤—ã–π –º–µ—Ç–æ–¥
   - `ZoneAnalysisPipeline._inject_swing_context()` - –Ω–æ–≤—ã–π –º–µ—Ç–æ–¥
   - `ZoneAnalysisBuilder.with_swing_scope()` - –Ω–æ–≤—ã–π –º–µ—Ç–æ–¥
   - –û–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π workflow diagram

5. ‚úÖ **`docs/api/analysis/zones/strategies.md`** (–û–ë–ù–û–í–ò–¢–¨)
   - `SwingCalculationStrategy` protocol - –Ω–æ–≤—ã–µ –º–µ—Ç–æ–¥—ã
   - `calculate_global()` - —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è
   - `aggregate_for_zone()` - —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è
   - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–ª—è ZigZagSwingStrategy, FindPeaksSwingStrategy

**6.2.3. Research Notebooks - –û–±–Ω–æ–≤–ª–µ–Ω–∏—è**:

6. ‚úÖ **`research/notebooks/05_case_study_zone_consistency.py`** (–û–ë–ù–û–í–ò–¢–¨)
   - –î–æ–±–∞–≤–∏—Ç—å —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ per_zone vs global —Ä–µ–∂–∏–º–æ–≤
   - –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Ä–∞–∑–ª–∏—á–∏–π –≤ –ø–æ–∫—Ä—ã—Ç–∏–∏ –∑–æ–Ω
   - –°—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ —É–ª—É—á—à–µ–Ω–∏–π
   - –û–±–Ω–æ–≤–∏—Ç—å –≤—ã–≤–æ–¥—ã —Å –Ω–æ–≤—ã–º–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏

7. ‚úÖ **`research/notebooks/06_swing_strategy_comparison.py`** (–°–û–ó–î–ê–¢–¨ –ù–û–í–´–ô)
   - –°—Ä–∞–≤–Ω–µ–Ω–∏–µ ZigZag, FindPeaks, PivotPoints –Ω–∞ –æ–¥–Ω–∏—Ö –¥–∞–Ω–Ω—ã—Ö
   - –ó–∞–ø—É—Å–∫ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –ø–∞–π–ø–ª–∞–π–Ω–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
   - Performance benchmarks –¥–ª—è –∫–∞–∂–¥–æ–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
   - –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –≤—ã–±–æ—Ä—É —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏

**6.2.4. Examples - –û–±–Ω–æ–≤–ª–µ–Ω–∏—è**:

8. ‚úÖ **`examples/zone_analysis_global_swings.py`** (–°–û–ó–î–ê–¢–¨ –ù–û–í–´–ô)
    - –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –ø—Ä–∏–º–µ—Ä global —Ä–µ–∂–∏–º–∞
    - –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
    - –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å per_zone —Ä–µ–∂–∏–º–æ–º

---

**‚úÖ Post-completion checklist –§–∞–∑—ã 6**:

### üö® –§–ê–ó–ê 6.1: MVP DOCUMENTATION (–ë–õ–û–ö–ò–†–£–ï–¢ –†–ï–õ–ò–ó)

**A. Docstrings –≤ –∫–æ–¥–µ** (–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û):
- [ ] **–û–ë–ù–û–í–õ–ï–ù–´**: bquant/analysis/zones/models.py - SwingPoint, SwingContext, ZoneInfo (Google Style)
- [ ] **–û–ë–ù–û–í–õ–ï–ù–´**: bquant/analysis/zones/pipeline.py - ZoneAnalysisBuilder.with_swing_scope(), _calculate_global_swings()
- [ ] **–û–ë–ù–û–í–õ–ï–ù–´**: bquant/analysis/zones/strategies/base.py - SwingCalculationStrategy.calculate_global()
- [ ] **–¢–ï–°–¢**: –ó–∞–ø—É—Å—Ç–∏—Ç—å `python -m pydoc bquant.analysis.zones.models` - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥

**B. CHANGELOG.md** (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û):
- [ ] **CHANGELOG.md –û–ë–ù–û–í–õ–Å–ù**: –î–æ–±–∞–≤–ª–µ–Ω —Ä–∞–∑–¥–µ–ª [X.Y.Z] —Å –¥–∞—Ç–æ–π —Ä–µ–ª–∏–∑–∞
- [ ] –°–µ–∫—Ü–∏—è "Added": SwingPoint, SwingContext, with_swing_scope('global'), cache versioning
- [ ] –°–µ–∫—Ü–∏—è "Changed": SwingCalculationStrategy protocol extended, 70-90% coverage
- [ ] –°–µ–∫—Ü–∏—è "Fixed": Boundary artifacts, low zone coverage (18-62% ‚Üí 70-90%)
- [ ] –°–µ–∫—Ü–∏—è "Migration": –°—Å—ã–ª–∫–∞ –Ω–∞ docs/migration/global_swings_migration.md
- [ ] **REVIEW**: Changelog –ø—Ä–æ—à—ë–ª code review

**C. Short Migration Guide** (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û):
- [ ] **–î–û–ö–£–ú–ï–ù–¢ –°–û–ó–î–ê–ù**: docs/migration/global_swings_migration.md
- [ ] –°–µ–∫—Ü–∏—è "Why Migrate?" —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏: 18-62% ‚Üí 70-90% coverage
- [ ] –°–µ–∫—Ü–∏—è "Migration Steps" —Å before/after code examples
- [ ] –°–µ–∫—Ü–∏—è "Troubleshooting" —Å FAQ (cache invalidation, performance, empty swings)
- [ ] **–¢–ï–°–¢**: –í—ã–ø–æ–ª–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –ø–æ guide –Ω–∞ sample data, —É–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞ MVP Documentation (–ë–õ–û–ö–ò–†–£–ï–¢ –†–ï–õ–ò–ó)**:
- [ ] ‚úÖ **–í—Å–µ docstrings –≤ –Ω–æ–≤—ã—Ö –∫–ª–∞—Å—Å–∞—Ö –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç** –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø–∞—Ä—Å—è—Ç—Å—è
- [ ] ‚úÖ **CHANGELOG.md —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è** (Added/Changed/Fixed/Migration)
- [ ] ‚úÖ **Migration guide –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω** –Ω–∞ sample data –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç

**‚ùå –ï—Å–ª–∏ —Ö–æ—Ç—å –æ–¥–∏–Ω MVP –¥–æ–∫—É–º–µ–Ω—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç ‚Üí –†–ï–õ–ò–ó –ë–õ–û–ö–ò–†–û–í–ê–ù**

---

### ‚≠ê –§–ê–ó–ê 6.2: COMPREHENSIVE DOCUMENTATION (–ù–ï –ë–õ–û–ö–ò–†–£–ï–¢ –†–ï–õ–ò–ó)

**D. User Guides** (–∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ):
- [ ] **–î–û–ö–£–ú–ï–ù–¢ –û–ë–ù–û–í–õ–Å–ù**: docs/user_guide/zone_analysis.md - —Ä–∞–∑–¥–µ–ª "Global vs Per-Zone Swing Calculation"
- [ ] **–î–û–ö–£–ú–ï–ù–¢ –°–û–ó–î–ê–ù**: docs/user_guide/swing_strategies.md - –æ–±–∑–æ—Ä ZigZag/FindPeaks/PivotPoints
- [ ] **–¢–ï–°–¢**: –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ –ø—Ä–∏–º–µ—Ä—ã –∫–æ–¥–∞ –∏–∑ user guides

**E. API Reference** (–∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ):
- [ ] **–î–û–ö–£–ú–ï–ù–¢ –û–ë–ù–û–í–õ–Å–ù**: docs/api/analysis/zones/models.md - –ø–æ–ª–Ω–∞—è —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è SwingPoint, SwingContext
- [ ] **–î–û–ö–£–ú–ï–ù–¢ –û–ë–ù–û–í–õ–Å–ù**: docs/api/analysis/zones/pipeline.md - workflow diagram —Å global mode
- [ ] **–î–û–ö–£–ú–ï–ù–¢ –û–ë–ù–û–í–õ–Å–ù**: docs/api/analysis/zones/strategies.md - –ø—Ä–æ—Ç–æ–∫–æ–ª —Å 3 –º–µ—Ç–æ–¥–∞–º–∏
- [ ] **–¢–ï–°–¢**: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ code snippets —Å–æ–≤–ø–∞–¥–∞—é—Ç —Å —Ä–µ–∞–ª—å–Ω—ã–º –∫–æ–¥–æ–º

**F. Research Notebooks** (–∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ):
- [ ] **–°–ö–†–ò–ü–¢ –û–ë–ù–û–í–õ–Å–ù**: research/notebooks/05_case_study_zone_consistency.py - —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ per_zone vs global
- [ ] **–°–ö–†–ò–ü–¢ –°–û–ó–î–ê–ù**: research/notebooks/06_swing_strategy_comparison.py - —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–π
- [ ] **–¢–ï–°–¢**: –ó–∞–ø—É—Å—Ç–∏—Ç—å –æ–±–∞ —Å–∫—Ä–∏–ø—Ç–∞, –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏

**G. Examples** (–∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ):
- [ ] **–ü–†–ò–ú–ï–† –°–û–ó–î–ê–ù**: examples/zone_analysis_global_swings.py - –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π working example
- [ ] **–¢–ï–°–¢**: –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–º–µ—Ä, –ø—Ä–æ–≤–µ—Ä–∏—Ç—å output

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞ Comprehensive Documentation (–ü–û–í–´–®–ê–ï–¢ USABILITY, –Ω–æ –ù–ï –±–ª–æ–∫–∏—Ä—É–µ—Ç —Ä–µ–ª–∏–∑)**:
- [ ] ‚≠ê –í—Å–µ 2 user guides –æ–±–Ω–æ–≤–ª–µ–Ω—ã/—Å–æ–∑–¥–∞–Ω—ã
- [ ] ‚≠ê –í—Å–µ 3 API reference docs –æ–±–Ω–æ–≤–ª–µ–Ω—ã
- [ ] ‚≠ê –û–±–∞ research notebooks —Ä–∞–±–æ—Ç–∞—é—Ç
- [ ] ‚≠ê Example –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–∞–∑–Ω–∏—Ü—É —Ä–µ–∂–∏–º–æ–≤

**‚úÖ –ï—Å–ª–∏ Comprehensive –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ù–ï –≥–æ—Ç–æ–≤–∞ ‚Üí –º–æ–∂–Ω–æ –≤—ã–ø—É—Å—Ç–∏—Ç—å —Ä–µ–ª–∏–∑ —Å –ø–æ–º–µ—Ç–∫–æ–π "documentation in progress"**

---

**Future validation (—Ñ–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞)**:
- [ ] üéØ **MVP –ì–û–¢–û–í**: –§–∞–∑—ã 1-6.1 –∑–∞–≤–µ—Ä—à–µ–Ω—ã, –≤—Å–µ MVP —Ç–µ—Å—Ç—ã –∑–µ–ª—ë–Ω—ã–µ, MVP –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –≥–æ—Ç–æ–≤–∞
- [ ] üéØ **READY FOR RELEASE**: Code review –ø—Ä–æ–π–¥–µ–Ω, changelog —É—Ç–≤–µ—Ä–∂–¥—ë–Ω, –º–æ–∂–Ω–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å release tag
- [ ] üìö **POST-RELEASE**: –§–∞–∑—ã 5.2 –∏ 6.2 (Comprehensive) –º–æ–∂–Ω–æ –∑–∞–≤–µ—Ä—à–∏—Ç—å –ø–æ—Å–ª–µ —Ä–µ–ª–∏–∑–∞

---

## 9. –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å, –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ fallback

### 9.1. –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å
- ‚úÖ **Default = "per_zone"**: –°—Ç–∞—Ä–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
- ‚úÖ **Legacy –º–µ—Ç–æ–¥ `calculate()`**: –ü—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –¥–ª—è old code
- ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π fallback**: –ï—Å–ª–∏ –≥–ª–æ–±–∞–ª—å–Ω—ã–π —Ä–∞—Å—á—ë—Ç –Ω–µ —É–¥–∞–ª—Å—è ‚Üí –æ—Ç–∫–∞—Ç –Ω–∞ per_zone

### 9.2. –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å —É—á—ë—Ç–æ–º swing —Å—Ç—Ä–∞—Ç–µ–≥–∏–π
```python
# –í bquant/analysis/zones/cache.py

class ZoneAnalysisCache:
    """
    –ö—ç—à —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∞–Ω–∞–ª–∏–∑–∞ –∑–æ–Ω.

    UPDATED: –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –∫—ç—à–∞ –ø–æ swing_scope –ò –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º —Å—Ç—Ä–∞—Ç–µ–≥–∏–π
    """

    def _generate_cache_key(self, config: ZoneAnalysisConfig, data_hash: str) -> str:
        """
        –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–∞ –∫—ç—à–∞.

        CRITICAL UPDATE: –í–∫–ª—é—á–∞–µ—Ç –∏–º–µ–Ω–∞ –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã swing —Å—Ç—Ä–∞—Ç–µ–≥–∏–π –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –∫–æ–ª–ª–∏–∑–∏–π

        –ü—Ä–æ–±–ª–µ–º–∞ –±–µ–∑ —ç—Ç–æ–≥–æ:
            - ZigZag(legs=10, deviation=0.05) –∏ ZigZag(legs=20, deviation=0.10)
              –ø–æ–ª—É—á–∏–ª–∏ –±—ã –æ–¥–∏–Ω –∫—ç—à-–∫–ª—é—á ‚Üí –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã!
            - –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É —Å—Ç—Ä–∞—Ç–µ–≥–∏—è–º–∏ ('zigzag' ‚Üí 'find_peaks')
              –≤–æ–∑–≤—Ä–∞—â–∞–ª–æ –±—ã —Å—Ç–∞—Ä—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

        –†–µ—à–µ–Ω–∏–µ:
            - –•—ç—à–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–∞–∂–¥–æ–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
            - –í–∫–ª—é—á–∏—Ç—å –∏–º–µ–Ω–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏–π –≤ –∫–ª—é—á
        """
        key_parts = [
            f"data={data_hash}",
            f"indicator={config.indicator_config.to_hash()}",
            f"detection={config.detection_config.to_hash()}",
            f"swing_scope={config.swing_scope}",  # –†–µ–∂–∏–º —Ä–∞—Å—á—ë—Ç–∞
            # ... other parts ...
        ]

        # –ù–û–í–û–ï: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ swing —Å—Ç—Ä–∞—Ç–µ–≥–∏–π —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
        swing_strategies_hash = self._hash_swing_strategies(config)
        if swing_strategies_hash:
            key_parts.append(f"swing={swing_strategies_hash}")

        return hashlib.sha256('|'.join(key_parts).encode()).hexdigest()

    def _hash_swing_strategies(self, config: ZoneAnalysisConfig) -> str:
        """
        –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ö—ç—à–∞ –¥–ª—è swing —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏.

        NEW METHOD

        Args:
            config: –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∞–Ω–∞–ª–∏–∑–∞ –∑–æ–Ω

        Returns:
            –•—ç—à —Å—Ç—Ä–æ–∫–∞ –≤–∏–¥–∞ "zigzag_legs10_dev0.05"

        Example:
            config._swing_strategy = ZigZagSwingStrategy(legs=10, deviation=0.05)
            hash = _hash_swing_strategies(config)
            # ‚Üí "zigzag_dev005_legs10"
        """
        if not hasattr(config, '_swing_strategy') or config._swing_strategy is None:
            return ""

        strategy = config._swing_strategy
        strategy_name = strategy.get_metadata()['name'].lower()
        params_hash = self._hash_strategy_params(strategy.config_hash())

        return f"{strategy_name}_{params_hash}"

    def _hash_strategy_params(self, params: Dict[str, Any]) -> str:
        """
        –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ—Ä–æ—Ç–∫–æ–≥–æ —Ö—ç—à–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏.

        NEW METHOD

        Args:
            params: Dict —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –∏–∑ config_hash()

        Returns:
            –ö–æ—Ä–æ—Ç–∫–∞—è —Å—Ç—Ä–æ–∫–∞ –≤–∏–¥–∞ "legs10_dev0.05"

        Example:
            params = {'legs': 10, 'deviation': 0.05}
            hash = _hash_strategy_params(params)
            # ‚Üí "dev0.05_legs10" (alphabetically sorted keys)
        """
        if not params:
            return "default"

        # –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –∫–ª—é—á–µ–π –¥–ª—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏
        sorted_params = sorted(params.items())

        # –ö–æ—Ä–æ—Ç–∫–∏–µ –∏–º–µ–Ω–∞ –¥–ª—è —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—ë–Ω–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
        short_names = {
            'legs': 'legs',
            'deviation': 'dev',
            'distance': 'dist',
            'prominence': 'prom',
            'window': 'win',
            'min_amplitude_pct': 'amp'
        }

        parts = []
        for key, value in sorted_params:
            short_key = short_names.get(key, key[:4])  # –ü–µ—Ä–≤—ã–µ 4 —Å–∏–º–≤–æ–ª–∞ –µ—Å–ª–∏ –Ω–µ—Ç mapping
            # –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è
            if isinstance(value, float):
                formatted_value = f"{value:.2f}".replace('.', '')
            else:
                formatted_value = str(value)
            parts.append(f"{short_key}{formatted_value}")

        return '_'.join(parts)


# –ü–û–õ–ù–´–ô –ü–†–ò–ú–ï–† –ö–≠–®-–ö–õ–Æ–ß–ê:

# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:
# - Data: XAUUSD 1H, 10000 bars
# - MACD: fast=12, slow=26, signal=9
# - Detection: zero_crossing
# - Swing: ZigZag(legs=10, deviation=0.05)
# - Scope: global

# –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–ª—é—á:
# "data=a3f2b8c1...
#  indicator=macd_fast12_slow26_sig9...
#  detection=zero_crossing...
#  swing_scope=global...
#  swing=zigzag_dev005_legs10"
# ‚Üí SHA256 ‚Üí "e7a9c4f2d8b3..."

# –ï—Å–ª–∏ –∏–∑–º–µ–Ω–∏—Ç—å deviation –Ω–∞ 0.10:
# swing=zigzag_dev010_legs10
# ‚Üí SHA256 ‚Üí "f1b8d5c3a2e7..." ‚Üê –î–†–£–ì–û–ô –∫–ª—é—á! ‚úÖ
```

### 9.3. Graceful Degradation
```python
# Fallback logic –≤ Pipeline

try:
    global_swing_context = self._calculate_global_swings(df_prepared)
except Exception as e:
    self.logger.warning(
        f"Global swing calculation failed: {e}. "
        f"Falling back to per_zone mode for this analysis."
    )
    global_swing_context = None
    # –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Å per_zone –ª–æ–≥–∏–∫–æ–π
```

### 9.4. –ú–∏–≥—Ä–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∫—ç—à–µ–π

**–ü—Ä–æ–±–ª–µ–º–∞**: –†–µ–∑—É–ª—å—Ç–∞—Ç—ã, –∑–∞–∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–æ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è global mode, –Ω–µ —Å–æ–¥–µ—Ä–∂–∞—Ç –ø–æ–ª–µ `swing_context` –≤ ZoneInfo.

**–°—Ü–µ–Ω–∞—Ä–∏–π**:
```python
# –î–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–ø—É—Å—Ç–∏–ª –∞–Ω–∞–ª–∏–∑ —Å per_zone (implicit default)
result_old = analyze_zones(data).build()
# ‚Üí –†–µ–∑—É–ª—å—Ç–∞—Ç –∑–∞–∫—ç—à–∏—Ä–æ–≤–∞–Ω –ë–ï–ó –ø–æ–ª—è swing_context

# –ü–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–ø—É—Å–∫–∞–µ—Ç —Ç–æ—Ç –∂–µ –∞–Ω–∞–ª–∏–∑
result_new = analyze_zones(data).with_swing_scope('global').build()
# ‚Üí –ß—Ç–æ –ø—Ä–æ–∏–∑–æ–π–¥—ë—Ç —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –∫—ç—à–µ–º?
```

**–†–∏—Å–∫–∏ –±–µ–∑ –º–∏–≥—Ä–∞—Ü–∏–∏**:
1. –î–µ—Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç–∞—Ä–æ–≥–æ –∫—ç—à–∞ —É–ø–∞–¥—ë—Ç, –µ—Å–ª–∏ SwingContext —Å—Ç–∞–ª –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º –ø–æ–ª–µ–º
2. –ö–æ–ª–ª–∏–∑–∏–∏ –∫—ç—à-–∫–ª—é—á–µ–π, –µ—Å–ª–∏ `swing_scope` –Ω–µ —É—á–∞—Å—Ç–≤—É–µ—Ç –≤ —Ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–∏
3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤ –Ω–æ–≤–æ–º –∫–æ–¥–µ –ø—Ä–∏–≤–µ–¥—ë—Ç –∫ AttributeError

---

**–°—Ç—Ä–∞—Ç–µ–≥–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏** (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è Phase 1):

**Option A: Cache Invalidation** ‚úÖ –†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –≤—Å–µ—Ö —Å—Ç–∞—Ä—ã—Ö –∫—ç—à–µ–π –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏.

**–î–≤—É—Å—Ç–æ—Ä–æ–Ω–Ω—è—è —Å—Ö–µ–º–∞ (bidirectional flow)**:
1. **WRITE**: `save()` –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç `cache_version: 2` –≤ payload –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏
2. **READ**: `load()` —á–∏—Ç–∞–µ—Ç `cache_version` –∏–∑ payload –∏ —Å—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç —Å `CACHE_VERSION`
3. **KEY**: `_generate_cache_key()` –≤–∫–ª—é—á–∞–µ—Ç –≤–µ—Ä—Å–∏—é –≤ –∫–ª—é—á (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –¥–ª—è namespace isolation)

```python
# –í bquant/analysis/zones/cache.py

class ZoneAnalysisCache:
    CACHE_VERSION = 2  # –ù–û–í–û–ï: –£–≤–µ–ª–∏—á–µ–Ω–æ —Å 1 –¥–æ 2

    def _generate_cache_key(self, config: ZoneAnalysisConfig, data_hash: str) -> str:
        """
        UPDATED: –í–∫–ª—é—á–∞–µ—Ç –≤–µ—Ä—Å–∏—é –∫—ç—à–∞ –≤ –∫–ª—é—á
        """
        key_parts = [
            f"version={self.CACHE_VERSION}",  # ‚Üê –ù–û–í–û–ï
            f"data={data_hash}",
            # ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ —á–∞—Å—Ç–∏
        ]
        return hashlib.sha256('|'.join(key_parts).encode()).hexdigest()

    def save(self, cache_key: str, result: ZoneAnalysisResult) -> None:
        """
        UPDATED: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ —Å –≤–µ—Ä—Å–∏–µ–π —Å—Ö–µ–º—ã (WRITE path)
        """
        serialized_data = {
            'cache_version': self.CACHE_VERSION,  # ‚Üê –ù–û–í–û–ï: –Ø–≤–Ω–æ –∑–∞–ø–∏—Å—ã–≤–∞–µ–º –≤–µ—Ä—Å–∏—é –≤ payload
            'result': self._serialize(result),
            'metadata': {
                'created_at': datetime.now().isoformat(),
                'schema': 'ZoneAnalysisResult_v2',  # –î–ª—è debugging
                'bquant_version': __version__
            }
        }

        self._write_to_disk(cache_key, serialized_data)
        self.logger.debug(
            f"Saved cache with version {self.CACHE_VERSION}: {cache_key[:12]}..."
        )

    def load(self, cache_key: str) -> Optional[ZoneAnalysisResult]:
        """
        UPDATED: –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Å–∏–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ (READ path)
        """
        cached_data = self._read_from_disk(cache_key)

        if cached_data is None:
            return None

        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Å–∏–∏
        cached_version = cached_data.get('cache_version', 1)  # Default 1 –¥–ª—è —Å—Ç–∞—Ä—ã—Ö –∫—ç—à–µ–π

        if cached_version < self.CACHE_VERSION:
            self.logger.info(
                f"Cache invalidated due to schema upgrade "
                f"(v{cached_version} ‚Üí v{self.CACHE_VERSION}). "
                f"Recalculating analysis..."
            )
            return None  # –ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è —Å—Ç–∞—Ä–æ–≥–æ –∫—ç—à–∞

        return self._deserialize(cached_data['result'])
```

**–ü—Ä–∏–º–µ—Ä —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–æ–≥–æ payload** (–¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è —Ñ–æ—Ä–º–∞—Ç–∞):

```json
{
  "cache_version": 2,
  "result": {
    "zones": [...],
    "swing_context": {...},
    ...
  },
  "metadata": {
    "created_at": "2025-11-10T14:32:15.123456",
    "schema": "ZoneAnalysisResult_v2",
    "bquant_version": "0.3.0"
  }
}
```

–°—Ç–∞—Ä—ã–µ –∫—ç—à–∏ (v1) –Ω–µ –∏–º–µ—é—Ç –ø–æ–ª—è `cache_version`, –ø–æ—ç—Ç–æ–º—É `cached_data.get('cache_version', 1)` –≤–µ—Ä–Ω—ë—Ç `1`, —á—Ç–æ –º–µ–Ω—å—à–µ `CACHE_VERSION = 2`, –∏ –∫—ç—à –±—É–¥–µ—Ç –∏–Ω–≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞–Ω.

---

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**:
- ‚úÖ –ü—Ä–æ—Å—Ç–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è (–æ–¥–Ω–æ —á–∏—Å–ª–æ –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å)
- ‚úÖ –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å (–Ω–µ—Ç —Å–º–µ—à–∏–≤–∞–Ω–∏—è old/new —Ñ–æ—Ä–º–∞—Ç–æ–≤)
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ—Ç)
- ‚úÖ –î–ª—è production –∫—ç—à–∏ –æ–±—ã—á–Ω–æ ephemeral (–º–æ–∂–Ω–æ –ø–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å)

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏**:
- ‚ö†Ô∏è –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫ –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±—É–¥–µ—Ç –º–µ–¥–ª–µ–Ω–Ω–µ–µ (–ø–µ—Ä–µ—Å—á—ë—Ç)
- ‚ö†Ô∏è –ü–æ—Ç–µ—Ä—è –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω—ã—Ö –∫—ç—à–µ–π (–¥–ª—è –±–æ–ª—å—à–∏—Ö –¥–∞—Ç–∞—Å–µ—Ç–æ–≤ —ç—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –¥–æ—Ä–æ–≥–æ)

---

**Option B: Backward Compatible Deserialization** (–¥–ª—è –±—É–¥—É—â–∏—Ö –≤–µ—Ä—Å–∏–π)

–ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Å—Ç–∞—Ä–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞ –ø—Ä–∏ –¥–µ—Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏.

```python
def _deserialize(self, cached_data: Dict) -> ZoneAnalysisResult:
    """
    FUTURE: –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –≤–µ—Ä—Å–∏–π —Ñ–æ—Ä–º–∞—Ç–∞
    """
    version = cached_data.get('cache_version', 1)

    if version == 1:
        # Legacy —Ñ–æ—Ä–º–∞—Ç: –¥–æ–±–∞–≤–ª—è–µ–º swing_context = None –∫–æ –≤—Å–µ–º –∑–æ–Ω–∞–º
        for zone_data in cached_data['zones']:
            if 'swing_context' not in zone_data:
                zone_data['swing_context'] = None

    # –î–∞–ª–µ–µ –æ–±—ã—á–Ω–∞—è –¥–µ—Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è
    return ZoneAnalysisResult.from_dict(cached_data)
```

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å**:
- –ö—ç—à–∏ –¥–æ—Ä–æ–≥–∏–µ (cloud storage, –±–æ–ª—å—à–∏–µ –¥–∞—Ç–∞—Å–µ—Ç—ã)
- –ù—É–∂–Ω–∞ –ø–ª–∞–≤–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è –±–µ–∑ –ø–µ—Ä–µ—Å—á—ë—Ç–æ–≤

**–î–ª—è —Ç–µ–∫—É—â–µ–π –≤–µ—Ä—Å–∏–∏**: –ù–ï —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è (—É—Å–ª–æ–∂–Ω—è–µ—Ç –∫–æ–¥ –±–µ–∑ —è–≤–Ω–æ–π –≤—ã–≥–æ–¥—ã)

---

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è Phase 1**:

**–§–∞–∑–∞ 1, –∑–∞–¥–∞—á–∞ 1.5** (–ù–û–í–ê–Ø):
- [ ] –î–æ–±–∞–≤–∏—Ç—å `CACHE_VERSION = 2` –≤ ZoneAnalysisCache
- [ ] –û–±–Ω–æ–≤–∏—Ç—å `_generate_cache_key()` - –≤–∫–ª—é—á–∏—Ç—å version –≤ –∫–ª—é—á
- [ ] –û–±–Ω–æ–≤–∏—Ç—å `load()` - –ø—Ä–æ–≤–µ—Ä—è—Ç—å –≤–µ—Ä—Å–∏—é –∏ –∏–Ω–≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–∞—Ä—ã–µ –∫—ç—à–∏
- [ ] –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å INFO –ø—Ä–∏ –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–∏

**–§–∞–∑–∞ 5, —Ç–µ—Å—Ç** (–ù–û–í–´–ô):
- [ ] **–¢–ï–°–¢ –°–û–ó–î–ê–ù**: test_cache_invalidation_on_version_upgrade() - —Å–æ–∑–¥–∞—Ç—å –∫—ç—à v1, –ø–æ–ø—ã—Ç–∞—Ç—å—Å—è –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å CACHE_VERSION=2, –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –≤–µ—Ä–Ω—É–ª—Å—è None –∏ –∑–∞–ª–æ–≥–∏—Ä–æ–≤–∞–Ω INFO

---

## 10. –†–∏—Å–∫–∏ –∏ –º–µ—Ä—ã

### –†–∏—Å–∫ 1: –ì—Ä–∞–Ω–∏—Ü—ã –ø–∏–≤–æ—Ç–æ–≤
**–ü—Ä–æ–±–ª–µ–º–∞**: –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –Ω–∞—Ä–µ–∑–∫–∞ –º–æ–∂–µ—Ç –æ–±—Ä–µ–∑–∞—Ç—å —Å–≤–∏–Ω–≥–∏ –Ω–∞ –≥—Ä–∞–Ω–∏—Ü–∞—Ö –∑–æ–Ω.

**–ú–µ—Ä–∞**: –ê–ª–≥–æ—Ä–∏—Ç–º `slice()` —Å –∑–∞—Ö–≤–∞—Ç–æ–º —Å–æ—Å–µ–¥–Ω–∏—Ö –ø–∏–≤–æ—Ç–æ–≤ (bisect_left/right + —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –Ω–∞ 1 —ç–ª–µ–º–µ–Ω—Ç).

**–¢–µ—Å—Ç**: Unit-—Ç–µ—Å—Ç –Ω–∞ –ø–æ–≥—Ä–∞–Ω–∏—á–Ω—ã–µ —Å–ª—É—á–∞–∏ (–∑–æ–Ω–∞ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Ä–æ–≤–Ω–æ –Ω–∞ –ø–∏–≤–æ—Ç–µ, –∑–æ–Ω–∞ –º–µ–∂–¥—É –¥–≤—É–º—è –ø–∏–≤–æ—Ç–∞–º–∏, –∏ —Ç.–¥.)

### –†–∏—Å–∫ 2: –ü–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏ –Ω–∞ –±–æ–ª—å—à–∏—Ö –¥–∞—Ç–∞—Å–µ—Ç–∞—Ö
**–ü—Ä–æ–±–ª–µ–º–∞**: SwingContext —Ö—Ä–∞–Ω–∏—Ç –≤—Å–µ swing points –≤ –ø–∞–º—è—Ç–∏. –ù–∞ –æ—á–µ–Ω—å –±–æ–ª—å—à–∏—Ö –¥–∞—Ç–∞—Å–µ—Ç–∞—Ö (>1M –±–∞—Ä–æ–≤) —Å –ø–ª–æ—Ç–Ω—ã–º–∏ —Å–≤–∏–Ω–≥–∞–º–∏ —ç—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ–º—É –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—é –ø–∞–º—è—Ç–∏.

**–û—Ü–µ–Ω–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ SwingPoint**:
```python
# –†–∞–∑–º–µ—Ä –æ–¥–Ω–æ–≥–æ SwingPoint –æ–±—ä–µ–∫—Ç–∞ –≤ –ø–∞–º—è—Ç–∏
import sys

@dataclass
class SwingPoint:
    point_id: int           # 28 bytes (Python int object)
    timestamp: datetime     # 48 bytes (datetime object)
    index: int              # 28 bytes
    price: float            # 24 bytes (Python float)
    swing_type: str         # 49+ bytes (string "peak"/"trough" + overhead)
    amplitude_to_next: Optional[float]  # 24 bytes + 8 (Optional overhead)
    duration_to_next: Optional[int]     # 28 bytes + 8
    strategy_name: str      # ~55 bytes (e.g., "zigzag" + overhead)
    strategy_params: Dict   # ~240 bytes (dict with 2-3 keys)

# –ò—Ç–æ–≥–æ: ~264 bytes per SwingPoint (–ø—Ä–∏–±–ª–∏–∑–∏—Ç–µ–ª—å–Ω–æ)
```

**–ü—Ä–∏–º–µ—Ä—ã –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è –ø–∞–º—è—Ç–∏**:

| –î–∞—Ç–∞—Å–µ—Ç      | Bars    | Swings (5% deviation) | Memory (SwingContext) |
|--------------|---------|----------------------|----------------------|
| XAUUSD 1H    | 10,000  | ~50-100              | 13-26 KB             |
| XAUUSD 1H    | 100,000 | ~500-1,000           | 130-260 KB           |
| XAUUSD 1M    | 1,000,000| ~5,000-10,000       | 1.3-2.6 MB           |
| Multi-pair 1M| 10,000,000| ~50,000-100,000    | 13-26 MB             |

**–û—Ü–µ–Ω–∫–∞**: –î–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ real-world —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ (<1M bars) –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏ **–ø—Ä–∏–µ–º–ª–µ–º–æ** (<3 MB).

---

**–†–µ—à–µ–Ω–∏–µ –≤ —Ç–µ–∫—É—â–µ–π –≤–µ—Ä—Å–∏–∏**:

- **–ù–µ—Ç —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π** - –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ Python dataclasses
- **Recommendation**: –î–ª—è –¥–∞—Ç–∞—Å–µ—Ç–æ–≤ >1M –±–∞—Ä–æ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å per_zone —Ä–µ–∂–∏–º

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é**:
- ‚úÖ **–î–∞—Ç–∞—Å–µ—Ç—ã <100k –±–∞—Ä–æ–≤**: –ù–∏–∫–∞–∫–∏—Ö –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ global mode
- ‚ö†Ô∏è **–î–∞—Ç–∞—Å–µ—Ç—ã 100k-1M –±–∞—Ä–æ–≤**: –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏ (~1-3 MB)
- ‚ùå **–î–∞—Ç–∞—Å–µ—Ç >1M –±–∞—Ä–æ–≤**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å per_zone —Ä–µ–∂–∏–º –∏–ª–∏ —Ä–∞–∑–±–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –Ω–∞ –ø–µ—Ä–∏–æ–¥—ã

**–¢–µ—Å—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ—Ü–µ–Ω–∫–∏**:
```python
def test_memory_consumption_estimate():
    """–ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ü–µ–Ω–∫–∏ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è –ø–∞–º—è—Ç–∏."""
    # –°–æ–∑–¥–∞—Ç—å SwingContext —Å 1000 —Ç–æ—á–µ–∫
    # –ò–∑–º–µ—Ä–∏—Ç—å —Ñ–∞–∫—Ç–∏—á–µ—Å–∫—É—é –ø–∞–º—è—Ç—å —á–µ—Ä–µ–∑ sys.getsizeof + gc
    # –°—Ä–∞–≤–Ω–∏—Ç—å —Å –æ—Ü–µ–Ω–∫–æ–π ~264 bytes/point
    assert actual_memory < estimated_memory * 1.5  # 50% tolerance
```

---

**–í–æ–∑–º–æ–∂–Ω—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ (–ù–ï –≤ scope —Ç–µ–∫—É—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏)**:

–ï—Å–ª–∏ –≤ –±—É–¥—É—â–µ–º –≤–æ–∑–Ω–∏–∫–Ω–µ—Ç –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—å –≤ –¥–∞—Ç–∞—Å–µ—Ç–∞—Ö >5M –±–∞—Ä–æ–≤, —Å–º. **[future_optimizations.md](future_optimizations.md)** –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –æ–ø–∏—Å–∞–Ω–∏—è —Å –ø—Å–µ–≤–¥–æ–∫–æ–¥–æ–º:
- **Lazy Loading**: –ó–∞–≥—Ä—É–∑–∫–∞ SwingPoint –ø–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—é –∏–∑ disk cache (~83% —ç–∫–æ–Ω–æ–º–∏—è –ø–∞–º—è—Ç–∏)
- **Chunking**: –†–∞–∑–±–∏–µ–Ω–∏–µ –¥–∞—Ç–∞—Å–µ—Ç–∞ –Ω–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã (support –¥–ª—è >10M bars)
- **Numpy structured arrays**: ~50% —ç–∫–æ–Ω–æ–º–∏–∏ –ø–∞–º—è—Ç–∏ –≤–º–µ—Å—Ç–æ Python objects
- **MemoryError fallback**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç–∫–∞—Ç –Ω–∞ per_zone –ø—Ä–∏ –Ω–µ—Ö–≤–∞—Ç–∫–µ –ø–∞–º—è—Ç–∏

–≠—Ç–∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ **–Ω–µ —Ç—Ä–µ–±—É—é—Ç—Å—è** –¥–ª—è —Ç–∏–ø–∏—á–Ω—ã—Ö use cases (<1M bars) –∏ –±—É–¥—É—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ **–∏–∑–º–µ—Ä–µ–Ω–Ω–æ–π** —Ä–µ–∞–ª—å–Ω–æ–π –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–∏ (–ø–æ—Å–ª–µ profiling –∏ cost-benefit analysis).

### –†–∏—Å–∫ 3: –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
**–ü—Ä–æ–±–ª–µ–º–∞**: –ì–ª–æ–±–∞–ª—å–Ω—ã–π —Ä–∞—Å—á—ë—Ç –Ω–∞ –±–æ–ª—å—à–∏—Ö –¥–∞—Ç–∞—Å–µ—Ç–∞—Ö (>100k –±–∞—Ä–æ–≤) –º–æ–∂–µ—Ç –±—ã—Ç—å –º–µ–¥–ª–µ–Ω–Ω—ã–º.

**–ú–µ—Ä—ã**:
- ‚úÖ –ì–ª–æ–±–∞–ª—å–Ω—ã–π —Ä–∞—Å—á—ë—Ç –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è **–æ–¥–∏–Ω —Ä–∞–∑** (vs N —Ä–∞–∑ –¥–ª—è N –∑–æ–Ω)
- ‚úÖ Bisect –¥–ª—è –Ω–∞—Ä–µ–∑–∫–∏ ‚Üí O(log N) –ø–æ–∏—Å–∫
- ‚úÖ –ü—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –±–æ–ª—å—à–∏—Ö –¥–∞—Ç–∞—Å–µ—Ç–∞—Ö
- ‚úÖ –°–º. –†–∏—Å–∫ 2 –¥–ª—è memory-performance tradeoffs

**Benchmark**: –°—Ä–∞–≤–Ω–∏—Ç—å –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –¥–ª—è –¥–∞—Ç–∞—Å–µ—Ç–∞ 10k, 50k, 100k –±–∞—Ä–æ–≤.

### –†–∏—Å–∫ 4: –†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å —Å—Ç—Ä–∞—Ç–µ–≥–∏–π
**–ü—Ä–æ–±–ª–µ–º–∞**: –ù–æ–≤—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –¥–æ–ª–∂–Ω—ã –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –æ–±–∞ –º–µ—Ç–æ–¥–∞.

**–ú–µ—Ä–∞**: –§–æ—Ä–º–∞–ª—å–Ω—ã–π –ø—Ä–æ—Ç–æ–∫–æ–ª `SwingCalculationStrategy` —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –≤ runtime.

**–¢–µ—Å—Ç**: –ü–æ–ø—ã—Ç–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –±–µ–∑ `calculate_global()` –≤ global mode ‚Üí —á–∏—Ç–∞–µ–º–∞—è –æ—à–∏–±–∫–∞.

---

## 11. –ò—Ç–æ–≥–æ–≤—ã–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

### ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –∞–Ω–∞–ª–∏–∑–∞
- –°–≤–∏–Ω–≥–∏ —Ä–∞—Å—Å—á–∏—Ç–∞–Ω—ã –Ω–∞ –≥–ª–æ–±–∞–ª—å–Ω–æ–º —É—Ä–æ–≤–Ω–µ ‚Üí –Ω–µ—Ç –ø–æ—Ç–µ—Ä–∏ –≥—Ä–∞–Ω–∏—á–Ω—ã—Ö —Ç–æ—á–µ–∫
- –ï–¥–∏–Ω—ã–µ –ø–æ—Ä–æ–≥–∏ –¥–ª—è –≤—Å–µ—Ö –∑–æ–Ω ‚Üí —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∞—è —Å–æ–ø–æ—Å—Ç–∞–≤–∏–º–æ—Å—Ç—å
- –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º "—Ä—É—á–Ω–æ–≥–æ" ZigZag –∞–Ω–∞–ª–∏–∑–∞

### ‚úÖ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- –ì–ª–æ–±–∞–ª—å–Ω—ã–π —Ä–∞—Å—á—ë—Ç **1 —Ä–∞–∑** –≤–º–µ—Å—Ç–æ N —Ä–∞–∑ (–¥–ª—è N –∑–æ–Ω)
- –ê–≥—Ä–µ–≥–∞—Ü–∏—è —á–µ—Ä–µ–∑ bisect + —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é ‚Üí O(k log n) –≥–¥–µ k = —á–∏—Å–ª–æ —Å–≤–∏–Ω–≥–æ–≤ –≤ –∑–æ–Ω–µ
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞

### ‚úÖ –ì–∏–±–∫–æ—Å—Ç—å
- –í—ã–±–æ—Ä —Ä–µ–∂–∏–º–∞ —á–µ—Ä–µ–∑ `.with_swing_scope('global' | 'per_zone')`
- Backward compatibility —Å legacy —Ä–µ–∂–∏–º–æ–º
- Graceful fallback –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö

### ‚úÖ –†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å
- `SwingContext` –º–æ–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å/–∑–∞–≥—Ä—É–∑–∏—Ç—å –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ
- –ú–æ–∂–Ω–æ –≤–∏–∑—É–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –≥–ª–æ–±–∞–ª—å–Ω—ã–µ —Å–≤–∏–Ω–≥–∏
- –ú–æ–∂–Ω–æ –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å–≤–∏–Ω–≥–∏ –≤–Ω–µ –∑–æ–Ω
- –§–æ—Ä–º–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç –¥–ª—è –Ω–æ–≤—ã—Ö —Å—Ç—Ä–∞—Ç–µ–≥–∏–π

### ‚úÖ –ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞
- –ß—ë—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ (—Ä–∞—Å—á—ë—Ç vs –∞–≥—Ä–µ–≥–∞—Ü–∏—è)
- –ë–æ–≥–∞—Ç–∞—è –º–æ–¥–µ–ª—å –¥–∞–Ω–Ω—ã—Ö (`SwingPoint` —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏)
- –ü–æ–ª–Ω–∞—è —Ç—Ä–∞—Å—Å–∏—Ä—É–µ–º–æ—Å—Ç—å (strategy_name, strategy_params)
- –£–¥–æ–±–Ω—ã–π API (`zone.get_zone_swings()`)

---

## 12. –ú–∞—Ç—Ä–∏—Ü–∞ –ø–æ–∫—Ä—ã—Ç–∏—è –ø–ª–∞–Ω–∞ (Coverage Matrix)

–≠—Ç–∞ —Ç–∞–±–ª–∏—Ü–∞ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ **–≤—Å—ë —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞ —É—á—Ç–µ–Ω–æ –≤ –ø–ª–∞–Ω–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏** (—Ä–∞–∑–¥–µ–ª 8). –ö–∞–∂–¥—ã–π –æ–ø–∏—Å–∞—Ç–µ–ª—å–Ω—ã–π —Ä–∞–∑–¥–µ–ª (1-7, 9-11) –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å —Ö–æ—Ç—è –±—ã –æ–¥–Ω—É —Å—Å—ã–ª–∫—É –∏–∑ —Ñ–∞–∑ 1-6.

| –†–∞–∑–¥–µ–ª –¥–æ–∫—É–º–µ–Ω—Ç–∞ | –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —Ñ–∞–∑–µ | –¢–∏–ø –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è | –°—Ç–∞—Ç—É—Å |
|------------------|-------------------|-------------------|---------|
| **1. –ù–æ–≤—ã–µ –º–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö** | | | |
| 1.1 SwingPoint dataclass | –§–∞–∑–∞ 1, –∑–∞–¥–∞—á–∞ 1.1 | –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è (—Å—Ç—Ä–æ–∫–∏ 55-101) | ‚úÖ |
| 1.2 SwingContext dataclass | –§–∞–∑–∞ 1, –∑–∞–¥–∞—á–∞ 1.2 | –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è + –∞–ª–≥–æ—Ä–∏—Ç–º slice() (—Å—Ç—Ä–æ–∫–∏ 103-200) | ‚úÖ |
| 1.3 –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ ZoneInfo | –§–∞–∑–∞ 1, –∑–∞–¥–∞—á–∞ 1.3 | –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è API (—Å—Ç—Ä–æ–∫–∏ 202-264) | ‚úÖ |
| **2. –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏** | | | |
| 2.1 swing_scope –≤ ZoneAnalysisConfig | –§–∞–∑–∞ 1, –∑–∞–¥–∞—á–∞ 1.4 | –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ–ª—è (—Å—Ç—Ä–æ–∫–∏ 268-300) | ‚úÖ |
| **3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ API —Å—Ç—Ä–∞—Ç–µ–≥–∏–π** | | | |
| 3.1 –ü—Ä–æ—Ç–æ–∫–æ–ª SwingCalculationStrategy | –§–∞–∑–∞ 2, –∑–∞–¥–∞—á–∞ 2.1 | –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ (—Å—Ç—Ä–æ–∫–∏ 310-401) | ‚úÖ |
| 3.2 –ü—Ä–∏–º–µ—Ä ZigZagSwingStrategy | –§–∞–∑–∞ 2, –∑–∞–¥–∞—á–∏ 2.2-2.4 | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è calculate_global(), aggregate_for_zone() (—Å—Ç—Ä–æ–∫–∏ 403-689) | ‚úÖ |
| **4. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ ZoneAnalysisPipeline** | | | |
| 4.1 –ù–æ–≤—ã–µ –º–µ—Ç–æ–¥—ã Pipeline | –§–∞–∑–∞ 3, –∑–∞–¥–∞—á–∏ 3.1-3.3 | _calculate_global_swings(), _inject_swing_context() (—Å—Ç—Ä–æ–∫–∏ 693-805) | ‚úÖ |
| 4.2 Builder API with_swing_scope() | –§–∞–∑–∞ 3, –∑–∞–¥–∞—á–∞ 3.4 | –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è –º–µ—Ç–æ–¥–∞ + –ø—Ä–∏–º–µ—Ä—ã (—Å—Ç—Ä–æ–∫–∏ 807-867) | ‚úÖ |
| **5. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ ZoneFeaturesAnalyzer** | | | |
| 5.1 extract_zone_features() –ª–æ–≥–∏–∫–∞ | –§–∞–∑–∞ 4, –∑–∞–¥–∞—á–∞ 4.1 | –í–µ—Ç–≤–ª–µ–Ω–∏–µ global/per_zone (—Å—Ç—Ä–æ–∫–∏ 869-942) | ‚úÖ |
| **6. –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –ø–æ—Ä–æ–≥–∏** | | | |
| 6.1 _AdaptiveSwingStrategy –≥–ª–æ–±–∞–ª—å–Ω—ã–π —Ä–µ–∂–∏–º | –§–∞–∑–∞ 2, –∑–∞–¥–∞—á–∞ 2.7 | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è (—Å—Ç—Ä–æ–∫–∏ 946-992) | ‚úÖ |
| **7. –°—Ö–µ–º–∞ –≤–æ—Ä–∫—Ñ–ª–æ—É** | | | |
| 7.1 –î–∏–∞–≥—Ä–∞–º–º–∞ –æ–±–Ω–æ–≤–ª—ë–Ω–Ω–æ–≥–æ workflow | –§–∞–∑–∞ 3, –∑–∞–¥–∞—á–∞ 3.3 (pre-reading) | –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è (—Å—Ç—Ä–æ–∫–∏ 996-1028) | ‚úÖ |
| **9. –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –∏ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ** | | | |
| 9.1 –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å | –§–∞–∑—ã 1-6 (–ø—Ä–∏–Ω—Ü–∏–ø) | Design constraint | ‚úÖ |
| 9.2 –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ swing —Å—Ç—Ä–∞—Ç–µ–≥–∏–π | –§–∞–∑–∞ 1, –∑–∞–¥–∞—á–∞ 1.4 | Hash generation –¥–ª—è cache keys (—Å—Ç—Ä–æ–∫–∏ 1487-1621) | ‚úÖ |
| 9.3 Graceful Degradation | –§–∞–∑–∞ 3, –∑–∞–¥–∞—á–∞ 3.3 | Fallback –ª–æ–≥–∏–∫–∞ (—Å—Ç—Ä–æ–∫–∏ 1623-1636) | ‚úÖ |
| **10. –†–∏—Å–∫–∏ –∏ –º–µ—Ä—ã** | | | |
| 10. –†–∏—Å–∫ 1: –ì—Ä–∞–Ω–∏—Ü—ã –ø–∏–≤–æ—Ç–æ–≤ | –§–∞–∑–∞ 5: Edge case —Ç–µ—Å—Ç—ã | test_single_bar_zone(), test_zone_at_dataset_boundaries() (—Å—Ç—Ä–æ–∫–∏ 1642-1648) | ‚úÖ |
| 10. –†–∏—Å–∫ 2: –ü–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏ | –§–∞–∑–∞ 1, –∑–∞–¥–∞—á–∞ 1.2 (constraint) <br> –§–∞–∑–∞ 5: Memory —Ç–µ—Å—Ç—ã | Design constraint (—Å—Ç—Ä–æ–∫–∏ 1649-1752) <br> test_memory_consumption_estimate() | ‚úÖ |
| 10. –†–∏—Å–∫ 3: –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å | –§–∞–∑–∞ 5: Benchmark —Ç–µ—Å—Ç—ã | Benchmark 10k/50k/100k –±–∞—Ä–æ–≤ (—Å—Ç—Ä–æ–∫–∏ 1754-1763) | ‚úÖ |
| 10. –†–∏—Å–∫ 4: –†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å —Å—Ç—Ä–∞—Ç–µ–≥–∏–π | –§–∞–∑–∞ 2, –∑–∞–¥–∞—á–∞ 2.1 (pre-reading) | Protocol design (—Å—Ç—Ä–æ–∫–∏ 1765-1770) | ‚úÖ |
| **11. –ò—Ç–æ–≥–æ–≤—ã–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞** | | | |
| 11.1-11.5 –í—Å–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ | –§–∞–∑–∞ 6: –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è | –ö–æ–Ω—Ç–µ–Ω—Ç –¥–ª—è migration guide –∏ user guide (—Å—Ç—Ä–æ–∫–∏ 2076-2104) | ‚úÖ |

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª–Ω–æ—Ç—ã –ø–æ–∫—Ä—ã—Ç–∏—è

**–ü–æ–∫—Ä—ã—Ç—ã –≤—Å–µ –∫–ª—é—á–µ–≤—ã–µ —Ä–∞–∑–¥–µ–ª—ã**: ‚úÖ

- –†–∞–∑–¥–µ–ª 1: –ú–æ–¥–µ–ª–∏ ‚Üí –§–∞–∑–∞ 1 (–≤—Å–µ 3 –ø–æ–¥—Ä–∞–∑–¥–µ–ª–∞)
- –†–∞–∑–¥–µ–ª 2: –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è ‚Üí –§–∞–∑–∞ 1
- –†–∞–∑–¥–µ–ª 3: –°—Ç—Ä–∞—Ç–µ–≥–∏–∏ ‚Üí –§–∞–∑–∞ 2 (–≤—Å–µ –ø–æ–¥—Ä–∞–∑–¥–µ–ª—ã)
- –†–∞–∑–¥–µ–ª 4: Pipeline ‚Üí –§–∞–∑–∞ 3 (–≤—Å–µ –ø–æ–¥—Ä–∞–∑–¥–µ–ª—ã)
- –†–∞–∑–¥–µ–ª 5: Features Analyzer ‚Üí –§–∞–∑–∞ 4
- –†–∞–∑–¥–µ–ª 6: –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –ø–æ—Ä–æ–≥–∏ ‚Üí –§–∞–∑–∞ 2
- –†–∞–∑–¥–µ–ª 7: –í–æ—Ä–∫—Ñ–ª–æ—É ‚Üí –§–∞–∑–∞ 3 (pre-reading)
- –†–∞–∑–¥–µ–ª 9: –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å ‚Üí –§–∞–∑—ã 1, 3 (design constraints)
- –†–∞–∑–¥–µ–ª 10: –†–∏—Å–∫–∏ ‚Üí –§–∞–∑—ã 1, 2, 5 (constraints + tests)
- –†–∞–∑–¥–µ–ª 11: –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ ‚Üí –§–∞–∑–∞ 6 (documentation)

**–ù–µ—Ç –Ω–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞**: ‚úÖ

–í—Å–µ –æ–ø–∏—Å–∞—Ç–µ–ª—å–Ω—ã–µ —Ä–∞–∑–¥–µ–ª—ã (1-7, 9-11) –∏–º–µ—é—Ç –º–∏–Ω–∏–º—É–º –æ–¥–Ω—É —è–≤–Ω—É—é —Å—Å—ã–ª–∫—É –∏–∑ –ø–ª–∞–Ω–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (—Ä–∞–∑–¥–µ–ª 8, –§–∞–∑—ã 1-6).

**–í—ã–≤–æ–¥**: –ü–ª–∞–Ω —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (—Ä–∞–∑–¥–µ–ª 8) –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–æ–∫—Ä—ã–≤–∞–µ—Ç –≤—Å—ë —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞. –ü—Ä–∏ —Ä–∞–±–æ—Ç–µ –ø–æ –ø–ª–∞–Ω—É —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –í–°–ï —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏, –ø—Ä–∏–º–µ—Ä—ã, —Ä–∏—Å–∫–∏ –∏ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞, –æ–ø–∏—Å–∞–Ω–Ω—ã–µ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–µ.

---

## 13. –†–µ–∑—é–º–µ

–í–≤–µ–¥—è –≥–ª–æ–±–∞–ª—å–Ω—ã–π —Ä–∞—Å—á—ë—Ç —Å–≤–∏–Ω–≥–æ–≤ –∏ –ø–æ—Å–ª–µ–¥—É—é—â—É—é –Ω–∞—Ä–µ–∑–∫—É –ø–∏–≤–æ—Ç–æ–≤ –Ω–∞ –∑–æ–Ω—ã, –º—ã –ø–æ–ª—É—á–∏–º:

1. **–°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω—ã–π –Ω–∞–±–æ—Ä –º–µ—Ç—Ä–∏–∫**, —Å–æ–≤–ø–∞–¥–∞—é—â–∏–π —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ ZigZag
2. **–£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –∏—Å–∫–∞–∂–µ–Ω–∏–π** –∞–Ω–∞–ª–∏–∑–∞ –∏–∑-–∑–∞ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ä–∞—Å—á—ë—Ç–∞
3. **–ü–æ–≤—ã—à–µ–Ω–∏–µ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º–æ—Å—Ç–∏** —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
4. **–ó–∞–∫–ª–∞–¥–∫—É –æ—Å–Ω–æ–≤—ã** –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ —Ä–∞–∑–≤–∏—Ç–∏—è —Å–≤–∏–Ω–≥–æ–≤—ã—Ö —Å—Ç—Ä–∞—Ç–µ–≥–∏–π
5. **–û–±—Ä–∞—Ç–Ω—É—é —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å** —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –∫–æ–¥–æ–º —á–µ—Ä–µ–∑ fallback

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏**: –§–∞–∑—ã 1‚Üí2‚Üí3‚Üí4‚Üí5‚Üí6

**–û–∂–∏–¥–∞–µ–º—ã–π —ç—Ñ—Ñ–µ–∫—Ç –Ω–∞ 05_case_study**: –ü–æ–∫—Ä—ã—Ç–∏–µ –∑–æ–Ω —Å–≤–∏–Ω–≥–∞–º–∏ —É–≤–µ–ª–∏—á–∏—Ç—Å—è —Å 20-60% –¥–æ 70-90% –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏.

---

## 14. –ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è (Acceptance Criteria)

–≠—Ç–æ—Ç —Ä–∞–∑–¥–µ–ª –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç **–∫–æ–ª–∏—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∫—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏—ë–º–∫–∏** –¥–ª—è –æ–±—ä–µ–∫—Ç–∏–≤–Ω–æ–≥–æ —Ä–µ—à–µ–Ω–∏—è –æ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –∫ —Ä–µ–ª–∏–∑—É.

### 14.1. –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å (Correctness)

**KPI 1: Zone Coverage with Swings**
- **Baseline** (—Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ): 18-62% –∑–æ–Ω –∏–º–µ—é—Ç swing –º–µ—Ç—Ä–∏–∫–∏ –≤ per_zone —Ä–µ–∂–∏–º–µ
  - `find_peaks`: 18.9% (7/37 –∑–æ–Ω)
  - `pivot_points`: 8.1% (3/37 –∑–æ–Ω)
  - `zigzag`: 62.2% (23/37 –∑–æ–Ω)
- **Target** (—Ü–µ–ª–µ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ): ‚â•70% –∑–æ–Ω –∏–º–µ—é—Ç swing –º–µ—Ç—Ä–∏–∫–∏ –≤ global —Ä–µ–∂–∏–º–µ
- **–ò–∑–º–µ—Ä–µ–Ω–∏–µ**: –ó–∞–ø—É—Å—Ç–∏—Ç—å `research/notebooks/05_case_study_zone_consistency.py` –Ω–∞ XAUUSD 1H dataset
- **–ö—Ä–∏—Ç–µ—Ä–∏–π –ø—Ä–∏—ë–º–∫–∏**:
  - ‚úÖ –£–ª—É—á—à–µ–Ω–∏–µ –º–∏–Ω–∏–º—É–º –Ω–∞ **+20 percentage points** –¥–ª—è –∫–∞–∂–¥–æ–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
  - ‚úÖ –í—Å–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –¥–æ—Å—Ç–∏–≥–∞—é—Ç ‚â•70% coverage

**KPI 2: Consistency with Manual Analysis**
- **Baseline**: Per_zone —Å–≤–∏–Ω–≥–∏ –ù–ï —Å–æ–≤–ø–∞–¥–∞—é—Ç —Å "—Ä—É—á–Ω—ã–º" ZigZag –Ω–∞ –ø–æ–ª–Ω–æ–º –¥–∞—Ç–∞—Å–µ—Ç–µ (–ø–æ—Ç–µ—Ä—è –≥—Ä–∞–Ω–∏—á–Ω—ã—Ö –ø–∏–≤–æ—Ç–æ–≤)
- **Target**: Global —Å–≤–∏–Ω–≥–∏ —Ç–æ—á–Ω–æ —Å–æ–≤–ø–∞–¥–∞—é—Ç —Å ZigZag, –ø–æ—Å—Ç—Ä–æ–µ–Ω–Ω—ã–º –Ω–∞ –ø–æ–ª–Ω–æ–º –¥–∞—Ç–∞—Å–µ—Ç–µ
- **–ò–∑–º–µ—Ä–µ–Ω–∏–µ**: –í–∏–∑—É–∞–ª—å–Ω–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –Ω–∞ 10 —Å–ª—É—á–∞–π–Ω—ã—Ö –∑–æ–Ω–∞—Ö
- **–ö—Ä–∏—Ç–µ—Ä–∏–π –ø—Ä–∏—ë–º–∫–∏**:
  - ‚úÖ 100% –≤–∏–∑—É–∞–ª—å–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ (–Ω–µ—Ç –ø–æ—Ç–µ—Ä—è–Ω–Ω—ã—Ö –ø–∏–≤–æ—Ç–æ–≤ –Ω–∞ –≥—Ä–∞–Ω–∏—Ü–∞—Ö)
  - ‚úÖ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã—Ö swings —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å global ZigZag ¬±1 —Ç–æ—á–∫–∞

---

### 14.2. –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (Performance)

**KPI 3: Execution Time**
- **Baseline**: N –≤—ã–∑–æ–≤–æ–≤ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ (–¥–ª—è N –∑–æ–Ω, –Ω–∞–ø—Ä–∏–º–µ—Ä N=30 –Ω–∞ —Ç–∏–ø–∏—á–Ω–æ–º –¥–∞—Ç–∞—Å–µ—Ç–µ)
- **Target**: 1 –≤—ã–∑–æ–≤ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ + N –±—ã—Å—Ç—Ä—ã—Ö slice –æ–ø–µ—Ä–∞—Ü–∏–π
- **–ò–∑–º–µ—Ä–µ–Ω–∏–µ**: Benchmark –Ω–∞ –¥–∞—Ç–∞—Å–µ—Ç–µ 100 –∑–æ–Ω √ó 10,000 bars
- **–ö—Ä–∏—Ç–µ—Ä–∏–π –ø—Ä–∏—ë–º–∫–∏**:
  - ‚úÖ Global mode ‚â§ **1.5√ó** –≤—Ä–µ–º—è per_zone mode
  - ‚ö†Ô∏è –î–æ–ø—É—Å—Ç–∏–º –Ω–µ–±–æ–ª—å—à–æ–π overhead –Ω–∞ slice/aggregate, –Ω–æ –ù–ï –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –º–µ–¥–ª–µ–Ω–Ω–µ–µ –±–æ–ª–µ–µ —á–µ–º –≤ 1.5 —Ä–∞–∑–∞

**KPI 4: Memory Consumption**
- **Target**: < 3 MB –¥–ª—è —Ç–∏–ø–∏—á–Ω—ã—Ö –¥–∞—Ç–∞—Å–µ—Ç–æ–≤ (100k bars, 5% deviation ‚Üí ~500-1000 swings)
- **–ò–∑–º–µ—Ä–µ–Ω–∏–µ**: `test_memory_consumption_estimate()` –∏–∑ –§–∞–∑—ã 5
- **–ö—Ä–∏—Ç–µ—Ä–∏–π –ø—Ä–∏—ë–º–∫–∏**:
  - ‚úÖ SwingContext —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏ –ø–æ—Ç—Ä–µ–±–ª—è–µ—Ç **~264 bytes/point ¬±50%** (—Ç.–µ. < 400 bytes/point)
  - ‚úÖ –î–ª—è 100k bars –¥–∞—Ç–∞—Å–µ—Ç–∞: memory < 500 KB

---

### 14.3. –°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å (Stability)

**KPI 5: Edge Cases Handling**
- **Target**: –í—Å–µ 7 edge case —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ—Ö–æ–¥—è—Ç –±–µ–∑ –∏—Å–∫–ª—é—á–µ–Ω–∏–π
- **–ò–∑–º–µ—Ä–µ–Ω–∏–µ**: –ó–∞–ø—É—Å—Ç–∏—Ç—å `tests/unit/test_swing_edge_cases.py`
- **–ö—Ä–∏—Ç–µ—Ä–∏–π –ø—Ä–∏—ë–º–∫–∏**:
  - ‚úÖ –ù–µ—Ç `IndexError` –Ω–∞ –≥—Ä–∞–Ω–∏—Ü–∞—Ö –¥–∞—Ç–∞—Å–µ—Ç–∞ (test_zone_at_dataset_boundaries)
  - ‚úÖ –ù–µ—Ç `division by zero` –ø—Ä–∏ –∞—Å–∏–º–º–µ—Ç—Ä–∏—á–Ω—ã—Ö —Å–≤–∏–Ω–≥–∞—Ö (test_zone_with_all_peaks_or_all_troughs)
  - ‚úÖ Graceful handling –ø—É—Å—Ç—ã—Ö –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–≤ (test_empty_swing_context)
  - ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ single-bar –∑–æ–Ω (test_single_bar_zone)
  - ‚úÖ –í–°–ï 7 —Ç–µ—Å—Ç–æ–≤ –∑–µ–ª—ë–Ω—ã–µ

**KPI 6: Backward Compatibility**
- **Target**: –°—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- **–ö—Ä–∏—Ç–µ—Ä–∏–π –ø—Ä–∏—ë–º–∫–∏**:
  - ‚úÖ Default —Ä–µ–∂–∏–º = `per_zone` (—Å—Ç–∞—Ä–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ)
  - ‚úÖ Legacy –º–µ—Ç–æ–¥ `calculate()` —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ —Ä–∞–Ω—å—à–µ
  - ‚úÖ –ù–µ—Ç breaking changes –≤ public API (–≤—Å–µ —Ç–µ—Å—Ç—ã —Å—Ç–∞—Ä–æ–≥–æ –∫–æ–¥–∞ –ø—Ä–æ—Ö–æ–¥—è—Ç)

---

### 14.4. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (Documentation)

**KPI 7: Migration Success Rate**
- **Target**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –º–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ global mode –∑–∞ < 5 –º–∏–Ω—É—Ç
- **–ò–∑–º–µ—Ä–µ–Ω–∏–µ**: –ü—Ä–æ–π—Ç–∏ migration guide –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–æ–µ–∫—Ç–µ (dry run)
- **–ö—Ä–∏—Ç–µ—Ä–∏–π –ø—Ä–∏—ë–º–∫–∏**:
  - ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ `.with_swing_scope('global')` - **–µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–µ** –∏–∑–º–µ–Ω–µ–Ω–∏–µ –∫–æ–¥–∞
  - ‚úÖ Migration guide —Å–æ–¥–µ—Ä–∂–∏—Ç working examples (–ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã)
  - ‚úÖ Troubleshooting section –ø–æ–∫—Ä—ã–≤–∞–µ—Ç —Ç–∏–ø–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

---

### 14.5. Acceptance Workflow

**–ü—Ä–æ—Ü–µ—Å—Å –ø—Ä–∏–Ω—è—Ç–∏—è —Ä–µ—à–µ–Ω–∏—è –æ —Ä–µ–ª–∏–∑–µ**:

```
1. Phase 5 –∑–∞–≤–µ—Ä—à–µ–Ω–∞
   ‚Üì
2. –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Ç–µ—Å—Ç—ã (unit + integration + edge cases)
   ‚Üì
3. –ò–∑–º–µ—Ä–∏—Ç—å KPI 1-7 –∏ –∑–∞–ø–∏—Å–∞—Ç—å —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è
   ‚Üì
4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫—Ä–∏—Ç–µ—Ä–∏–µ–≤:
   ‚îú‚îÄ KPI 1: Zone Coverage ‚â•70%?
   ‚îú‚îÄ KPI 2: Visual Match 100%?
   ‚îú‚îÄ KPI 3: Performance ‚â§1.5√ó baseline?
   ‚îú‚îÄ KPI 4: Memory < 3 MB for 100k bars?
   ‚îú‚îÄ KPI 5: All 7 edge cases pass?
   ‚îú‚îÄ KPI 6: Backward compatibility OK?
   ‚îî‚îÄ KPI 7: Migration < 5 min?
   ‚Üì
5a. –ï—Å–ª–∏ —Ö–æ—Ç—å –æ–¥–∏–Ω KPI –ù–ï –¥–æ—Å—Ç–∏–≥–Ω—É—Ç:
    ‚Üí –í–µ—Ä–Ω—É—Ç—å—Å—è –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é —Ñ–∞–∑—É (1-4)
    ‚Üí –ò—Å–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—É
    ‚Üí –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å workflow —Å —à–∞–≥–∞ 1
   ‚Üì
5b. –ï—Å–ª–∏ –í–°–ï KPI –¥–æ—Å—Ç–∏–≥–Ω—É—Ç—ã:
    ‚Üí Phase 6 (Documentation)
    ‚Üì
6. Code Review
   ‚Üì
7. ‚úÖ READY FOR RELEASE
```

### 14.6. Tracking Template

–ó–∞–ø–æ–ª–Ω–∏—Ç—å –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è Phase 5:

| KPI | Target | Actual | Status | Notes |
|-----|--------|--------|--------|-------|
| KPI 1: Coverage (find_peaks) | ‚â•70% | ___% | ‚è≥ | Baseline: 18.9% |
| KPI 1: Coverage (pivot_points) | ‚â•70% | ___% | ‚è≥ | Baseline: 8.1% |
| KPI 1: Coverage (zigzag) | ‚â•70% | ___% | ‚è≥ | Baseline: 62.2% |
| KPI 2: Visual Match | 100% | ___% | ‚è≥ | 10/10 zones |
| KPI 3: Performance | ‚â§1.5√ó | ___√ó | ‚è≥ | 100 zones √ó 10k bars |
| KPI 4: Memory | <3 MB | ___ MB | ‚è≥ | 100k bars dataset |
| KPI 5: Edge Cases | 7/7 pass | ___/7 | ‚è≥ | No exceptions |
| KPI 6: Backward Compat | No breaks | ___  | ‚è≥ | Old tests pass |
| KPI 7: Migration Time | <5 min | ___ min | ‚è≥ | Dry run |

**–ö—Ä–∏—Ç–µ—Ä–∏–π —Ä–µ–ª–∏–∑–∞**: –í–°–ï —Å—Ç–∞—Ç—É—Å—ã = ‚úÖ

---
