# –ê–Ω–∞–ª–∏–∑ —Ñ–æ—Ä–º –∑–æ–Ω MACD: –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –º–µ—Ç–æ–¥—ã –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏

**–î–∞—Ç–∞:** 2025-10-12  
**–ö–æ–Ω—Ç–µ–∫—Å—Ç:** Phase 3.2 - Shape —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏

---

## –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è –ø—Ä–æ—Å—Ç–æ—Ç–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö Shape —Å—Ç—Ä–∞—Ç–µ–≥–∏–π](#1-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è-–ø—Ä–æ—Å—Ç–æ—Ç–∞-–¥–æ–±–∞–≤–ª–µ–Ω–∏—è-–Ω–æ–≤—ã—Ö-shape-—Å—Ç—Ä–∞—Ç–µ–≥–∏–π)
2. [–ú–µ—Ç–æ–¥—ã –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏ –¥–ª—è —Ñ–æ—Ä–º –±—É–≥—Ä–æ–≤](#2-–º–µ—Ç–æ–¥—ã-–∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏-–¥–ª—è-—Ñ–æ—Ä–º-–±—É–≥—Ä–æ–≤)
3. [–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏](#3-—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏-–ø–æ-—Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏)

---

## 1. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è –ø—Ä–æ—Å—Ç–æ—Ç–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö Shape —Å—Ç—Ä–∞—Ç–µ–≥–∏–π

### ‚úÖ –û—á–µ–Ω—å –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–∏—Ç—å - 5 —à–∞–≥–æ–≤:

#### –®–∞–≥ 1: –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é —Å—Ç—Ä–∞—Ç–µ–≥–∏—é (1 —Ñ–∞–π–ª)
```
bquant/analysis/zones/strategies/shape/fourier.py
```

–ù–µ–æ–±—Ö–æ–¥–∏–º–æ:
- –ù–∞—Å–ª–µ–¥–æ–≤–∞—Ç—å dataclass
- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –º–µ—Ç–æ–¥ `calculate(zone_data) -> ShapeMetrics`
- –î–æ–±–∞–≤–∏—Ç—å –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä `@StrategyRegistry.register_shape_strategy('fourier')`

**–°–ª–æ–∂–Ω–æ—Å—Ç—å:** –ù–∏–∑–∫–∞—è - —à–∞–±–ª–æ–Ω —É–∂–µ –µ—Å—Ç—å –≤ `statistical.py`

---

#### –®–∞–≥ 2: –≠–∫—Å–ø–æ—Ä—Ç (1 —Å—Ç—Ä–æ–∫–∞)
```python
# bquant/analysis/zones/strategies/shape/__init__.py
from .fourier import FourierShapeStrategy
__all__ = ['StatisticalShapeStrategy', 'FourierShapeStrategy']
```

---

#### –®–∞–≥ 3: –ö–æ–Ω—Ñ–∏–≥ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
```python
# bquant/core/config.py
'shape_strategy': {
    'type': 'fourier',  # –∏–ª–∏ –æ—Å—Ç–∞–≤–∏—Ç—å 'statistical' –∫–∞–∫ default
    'params': {'n_components': 5}
}
```

---

#### –®–∞–≥ 4: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ (0 –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –∫–æ–¥–µ!)
```python
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç—Å—è –∏–∑ config
analyzer = ZoneFeaturesAnalyzer()

# –ò–ª–∏ —è–≤–Ω–æ
from bquant.analysis.zones.strategies.shape import FourierShapeStrategy
analyzer = ZoneFeaturesAnalyzer(
    shape_strategy=FourierShapeStrategy(n_components=5)
)
```

**ZoneFeaturesAnalyzer –ù–ï –ù–£–ñ–ù–û –ú–ï–ù–Ø–¢–¨** - –æ–Ω —É–∂–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ª—é–±—ã–µ shape —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏!

---

#### –®–∞–≥ 5: –¢–µ—Å—Ç—ã
```
tests/unit/test_fourier_shape_strategy.py
```

**–ò—Ç–æ–≥–æ:** ~3 –Ω–æ–≤—ã—Ö —Ñ–∞–π–ª–∞, 0 –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º –∫–æ–¥–µ (–∫—Ä–æ–º–µ exports)

---

### üéØ –ü–æ—á–µ–º—É –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –æ—Ç–ª–∏—á–Ω–∞—è:

1. **–ü–æ–ª–Ω–∞—è –∏–∑–æ–ª—è—Ü–∏—è:**
   - –ù–æ–≤–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º —Ñ–∞–π–ª–µ
   - –ù–µ —Ç—Ä–æ–≥–∞–µ—Ç –¥—Ä—É–≥–∏–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
   - –ù–µ —Ç—Ä–æ–≥–∞–µ—Ç ZoneFeaturesAnalyzer

2. **Strategy Pattern —Ä–∞–±–æ—Ç–∞–µ—Ç:**
   - –ï–¥–∏–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å `ShapeCalculationStrategy`
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä
   - –§–∞–±—Ä–∏–∫–∞ –≤ config.py

3. **–ì–æ—Ä—è—á–∞—è –∑–∞–º–µ–Ω–∞:**
   ```python
   # –í production
   analyzer.shape_strategy = FourierShapeStrategy()
   # –°—Ä–∞–∑—É —Ä–∞–±–æ—Ç–∞–µ—Ç!
   ```

4. **A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
   ```python
   strategies = [
       StatisticalShapeStrategy(),
       FourierShapeStrategy(n_components=5),
       WaveletShapeStrategy(wavelet='db4')
   ]
   
   for strategy in strategies:
       analyzer.shape_strategy = strategy
       results = analyzer.extract_zone_features(zone)
       # –°—Ä–∞–≤–Ω–∏—Ç—å
   ```

---

## 2. –ú–µ—Ç–æ–¥—ã –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏ –¥–ª—è —Ñ–æ—Ä–º –±—É–≥—Ä–æ–≤

### –ö–æ–Ω—Ç–µ–∫—Å—Ç –∑–∞–¥–∞—á–∏:

**–ß—Ç–æ –∫–ª–∞—Å—Ç–µ—Ä–∏–∑—É–µ–º:**
- –ó–æ–Ω—ã MACD —Å —Ä–∞–∑–Ω—ã–º–∏ —Ñ–æ—Ä–º–∞–º–∏ –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º—ã
- –ü—Ä–∏–∑–Ω–∞–∫–∏: skewness, kurtosis, smoothness, duration, amplitude...
- –¶–µ–ª—å: –Ω–∞–π—Ç–∏ –∞—Ä—Ö–µ—Ç–∏–ø—ã –∑–æ–Ω (Sharp Impulse, Smooth Trend, Late Wave...)

---

### üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –º–µ—Ç–æ–¥–æ–≤ –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏

| –ú–µ—Ç–æ–¥ | –ü–ª—é—Å—ã | –ú–∏–Ω—É—Å—ã | –ü–æ–¥—Ö–æ–¥–∏—Ç? |
|-------|-------|--------|-----------|
| **K-Means** | –ë—ã—Å—Ç—Ä—ã–π, –ø—Ä–æ—Å—Ç–æ–π, —Ö–æ—Ä–æ—à–æ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç—Å—è | –ù—É–∂–Ω–æ –∑–Ω–∞—Ç—å K –∑–∞—Ä–∞–Ω–µ–µ, —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω –∫ –≤—ã–±—Ä–æ—Å–∞–º, —Ç–æ–ª—å–∫–æ —Å—Ñ–µ—Ä–∏—á–µ—Å–∫–∏–µ –∫–ª–∞—Å—Ç–µ—Ä—ã | ‚úÖ **–î–ê** (—É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è) |
| **DBSCAN** | –ù–∞—Ö–æ–¥–∏—Ç –∫–ª–∞—Å—Ç–µ—Ä—ã –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω–æ–π —Ñ–æ—Ä–º—ã, –Ω–∞—Ö–æ–¥–∏—Ç –≤—ã–±—Ä–æ—Å—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ | –°–ª–æ–∂–Ω–æ –ø–æ–¥–æ–±—Ä–∞—Ç—å eps –∏ min_samples, –ø–ª–æ—Ö–æ —Å —Ä–∞–∑–Ω–æ–π –ø–ª–æ—Ç–Ω–æ—Å—Ç—å—é | ‚ö†Ô∏è **–í–û–ó–ú–û–ñ–ù–û** |
| **Hierarchical** | –ù–µ –Ω—É–∂–Ω–æ –∑–Ω–∞—Ç—å K, –¥–µ–Ω–¥—Ä–æ–≥—Ä–∞–º–º–∞ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ | –ú–µ–¥–ª–µ–Ω–Ω—ã–π O(n¬≥), —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω –∫ —à—É–º—É | ‚úÖ **–î–ê** (–¥–ª—è –∞–Ω–∞–ª–∏–∑–∞) |
| **GMM** | –ú—è–≥–∫–∞—è –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è (–≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏), —ç–ª–ª–∏–ø—Å–æ–∏–¥–Ω—ã–µ –∫–ª–∞—Å—Ç–µ—Ä—ã | –ú–µ–¥–ª–µ–Ω–Ω–µ–µ K-Means, –º–æ–∂–µ—Ç –ø–µ—Ä–µ–æ–±—É—á–∏—Ç—å—Å—è | ‚úÖ **–î–ê** (—Ö–æ—Ä–æ—à–∞—è –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞) |
| **Agglomerative** | –ò–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∏–π, —Å—Ç–∞–±–∏–ª—å–Ω—ã–π | –¢—Ä–µ–±—É–µ—Ç –ø–∞–º—è—Ç–∏ O(n¬≤) | ‚úÖ **–î–ê** |
| **OPTICS** | –õ—É—á—à–µ DBSCAN –¥–ª—è —Ä–∞–∑–Ω–æ–π –ø–ª–æ—Ç–Ω–æ—Å—Ç–∏ | –°–ª–æ–∂–Ω–µ–µ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä–æ–≤–∞—Ç—å | ‚ö†Ô∏è **–í–û–ó–ú–û–ñ–ù–û** |

---

### üñºÔ∏è Computer Vision (CV) –º–µ—Ç–æ–¥—ã –¥–ª—è —Ñ–æ—Ä–º

#### –ü–æ—á–µ–º—É CV –º–µ—Ç–æ–¥—ã —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã:

**–§–æ—Ä–º—ã "–±—É–≥—Ä–æ–≤" MACD –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º—ã - —ç—Ç–æ –≤–∏–∑—É–∞–ª—å–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã!**
- –ö–∞–∂–¥–∞—è –∑–æ–Ω–∞ = –≤–∏–∑—É–∞–ª—å–Ω–∞—è —Ñ–æ—Ä–º–∞ –≥—Ä–∞—Ñ–∏–∫–∞
- –¢—Ä–µ–π–¥–µ—Ä—ã –≤–∏–∑—É–∞–ª—å–Ω–æ —Ä–∞–∑–ª–∏—á–∞—é—Ç –ø–∞—Ç—Ç–µ—Ä–Ω—ã
- CV –º–µ—Ç–æ–¥—ã –º–æ–≥—É—Ç –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å —ç—Ç–æ

---

#### 5. **Contour Analysis & Shape Descriptors** ‚úÖ (–æ—á–µ–Ω—å –ø–µ—Ä—Å–ø–µ–∫—Ç–∏–≤–Ω–æ!)

**–ò–¥–µ—è:** –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å –≤—Ä–µ–º–µ–Ω–Ω–æ–π —Ä—è–¥ –≤ –∫–æ–Ω—Ç—É—Ä –∏ –∏–∑–≤–ª–µ—á—å –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä—ã —Ñ–æ—Ä–º—ã

**–ú–µ—Ç–æ–¥—ã:**

##### a) Hu Moments (–∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã –º–æ–º–µ–Ω—Ç–æ–≤)
```python
import cv2
import numpy as np

def extract_hu_moments(zone_data):
    # 1. –ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—é
    hist = zone_data['macd_hist'].values
    hist_normalized = ((hist - hist.min()) / (hist.max() - hist.min()) * 255).astype(np.uint8)
    
    # 2. –°–æ–∑–¥–∞—Ç—å –±–∏–Ω–∞—Ä–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
    img = np.zeros((100, len(hist)), dtype=np.uint8)
    for i, val in enumerate(hist_normalized):
        img[100-val:100, i] = 255
    
    # 3. –ù–∞–π—Ç–∏ –∫–æ–Ω—Ç—É—Ä
    contours, _ = cv2.findContours(img, cv2.RETR_EXTERNAL, cv2.CHAIN_APPROX_SIMPLE)
    
    # 4. –†–∞—Å—Å—á–∏—Ç–∞—Ç—å Hu –º–æ–º–µ–Ω—Ç—ã (7 –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç–æ–≤)
    moments = cv2.moments(contours[0])
    hu_moments = cv2.HuMoments(moments).flatten()
    
    return hu_moments  # 7 —á–∏—Å–µ–ª, –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç–Ω—ã—Ö –∫ –º–∞—Å—à—Ç–∞–±—É, –ø–æ–≤–æ—Ä–æ—Ç—É, –æ—Ç—Ä–∞–∂–µ–Ω–∏—é
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ò–Ω–≤–∞—Ä–∏–∞–Ω—Ç–Ω—ã –∫ –º–∞—Å—à—Ç–∞–±—É (–¥–ª–∏–Ω–∞ –∑–æ–Ω—ã –Ω–µ –≤–∞–∂–Ω–∞)
- ‚úÖ –ò–Ω–≤–∞—Ä–∏–∞–Ω—Ç–Ω—ã –∫ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–º—É —Å–¥–≤–∏–≥—É
- ‚úÖ 7 –∫–æ–º–ø–∞–∫—Ç–Ω—ã—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤
- ‚úÖ –•–æ—Ä–æ—à–æ —Ä–∞–±–æ—Ç–∞—é—Ç –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è —Ñ–æ—Ä–º

**–î–ª—è —Ñ–æ—Ä–º –±—É–≥—Ä–æ–≤:** –û—Ç–ª–∏—á–Ω–æ! –ú–æ–≥—É—Ç —Ä–∞–∑–ª–∏—á–∞—Ç—å "–æ—Å—Ç—Ä—ã–π –ø–∏–∫" vs "–ø–ª–æ—Å–∫–∞—è –≤–æ–ª–Ω–∞" –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç —Ä–∞–∑–º–µ—Ä–∞.

---

##### b) Zernike Moments
```python
import mahotas

def extract_zernike_moments(zone_data, radius=8):
    # –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å –≤ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ (–∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ –≤—ã—à–µ)
    img = render_zone_as_image(zone_data)
    
    # –†–∞—Å—Å—á–∏—Ç–∞—Ç—å Zernike –º–æ–º–µ–Ω—Ç—ã
    zernike = mahotas.features.zernike_moments(img, radius)
    
    return zernike  # 25+ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç radius)
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ï—â–µ –±–æ–ª–µ–µ –º–æ—â–Ω—ã–µ —á–µ–º Hu Moments
- ‚úÖ –û—Ä—Ç–æ–≥–æ–Ω–∞–ª—å–Ω—ã–µ (–Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏)
- ‚úÖ –•–æ—Ä–æ—à–æ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç —Ñ–æ—Ä–º—É

**–ú–∏–Ω—É—Å—ã:**
- ‚ö†Ô∏è –ú–µ–¥–ª–µ–Ω–Ω–µ–µ —á–µ–º Hu Moments
- ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç –±–∏–±–ª–∏–æ—Ç–µ–∫—É mahotas

---

#### 6. **Dynamic Time Warping (DTW)** ‚úÖ‚úÖ (–û–ß–ï–ù–¨ —Ä–µ–∫–æ–º–µ–Ω–¥—É—é!)

**–ò–¥–µ—è:** –ò–∑–º–µ—Ä–∏—Ç—å "—Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ" –º–µ–∂–¥—É –¥–≤—É–º—è –≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ —Ä—è–¥–∞–º–∏, —É—á–∏—Ç—ã–≤–∞—è –≤–æ–∑–º–æ–∂–Ω–æ–µ —Ä–∞—Å—Ç—è–∂–µ–Ω–∏–µ –ø–æ –≤—Ä–µ–º–µ–Ω–∏

```python
from dtaidistance import dtw

def cluster_zones_with_dtw(zones_list):
    # 1. –ò–∑–≤–ª–µ—á—å –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º—ã
    histograms = [zone['macd_hist'].values for zone in zones_list]
    
    # 2. –ü–æ—Å—Ç—Ä–æ–∏—Ç—å –º–∞—Ç—Ä–∏—Ü—É —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–π DTW
    distance_matrix = dtw.distance_matrix_fast(histograms)
    
    # 3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å –ª—é–±—ã–º –∞–ª–≥–æ—Ä–∏—Ç–º–æ–º –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏
    from sklearn.cluster import AgglomerativeClustering
    clusterer = AgglomerativeClustering(
        n_clusters=4, 
        affinity='precomputed',
        linkage='average'
    )
    labels = clusterer.fit_predict(distance_matrix)
    
    return labels
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –¥–ª—è —Ñ–æ—Ä–º:**
- ‚úÖ‚úÖ **–ò–î–ï–ê–õ–¨–ù–û –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ä—è–¥–æ–≤ —Ä–∞–∑–Ω–æ–π –¥–ª–∏–Ω—ã**
- ‚úÖ –ù–∞—Ö–æ–¥–∏—Ç –ø–æ—Ö–æ–∂–∏–µ —Ñ–æ—Ä–º—ã –¥–∞–∂–µ –µ—Å–ª–∏ —Ä–∞—Å—Ç—è–Ω—É—Ç—ã/—Å–∂–∞—Ç—ã –ø–æ –≤—Ä–µ–º–µ–Ω–∏
- ‚úÖ –ò–Ω—Ç—É–∏—Ç–∏–≤–Ω–æ –ø–æ–Ω—è—Ç–Ω–æ: "—ç—Ç–∏ –¥–≤–∞ –±—É–≥—Ä–∞ –ø–æ—Ö–æ–∂–∏ –ø–æ —Ñ–æ—Ä–º–µ"
- ‚úÖ –ù–µ –Ω—É–∂–Ω–∞ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª–∏–Ω—ã

**–ü—Ä–∏–º–µ—Ä:**
```
Zone 1: ___/\___  (20 –±–∞—Ä–æ–≤)
Zone 2: ___/\___  (30 –±–∞—Ä–æ–≤)
DTW: "–≠—Ç–∏ —Ñ–æ—Ä–º—ã –∏–¥–µ–Ω—Ç–∏—á–Ω—ã!" (–Ω–µ—Å–º–æ—Ç—Ä—è –Ω–∞ —Ä–∞–∑–Ω—É—é –¥–ª–∏–Ω—É)
```

**–î–ª—è –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏:** –°–Ω–∞—á–∞–ª–∞ DTW distance matrix, –ø–æ—Ç–æ–º Hierarchical clustering.

---

#### 7. **Template Matching** ‚úÖ (–¥–ª—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤)

**–ò–¥–µ—è:** –°–æ–∑–¥–∞—Ç—å —à–∞–±–ª–æ–Ω—ã —ç—Ç–∞–ª–æ–Ω–Ω—ã—Ö —Ñ–æ—Ä–º –∏ –∏—Å–∫–∞—Ç—å –ø–æ—Ö–æ–∂–∏–µ

```python
import numpy as np
from scipy.spatial.distance import correlation

# –≠—Ç–∞–ª–æ–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã
templates = {
    'sharp_early': [0, 1, 5, 10, 8, 4, 2, 1, 0],  # –†–µ–∑–∫–∏–π —Ä–∞–Ω–Ω–∏–π –ø–∏–∫
    'smooth_trend': [0, 2, 4, 6, 8, 7, 5, 3, 1],  # –ü–ª–∞–≤–Ω—ã–π —Ç—Ä–µ–Ω–¥
    'late_wave': [0, 1, 2, 3, 5, 8, 10, 9, 5]     # –ü–æ–∑–¥–Ω—è—è –≤–æ–ª–Ω–∞
}

def classify_zone_by_template(zone_hist):
    # –ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å –¥–ª–∏–Ω—É –∑–æ–Ω—ã –∫ –¥–ª–∏–Ω–µ —à–∞–±–ª–æ–Ω–∞
    normalized = np.interp(
        np.linspace(0, len(zone_hist), len(templates['sharp_early'])),
        np.arange(len(zone_hist)),
        zone_hist
    )
    
    # –ù–∞–π—Ç–∏ –Ω–∞–∏–±–æ–ª–µ–µ –ø–æ—Ö–æ–∂–∏–π —à–∞–±–ª–æ–Ω
    best_match = None
    best_score = float('inf')
    
    for name, template in templates.items():
        distance = correlation(normalized, template)
        if distance < best_score:
            best_score = distance
            best_match = name
    
    return best_match, best_score
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä—É–µ–º–æ: "–ó–æ–Ω–∞ –ø–æ—Ö–æ–∂–∞ –Ω–∞ —à–∞–±–ª–æ–Ω X —Å –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–º Y"
- ‚úÖ –ú–æ–∂–Ω–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å —à–∞–±–ª–æ–Ω—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ —ç–∫—Å–ø–µ—Ä—Ç–Ω–æ–≥–æ –∑–Ω–∞–Ω–∏—è
- ‚úÖ –ë—ã—Å—Ç—Ä–æ

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:** –ù–µ –¥–ª—è –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏, –∞ –¥–ª—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø–æ –∏–∑–≤–µ—Å—Ç–Ω—ã–º –ø–∞—Ç—Ç–µ—Ä–Ω–∞–º.

---

#### 8. **Convolutional Neural Networks (CNN)** ‚ö†Ô∏è (–µ—Å–ª–∏ –º–Ω–æ–≥–æ –¥–∞–Ω–Ω—ã—Ö)

**–ò–¥–µ—è:** –û–±—É—á–∏—Ç—å –Ω–µ–π—Ä–æ—Å–µ—Ç—å —Ä–∞–∑–ª–∏—á–∞—Ç—å —Ñ–æ—Ä–º—ã

```python
import tensorflow as tf

def create_shape_classifier():
    model = tf.keras.Sequential([
        # –í—Ö–æ–¥: –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∑–æ–Ω—ã 64x64
        tf.keras.layers.Conv2D(32, (3, 3), activation='relu', input_shape=(64, 64, 1)),
        tf.keras.layers.MaxPooling2D((2, 2)),
        tf.keras.layers.Conv2D(64, (3, 3), activation='relu'),
        tf.keras.layers.MaxPooling2D((2, 2)),
        tf.keras.layers.Flatten(),
        tf.keras.layers.Dense(128, activation='relu'),
        tf.keras.layers.Dense(4, activation='softmax')  # 4 –∫–ª–∞—Å—Å–∞ —Ñ–æ—Ä–º
    ])
    
    return model

# –û–±—É—á–µ–Ω–∏–µ
model = create_shape_classifier()
model.compile(optimizer='adam', loss='categorical_crossentropy', metrics=['accuracy'])
model.fit(zone_images, zone_labels, epochs=50)
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ú–æ–∂–µ—Ç –≤—ã—É—á–∏—Ç—å —Å–ª–æ–∂–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã
- ‚úÖ SOTA –¥–ª—è image classification

**–ú–∏–Ω—É—Å—ã:**
- ‚ùå –ù—É–∂–Ω–æ –º–Ω–æ–≥–æ –¥–∞–Ω–Ω—ã—Ö (—Ç—ã—Å—è—á–∏ –∑–æ–Ω)
- ‚ùå –¢—Ä–µ–±—É–µ—Ç —Ä–∞–∑–º–µ—Ç–∫–∏ (supervised learning)
- ‚ùå "–ß–µ—Ä–Ω—ã–π —è—â–∏–∫"
- ‚ùå –ò–∑–±—ã—Ç–æ—á–µ–Ω –¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö —Ñ–æ—Ä–º

**–í—ã–≤–æ–¥:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏:
- –ï—Å—Ç—å >10,000 —Ä–∞–∑–º–µ—á–µ–Ω–Ω—ã—Ö –∑–æ–Ω
- –ü—Ä–æ—Å—Ç—ã–µ –º–µ—Ç–æ–¥—ã –Ω–µ –¥–∞—é—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç
- –ù—É–∂–Ω–∞ –≤—ã—Å–æ–∫–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å

---

#### 9. **Siamese Networks –¥–ª—è Similarity Learning** ‚ö†Ô∏è (–ø—Ä–æ–¥–≤–∏–Ω—É—Ç–æ)

**–ò–¥–µ—è:** –û–±—É—á–∏—Ç—å —Å–µ—Ç—å –æ–ø—Ä–µ–¥–µ–ª—è—Ç—å "–ø–æ—Ö–æ–∂–µ—Å—Ç—å" –¥–≤—É—Ö –∑–æ–Ω

```python
def create_siamese_network():
    # –ë–∞–∑–æ–≤–∞—è —Å–µ—Ç—å –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –ø—Ä–∏–∑–Ω–∞–∫–æ–≤
    base_network = tf.keras.Sequential([
        tf.keras.layers.Conv1D(64, 3, activation='relu', input_shape=(100, 1)),
        tf.keras.layers.MaxPooling1D(2),
        tf.keras.layers.Conv1D(128, 3, activation='relu'),
        tf.keras.layers.GlobalAveragePooling1D(),
        tf.keras.layers.Dense(64, activation='relu')
    ])
    
    # Siamese –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
    input_a = tf.keras.Input(shape=(100, 1))
    input_b = tf.keras.Input(shape=(100, 1))
    
    embedding_a = base_network(input_a)
    embedding_b = base_network(input_b)
    
    # –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É —ç–º–±–µ–¥–¥–∏–Ω–≥–∞–º–∏
    distance = tf.keras.layers.Lambda(
        lambda x: tf.abs(x[0] - x[1])
    )([embedding_a, embedding_b])
    
    output = tf.keras.layers.Dense(1, activation='sigmoid')(distance)
    
    model = tf.keras.Model(inputs=[input_a, input_b], outputs=output)
    
    return model
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
1. –û–±—É—á–∏—Ç—å –Ω–∞ –ø–∞—Ä–∞—Ö –ø–æ—Ö–æ–∂–∏—Ö/–Ω–µ–ø–æ—Ö–æ–∂–∏—Ö –∑–æ–Ω
2. –ò–∑–≤–ª–µ—á—å —ç–º–±–µ–¥–¥–∏–Ω–≥–∏ –¥–ª—è –≤—Å–µ—Ö –∑–æ–Ω
3. –ö–ª–∞—Å—Ç–µ—Ä–∏–∑–æ–≤–∞—Ç—å —ç–º–±–µ–¥–¥–∏–Ω–≥–∏ (K-Means, Hierarchical)

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã—É—á–∏–≤–∞–µ—Ç –º–µ—Ç—Ä–∏–∫—É –ø–æ—Ö–æ–∂–µ—Å—Ç–∏
- ‚úÖ –≠–º–±–µ–¥–¥–∏–Ω–≥–∏ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏

**–ú–∏–Ω—É—Å—ã:**
- ‚ùå –ù—É–∂–Ω–æ –º–Ω–æ–≥–æ –¥–∞–Ω–Ω—ã—Ö
- ‚ùå –°–ª–æ–∂–Ω–æ—Å—Ç—å –æ–±—É—á–µ–Ω–∏—è

---

#### 10. **Image-based Features + Traditional ML** ‚úÖ (hybrid –ø–æ–¥—Ö–æ–¥)

**–ò–¥–µ—è:** –†–µ–Ω–¥–µ—Ä–∏—Ç—å –∑–æ–Ω—É –∫–∞–∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏ –∏–∑–≤–ª–µ–∫–∞—Ç—å –ø—Ä–∏–∑–Ω–∞–∫–∏

```python
import matplotlib.pyplot as plt
from skimage import feature, io
import numpy as np

def extract_image_features(zone_data):
    # 1. –†–µ–Ω–¥–µ—Ä–∏—Ç—å –∑–æ–Ω—É –∫–∞–∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
    fig, ax = plt.subplots(figsize=(6, 4))
    ax.plot(zone_data['macd_hist'])
    ax.fill_between(range(len(zone_data)), zone_data['macd_hist'], alpha=0.3)
    ax.axis('off')
    
    # –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –±—É—Ñ–µ—Ä
    fig.canvas.draw()
    img = np.frombuffer(fig.canvas.tostring_rgb(), dtype=np.uint8)
    img = img.reshape(fig.canvas.get_width_height()[::-1] + (3,))
    plt.close(fig)
    
    # 2. –ò–∑–≤–ª–µ—á—å –ø—Ä–∏–∑–Ω–∞–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
    gray = cv2.cvtColor(img, cv2.COLOR_RGB2GRAY)
    
    # HOG (Histogram of Oriented Gradients)
    hog_features = feature.hog(gray, pixels_per_cell=(16, 16))
    
    # LBP (Local Binary Patterns)
    lbp = feature.local_binary_pattern(gray, P=8, R=1, method='uniform')
    lbp_hist, _ = np.histogram(lbp.ravel(), bins=59, range=(0, 59))
    lbp_hist = lbp_hist.astype(float) / lbp_hist.sum()
    
    # –û–±—ä–µ–¥–∏–Ω–∏—Ç—å –ø—Ä–∏–∑–Ω–∞–∫–∏
    features = np.concatenate([hog_features, lbp_hist])
    
    return features

# –ó–∞—Ç–µ–º –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–æ–≤–∞—Ç—å —ç—Ç–∏ –ø—Ä–∏–∑–Ω–∞–∫–∏
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –±–æ–≥–∞—Ç—ã–π –∞—Ä—Å–µ–Ω–∞–ª CV –º–µ—Ç–æ–¥–æ–≤
- ‚úÖ HOG –æ—Ç–ª–∏—á–Ω–æ –¥–ª—è —Ç–µ–∫—Å—Ç—É—Ä –∏ —Ñ–æ—Ä–º
- ‚úÖ LBP –¥–ª—è –ª–æ–∫–∞–ª—å–Ω—ã—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤

**–ú–∏–Ω—É—Å—ã:**
- ‚ö†Ô∏è Overhead —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞
- ‚ö†Ô∏è –ó–∞–≤–∏—Å–∏—Ç –æ—Ç —Ä–∞–∑–º–µ—Ä–∞/—Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è

---

### üìä –°—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ CV –º–µ—Ç–æ–¥–æ–≤

| –ú–µ—Ç–æ–¥ | –°–ª–æ–∂–Ω–æ—Å—Ç—å | –î–∞–Ω–Ω—ã—Ö –Ω—É–∂–Ω–æ | –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å | –î–ª—è —Ñ–æ—Ä–º –±—É–≥—Ä–æ–≤ |
|-------|-----------|--------------|-------------------|-----------------|
| **Hu Moments** | –ù–∏–∑–∫–∞—è | –ú–∞–ª–æ | –°—Ä–µ–¥–Ω—è—è | ‚úÖ‚úÖ –û—Ç–ª–∏—á–Ω–æ |
| **Zernike Moments** | –°—Ä–µ–¥–Ω—è—è | –ú–∞–ª–æ | –ù–∏–∑–∫–∞—è | ‚úÖ –•–æ—Ä–æ—à–æ |
| **DTW** | –ù–∏–∑–∫–∞—è | –ú–∞–ª–æ | –í—ã—Å–æ–∫–∞—è | ‚úÖ‚úÖ‚úÖ –ò–î–ï–ê–õ–¨–ù–û |
| **Template Matching** | –ù–∏–∑–∫–∞—è | –ú–∞–ª–æ (—à–∞–±–ª–æ–Ω—ã) | –û—á–µ–Ω—å –≤—ã—Å–æ–∫–∞—è | ‚úÖ –•–æ—Ä–æ—à–æ –¥–ª—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏ |
| **CNN** | –í—ã—Å–æ–∫–∞—è | –ú–Ω–æ–≥–æ (10k+) | –ù–∏–∑–∫–∞—è | ‚ö†Ô∏è –ò–∑–±—ã—Ç–æ—á–Ω–æ |
| **Siamese Networks** | –í—ã—Å–æ–∫–∞—è | –ú–Ω–æ–≥–æ | –ù–∏–∑–∫–∞—è | ‚ö†Ô∏è –ò–∑–±—ã—Ç–æ—á–Ω–æ |
| **Image Features (HOG/LBP)** | –°—Ä–µ–¥–Ω—è—è | –°—Ä–µ–¥–Ω–µ | –°—Ä–µ–¥–Ω—è—è | ‚úÖ –•–æ—Ä–æ—à–æ |

---

### üéØ CV –º–µ—Ç–æ–¥—ã - —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

#### –õ—É—á—à–∏–µ –¥–ª—è —Ñ–æ—Ä–º –±—É–≥—Ä–æ–≤:

1. **Dynamic Time Warping (DTW)** ‚≠ê‚≠ê‚≠ê
   - **–°–ê–ú–´–ô –†–ï–ö–û–ú–ï–ù–î–£–ï–ú–´–ô**
   - –°–ø–µ—Ü–∏–∞–ª—å–Ω–æ —Å–æ–∑–¥–∞–Ω –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ä—è–¥–æ–≤
   - –†–∞–±–æ—Ç–∞–µ—Ç —Å —Ä–∞–∑–Ω–æ–π –¥–ª–∏–Ω–æ–π –∑–æ–Ω
   - –ò–Ω—Ç—É–∏—Ç–∏–≤–Ω–æ –ø–æ–Ω—è—Ç–Ω–æ

2. **Hu Moments** ‚≠ê‚≠ê
   - –ü—Ä–æ—Å—Ç–æ–π –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–π
   - 7 –∫–æ–º–ø–∞–∫—Ç–Ω—ã—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤
   - –ò–Ω–≤–∞—Ä–∏–∞–Ω—Ç–Ω–æ—Å—Ç—å –∫ –º–∞—Å—à—Ç–∞–±—É
   - –õ–µ–≥–∫–æ –¥–æ–±–∞–≤–∏—Ç—å –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –º–µ—Ç—Ä–∏–∫–∞–º

3. **Template Matching** ‚≠ê
   - –î–ª—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏ (–Ω–µ –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏)
   - –ï—Å–ª–∏ –µ—Å—Ç—å –∏–∑–≤–µ—Å—Ç–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã
   - –û—á–µ–Ω—å –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä—É–µ–º–æ

#### –ù–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è (–ø–æ–∫–∞):

- **CNN / Siamese** - –∏–∑–±—ã—Ç–æ—á–Ω—ã, –Ω—É–∂–Ω–æ –º–Ω–æ–≥–æ –¥–∞–Ω–Ω—ã—Ö
- **Image-based (HOG/LBP)** - overhead —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞

---

### üî® –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

#### –®–∞–≥ 1: –î–æ–±–∞–≤–∏—Ç—å DTW –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É

```python
# bquant/analysis/zones/strategies/shape/dtw_shape.py

from dtaidistance import dtw
import numpy as np
from dataclasses import dataclass

@StrategyRegistry.register_shape_strategy('dtw')
@dataclass
class DTWShapeStrategy:
    """Shape analysis using Dynamic Time Warping distance."""
    
    reference_templates: dict = None  # –≠—Ç–∞–ª–æ–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã
    
    def calculate(self, zone_data):
        hist = zone_data['macd_hist'].values
        
        # –í—ã—á–∏—Å–ª–∏—Ç—å DTW —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è –¥–æ —ç—Ç–∞–ª–æ–Ω–æ–≤
        distances = {}
        for name, template in self.reference_templates.items():
            dist = dtw.distance(hist, template)
            distances[f'dtw_to_{name}'] = dist
        
        # –ù–∞–π—Ç–∏ –±–ª–∏–∂–∞–π—à–∏–π —ç—Ç–∞–ª–æ–Ω
        closest_template = min(distances, key=distances.get)
        closest_distance = distances[closest_template]
        
        # –í–µ—Ä–Ω—É—Ç—å –∫–∞–∫ ShapeMetrics (—Ä–∞—Å—à–∏—Ä–∏—Ç—å –¥–ª—è DTW —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–π)
        return ShapeMetrics(
            hist_skewness=0.0,  # DTW –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç
            hist_kurtosis=0.0,   # DTW –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç
            hist_smoothness=None,
            strategy_name='dtw',
            strategy_params={
                'closest_template': closest_template,
                'closest_distance': closest_distance,
                **distances  # –í—Å–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è
            }
        )
```

#### –®–∞–≥ 2: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å DTW –¥–ª—è –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏

```python
# –í ZoneSequenceAnalyzer –∏–ª–∏ –Ω–æ–≤–æ–º –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä–µ

def cluster_zones_dtw(self, zones_list, n_clusters=4):
    """Cluster zones using DTW distance matrix."""
    from dtaidistance import dtw
    from sklearn.cluster import AgglomerativeClustering
    
    # 1. –ò–∑–≤–ª–µ—á—å –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º—ã
    histograms = [z.metadata['hist_values'] for z in zones_list]
    
    # 2. –ü–æ—Å—Ç—Ä–æ–∏—Ç—å –º–∞—Ç—Ä–∏—Ü—É —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–π
    distance_matrix = dtw.distance_matrix_fast(histograms)
    
    # 3. Hierarchical clustering
    clusterer = AgglomerativeClustering(
        n_clusters=n_clusters,
        affinity='precomputed',
        linkage='average'
    )
    labels = clusterer.fit_predict(distance_matrix)
    
    return labels
```

---

### üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è —Ñ–æ—Ä–º "–±—É–≥—Ä–æ–≤":

#### 1. **K-Means** (—Ç–µ–∫—É—â–∏–π) ‚úÖ
**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
- –ï—Å—Ç—å –≥–∏–ø–æ—Ç–µ–∑–∞ –æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ –∞—Ä—Ö–µ—Ç–∏–ø–æ–≤ (3-5)
- –ù—É–∂–Ω–∞ —Å–∫–æ—Ä–æ—Å—Ç—å
- –ü—Ä–∏–∑–Ω–∞–∫–∏ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω—ã

**–î–ª—è —Ñ–æ—Ä–º –±—É–≥—Ä–æ–≤:**
```python
features = [
    'hist_skewness',      # -2 –¥–æ 2
    'hist_kurtosis',      # 1 –¥–æ 10
    'hist_smoothness',    # 0 –¥–æ 1
    'duration',           # 10 –¥–æ 200 –±–∞—Ä–æ–≤
    'max_price_change'    # %
]
# –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞!
# K = 3-5 –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ
```

**–ê—Ä—Ö–µ—Ç–∏–ø—ã:**
- –ö–ª–∞—Å—Ç–µ—Ä 1: Sharp Early Impulse (skew>0, kurt>5)
- –ö–ª–∞—Å—Ç–µ—Ä 2: Smooth Trend (skew‚âà0, kurt<3)
- –ö–ª–∞—Å—Ç–µ—Ä 3: Late Wave (skew<0)

---

#### 2. **Hierarchical Clustering** ‚úÖ (—Ä–µ–∫–æ–º–µ–Ω–¥—É—é –¥–æ–±–∞–≤–∏—Ç—å)

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –¥–ª—è –≤–∞—à–µ–π –∑–∞–¥–∞—á–∏:**
- **–ù–µ –Ω—É–∂–Ω–æ –∑–Ω–∞—Ç—å K –∑–∞—Ä–∞–Ω–µ–µ** - –º–æ–∂–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –¥–µ–Ω–¥—Ä–æ–≥—Ä–∞–º–º—É
- **–ò—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑** - –ø–æ–Ω—è—Ç—å –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—É—é –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫—É
- **–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å** - –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Å—Ç–∏—á–µ–Ω (–≤ –æ—Ç–ª–∏—á–∏–µ –æ—Ç K-Means —Å random init)

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```python
from scipy.cluster.hierarchy import dendrogram, linkage
from sklearn.cluster import AgglomerativeClustering

# 1. –ü–æ—Å—Ç—Ä–æ–∏—Ç—å –¥–µ–Ω–¥—Ä–æ–≥—Ä–∞–º–º—É (–∞–Ω–∞–ª–∏–∑)
linkage_matrix = linkage(features, method='ward')
dendrogram(linkage_matrix)
# –í–∏–∑—É–∞–ª—å–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–µ K

# 2. –ö–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è —Å –≤—ã–±—Ä–∞–Ω–Ω—ã–º K
clusterer = AgglomerativeClustering(n_clusters=4, linkage='ward')
labels = clusterer.fit_predict(features)
```

**–î–ª—è —Ñ–æ—Ä–º:** –û—á–µ–Ω—å —Ö–æ—Ä–æ—à–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∏–µ—Ä–∞—Ä—Ö–∏—é –ø–æ—Ö–æ–∂–µ—Å—Ç–∏:
- –£—Ä–æ–≤–µ–Ω—å 1: Bull vs Bear
- –£—Ä–æ–≤–µ–Ω—å 2: Early vs Late impulse
- –£—Ä–æ–≤–µ–Ω—å 3: Sharp vs Smooth

---

#### 3. **GMM (Gaussian Mixture Models)** ‚úÖ

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- **–ú—è–≥–∫–∞—è –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è** - –∫–∞–∂–¥–∞—è –∑–æ–Ω–∞ –º–æ–∂–µ—Ç –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∞—Ç—å –∫ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º –∫–ª–∞—Å—Ç–µ—Ä–∞–º —Å –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—è–º–∏
- **–≠–ª–ª–∏–ø—Å–æ–∏–¥–Ω—ã–µ –∫–ª–∞—Å—Ç–µ—Ä—ã** - –ª—É—á—à–µ –¥–ª—è —Ñ–æ—Ä–º (–Ω–µ —Ç–æ–ª—å–∫–æ —Å—Ñ–µ—Ä—ã)
- **Model selection** - BIC/AIC –¥–ª—è –≤—ã–±–æ—Ä–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```python
from sklearn.mixture import GaussianMixture

# –ü–æ–¥–±–æ—Ä K —á–µ—Ä–µ–∑ BIC
bic_scores = []
for k in range(2, 10):
    gmm = GaussianMixture(n_components=k, random_state=42)
    gmm.fit(features)
    bic_scores.append(gmm.bic(features))

optimal_k = np.argmin(bic_scores) + 2

# –ö–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è
gmm = GaussianMixture(n_components=optimal_k)
labels = gmm.fit_predict(features)
probabilities = gmm.predict_proba(features)  # –ú—è–≥–∫–∏–µ –º–µ—Ç–∫–∏!
```

**–î–ª—è —Ñ–æ—Ä–º:** –û—Ç–ª–∏—á–Ω–æ - —Ñ–æ—Ä–º—ã –Ω–µ –≤—Å–µ–≥–¥–∞ —á–µ—Ç–∫–æ —Ä–∞–∑–¥–µ–ª–µ–Ω—ã, –ø–µ—Ä–µ—Ö–æ–¥–Ω—ã–µ —Å–ª—É—á–∞–∏ –ø–æ–ª—É—á–∞—Ç —Å–º–µ—à–∞–Ω–Ω—ã–µ –º–µ—Ç–∫–∏.

---

#### 4. **DBSCAN** ‚ö†Ô∏è (–æ—Å—Ç–æ—Ä–æ–∂–Ω–æ)

**–ö–æ–≥–¥–∞ –º–æ–∂–µ—Ç –ø–æ–º–æ—á—å:**
- –ï—Å—Ç—å **–≤—ã–±—Ä–æ—Å—ã** (–∞–Ω–æ–º–∞–ª—å–Ω—ã–µ —Ñ–æ—Ä–º—ã –±—É–≥—Ä–æ–≤)
- –ö–ª–∞—Å—Ç–µ—Ä—ã **–ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω–æ–π —Ñ–æ—Ä–º—ã** (–Ω–µ —ç–ª–ª–∏–ø—Å—ã)
- –ù–µ –∑–Ω–∞–µ–º K

**–ü—Ä–æ–±–ª–µ–º—ã –¥–ª—è —Ñ–æ—Ä–º:**
- –°–ª–æ–∂–Ω–æ –ø–æ–¥–æ–±—Ä–∞—Ç—å `eps` (radius)
- –ü–ª–æ—Ö–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –µ—Å–ª–∏ —Ä–∞–∑–Ω–∞—è "–ø–ª–æ—Ç–Ω–æ—Å—Ç—å" –∞—Ä—Ö–µ—Ç–∏–ø–æ–≤
- –ú–æ–∂–µ—Ç –≤—Å–µ –∑–∞–ø–∏—Å–∞—Ç—å –≤ —à—É–º

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```python
from sklearn.cluster import DBSCAN

# –°–ª–æ–∂–Ω–æ –ø–æ–¥–æ–±—Ä–∞—Ç—å eps!
eps_values = np.linspace(0.5, 5.0, 20)
for eps in eps_values:
    clusterer = DBSCAN(eps=eps, min_samples=5)
    labels = clusterer.fit_predict(features)
    n_clusters = len(set(labels)) - (1 if -1 in labels else 0)
    print(f"eps={eps:.2f}: {n_clusters} clusters")
```

**–í—ã–≤–æ–¥:** –î–ª—è —Ñ–æ—Ä–º DBSCAN –∏–∑–±—ã—Ç–æ—á–µ–Ω, —Å–ª–æ–∂–µ–Ω –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ.

---

### üî• Multi-Strategy –ø–æ–¥—Ö–æ–¥ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

#### –≠—Ç–∞–ø 1: –ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ (Hierarchical)
```python
# –ü–æ–Ω—è—Ç—å –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—É—é –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫—É
linkage_matrix = linkage(features, method='ward')
dendrogram(linkage_matrix)
# –†–µ–∑—É–ª—å—Ç–∞—Ç: "–ê–≥–∞, –≤–∏–¥–Ω–æ 4 –æ—Å–Ω–æ–≤–Ω—ã—Ö –≥—Ä—É–ø–ø—ã"
```

#### –≠—Ç–∞–ø 2: Production (K-Means –∏–ª–∏ GMM)
```python
# K-Means –¥–ª—è —Å–∫–æ—Ä–æ—Å—Ç–∏ –∏ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä—É–µ–º–æ—Å—Ç–∏
kmeans = KMeans(n_clusters=4, random_state=42)
labels = kmeans.fit_predict(features)

# –ò–õ–ò GMM –¥–ª—è –º—è–≥–∫–æ–π –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏
gmm = GaussianMixture(n_components=4)
labels = gmm.fit_predict(features)
probabilities = gmm.predict_proba(features)
```

#### –≠—Ç–∞–ø 3: –î–µ—Ç–µ–∫—Ü–∏—è –∞–Ω–æ–º–∞–ª–∏–π (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
```python
# Isolation Forest –¥–ª—è –≤—ã–±—Ä–æ—Å–æ–≤
from sklearn.ensemble import IsolationForest
iso = IsolationForest(contamination=0.05)
anomalies = iso.fit_predict(features)
# –†–µ–∑—É–ª—å—Ç–∞—Ç: –∑–æ–Ω—ã —Å –∞–Ω–æ–º–∞–ª—å–Ω–æ–π —Ñ–æ—Ä–º–æ–π
```

---

## 3. –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### üìê –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏

**–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```python
# ZoneSequenceAnalyzer.cluster_zones() - —É–∂–µ –µ—Å—Ç—å K-Means
```

**–ö–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å –¥—Ä—É–≥–∏–µ –º–µ—Ç–æ–¥—ã:**

#### –í–∞—Ä–∏–∞–Ω—Ç 1: –ü–∞—Ä–∞–º–µ—Ç—Ä method
```python
def cluster_zones(self, zones_data, n_clusters=3, method='kmeans'):
    if method == 'kmeans':
        clusterer = KMeans(n_clusters=n_clusters)
    elif method == 'gmm':
        clusterer = GaussianMixture(n_components=n_clusters)
    elif method == 'hierarchical':
        clusterer = AgglomerativeClustering(n_clusters=n_clusters)
    else:
        raise ValueError(f"Unknown method: {method}")
    
    labels = clusterer.fit_predict(zones_data)
    return labels
```

#### –í–∞—Ä–∏–∞–Ω—Ç 2: Strategy Pattern (–ª—É—á—à–µ!)
```python
# bquant/analysis/zones/clustering_strategies.py

class ClusteringStrategy(Protocol):
    def fit_predict(self, data: np.ndarray) -> np.ndarray: ...

@dataclass
class KMeansClusteringStrategy:
    n_clusters: int = 3
    
    def fit_predict(self, data):
        clusterer = KMeans(n_clusters=self.n_clusters)
        return clusterer.fit_predict(data)

@dataclass
class GMMClusteringStrategy:
    n_components: int = 3
    
    def fit_predict(self, data):
        gmm = GaussianMixture(n_components=self.n_components)
        return gmm.fit_predict(data)

@dataclass
class HierarchicalClusteringStrategy:
    n_clusters: int = 3
    linkage: str = 'ward'
    
    def fit_predict(self, data):
        clusterer = AgglomerativeClustering(
            n_clusters=self.n_clusters,
            linkage=self.linkage
        )
        return clusterer.fit_predict(data)

# –í ZoneSequenceAnalyzer:
def cluster_zones(self, zones_data, strategy: ClusteringStrategy = None):
    if strategy is None:
        strategy = KMeansClusteringStrategy(n_clusters=3)
    
    return strategy.fit_predict(zones_data)
```

**–°–ª–æ–∂–Ω–æ—Å—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω–∏—è:** 1 –Ω–æ–≤—ã–π —Ñ–∞–π–ª, 1 –Ω–æ–≤—ã–π –∫–ª–∞—Å—Å —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏!

---

### üéØ –ò—Ç–æ–≥–æ–≤–∞—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è

#### –î–ª—è —Ñ–æ—Ä–º "–±—É–≥—Ä–æ–≤" –ª—É—á—à–µ –≤—Å–µ–≥–æ:

#### Traditional ML –º–µ—Ç–æ–¥—ã:

1. **K-Means** (—Ç–µ–∫—É—â–∏–π) - –¥–ª—è production
   - ‚úÖ –ë—ã—Å—Ç—Ä–æ
   - ‚úÖ –ü–æ–Ω—è—Ç–Ω–æ
   - ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç

2. **Hierarchical** - –¥–æ–±–∞–≤–∏—Ç—å –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
   - ‚úÖ –ü–æ–º–æ–≥–∞–µ—Ç –Ω–∞–π—Ç–∏ –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–µ K
   - ‚úÖ –î–µ–Ω–¥—Ä–æ–≥—Ä–∞–º–º–∞ –Ω–∞–≥–ª—è–¥–Ω–∞
   - ‚úÖ –î–µ—Ç–µ—Ä–º–∏–Ω–∏—Å—Ç–∏—á–µ–Ω

3. **GMM** - –¥–æ–±–∞–≤–∏—Ç—å –∫–∞–∫ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞
   - ‚úÖ –ú—è–≥–∫–∞—è –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è
   - ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä K (BIC)
   - ‚úÖ –õ—É—á—à–µ –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥–Ω—ã—Ö —Ñ–æ—Ä–º

4. **DBSCAN** - –ù–ï —Ä–µ–∫–æ–º–µ–Ω–¥—É—é
   - ‚ùå –°–ª–æ–∂–µ–Ω –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ
   - ‚ùå –ò–∑–±—ã—Ç–æ—á–µ–Ω –¥–ª—è –∑–∞–¥–∞—á–∏
   - ‚úÖ –õ—É—á—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Isolation Forest –¥–ª—è –∞–Ω–æ–º–∞–ª–∏–π

#### Computer Vision –º–µ—Ç–æ–¥—ã:

1. **DTW (Dynamic Time Warping)** ‚≠ê‚≠ê‚≠ê - –°–ê–ú–´–ô –†–ï–ö–û–ú–ï–ù–î–£–ï–ú–´–ô
   - ‚úÖ‚úÖ‚úÖ –ò–¥–µ–∞–ª—å–Ω–æ –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ä—è–¥–æ–≤
   - ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç —Å —Ä–∞–∑–Ω–æ–π –¥–ª–∏–Ω–æ–π –∑–æ–Ω
   - ‚úÖ –ò–Ω—Ç—É–∏—Ç–∏–≤–Ω–æ –ø–æ–Ω—è—Ç–Ω–∞—è –º–µ—Ç—Ä–∏–∫–∞ –ø–æ—Ö–æ–∂–µ—Å—Ç–∏
   - ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å Hierarchical clustering

2. **Hu Moments** ‚≠ê‚≠ê - –¥–æ–±–∞–≤–∏—Ç—å –∫–∞–∫ –ø—Ä–∏–∑–Ω–∞–∫–∏
   - ‚úÖ 7 –∫–æ–º–ø–∞–∫—Ç–Ω—ã—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ —Ñ–æ—Ä–º—ã
   - ‚úÖ –ò–Ω–≤–∞—Ä–∏–∞–Ω—Ç–Ω–æ—Å—Ç—å –∫ –º–∞—Å—à—Ç–∞–±—É
   - ‚úÖ –î–æ–ø–æ–ª–Ω–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ shape metrics

3. **Template Matching** ‚≠ê - –¥–ª—è –∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤
   - ‚úÖ –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è (–Ω–µ –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è)
   - ‚úÖ –û—á–µ–Ω—å –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä—É–µ–º–æ

4. **CNN/Deep Learning** - –ù–ï —Ä–µ–∫–æ–º–µ–Ω–¥—É—é —Å–µ–π—á–∞—Å
   - ‚ùå –ù—É–∂–Ω–æ >10,000 —Ä–∞–∑–º–µ—á–µ–Ω–Ω—ã—Ö –∑–æ–Ω
   - ‚ùå –ò–∑–±—ã—Ç–æ—á–Ω–æ –¥–ª—è –∑–∞–¥–∞—á–∏
   - ‚è∞ –¢–æ–ª—å–∫–æ –µ—Å–ª–∏ –ø—Ä–æ—Å—Ç—ã–µ –º–µ—Ç–æ–¥—ã –Ω–µ –¥–∞–¥—É—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç

---

### ‚úÖ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –≤—ã–≤–æ–¥—ã

**–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ –º–µ—Ç–æ–¥—ã –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏:** –û–ß–ï–ù–¨ –õ–ï–ì–ö–û
- Strategy Pattern –¥–ª—è clustering (–∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ shape strategies)
- 1 –Ω–æ–≤—ã–π —Ñ–∞–π–ª –Ω–∞ –º–µ—Ç–æ–¥
- 0 –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º –∫–æ–¥–µ

**–ö–æ–≥–¥–∞ –¥–æ–±–∞–≤–ª—è—Ç—å:**

#### Traditional ML:
- **Hierarchical** - —Å–µ–π—á–∞—Å (–¥–ª—è –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–≥–æ K)
- **GMM** - —Å–∫–æ—Ä–æ (–∫–æ–≥–¥–∞ –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è –º—è–≥–∫–∞—è –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è)
- **DBSCAN** - —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –ø–æ—è–≤—è—Ç—Å—è –≤—ã–±—Ä–æ—Å—ã

#### Computer Vision:
- **DTW** - –ü–†–ò–û–†–ò–¢–ï–¢ #1 (–∏–¥–µ–∞–ª—å–Ω–æ –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ä—è–¥–æ–≤)
- **Hu Moments** - –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç #2 (–¥–æ–±–∞–≤–∏—Ç—å –∫–∞–∫ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ –∫ shape metrics)
- **Template Matching** - –¥–ª—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤
- **CNN/Siamese** - —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ >10k —Ä–∞–∑–º–µ—á–µ–Ω–Ω—ã—Ö –∑–æ–Ω

---

## –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ: –ü–æ—á–µ–º—É FourierShapeStrategy –æ—Ç–ª–æ–∂–µ–Ω–∞

### –ü—Ä–∏—á–∏–Ω—ã –æ—Ç–ª–æ–∂–µ–Ω–∏—è Fourier –∞–Ω–∞–ª–∏–∑–∞

#### 1. **–î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ—Å—Ç—å –±–∞–∑–æ–≤—ã—Ö –º–µ—Ç—Ä–∏–∫**

`StatisticalShapeStrategy` —É–∂–µ –ø–æ–∫—Ä—ã–≤–∞–µ—Ç –æ—Å–Ω–æ–≤–Ω—ã–µ –∞—Å–ø–µ–∫—Ç—ã —Ñ–æ—Ä–º—ã:
- **Skewness** ‚Üí –≥–¥–µ –ø–∏–∫ (–Ω–∞—á–∞–ª–æ/–∫–æ–Ω–µ—Ü)
- **Kurtosis** ‚Üí –Ω–∞—Å–∫–æ–ª—å–∫–æ —Ä–µ–∑–∫–∏–π –ø–∏–∫
- **Smoothness** ‚Üí –Ω–∞—Å–∫–æ–ª—å–∫–æ –≥–ª–∞–¥–∫–∞—è –∫—Ä–∏–≤–∞—è

–≠—Ç–æ–≥–æ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è:
- –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∑–æ–Ω –ø–æ –∞—Ä—Ö–µ—Ç–∏–ø–∞–º
- –£–ª—É—á—à–µ–Ω–Ω–æ–π –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏ (K-Means)
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤

---

#### 2. **–°–ª–æ–∂–Ω–æ—Å—Ç—å –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏–∏ –¥–ª—è —Ç—Ä–µ–π–¥–µ—Ä–æ–≤**

**–§—É—Ä—å–µ-–∞–Ω–∞–ª–∏–∑** –¥–∞–µ—Ç:
- –ß–∞—Å—Ç–æ—Ç–Ω—ã–π —Å–ø–µ–∫—Ç—Ä (–¥–æ–º–∏–Ω–∞–Ω—Ç–Ω—ã–µ —á–∞—Å—Ç–æ—Ç—ã)
- –ê–º–ø–ª–∏—Ç—É–¥—ã –≥–∞—Ä–º–æ–Ω–∏–∫
- –§–∞–∑–æ–≤—ã–µ —Å–¥–≤–∏–≥–∏

**–ü—Ä–æ–±–ª–µ–º–∞:** –ß—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç "–¥–æ–º–∏–Ω–∞–Ω—Ç–Ω–∞—è —á–∞—Å—Ç–æ—Ç–∞ 0.3" –¥–ª—è –ø—Ä–∏–Ω—è—Ç–∏—è —Ç–æ—Ä–≥–æ–≤—ã—Ö —Ä–µ—à–µ–Ω–∏–π?

**–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞** –¥–∞–µ—Ç:
- Skewness = 0.7 ‚Üí "—Ä–∞–Ω–Ω–∏–π –∏–º–ø—É–ª—å—Å" ‚úÖ –ø–æ–Ω—è—Ç–Ω–æ
- Kurtosis = 6.5 ‚Üí "—Ä–µ–∑–∫–∏–π –ø–∏–∫" ‚úÖ –ø–æ–Ω—è—Ç–Ω–æ

---

#### 3. **–ü—Ä–∏–Ω—Ü–∏–ø YAGNI (You Aren't Gonna Need It)**

–°—Ç—Ä–∞—Ç–µ–≥–∏—è:
1. ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –±–∞–∑–æ–≤—ã–π –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª
2. ‚è∏Ô∏è –û—Ç–ª–æ–∂–∏—Ç—å –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π, –ø–æ–∫–∞ –Ω–µ –ø–æ—è–≤–∏—Ç—Å—è —Ä–µ–∞–ª—å–Ω–∞—è –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—å
3. ‚úÖ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –≥–æ—Ç–æ–≤–∞ - –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–∑–∂–µ

–°–µ–π—á–∞—Å –Ω–µ—Ç –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤, —á—Ç–æ –§—É—Ä—å–µ-–º–µ—Ç—Ä–∏–∫–∏ –¥–∞–¥—É—Ç –∑–Ω–∞—á–∏–º–æ–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ –Ω–∞–¥ —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏–º–∏.

---

#### 4. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**

**FFT (Fast Fourier Transform):**
- –°–ª–æ–∂–Ω–æ—Å—Ç—å: O(n log n)
- –î–ª—è –∫–æ—Ä–æ—Ç–∫–∏—Ö –∑–æ–Ω (20-50 –±–∞—Ä–æ–≤) –º–æ–∂–µ—Ç –±—ã—Ç—å –∏–∑–±—ã—Ç–æ—á–µ–Ω
- –¢—Ä–µ–±—É–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (numpy.fft –∏–ª–∏ scipy.fft)

**–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (skew, kurtosis):**
- –°–ª–æ–∂–Ω–æ—Å—Ç—å: O(n)
- –ë—ã—Å—Ç—Ä–µ–µ –Ω–∞ –º–∞–ª—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- –£–∂–µ –µ—Å—Ç—å –≤ scipy.stats

---

#### 5. **–°–ø–µ—Ü–∏—Ñ–∏–∫–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è**

**–§—É—Ä—å–µ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è:**
- –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏—Ö —Å–∏–≥–Ω–∞–ª–æ–≤
- –í—ã–¥–µ–ª–µ–Ω–∏—è —Ü–∏–∫–ª–æ–≤
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ —à—É–º–∞

**–ó–æ–Ω—ã MACD:**
- –û–±—ã—á–Ω–æ **–Ω–µ –ø–µ—Ä–∏–æ–¥–∏—á–Ω—ã** (–æ–¥–∏–Ω–æ—á–Ω—ã–µ –∏–º–ø—É–ª—å—Å—ã)
- –ö–æ—Ä–æ—Ç–∫–∏–µ (20-100 –±–∞—Ä–æ–≤)
- –§–æ—Ä–º–∞ –≤–∞–∂–Ω–µ–µ —á–∞—Å—Ç–æ—Ç–Ω–æ–≥–æ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏—è

**–í—ã–≤–æ–¥:** –î–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Ñ–æ—Ä–º—ã "–±—É–≥—Ä–∞" –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º—ã —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ –º–æ–º–µ–Ω—Ç—ã –ø–æ–¥—Ö–æ–¥—è—Ç –ª—É—á—à–µ.

---

#### 6. **–í–æ–∑–º–æ–∂–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ Fourier (–µ—Å–ª–∏ —Ä–µ–∞–ª–∏–∑–æ–≤—ã–≤–∞—Ç—å)**

–ß—Ç–æ –º–æ–∂–Ω–æ –±—ã–ª–æ –±—ã –ø–æ–ª—É—á–∏—Ç—å:
- `dominant_frequency` - –≥–ª–∞–≤–Ω–∞—è —á–∞—Å—Ç–æ—Ç–∞
- `frequency_concentration` - –Ω–∞—Å–∫–æ–ª—å–∫–æ —ç–Ω–µ—Ä–≥–∏—è —Å–∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∞
- `spectral_entropy` - –º–µ—Ä–∞ —Ö–∞–æ—Ç–∏—á–Ω–æ—Å—Ç–∏ —Å–ø–µ–∫—Ç—Ä–∞

**–ù–û:** –ö–∞–∫ —ç—Ç–æ –ø–æ–º–æ–∂–µ—Ç –∫–ª–∞—Å—Å–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –∑–æ–Ω—ã? –ù–µ–æ—á–µ–≤–∏–¥–Ω–æ.

---

#### 7. **–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã Fourier**

–ï—Å–ª–∏ –Ω—É–∂–µ–Ω –±–æ–ª–µ–µ –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π –∞–Ω–∞–ª–∏–∑ —Ñ–æ—Ä–º—ã:

**WaveletShapeStrategy** (—Ç–æ–∂–µ –æ—Ç–ª–æ–∂–µ–Ω–∞):
- –õ—É—á—à–µ –¥–ª—è –Ω–µ–ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏—Ö —Å–∏–≥–Ω–∞–ª–æ–≤
- –õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è –≤–æ –≤—Ä–µ–º–µ–Ω–∏ –∏ —á–∞—Å—Ç–æ—Ç–µ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
- –ú–æ–∂–µ—Ç –≤—ã–¥–µ–ª–∏—Ç—å "–≤—Å–ø–ª–µ—Å–∫–∏" –Ω–∞ —Ä–∞–∑–Ω—ã—Ö –º–∞—Å—à—Ç–∞–±–∞—Ö

–ù–æ —Ç–æ–∂–µ –∏–∑–±—ã—Ç–æ—á–Ω–∞ –Ω–∞ –¥–∞–Ω–Ω–æ–º —ç—Ç–∞–ø–µ.

---

### –ö–æ–≥–¥–∞ –∏–º–µ–µ—Ç —Å–º—ã—Å–ª —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å Fourier?

#### –°—Ü–µ–Ω–∞—Ä–∏–∏:

1. **–ï—Å–ª–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ –º–µ—Ç—Ä–∏–∫–∏ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã:**
   - –ö–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è –¥–∞–µ—Ç –ø–ª–æ—Ö–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ
   - –ù—É–∂–Ω—ã –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ –¥–ª—è ML

2. **–î–ª—è —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã—Ö –∑–∞–¥–∞—á:**
   - –ü–æ–∏—Å–∫ —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ –≤–Ω—É—Ç—Ä–∏ –∑–æ–Ω
   - –í—ã–¥–µ–ª–µ–Ω–∏–µ "–º—É–∑—ã–∫–∞–ª—å–Ω—ã—Ö" (–≥–∞—Ä–º–æ–Ω–∏—á–Ω—ã—Ö) vs "—Ö–∞–æ—Ç–∏—á–Ω—ã—Ö" –∑–æ–Ω

3. **–î–ª—è –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Ü–µ–ª–µ–π:**
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥–∏–ø–æ—Ç–µ–∑—ã –æ –ø–µ—Ä–∏–æ–¥–∏—á–Ω–æ—Å—Ç–∏
   - –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —á–∞—Å—Ç–æ—Ç–Ω–æ–≥–æ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏—è bull vs bear –∑–æ–Ω

---

### –¢–µ–∫—É—â–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è

#### –§–∞–∑–∞ 3.2: ‚úÖ –ë–∞–∑–æ–≤—ã–π –∞–Ω–∞–ª–∏–∑ —Ñ–æ—Ä–º—ã
- StatisticalShapeStrategy —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞
- –†–∞–±–æ—Ç–∞–µ—Ç, –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∞, –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

#### –°–ª–µ–¥—É—é—â–∏–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã:
1. **–§–∞–∑–∞ 3.5: Volatility** (Bollinger/ATR) - –±–æ–ª–µ–µ –≤–∞–∂–Ω–æ
2. **–§–∞–∑–∞ 3.4: Divergence** - –±–æ–ª–µ–µ –≤–∞–∂–Ω–æ
3. **–§–∞–∑–∞ 3.6: Volume** - –±–æ–ª–µ–µ –≤–∞–∂–Ω–æ

#### Fourier/Wavelet:
- –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è
- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –ø–æ—è–≤–∏—Ç—Å—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∞—è –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—å
- –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –≥–æ—Ç–æ–≤–∞ - –¥–æ–±–∞–≤–∏—Ç—å –ª–µ–≥–∫–æ

---

### –ò—Ç–æ–≥

**–ü–æ—á–µ–º—É –æ—Ç–ª–æ–∂–µ–Ω–æ:**
1. ‚úÖ –ë–∞–∑–æ–≤—ã—Ö –º–µ—Ç—Ä–∏–∫ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ
2. ‚úÖ –§—É—Ä—å–µ —Å–ª–æ–∂–Ω–µ–µ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä–æ–≤–∞—Ç—å
3. ‚úÖ –ù–µ–æ—á–µ–≤–∏–¥–Ω–∞—è –ø–æ–ª—å–∑–∞ –¥–ª—è –∑–æ–Ω MACD
4. ‚úÖ –î—Ä—É–≥–∏–µ —Ñ–∞–∑—ã –≤–∞–∂–Ω–µ–µ
5. ‚úÖ YAGNI - –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤—ã–≤–∞—Ç—å –ø–æ–∫–∞ –Ω–µ –Ω—É–∂–Ω–æ

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ:**
- Strategy Pattern –ø–æ–∑–≤–æ–ª—è–µ—Ç –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–∏—Ç—å FourierShapeStrategy –ø–æ–∑–∂–µ
- –ú–æ–∂–Ω–æ –ø—Ä–æ–≤–µ—Å—Ç–∏ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç –∏ —Å—Ä–∞–≤–Ω–∏—Ç—å —Å StatisticalShapeStrategy
- –ï—Å–ª–∏ Fourier –¥–∞—Å—Ç –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ - –¥–æ–±–∞–≤–∏–º

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
–°–Ω–∞—á–∞–ª–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å StatisticalShapeStrategy –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö, –æ—Ü–µ–Ω–∏—Ç—å —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏. –ï—Å–ª–∏ –ø–æ–Ω–∞–¥–æ–±—è—Ç—Å—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ —Ñ–æ—Ä–º—ã - –¥–æ–±–∞–≤–∏—Ç—å Fourier —Ç–æ–≥–¥–∞.

---

**–ê–≤—Ç–æ—Ä:** AI Assistant  
**–î–∞—Ç–∞:** 2025-10-12  
**–°—Ç–∞—Ç—É—Å:** –ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–π –¥–æ–∫—É–º–µ–Ω—Ç

