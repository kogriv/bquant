# –ê–Ω–∞–ª–∏–∑ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ Swing-—Å—Ç—Ä–∞—Ç–µ–≥–∏–π

**–î–∞—Ç–∞:** 2025-10-09  
**–ó–∞–¥–∞—á–∞:** –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ SwingCalculationStrategy (–§–∞–∑–∞ 3.1 –∏–∑ impl.md)

**–°—Ç–∞—Ç—É—Å:** ‚ö†Ô∏è **–£–°–¢–ê–†–ï–õ** - –¥–∞–Ω–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–µ—Ä–≤–∏—á–Ω—ã–π –∞–Ω–∞–ª–∏–∑. –ê–∫—Ç—É–∞–ª—å–Ω—ã–µ –≤—ã–≤–æ–¥—ã –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ —Å–º. –≤ `swing_detection_approaches.md`

---

## –†–µ–∑—é–º–µ

‚úÖ **pandas-ta ZigZag –î–û–°–¢–£–ü–ï–ù** —á–µ—Ä–µ–∑ —Å–∏—Å—Ç–µ–º—É BQuant (`LibraryManager`)  
‚úÖ **scipy find_peaks –£–ñ–ï –ò–°–ü–û–õ–¨–ó–£–ï–¢–°–Ø** –≤ –ø—Ä–æ–µ–∫—Ç–µ  
‚ùå **Bollinger Bands –ù–ï –ü–û–î–•–û–î–Ø–¢** –¥–ª—è –ø—Ä—è–º–æ–≥–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å–≤–∏–Ω–≥–æ–≤ (–∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏)  
‚ùå **ATR –ù–ï –ü–û–î–•–û–î–ò–¢** –¥–ª—è –ø—Ä—è–º–æ–≥–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å–≤–∏–Ω–≥–æ–≤ (–º–µ—Ä–∞ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏)  
‚úÖ **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω –±–∞–≥** –≤ `bquant/indicators/library/manager.py` (–ø–µ—Ä–µ–¥–∞–≤–∞–ª 'library' –≤–º–µ—Å—Ç–æ library_name)

> **‚ö†Ô∏è –í–ê–ñ–ù–û–ï –û–ë–ù–û–í–õ–ï–ù–ò–ï:** –ü–æ—Å–ª–µ –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –≤—ã—è—Å–Ω–∏–ª–æ—Å—å, —á—Ç–æ Bollinger Bands –∏ ATR **–ù–ï –ø–æ–¥—Ö–æ–¥—è—Ç** –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å–≤–∏–Ω–≥–æ–≤, —Ç–∞–∫ –∫–∞–∫ —ç—Ç–æ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã **–≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏**, –∞ –Ω–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –ø–æ–∏—Å–∫–∞ –ø–∏–∫–æ–≤/–≤–ø–∞–¥–∏–Ω. 
>
> –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç–∏ –ø–æ–¥—Ö–æ–¥–æ–≤ –∏ –ø–æ–ª–Ω–æ—Ç—ã –º–µ—Ç—Ä–∏–∫ —Å–º. –≤ **`devref/gaps/swing_detection_approaches.md`**

---

## 1. –î–æ—Å—Ç—É–ø–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è Swing Detection

### 1.1. pandas-ta ZigZag (–†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø –¥–ª—è –±–∞–∑–æ–≤–æ–π –≤–µ—Ä—Å–∏–∏)

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ `LibraryManager`

**–ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
```python
from bquant.indicators import LibraryManager

zigzag = LibraryManager.create_indicator(
    'pandas_ta', 
    'zigzag',
    legs=10,        # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–∞—Ä–æ–≤ –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —Ä–∞–∑–≤–æ—Ä–æ—Ç–∞
    deviation=0.05  # –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö (5%)
)

result = zigzag.calculate(zone_data)
# –†–µ–∑—É–ª—å—Ç–∞—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç 3 –∫–æ–ª–æ–Ω–∫–∏:
# - ZIGZAGs_<params>: –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–≤–∏–Ω–≥–∞ (-1 = –≤–Ω–∏–∑, 1 = –≤–≤–µ—Ä—Ö)
# - ZIGZAGv_<params>: –∑–Ω–∞—á–µ–Ω–∏–µ —Ü–µ–Ω—ã –≤ —Ç–æ—á–∫–µ —Å–≤–∏–Ω–≥–∞
# - ZIGZAGd_<params>: —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ/–¥–∏—Å—Ç–∞–Ω—Ü–∏—è –¥–æ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ —Å–≤–∏–Ω–≥–∞
```

**–°–∏–≥–Ω–∞—Ç—É—Ä–∞ —Ñ—É–Ω–∫—Ü–∏–∏:**
```python
zigzag(high, low, close=None, legs: int = None, 
       deviation: float = None, backtest: bool = None, 
       offset: int = None)
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `legs` (int): –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–∞—Ä–æ–≤ –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –ø–∏–∫–∞/–≤–ø–∞–¥–∏–Ω—ã
- `deviation` (float): –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –ø—Ä–æ—Ü–µ–Ω—Ç–Ω–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 0.05 = 5%)
- `backtest` (bool): –†–µ–∂–∏–º –±—ç–∫—Ç–µ—Å—Ç–∏–Ω–≥–∞ (None = –∞–≤—Ç–æ)

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –ì–æ—Ç–æ–≤—ã–π, –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ —Å–∏—Å—Ç–µ–º—É –ø–∞–∫–µ—Ç–∞
- –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
- –í—ã–¥–∞–µ—Ç –Ω–µ —Ç–æ–ª—å–∫–æ —Ç–æ—á–∫–∏, –Ω–æ –∏ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ/–∞–º–ø–ª–∏—Ç—É–¥—É

**–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:**
- –¢—Ä–µ–±—É–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –ø–æ–¥ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –∞–∫—Ç–∏–≤
- –í —Ç–µ–∫—É—â–µ–º —Ç–µ—Å—Ç–µ —Å –¥–µ—Ñ–æ–ª—Ç–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –≤—ã–¥–∞–ª —Ç–æ–ª—å–∫–æ 1 —Ç–æ—á–∫—É (–Ω—É–∂–Ω–∞ –∫–∞–ª–∏–±—Ä–æ–≤–∫–∞)

---

### 1.2. Bollinger Bands

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ `LibraryManager`

**–ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
```python
from bquant.indicators import LibraryManager

bbands = LibraryManager.create_indicator(
    'pandas_ta', 
    'bbands',
    length=20,  # –ü–µ—Ä–∏–æ–¥ —Å–∫–æ–ª—å–∑—è—â–µ–π —Å—Ä–µ–¥–Ω–µ–π
    std=2.0     # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–π
)

result = bbands.calculate(zone_data)
# –†–µ–∑—É–ª—å—Ç–∞—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç:
# - BBL_<params>: –Ω–∏–∂–Ω—è—è –ø–æ–ª–æ—Å–∞
# - BBM_<params>: —Å—Ä–µ–¥–Ω—è—è –ª–∏–Ω–∏—è
# - BBU_<params>: –≤–µ—Ä—Ö–Ω—è—è –ø–æ–ª–æ—Å–∞
```

**–°—Ç—Ä–∞—Ç–µ–≥–∏—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å–≤–∏–Ω–≥–æ–≤:**
- –ü—Ä–æ–±–∏—Ç–∏–µ –≤–µ—Ä—Ö–Ω–µ–π –ø–æ–ª–æ—Å—ã = –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π –ø–∏–∫
- –ü—Ä–æ–±–∏—Ç–∏–µ –Ω–∏–∂–Ω–µ–π –ø–æ–ª–æ—Å—ã = –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –≤–ø–∞–¥–∏–Ω–∞
- –í–æ–∑–≤—Ä–∞—Ç –≤–Ω—É—Ç—Ä—å –ø–æ–ª–æ—Å = –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Ä–∞–∑–≤–æ—Ä–æ—Ç–∞

---

### 1.3. ATR (Average True Range)

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –£–ñ–ï –†–ê–°–°–ß–ò–¢–´–í–ê–ï–¢–°–Ø –≤ `zone_data['atr']`

**–ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
```python
# ATR —É–∂–µ –¥–æ—Å—Ç—É–ø–µ–Ω –≤ zone_data –ø–æ—Å–ª–µ calculate_macd_with_atr()
atr_threshold = zone_data['atr'].mean() * 1.5

# –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∑–Ω–∞—á–∏–º—ã–µ —Å–≤–∏–Ω–≥–∏:
# - –ï—Å–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ü–µ–Ω—ã > atr_threshold, —ç—Ç–æ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π —Å–≤–∏–Ω–≥
```

**–°—Ç—Ä–∞—Ç–µ–≥–∏—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å–≤–∏–Ω–≥–æ–≤:**
- –í—ã—á–∏—Å–ª–∏—Ç—å —Å—Ä–µ–¥–Ω–µ–µ ATR –¥–ª—è –∑–æ–Ω—ã
- –ó–Ω–∞—á–∏–º–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ = –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ü–µ–Ω—ã > ATR √ó multiplier
- –ò—Å–∫–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–µ —ç–∫—Å—Ç—Ä–µ–º—É–º—ã —Å—Ä–µ–¥–∏ –∑–Ω–∞—á–∏–º—ã—Ö –¥–≤–∏–∂–µ–Ω–∏–π

---

## 2. scipy.signal.find_peaks

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –£–ñ–ï –ò–°–ü–û–õ–¨–ó–£–ï–¢–°–Ø –≤ –ø—Ä–æ–µ–∫—Ç–µ (`bquant/analysis/zones/zone_features.py`)

**–ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
```python
from scipy.signal import find_peaks

# –ù–∞–π—Ç–∏ –ø–∏–∫–∏ (–ª–æ–∫–∞–ª—å–Ω—ã–µ –º–∞–∫—Å–∏–º—É–º—ã)
peaks_idx, _ = find_peaks(zone_data['high'].values, prominence=threshold)

# –ù–∞–π—Ç–∏ –≤–ø–∞–¥–∏–Ω—ã (–ª–æ–∫–∞–ª—å–Ω—ã–µ –º–∏–Ω–∏–º—É–º—ã)
troughs_idx, _ = find_peaks(-zone_data['low'].values, prominence=threshold)
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –£–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –ø–∞–∫–µ—Ç–µ
- –ë—ã—Å—Ç—Ä—ã–π, –≤–µ–∫—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π
- –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–π (prominence, distance, width)

**–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:**
- –ù–ï –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π ZigZag (–Ω–∞—Ö–æ–¥–∏—Ç –í–°–ï –ª–æ–∫–∞–ª—å–Ω—ã–µ —ç–∫—Å—Ç—Ä–µ–º—É–º—ã)
- –¢—Ä–µ–±—É–µ—Ç –ø–æ—Å—Ç—Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ –∞–º–ø–ª–∏—Ç—É–¥–µ –¥–≤–∏–∂–µ–Ω–∏—è

---

## 3. –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –ø–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –§–∞–∑–∞ 3.1: ZigZagSwingStrategy (–ü–†–ò–û–†–ò–¢–ï–¢ 1)

**–í–∞—Ä–∏–∞–Ω—Ç A: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ pandas-ta ZigZag (–†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø)**

```python
# bquant/analysis/zones/strategies/swing/zigzag.py

from dataclasses import dataclass
from typing import Dict, Any
import pandas as pd
from bquant.indicators import LibraryManager
from ..base import SwingMetrics, SwingCalculationStrategy

@dataclass
class ZigZagSwingStrategy(SwingCalculationStrategy):
    """
    –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å–≤–∏–Ω–≥–æ–≤ —á–µ—Ä–µ–∑ pandas-ta ZigZag.
    """
    legs: int = 10
    deviation: float = 0.05  # 5%
    
    def calculate(self, zone_data: pd.DataFrame) -> SwingMetrics:
        """
        –í—ã—á–∏—Å–ª—è–µ—Ç —Å–≤–∏–Ω–≥-–º–µ—Ç—Ä–∏–∫–∏ —á–µ—Ä–µ–∑ ZigZag.
        """
        # 1. –°–æ–∑–¥–∞—Ç—å ZigZag –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä
        zigzag = LibraryManager.create_indicator(
            'pandas_ta', 
            'zigzag',
            legs=self.legs,
            deviation=self.deviation
        )
        
        # 2. –í—ã—á–∏—Å–ª–∏—Ç—å ZigZag
        result = zigzag.calculate(zone_data)
        
        # 3. –ò–∑–≤–ª–µ—á—å —Å–≤–∏–Ω–≥-—Ç–æ—á–∫–∏
        swing_signal = result.data.iloc[:, 0]  # ZIGZAGs_<params>
        swing_values = result.data.iloc[:, 1]  # ZIGZAGv_<params>
        
        # 4. –ù–∞–π—Ç–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è
        swings = swing_values.dropna()
        
        if len(swings) < 2:
            return SwingMetrics(
                rally_count=0, drop_count=0,
                avg_rally_pct=0.0, avg_drop_pct=0.0,
                max_rally_pct=0.0, max_drop_pct=0.0
            )
        
        # 5. –í—ã—á–∏—Å–ª–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏
        rallies = []
        drops = []
        
        for i in range(1, len(swings)):
            price_change_pct = (swings.iloc[i] / swings.iloc[i-1] - 1) * 100
            
            if price_change_pct > 0:
                rallies.append(price_change_pct)
            else:
                drops.append(abs(price_change_pct))
        
        return SwingMetrics(
            rally_count=len(rallies),
            drop_count=len(drops),
            avg_rally_pct=sum(rallies) / len(rallies) if rallies else 0.0,
            avg_drop_pct=sum(drops) / len(drops) if drops else 0.0,
            max_rally_pct=max(rallies) if rallies else 0.0,
            max_drop_pct=max(drops) if drops else 0.0
        )
    
    def get_name(self) -> str:
        return f"zigzag_legs{self.legs}_dev{self.deviation}"
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞ A:**
- –ì–æ—Ç–æ–≤–æ–µ —Ä–µ—à–µ–Ω–∏–µ —á–µ—Ä–µ–∑ pandas-ta
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–∏—Å—Ç–µ–º—É –ø–∞–∫–µ—Ç–∞
- –ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π ZigZag –∞–ª–≥–æ—Ä–∏—Ç–º
- ~50-70 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é:**
- `legs=10`: –¢—Ä–µ–±—É–µ—Ç—Å—è 10 –±–∞—Ä–æ–≤ –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —Ä–∞–∑–≤–æ—Ä–æ—Ç–∞
- `deviation=0.05`: –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ 5% –¥–ª—è –ø—Ä–∏–∑–Ω–∞–Ω–∏—è —Å–≤–∏–Ω–≥–∞

---

**–í–∞—Ä–∏–∞–Ω—Ç B: –°–∞–º–æ–ø–∏—Å–Ω—ã–π ZigZag —á–µ—Ä–µ–∑ find_peaks + —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è**

```python
# –ü—Å–µ–≤–¥–æ–∫–æ–¥ –¥–ª—è —Å–ø—Ä–∞–≤–∫–∏

from scipy.signal import find_peaks

def calculate_zigzag_swings(zone_data, threshold_pct=0.02):
    # 1. –ù–∞–π—Ç–∏ –≤—Å–µ –ª–æ–∫–∞–ª—å–Ω—ã–µ –ø–∏–∫–∏ –∏ –≤–ø–∞–¥–∏–Ω—ã
    peaks, _ = find_peaks(zone_data['high'].values)
    troughs, _ = find_peaks(-zone_data['low'].values)
    
    # 2. –û–±—ä–µ–¥–∏–Ω–∏—Ç—å –∏ –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ –≤—Ä–µ–º–µ–Ω–∏
    all_extrema = [(idx, 'peak', zone_data['high'].iloc[idx]) for idx in peaks] + \
                   [(idx, 'trough', zone_data['low'].iloc[idx]) for idx in troughs]
    all_extrema.sort(key=lambda x: x[0])
    
    # 3. –§–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å: –æ—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ –¥–≤–∏–∂–µ–Ω–∏—è > threshold_pct
    filtered = []
    for i in range(1, len(all_extrema)):
        prev_price = all_extrema[i-1][2]
        curr_price = all_extrema[i][2]
        change_pct = abs(curr_price / prev_price - 1)
        
        if change_pct > threshold_pct:
            filtered.append(all_extrema[i])
    
    # 4. –í—ã—á–∏—Å–ª–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏
    # ...
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞ B:**
- –ü–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ –∞–ª–≥–æ—Ä–∏—Ç–º–æ–º
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —É–∂–µ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π `find_peaks`

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏ –≤–∞—Ä–∏–∞–Ω—Ç–∞ B:**
- –ë–æ–ª—å—à–µ –∫–æ–¥–∞ (~100-150 —Å—Ç—Ä–æ–∫)
- –ù—É–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å
- –ú–æ–∂–µ—Ç –¥–∞–≤–∞—Ç—å –ª–æ–∂–Ω—ã–µ —Å–≤–∏–Ω–≥–∏

---

### –§–∞–∑–∞ 3.2: BollingerSwingStrategy (–ü–†–ò–û–†–ò–¢–ï–¢ 2)

```python
# bquant/analysis/zones/strategies/swing/bollinger.py

@dataclass
class BollingerSwingStrategy(SwingCalculationStrategy):
    length: int = 20
    std: float = 2.0
    
    def calculate(self, zone_data: pd.DataFrame) -> SwingMetrics:
        # 1. –í—ã—á–∏—Å–ª–∏—Ç—å Bollinger Bands
        bbands = LibraryManager.create_indicator(
            'pandas_ta', 'bbands',
            length=self.length, std=self.std
        )
        result = bbands.calculate(zone_data)
        
        # 2. –ù–∞–π—Ç–∏ –ø—Ä–æ–±–∏—Ç–∏—è –ø–æ–ª–æ—Å
        upper = result.data.iloc[:, 2]  # BBU_<params>
        lower = result.data.iloc[:, 0]  # BBL_<params>
        
        upper_breaks = zone_data['close'] > upper
        lower_breaks = zone_data['close'] < lower
        
        # 3. –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Å–≤–∏–Ω–≥–∏ –º–µ–∂–¥—É –ø—Ä–æ–±–∏—Ç–∏—è–º–∏
        # ...
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é:**
- `length=20`: –ü–µ—Ä–∏–æ–¥ SMA
- `std=2.0`: 2 —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è

---

### –§–∞–∑–∞ 3.3: ATRSwingStrategy (–ü–†–ò–û–†–ò–¢–ï–¢ 3)

```python
# bquant/analysis/zones/strategies/swing/atr_based.py

@dataclass
class ATRSwingStrategy(SwingCalculationStrategy):
    multiplier: float = 1.5
    
    def calculate(self, zone_data: pd.DataFrame) -> SwingMetrics:
        # ATR —É–∂–µ –µ—Å—Ç—å –≤ –¥–∞–Ω–Ω—ã—Ö!
        atr_threshold = zone_data['atr'].mean() * self.multiplier
        
        # –ù–∞–π—Ç–∏ –∑–Ω–∞—á–∏–º—ã–µ –¥–≤–∏–∂–µ–Ω–∏—è (> ATR threshold)
        price_changes = zone_data['close'].diff().abs()
        significant = price_changes > atr_threshold
        
        # –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Å–≤–∏–Ω–≥–∏
        # ...
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é:**
- `multiplier=1.5`: –î–≤–∏–∂–µ–Ω–∏–µ > 1.5 √ó ATR —Å—á–∏—Ç–∞–µ—Ç—Å—è –∑–Ω–∞—á–∏–º—ã–º

---

## 4. –ò—Ç–æ–≥–æ–≤—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ (–û–ë–ù–û–í–õ–ï–ù–û)

> **‚ö†Ô∏è –í–ê–ñ–ù–û:** –î–∞–Ω–Ω—ã–π —Ä–∞–∑–¥–µ–ª –æ–±–Ω–æ–≤–ª–µ–Ω –ø–æ—Å–ª–µ –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞. Bollinger –∏ ATR **–ò–°–ö–õ–Æ–ß–ï–ù–´** –∏–∑ SwingStrategies.

### ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø–æ–¥—Ö–æ–¥—ã –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å–≤–∏–Ω–≥–æ–≤:

**–°–º. –¥–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –≤ `devref/gaps/swing_detection_approaches.md` (—Ä–∞–∑–¥–µ–ª—ã 1-3)**

1. **–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `ZigZagSwingStrategy`** (pandas-ta) - **–ü–†–ò–û–†–ò–¢–ï–¢ 1**
   - –ü—Ä–æ—Å—Ç–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ LibraryManager
   - –ì–æ—Ç–æ–≤—ã–π, –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º
   - –ü–∞—Ä–∞–º–µ—Ç—Ä—ã: `legs=10`, `deviation=0.05`
   - ~50-70 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞

2. **–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `FindPeaksSwingStrategy`** (scipy) - **–ü–†–ò–û–†–ò–¢–ï–¢ 2**
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `scipy.signal.find_peaks` (—É–∂–µ –≤ –ø—Ä–æ–µ–∫—Ç–µ!)
   - –ì–∏–±–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
   - –¢—Ä–µ–±—É–µ—Ç –ø–æ—Å—Ç—Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ –∞–º–ø–ª–∏—Ç—É–¥–µ
   - ~70-100 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞

3. **–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `PivotPointsSwingStrategy`** - **–ü–†–ò–û–†–ò–¢–ï–¢ 3**
   - –ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π N-bar pattern
   - –ü–∞—Ä–∞–º–µ—Ç—Ä—ã: `left_bars=2`, `right_bars=2`
   - ~60-80 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞

4. **–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: `NBarSwingStrategy`** - –æ–±–æ–±—â–µ–Ω–∏–µ Pivot
   - –ê—Å–∏–º–º–µ—Ç—Ä–∏—á–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
   - –ë–æ–ª–µ–µ –≥–∏–±–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

5. **–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: `FractalSwingStrategy`** - Williams Fractal
   - –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–∞—Ç—Ç–µ—Ä–Ω –∏–∑ 5 –±–∞—Ä–æ–≤
   - –®–∏—Ä–æ–∫–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç—Ä–µ–π–¥–µ—Ä–∞–º–∏

### ‚ùå –ß–¢–û –ù–ï –î–ï–õ–ê–¢–¨:

- ~~`BollingerSwingStrategy`~~ - **–ò–°–ö–õ–Æ–ß–ï–ù–û**. Bollinger —ç—Ç–æ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏, –Ω–µ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –ø–æ–∏—Å–∫–∞ —Å–≤–∏–Ω–≥–æ–≤
- ~~`ATRSwingStrategy`~~ - **–ò–°–ö–õ–Æ–ß–ï–ù–û**. ATR —ç—Ç–æ –º–µ—Ä–∞ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏, –Ω–µ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –ø–æ–∏—Å–∫–∞ —Å–≤–∏–Ω–≥–æ–≤

### ‚úÖ –í–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ - —Å–æ–∑–¥–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏:

- –°–æ–∑–¥–∞—Ç—å `VolatilityMetrics` dataclass
- –°–æ–∑–¥–∞—Ç—å `VolatilityStrategy` –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ —á–µ—Ä–µ–∑ Bollinger/ATR
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –æ—Ü–µ–Ω–∫–∏ **–≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏ –∑–æ–Ω—ã**, –∞ –Ω–µ —Å–≤–∏–Ω–≥–æ–≤

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (–æ–±–Ω–æ–≤–ª–µ–Ω–æ):

| –°—Ç—Ä–∞—Ç–µ–≥–∏—è | –ü–∞—Ä–∞–º–µ—Ç—Ä—ã | –ó–Ω–∞—á–µ–Ω–∏—è |
|-----------|-----------|----------|
| ZigZag (pandas-ta) | `legs`, `deviation` | `10`, `0.05` (5%) |
| FindPeaks (scipy) | `prominence`, `distance`, `min_amplitude_pct` | TBD, TBD, `0.02` |
| Pivot Points | `left_bars`, `right_bars` | `2`, `2` |
| N-bar Swing | `left_bars`, `right_bars` | `3`, `2` |
| Fractal | —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–æ | 5 –±–∞—Ä–æ–≤ |

---

## 5. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π –±–∞–≥

**–§–∞–π–ª:** `bquant/indicators/library/manager.py`  
**–°—Ç—Ä–æ–∫–∞:** 162 (–±—ã–ª–æ), 161 (—Å—Ç–∞–ª–æ)

**–ü—Ä–æ–±–ª–µ–º–∞:**
```python
# –ë–´–õ–û (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ):
return IndicatorFactory.create('library', full_name, **kwargs)
# –ü–µ—Ä–µ–¥–∞–≤–∞–ª 'library' –≤–º–µ—Å—Ç–æ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –∏–º–µ–Ω–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
```

**–†–µ—à–µ–Ω–∏–µ:**
```python
# –°–¢–ê–õ–û (–ø—Ä–∞–≤–∏–ª—å–Ω–æ):
return IndicatorFactory.create(library_name, indicator_name, **kwargs)
# –ü–µ—Ä–µ–¥–∞–µ—Ç 'pandas_ta', 'zigzag'
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**  
‚úÖ `LibraryManager.create_indicator('pandas_ta', 'zigzag')` —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

---

## 6. –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ (–û–ë–ù–û–í–õ–ï–ù–û)

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ:

- [ ] –û–±–Ω–æ–≤–∏—Ç—å `SwingMetrics` dataclass (+17 –ø–æ–ª–µ–π, —Å–º. `swing_detection_approaches.md`, —Ä–∞–∑–¥–µ–ª 5)
- [ ] –°–æ–∑–¥–∞—Ç—å `bquant/analysis/zones/strategies/swing/zigzag.py` (ZigZagSwingStrategy)
- [ ] –°–æ–∑–¥–∞—Ç—å `bquant/analysis/zones/strategies/swing/find_peaks.py` (FindPeaksSwingStrategy)
- [ ] –°–æ–∑–¥–∞—Ç—å `bquant/analysis/zones/strategies/swing/pivot_points.py` (PivotPointsSwingStrategy)
- [ ] –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –≤ `StrategyRegistry`
- [ ] –ù–∞–ø–∏—Å–∞—Ç—å unit-—Ç–µ—Å—Ç—ã –¥–ª—è –∫–∞–∂–¥–æ–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ (–ø—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö 23 –ø–æ–ª–µ–π SwingMetrics)
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö, –ø–æ–¥–æ–±—Ä–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

### –°–æ–∑–¥–∞—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏ (–≤–º–µ—Å—Ç–æ Bollinger/ATR —Å–≤–∏–Ω–≥–æ–≤):

- [ ] –°–æ–∑–¥–∞—Ç—å `VolatilityMetrics` dataclass –≤ `strategies/base.py`
- [ ] –°–æ–∑–¥–∞—Ç—å `VolatilityStrategy` –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ —á–µ—Ä–µ–∑ Bollinger/ATR
- [ ] –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ `ZoneFeaturesAnalyzer` –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω—É—é –º–µ—Ç—Ä–∏–∫—É (–Ω–µ –≤ SwingMetrics!)

### –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ:

- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `NBarSwingStrategy`
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `FractalSwingStrategy`

---

## 7. –°—Å—ã–ª–∫–∏ –Ω–∞ —Å–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- **–î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –ø–æ–¥—Ö–æ–¥–æ–≤:** `devref/gaps/swing_detection_approaches.md`
  - –†–∞–∑–¥–µ–ª 1: –û—Ü–µ–Ω–∫–∞ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω—ã—Ö –ø–æ–¥—Ö–æ–¥–æ–≤ (–ø–æ—á–µ–º—É Bollinger/ATR –Ω–µ –ø–æ–¥—Ö–æ–¥—è—Ç)
  - –†–∞–∑–¥–µ–ª 2: –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–¥—Ö–æ–¥—ã (Pivot Points, Fractal, N-bar)
  - –†–∞–∑–¥–µ–ª 3: –ò—Ç–æ–≥–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞ –ø–æ–¥—Ö–æ–¥–æ–≤
  - –†–∞–∑–¥–µ–ª 4: –ê–Ω–∞–ª–∏–∑ –ø–æ–ª–Ω–æ—Ç—ã –º–µ—Ç—Ä–∏–∫ (+17 –ø–æ–ª–µ–π)
  - –†–∞–∑–¥–µ–ª 5: –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π SwingMetrics dataclass
  - –†–∞–∑–¥–µ–ª 6: –ü–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π

- **–ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:** `devref/gaps/impl.md`
  - –†–∞–∑–¥–µ–ª 6.3: –§–∞–∑–∞ 3.1 (–¥–µ—Ç–∞–ª—å–Ω—ã–π —á–µ–∫-–ª–∏—Å—Ç)
  - –†–∞–∑–¥–µ–ª 7.1.1: –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è –º–µ—Ç—Ä–∏–∫ —Å–≤–∏–Ω–≥–æ–≤
  - –†–∞–∑–¥–µ–ª 7.6: –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ Strategy Pattern

---

**–í—ã–≤–æ–¥ (–æ–±–Ω–æ–≤–ª–µ–Ω):** 
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –î–û–°–¢–£–ü–ù–´: pandas-ta ZigZag, scipy find_peaks, Pivot Points
- ‚ùå Bollinger/ATR –ù–ï –ø–æ–¥—Ö–æ–¥—è—Ç –¥–ª—è —Å–≤–∏–Ω–≥–æ–≤ - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –º–µ—Ç—Ä–∏–∫ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏
- ‚ö†Ô∏è –¢–µ–∫—É—â–∏–π SwingMetrics –ù–ï–ü–û–õ–ù–´–ô - —Ç—Ä–µ–±—É–µ—Ç—Å—è +17 –ø–æ–ª–µ–π
- üìä –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –Ω–∞—á–∞—Ç—å —Å ZigZagSwingStrategy, –∑–∞—Ç–µ–º FindPeaksSwingStrategy

