# Сводка обновлений документации по Swing-стратегиям

**Дата:** 2025-10-09  
**Контекст:** Уточнение подходов к определению свингов после детального анализа

---

## Что изменено

### 1. Создан новый документ: `swing_detection_approaches.md`

**Содержание:**
- Раздел 1: Оценка предложенных подходов (ZigZag ✅, Bollinger ❌, ATR ❌, find_peaks ✅)
- Раздел 2: Дополнительные подходы (Pivot Points, Fractal, N-bar Swing)
- Раздел 3: Итоговая таблица подходов (5 подходящих + 3 неподходящих)
- Раздел 4: Анализ полноты метрик (текущие 6 полей vs требуемые 23)
- Раздел 5: Обновленный SwingMetrics dataclass (+17 новых полей)
- Раздел 6: План действий

**Ключевые выводы:**
- ❌ Bollinger Bands НЕ подходят для свингов (индикатор волатильности)
- ❌ ATR НЕ подходит для свингов (мера волатильности)
- ✅ Подходят: ZigZag, find_peaks, Pivot Points, N-bar Swing, Fractal
- ⚠️ Текущий SwingMetrics НЕПОЛНЫЙ - отсутствуют критичные метрики

---

### 2. Обновлен документ: `impl.md`

#### Раздел 6.3 - Фаза 3.1:

**Было:**
- 3 стратегии: ZigZag, Bollinger, ATR
- 6 шагов реализации

**Стало:**
- Добавлено предупреждение о неприменимости Bollinger/ATR
- Добавлены ссылки на аналитические документы
- 12 шагов реализации:
  1. Обновить SwingMetrics (+17 полей)
  2-6. Реализовать стратегии: ZigZag, FindPeaks, PivotPoints, NBar, Fractal
  7-10. Интеграция, тесты, A/B тестирование, подбор параметров
  11-12. Создать VolatilityMetrics и VolatilityStrategy для Bollinger/ATR

#### Новый раздел 7.1.5:

**Добавлено:**
- Спецификация VolatilityMetrics (10 полей)
- Спецификация VolatilityCalculationStrategy Protocol
- Пример реализации CombinedVolatilityStrategy (~80 строк кода)
- Интерпретация метрик волатильности

#### Раздел 7.6.3 - Таблица типов стратегий:

**Было:**
- 4 типа метрик
- Свинги: ZigZag, Bollinger, ATR, ML-based

**Стало:**
- 5 типов метрик (добавлен Volatility)
- Свинги: ZigZag (pandas-ta), FindPeaks (scipy), PivotPoints, N-bar, Fractal
- Волатильность: Bollinger, ATR, Combined

#### Раздел 7.6.4 - Структура директорий:

**Добавлено:**
```
└── volatility/
    ├── __init__.py
    ├── bollinger.py        # BollingerVolatilityStrategy
    └── atr.py              # ATRVolatilityStrategy
```

#### Обновлены примеры кода:

- Раздел 7.6.6 (использование в оркестраторе)
- Раздел 7.6.7 (преимущества архитектуры)
- Раздел 7.6.8 (AutoSwingStrategy)

#### Добавлена новая Фаза 3.5:

**Volatility стратегии** - правильное использование Bollinger/ATR
- 9 шагов реализации
- Интеграция в ZoneFeaturesAnalyzer

#### Обновлены номера фаз:

- Фаза 3.5: Volatility (новая)
- Фаза 3.6: Volume (было 3.5)
- Фаза 3.7: Гипотезные тесты (было 3.6)
- Фаза 3.8: Моделирование (было 3.7)

---

### 3. Обновлен документ: `swing_strategies_analysis.md`

#### В начале документа:

**Добавлено:**
- Предупреждение о статусе "УСТАРЕЛ"
- Ссылка на актуальный документ `swing_detection_approaches.md`
- Обновленное резюме (Bollinger/ATR помечены ❌)

#### Раздел 4 - Итоговые рекомендации:

**Было:**
- 4 рекомендации (включая Bollinger/ATR)
- Таблица с 3 стратегиями

**Стало:**
- 5 правильных подходов (ZigZag, FindPeaks, PivotPoints, NBar, Fractal)
- Раздел "ЧТО НЕ ДЕЛАТЬ" с исключением Bollinger/ATR
- Раздел "Вместо этого" - создать VolatilityMetrics
- Обновленная таблица параметров (5 стратегий)

#### Раздел 6 - Следующие шаги:

**Добавлено:**
- Обязательные: обновить SwingMetrics, 3 стратегии, тесты
- Создать метрики волатильности (вместо Bollinger/ATR свингов)
- Опционально: NBar, Fractal

#### Новый раздел 7:

**Добавлено:**
- Ссылки на связанные документы с указанием конкретных разделов
- Обновленный вывод документа

---

## Исправлен баг

**Файл:** `bquant/indicators/library/manager.py`, строка 161

**Было:**
```python
return IndicatorFactory.create('library', full_name, **kwargs)
```

**Стало:**
```python
return IndicatorFactory.create(library_name, indicator_name, **kwargs)
```

**Результат:** LibraryManager теперь корректно создает pandas-ta индикаторы, включая ZigZag.

---

## Итоговые выводы

### ✅ Подтверждено:
1. pandas-ta ZigZag доступен и работает через LibraryManager
2. scipy find_peaks уже используется в проекте
3. Инфраструктура Strategy Pattern готова к добавлению стратегий

### ❌ Исключено:
1. BollingerSwingStrategy - не для свингов
2. ATRSwingStrategy - не для свингов

### ➕ Добавлено:
1. FindPeaksSwingStrategy (приоритет 2)
2. PivotPointsSwingStrategy (приоритет 3)
3. NBarSwingStrategy (опционально)
4. FractalSwingStrategy (опционально)
5. VolatilityMetrics + VolatilityStrategy (новый тип метрик)

### ⚠️ Требуется обновить:
1. SwingMetrics dataclass: с 6 до 23 полей (+17 критичных полей)
2. Добавить метрики: длительность, скорость, распределение, счетчики

---

## Связь между документами

```
impl.md (план реализации)
    │
    ├─→ Раздел 6.3 (Фаза 3.1) ──┐
    │                            │
    └─→ Раздел 7.1.1 (спецификация SwingMetrics) ──┐
                                                    │
                                                    ↓
swing_strategies_analysis.md ──→ swing_detection_approaches.md
(первичный анализ, устарел)      (актуальный детальный анализ)
                                    │
                                    ├─→ Раздел 1: Оценка подходов
                                    ├─→ Раздел 2: Дополнительные подходы
                                    ├─→ Раздел 3: Таблица (5 подходят, 3 нет)
                                    ├─→ Раздел 4: Анализ полноты метрик
                                    ├─→ Раздел 5: Обновленный SwingMetrics
                                    └─→ Раздел 6: План действий
```

---

**Следующий шаг:** Реализация Фазы 3.1 согласно обновленному плану в `impl.md`, раздел 6.3.

